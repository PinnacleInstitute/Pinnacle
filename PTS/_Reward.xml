<WTROOT prefix="pts" system="Pinnacle">
	<WTENTITY id="152" name="Reward" alias="rew">

		<!--Identity-->
		<WTATTRIBUTE id="15201" name="RewardID" type="number" identity="true" min="1" title="true" required="true" source="entity"/>

    <!--Foreign Keys-->
		<WTATTRIBUTE id="15202" name="MerchantID" type="number" source="entity"/>
		<WTATTRIBUTE id="15203" name="ConsumerID" type="number" source="entity"/>
    <WTATTRIBUTE id="15204" name="Payment2ID" type="number" source="entity"/>
    <WTATTRIBUTE id="15205" name="AwardID" type="number" source="entity"/>

    <!--Foreign Table Fields-->
		<WTATTRIBUTE id="15206" name="NameFirst" type="text" length="30" source="join">
			<WTJOIN entity="Consumer" name="NameFirst"/>
		</WTATTRIBUTE>
		<WTATTRIBUTE id="15207" name="NameLast" type="text" length="30" source="join">
			<WTJOIN entity="Consumer" name="NameLast"/>
		</WTATTRIBUTE>
		<WTATTRIBUTE id="15208" name="ConsumerName" type="text" length="62" min="1" max="62" source="entity">
			<WTCOMPUTE name="NameFirst"/>
			<WTCOMPUTE text=" "/>
			<WTCOMPUTE name="NameLast"/>
		</WTATTRIBUTE>
    <WTATTRIBUTE id="15209" name="MerchantName" type="text" length="80" source="join">
      <WTJOIN entity="Merchant" name="MerchantName"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="15210" name="AwardName" type="text" length="100" source="join">
      <WTJOIN entity="Award" name="Description"/>
    </WTATTRIBUTE>

    <!--Attributes-->
		<WTATTRIBUTE id="15211" name="RewardDate" type="date" source="entity">
			<WTFORMAT value="m-d-yy h:mm am/pm"/>
		</WTATTRIBUTE>
		<WTATTRIBUTE id="15212" name="RewardType" type="number" source="entity">
			<WTENUM id="1" name="Cash"/>
			<WTENUM id="2" name="Points"/>
		</WTATTRIBUTE>
		<WTATTRIBUTE id="15213" name="Amount" type="big number" source="entity">
      <WTFORMAT value="##,###.00" convert="/100000000"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="15214" name="Points" type="currency" source="entity">
      <WTFORMAT value="##,###.00" convert="/100000000"/>
      <WTCOMPUTE name="Amount"/>
		</WTATTRIBUTE>
		<WTATTRIBUTE id="15215" name="Status" type="number" source="entity">
			<WTENUM id="1" name="Submitted"/>
			<WTENUM id="2" name="Pending"/>
      <WTENUM id="3" name="Approved"/>
      <WTENUM id="4" name="Hold"/>
    </WTATTRIBUTE>
		<WTATTRIBUTE id="15216" name="HoldDate" type="date" source="entity"/>
		<WTATTRIBUTE id="15217" name="Reference" type="text" length="15" min="1" max="15" source="entity"/>
		<WTATTRIBUTE id="15218" name="Note" type="text" length="100" min="1" max="100" source="entity"/>

		<WTINDEX name="MerchantID">
			<WTATTRIBUTE name="MerchantID"/>
			<WTATTRIBUTE name="ConsumerID"/>
		</WTINDEX>
		<WTINDEX name="MerchantDate">
			<WTATTRIBUTE name="MerchantID"/>
			<WTATTRIBUTE name="RewardDate"/>
		</WTINDEX>
		<WTINDEX name="ConsumerID">
			<WTATTRIBUTE name="ConsumerID"/>
			<WTATTRIBUTE name="MerchantID"/>
		</WTINDEX>
    <WTINDEX name="ConsumerDate">
      <WTATTRIBUTE name="ConsumerID"/>
      <WTATTRIBUTE name="RewardDate"/>
    </WTINDEX>
    <WTINDEX name="Payment2ID">
      <WTATTRIBUTE name="Payment2ID"/>
    </WTINDEX>

    <WTRELATIONSHIPS>
			<WTRELATIONSHIP name="Reward" entity="Reward" alias="rew"/>
			<WTRELATIONSHIP name="Common" entity="Reward" alias="rew">
				<WTENTITY name="Consumer" entity="Consumer" alias="csm">
					<WTATTRIBUTE alias="rew" name="ConsumerID" relalias="csm" relname="ConsumerID"/>
				</WTENTITY>
        <WTENTITY name="Merchant" entity="Merchant" alias="mer">
          <WTATTRIBUTE alias="rew" name="MerchantID" relalias="mer" relname="MerchantID"/>
        </WTENTITY>
        <WTENTITY name="Award" entity="Award" alias="awd">
          <WTATTRIBUTE alias="rew" name="AwardID" relalias="awd" relname="AwardID"/>
        </WTENTITY>
      </WTRELATIONSHIP>
		</WTRELATIONSHIPS>

		<WTENUM id="1" type="find">
			<WTATTRIBUTE name="RewardDate" default="true"/>
			<WTATTRIBUTE name="MerchantID"/>
			<WTATTRIBUTE name="ConsumerID"/>
		</WTENUM>

    <!-- System Constants -->
    <WTSYSCONS>
      <WTSYSCON name="ORDER-TYPE-CRYPTO" value="0"/>
      <WTSYSCON name="ORDER-TYPE-CASH" value="1"/>
      <WTSYSCON name="ORDER-TYPE-REDEEM" value="2"/>
      <WTSYSCON name="ORDER-TYPE-AWARD" value="3"/>
      <WTSYSCON name="ORDER-PROCESS-NEW" value="0"/>
      <WTSYSCON name="ORDER-PROCESS-ORDER" value="1"/>
      <WTSYSCON name="ORDER-PROCESS-PAYMENT" value="2"/>
      <WTSYSCON name="ORDER-PROCESS-CONFIRM" value="3"/>
    </WTSYSCONS>

  </WTENTITY>

	<WTPROCEDURES>
		<!--================================================================================================-->
		<WTPROCEDURE type="Add" name="Add" style="GenerateDataProc.xsl"/>
		<!--================================================================================================-->
		<WTPROCEDURE type="Delete" name="Delete" style="GenerateDataProc.xsl"/>
		<!--================================================================================================-->
		<WTPROCEDURE type="Fetch" name="Fetch" style="GenerateDataProc.xsl">
			<WTJOIN name="Common"/>
		</WTPROCEDURE>
    <!--================================================================================================-->
    <WTPROCEDURE type="Find" name="FindMerchant" style="GenerateDataProc.xsl">
      <WTBOOKMARK name=""/>
      <WTPARAM name="ATTR(MerchantID)" direction="input"/>
      <WTPARAM name="ATTR(RewardType)" direction="input"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTJOIN name="Common"/>
      <WTCONDITION expr="ATTR(Reward.MerchantID)" oper="equal" value="PARAM(MerchantID)" connector="and"/>
      <WTCONDITION expr="ATTR(Reward.RewardType)" oper="equal" value="PARAM(RewardType)" connector="and"/>
      <WTCONDITION expr="ATTR(Reward.Amount)" oper="greater" value="CONST(0)" connector="and"/>
    </WTPROCEDURE>
    <!--================================================================================================-->
    <WTPROCEDURE type="Find" name="FindMerchantRedeem" style="GenerateDataProc.xsl">
      <WTBOOKMARK name=""/>
      <WTPARAM name="ATTR(MerchantID)" direction="input"/>
      <WTPARAM name="ATTR(RewardType)" direction="input"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTJOIN name="Common"/>
      <WTCONDITION expr="ATTR(Reward.MerchantID)" oper="equal" value="PARAM(MerchantID)" connector="and"/>
      <WTCONDITION expr="ATTR(Reward.RewardType)" oper="equal" value="PARAM(RewardType)" connector="and"/>
      <WTCONDITION expr="ATTR(Reward.Amount)" oper="less" value="CONST(0)" connector="and"/>
    </WTPROCEDURE>
    <!--================================================================================================-->
    <WTPROCEDURE type="Find" name="FindConsumer" style="GenerateDataProc.xsl">
      <WTBOOKMARK name=""/>
      <WTPARAM name="ATTR(ConsumerID)" direction="input"/>
      <WTPARAM name="ATTR(RewardType)" direction="input"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTJOIN name="Common"/>
      <WTCONDITION expr="ATTR(Reward.ConsumerID)" oper="equal" value="PARAM(ConsumerID)" connector="and"/>
      <WTCONDITION expr="ATTR(Reward.RewardType)" oper="equal" value="PARAM(RewardType)" connector="and"/>
      <WTCONDITION expr="ATTR(Reward.Amount)" oper="greater" value="CONST(0)" connector="and"/>
    </WTPROCEDURE>
    <!--================================================================================================-->
    <WTPROCEDURE type="Find" name="FindConsumerRedeem" style="GenerateDataProc.xsl">
      <WTBOOKMARK name=""/>
      <WTPARAM name="ATTR(ConsumerID)" direction="input"/>
      <WTPARAM name="ATTR(RewardType)" direction="input"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTJOIN name="Common"/>
      <WTCONDITION expr="ATTR(Reward.ConsumerID)" oper="equal" value="PARAM(ConsumerID)" connector="and"/>
      <WTCONDITION expr="ATTR(Reward.RewardType)" oper="equal" value="PARAM(RewardType)" connector="and"/>
      <WTCONDITION expr="ATTR(Reward.Amount)" oper="less" value="CONST(0)" connector="and"/>
    </WTPROCEDURE>
    <!--================================================================================================-->
		<WTPROCEDURE type="List" name="ListCash" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
			<WTPARAM name="ATTR(ConsumerID)" direction="input"/>
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE value="ATTR(Reward.RewardID)"/>
					<WTATTRIBUTE value="ATTR(Merchant.MerchantName)"/>
					<WTATTRIBUTE value="ATTR(Reward.RewardDate)"/>
					<WTATTRIBUTE value="ATTR(Reward.RewardType)"/>
					<WTATTRIBUTE value="ATTR(Reward.Amount)"/>
					<WTATTRIBUTE value="ATTR(Reward.Status)"/>
					<WTATTRIBUTE value="ATTR(Reward.HoldDate)"/>
					<WTATTRIBUTE value="ATTR(Reward.Reference)"/>
					<WTATTRIBUTE value="ATTR(Reward.Note)"/>
					<WTJOIN name="Common" lock="false"/>
					<WTORDER name="ATTR(Reward.RewardDate)" descend="true"/>
				</WTSELECT>
			</WTCODEGROUP>
		</WTPROCEDURE>
		<!--================================================================================================-->
		<WTPROCEDURE type="List" name="ListPointsSummary" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
			<WTPARAM name="ATTR(ConsumerID)" direction="input"/>
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE value="ATTR(Reward.RewardID)"/>
					<WTATTRIBUTE value="ATTR(Reward.MerchantID)"/>
					<WTATTRIBUTE value="ATTR(Merchant.MerchantName)"/>
					<WTATTRIBUTE value="ATTR(Reward.Points)"/>
					<WTJOIN name="Common" lock="false"/>
					<WTORDER name="ATTR(Reward.Amount)" descend="true"/>
				</WTSELECT>
			</WTCODEGROUP>
		</WTPROCEDURE>
		<!--================================================================================================-->
		<WTPROCEDURE type="List" name="ListPointsDetail" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
			<WTPARAM name="ATTR(ConsumerID)" direction="input"/>
			<WTPARAM name="ATTR(MerchantID)" direction="input"/>
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE value="ATTR(Reward.RewardID)"/>
					<WTATTRIBUTE value="ATTR(Merchant.MerchantName)"/>
					<WTATTRIBUTE value="ATTR(Reward.RewardDate)"/>
					<WTATTRIBUTE value="ATTR(Reward.RewardType)"/>
					<WTATTRIBUTE value="ATTR(Reward.Points)"/>
					<WTATTRIBUTE value="ATTR(Reward.Status)"/>
					<WTATTRIBUTE value="ATTR(Reward.HoldDate)"/>
					<WTATTRIBUTE value="ATTR(Reward.Reference)"/>
					<WTATTRIBUTE value="ATTR(Reward.Note)"/>
					<WTJOIN name="Common" lock="false"/>
					<WTORDER name="ATTR(Reward.RewardDate)" descend="true"/>
				</WTSELECT>
			</WTCODEGROUP>
		</WTPROCEDURE>
		<!--==========================================================================================-->
		<WTPROCEDURE type="Update" name="Update" style="GenerateDataProc.xsl"/>
		<!--===================================================================================-->
		<WTPROCEDURE name="TotalReward" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
			<WTPARAM name="ATTR(ConsumerID)" direction="input"/>
			<WTPARAM name="ATTR(MerchantID)" direction="input" required="false"/>
			<WTPARAM name="Result" direction="output" datatype="currency"/>
		</WTPROCEDURE>
    <!--==========================================================================================-->
    <WTPROCEDURE name="PaymentRewards" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
      <WTPARAM name="ATTR(Payment2ID)" direction="input"/>
      <WTPARAM name="Result" direction="output" datatype="text" length="300"/>
    </WTPROCEDURE>
  </WTPROCEDURES>

	<WTWEBPAGES>
		<!--=============================================================================================-->
		<WTWEBPAGE name="m_15220" caption="Rewards" page-left="0" page-top="0" navbar="false" header="false" footer="false" wrapper="false"
			page-width="100%" margin-width="0%" navbar-width="0%" content-width="100%" viewport="width=device-width"
		   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl">
			<!--=============================================================================================-->
			<WTPARAM name="MerchantID" datatype="number"/>
			<WTPARAM name="C" datatype="number"/>			<!-- CompanyID -->
			<WTPARAM name="IsAwards" datatype="number"/>

			<WTINCLUDE name="Company.asp"/>

			<WTDATATXN name="Award2"/>

			<WTSETATTRIBUTE name="PARAM(C)" value="SYSCON(NEXXUS)">
				<WTCONDITION expr="PARAM(C)" oper="equal" value="CONST(0)"/>
			</WTSETATTRIBUTE>

			<WTACTION id="0" name="New" type="New">
				<WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
					<WTMETHOD name="Load">
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(IsAwards)" value="ATTR(IsAwards)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlMerchant" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Awards" project="ptsAwardUser" class="CAwards">
					<WTMETHOD name="ListAwards">
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
						<WTPARAM name="AwardType" direction="input" value="CONST(1)"/>
					</WTMETHOD>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlAwards" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(13)"/>
					</WTMETHOD>
					<WTMETHOD name="ListAwards">
						<WTCONDITION expr="PARAM(IsAwards)" oper="not-equal" value="CONST(0)"/>
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
						<WTPARAM name="AwardType" direction="input" value="CONST(2)"/>
					</WTMETHOD>
					<WTMETHOD name="XML">
						<WTCONDITION expr="PARAM(IsAwards)" oper="not-equal" value="CONST(0)"/>
						<WTPARAM name="xmlAward2" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(13)"/>
						<WTPARAM name="ElementName" direction="input" value="CONST(&quot;Award2&quot;)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTACTION>

			<!--*******************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="100%" align="center"/>

				<WTSTATIC label="GiveRewardTip"/>
				<WTSTATIC label="RedeemRewardTip"/>

				<WTROW margin-top="6">
					<WTTABLE col="1" valign="top">
						<WTCOLUMN width="50" align="center"/>
						<WTCOLUMN width="50" align="center"/>
						<WTROW>
							<WTIMAGE col="1" value="CONST(m_Contest.gif)" alt="GiveRewardTip">
								<WTLINK name="m_15202">
									<WTPARAM name="MerchantID" value="PARAM(MerchantID)"/>
								</WTLINK>
							</WTIMAGE>
							<WTIMAGE col="2" value="CONST(m_Money.gif)" alt="RedeemRewardTip">
								<WTLINK name="m_15204">
									<WTPARAM name="MerchantID" value="PARAM(MerchantID)"/>
								</WTLINK>
							</WTIMAGE>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" label="CollectReward" fontsize="3"/>
							<WTSTATIC col="2" label="RedeemReward" fontsize="3"/>
						</WTROW>
					</WTTABLE>
				</WTROW>

				<WTROW margin-top="12">
					<WTTABLE col="1" valign="top" padding="0" style="border:1px solid; border-radius:15px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #ffffff">
						<WTCOLUMN width="18" align="center"/>
						<WTCOLUMN width="77" align="left"/>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" merge="2" align="center">
								<WTCODEGROUP>
									<WTIMAGE value="CONST(money24.gif)" imgalign="absmiddle"/>
									<WTSTATIC space="1"/>
									<WTSTATIC label="RewardPoints" fontsize="3"/>
								</WTCODEGROUP>
							</WTSTATIC>
						</WTROW>
						<WTREPEAT entity="Award">
							<WTROW height="24">
								<WTSTATIC col="1" bold="true">
									<WTSTATIC value="DATA(Award.Amount)"/>
									<WTSTATIC label="%"/>
								</WTSTATIC>
								<WTSTATIC col="2" value="DATA(Award.Description)"/>
							</WTROW>
						</WTREPEAT>
					</WTTABLE>
				</WTROW>

				<WTROW margin-top="6">
					<WTCONDITION expr="PARAM(IsAwards)" oper="not-equal" value="CONST(0)"/>
					<WTTABLE col="1" valign="top" padding="0" style="border:1px solid; border-radius:15px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #ffffff">
						<WTCOLUMN width="18" align="center"/>
						<WTCOLUMN width="77" align="left"/>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" merge="2" align="center">
								<WTCODEGROUP>
									<WTIMAGE value="CONST(prize24.gif)" imgalign="absmiddle"/>
									<WTSTATIC space="1"/>
									<WTSTATIC label="AwardPoints" fontsize="3"/>
								</WTCODEGROUP>
							</WTSTATIC>
						</WTROW>
						<WTREPEAT entity="Award2">
							<WTROW height="24">
								<WTSTATIC col="1" value="DATA(Award.Amount)" bold="true"/>
								<WTSTATIC col="2" value="DATA(Award.Description)"/>
							</WTROW>
						</WTREPEAT>
						
					</WTTABLE>
				</WTROW>
			</WTCONTENT>
		</WTWEBPAGE>

		<!--============================================================================================-->
		<WTWEBPAGE name="15201" caption="FindReward" action="5" navbar="false" header="false" footer="false" wrapper="wrapper800"
		aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl">
			<!--============================================================================================-->
			<WTPARAM name="MerchantID" datatype="number"/>
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="RewardType" datatype="number"/>
      <WTPARAM name="Redeem" datatype="number"/>
      <WTPARAM name="SearchText" datatype="text"/>
			<WTPARAM name="FindTypeID" datatype="number"/>
			<WTPARAM name="Bookmark" datatype="text"/>
      <WTPARAM name="Direction" datatype="number"/>
      <WTPARAM name="Popup" datatype="number"/>

      <WTINCLUDE name="2FA.asp"/>

      <WTSETATTRIBUTE name="PARAM(FindTypeID)" value="FINDID(RewardDate)">
        <WTCONDITION expr="PARAM(FindTypeID)" oper="equal" value="CONST(0)"/>
      </WTSETATTRIBUTE>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
        <WTCODEGROUP><WTCALLSUB name="Check2FAMerchant reqMerchantID"/></WTCODEGROUP>
        <WTSETATTRIBUTE name="PARAM(RewardType)" value="CONST(1)">
          <WTCONDITION expr="PARAM(RewardType)" oper="equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
        <WTSETATTRIBUTE name="PARAM(Redeem)" value="CONST(1)">
          <WTCONDITION expr="PARAM(Redeem)" oper="equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(RewardType)" value="CONST(1)">
          <WTCONDITION expr="PARAM(RewardType)" oper="equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
        <WTSETATTRIBUTE name="PARAM(Redeem)" value="CONST(1)">
          <WTCONDITION expr="PARAM(Redeem)" oper="equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
      </WTCODEGROUP>

      <WTACTION id="0" name="New" type="New">
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
				<WTOBJECT name="Rewards" project="ptsRewardUser" class="CRewards">
					<WTSETATTRIBUTE name="CONST(.FindTypeID)" value="PARAM(FindTypeID)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlRewards" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(14)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark"/>
			</WTACTION>

			<WTACTION id="5" name="Find" type="New">
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTACTION id="6" name="Previous" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(2)"/>
			</WTACTION>

			<WTACTION id="7" name="Next" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTOBJECT name="Rewards" project="ptsRewardUser" class="CRewards">
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="FindMerchant">
            <WTCONDITION expr="PARAM(Redeem)" oper="equal" value="CONST(1)"/>
            <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
            <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
            <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
            <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
            <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
            <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
            <WTPARAM name="RewardType" direction="input" value="PARAM(RewardType)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="FindMerchantRedeem">
            <WTCONDITION expr="PARAM(Redeem)" oper="equal" value="CONST(2)"/>
            <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
            <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
            <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
            <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
            <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
            <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
            <WTPARAM name="RewardType" direction="input" value="PARAM(RewardType)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="FindConsumer">
            <WTCONDITION expr="PARAM(Redeem)" oper="equal" value="CONST(1)"/>
            <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
            <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
            <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
            <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
            <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="RewardType" direction="input" value="PARAM(RewardType)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="FindConsumerRedeem">
            <WTCONDITION expr="PARAM(Redeem)" oper="equal" value="CONST(2)"/>
            <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
            <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
            <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
            <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
            <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="RewardType" direction="input" value="PARAM(RewardType)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTCODEGROUP>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlRewards" direction="return" datatype="text"/>
					<WTPARAM name="Option" direction="input" value="CONST(15)"/>
				</WTMETHOD>
			</WTOBJECT>
			<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark">
				<WTSETATTRIBUTE name="ATTR(LastBookmark)" value="PARAM(Bookmark)"/>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlBookmark" direction="return" datatype="text"/>
				</WTMETHOD>
			</WTOBJECT>

			<!--**********************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="800" align="left"/>

        <WTFUNCTION name="SpecialAward()">
          var mid = document.getElementById('MerchantID').value;
          var url = "15205.asp?merchantid=" + mid
          var win = window.open(url)
        </WTFUNCTION>

        <WTROW>
          <WTHIDDEN value="PARAM(MerchantID)"/>
        </WTROW>

        <WTROW margin-bottom="12">
          <WTTABLE col="1">
            <WTCOLUMN width="400" align="left"/>
            <WTCOLUMN width="400" align="right"/>
            <WTROW>
              <WTSTATIC col="1" class="PageHeading">
                <WTSTATIC label="CashbackRewards">
                  <WTCONDITION expr="PARAM(RewardType)" oper="equal" value="CONST(1)"/>
                </WTSTATIC>
                <WTSTATIC label="SpecialAwards">
                  <WTCONDITION expr="PARAM(RewardType)" oper="equal" value="CONST(2)"/>
                </WTSTATIC>
              </WTSTATIC>
              <WTSTATIC col="2" class="PageHeader">
                <WTCODEGROUP>
                  <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
                  <WTBUTTON  value="CONST(GiveSpecialAward)" btnclass="smbutton">
                    <WTCLICK>SpecialAward()</WTCLICK>
                  </WTBUTTON>
                </WTCODEGROUP>
              </WTSTATIC>
            </WTROW>
          </WTTABLE>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" tag="SearchBy" class="ColumnHeader" align="center"/>
					<WTCOMBO col="1" value="ATTR(Rewards.FindTypeID)" translate="true">
						<WTOPTION id="15211" label="RewardDate"/>
						<WTOPTION id="15202" label="MerchantID">
							<WTCONDITION expr="PARAM(MerchantID)" oper="equal" value="CONST(0)"/>
						</WTOPTION>
						<WTOPTION id="15203" label="ConsumerID">
							<WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
						</WTOPTION>
					</WTCOMBO>
					<WTSTATIC col="1" tag="SearchFor" class="ColumnHeader"/>
					<WTTEXT col="1" value="ATTR(Bookmark.SearchText)" size="20" focus="true"/>
          <WTCOMBO col="1" value="PARAM(Redeem)">
            <WTOPTION id="1" label="Earned"/>
            <WTOPTION id="2" label="Redeemed"/>
          </WTCOMBO>
          <WTCOMBO col="1" value="PARAM(RewardType)">
            <WTOPTION id="1" label="CashbackRewards"/>
            <WTOPTION id="2" label="SpecialAwards"/>
          </WTCOMBO>
          <WTBUTTON col="1" action="5" value="CONST(View)" default="true"/>
          <WTBUTTON col="1" value="CONST(Close)">
            <WTCONDITION expr="PARAM(Popup)" oper="not-equal" value="CONST(0)"/>
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
          <WTBUTTON col="1" merge="2" value="CONST(Home)" align="center">
            <WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)"/>
            <WTCLICK>window.parent.ShowTab('TabDashboard',1)</WTCLICK>
          </WTBUTTON>
        </WTROW>

				<WTROW>
					<WTRECORDSET col="1" graybar="true" prevnext="top" entity="Reward">
						<WTCOLUMN width="15" align="left" valign="top" label="RewardDate"/>
						<WTCOLUMN width="15" align="left" valign="top" label="Amount"/>
            <WTCOLUMN width="30" align="left" valign="top" label="Name"/>
            <WTCOLUMN width="30" align="left" valign="top" label="AwardName"/>
            <WTCOLUMN width="10" align="left" valign="top" label="Status"/>
            <WTROW height="24">
              <WTSTATIC col="1" value="DATA(RewardDate)"/>
							<WTSTATIC col="2">
  							<WTSTATIC value="DATA(Amount)"/>
								<WTCODEGROUP>
                  <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
                  <WTSTATIC space="1"/>
									<WTIMAGE value="CONST(Edit.gif)" alt="Edit" imgalign="absmiddle">
										<WTLINK name="15203">
											<WTPARAM name="RewardID" value="DATA(RewardID)"/>
										</WTLINK>
									</WTIMAGE>
								</WTCODEGROUP>
							</WTSTATIC>
							<WTSTATIC col="3">
                <WTCODEGROUP>
                  <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
                  <WTSTATIC value="DATA(ConsumerName)" space="1"/>
                  <WTSTATIC value="CONST(#&lt;xsl:value-of select=&quot;@consumerid&quot;/&gt;)" fontcolor="purple"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="PARAM(MerchantID)" oper="equal" value="CONST(0)"/>
                  <WTSTATIC value="DATA(MerchantName)">
                    <WTCONDITION expr="DATA(MerchantID)" oper="not-equal" value="CONST(0)"/>
                  </WTSTATIC>
                  <WTSTATIC value="DATA(Note)">
                    <WTCONDITION expr="DATA(MerchantID)" oper="equal" value="CONST(0)"/>
                  </WTSTATIC>
                </WTCODEGROUP>
              </WTSTATIC>
              <WTSTATIC col="4">
                <WTCODEGROUP>
                  <WTCONDITION expr="DATA(RewardType)" oper="equal" value="CONST(1)"/>
                  <WTIMAGE value="CONST(NXC.gif)" imgalign="absmiddle"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="DATA(RewardType)" oper="equal" value="CONST(2)"/>
                  <WTIMAGE value="CONST(points.gif)" imgalign="absmiddle"/>
                </WTCODEGROUP>
                <WTSTATIC space="1"/>
                <WTSTATIC value="DATA(AwardName)"/>
                <WTCODEGROUP>
                  <WTCONDITION expr="DATA(Payment2ID)" oper="not-equal" value="CONST(0)"/>
                  <WTSTATIC space="1"/>
                  <WTSTATIC value="DATA(Payment2ID)" fontcolor="purple"/>
                </WTCODEGROUP>
              </WTSTATIC>
              <WTSTATIC col="5">
                <WTSTATIC value="DATA(Status)" fontcolor="green">
                  <WTCONDITION expr="DATA(Status)" oper="less-equal" value="CONST(1)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Status)" fontcolor="blue">
                  <WTCONDITION expr="DATA(Status)" oper="equal" value="CONST(2)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Status)">
                  <WTCONDITION expr="DATA(Status)" oper="equal" value="CONST(3)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Status)" fontcolor="orange">
                  <WTCONDITION expr="DATA(Status)" oper="greater" value="CONST(3)"/>
                </WTSTATIC>
              </WTSTATIC>
            </WTROW>
						<WTROW>
              <WTSTATIC col="1" value="DATA(Reference)" fontcolor="gray"/>
              <WTSTATIC col="2" merge="3" fontcolor="gray">
                <WTSTATIC value="DATA(Note)">
                  <WTCONDITION expr="DATA(MerchantID)" oper="not-equal" value="CONST(0)"/>
                </WTSTATIC>
              </WTSTATIC>
              <WTSTATIC col="5" value="DATA(HoldDate)" fontcolor="orange">
                <WTCONDITION expr="DATA(Status)" oper="greater" value="CONST(3)"/>
              </WTSTATIC>
            </WTROW>
					</WTRECORDSET>
				</WTROW>
<!--        
				<WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" value="CONST(Close)" align="center">
						<WTCLICK>window.close()</WTCLICK>
					</WTBUTTON>
				</WTROW>
-->
			</WTCONTENT>
		</WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="m_15201" caption="FindReward" page-left="3" page-top="0" navbar="false" header="false" footer="false"
      page-image="bg.jpg" page-width="100%" margin-width="0%" navbar-width="0%" content-width="100%" viewport="width=device-width"
      aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" focus="false" mobile="m_15201.asp" track="0">
    <!--============================================================================================-->
      <WTPARAM name="MerchantID" datatype="number"/>
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="RewardType" datatype="number"/>
      <WTPARAM name="Redeem" datatype="number"/>
      <WTPARAM name="SearchText" datatype="text"/>
      <WTPARAM name="FindTypeID" datatype="number"/>
      <WTPARAM name="Bookmark" datatype="text"/>
      <WTPARAM name="Direction" datatype="number"/>

      <WTSETATTRIBUTE name="PARAM(FindTypeID)" value="FINDID(RewardDate)">
        <WTCONDITION expr="PARAM(FindTypeID)" oper="equal" value="CONST(0)"/>
      </WTSETATTRIBUTE>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(RewardType)" value="CONST(1)">
          <WTCONDITION expr="PARAM(RewardType)" oper="equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
        <WTSETATTRIBUTE name="PARAM(Redeem)" value="CONST(1)">
          <WTCONDITION expr="PARAM(Redeem)" oper="equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(RewardType)" value="CONST(1)">
          <WTCONDITION expr="PARAM(RewardType)" oper="equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
        <WTSETATTRIBUTE name="PARAM(Redeem)" value="CONST(1)">
          <WTCONDITION expr="PARAM(Redeem)" oper="equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
      </WTCODEGROUP>

      <WTACTION id="0" name="New" type="New">
        <WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
        <WTOBJECT name="Rewards" project="ptsRewardUser" class="CRewards">
          <WTSETATTRIBUTE name="CONST(.FindTypeID)" value="PARAM(FindTypeID)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlRewards" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(14)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark"/>
      </WTACTION>

      <WTACTION id="5" name="Find" type="New">
        <WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
      </WTACTION>

      <WTACTION id="6" name="Previous" type="New">
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(2)"/>
      </WTACTION>

      <WTACTION id="7" name="Next" type="New">
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
      </WTACTION>

      <WTOBJECT name="Rewards" project="ptsRewardUser" class="CRewards">
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="FindMerchant">
            <WTCONDITION expr="PARAM(Redeem)" oper="equal" value="CONST(1)"/>
            <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
            <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
            <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
            <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
            <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
            <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
            <WTPARAM name="RewardType" direction="input" value="PARAM(RewardType)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="FindMerchantRedeem">
            <WTCONDITION expr="PARAM(Redeem)" oper="equal" value="CONST(2)"/>
            <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
            <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
            <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
            <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
            <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
            <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
            <WTPARAM name="RewardType" direction="input" value="PARAM(RewardType)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="FindConsumer">
            <WTCONDITION expr="PARAM(Redeem)" oper="equal" value="CONST(1)"/>
            <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
            <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
            <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
            <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
            <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="RewardType" direction="input" value="PARAM(RewardType)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="FindConsumerRedeem">
            <WTCONDITION expr="PARAM(Redeem)" oper="equal" value="CONST(2)"/>
            <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
            <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
            <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
            <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
            <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="RewardType" direction="input" value="PARAM(RewardType)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTCODEGROUP>
        <WTMETHOD name="XML">
          <WTPARAM name="xmlRewards" direction="return" datatype="text"/>
          <WTPARAM name="Option" direction="input" value="CONST(15)"/>
        </WTMETHOD>
      </WTOBJECT>
      <WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark">
        <WTSETATTRIBUTE name="ATTR(LastBookmark)" value="PARAM(Bookmark)"/>
        <WTMETHOD name="XML">
          <WTPARAM name="xmlBookmark" direction="return" datatype="text"/>
        </WTMETHOD>
      </WTOBJECT>

      <!--**********************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="100" align="center"/>

        <WTROW margin-bottom="12">
          <WTSTATIC col="1" class="PageHeading">
            <WTSTATIC label="CashbackRewards">
              <WTCONDITION expr="PARAM(RewardType)" oper="equal" value="CONST(1)"/>
            </WTSTATIC>
            <WTSTATIC label="SpecialAwards">
              <WTCONDITION expr="PARAM(RewardType)" oper="equal" value="CONST(2)"/>
            </WTSTATIC>
          </WTSTATIC>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" tag="SearchBy" class="ColumnHeader"/>
          <WTCOMBO col="1" value="ATTR(Rewards.FindTypeID)" translate="true">
            <WTOPTION id="15211" label="RewardDate"/>
            <WTOPTION id="15202" label="MerchantID">
              <WTCONDITION expr="PARAM(MerchantID)" oper="equal" value="CONST(0)"/>
            </WTOPTION>
            <WTOPTION id="15203" label="ConsumerID">
              <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
            </WTOPTION>
          </WTCOMBO>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTSTATIC col="1" tag="SearchFor" class="ColumnHeader"/>
          <WTTEXT col="1" value="ATTR(Bookmark.SearchText)" size="15" focus="true"/>
          <WTBUTTON col="1" action="5" value="CONST(View)" default="true"/>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTCOMBO col="1" value="PARAM(Redeem)">
            <WTOPTION id="1" label="Earned"/>
            <WTOPTION id="2" label="Redeemed"/>
          </WTCOMBO>
          <WTCOMBO col="1" value="PARAM(RewardType)">
            <WTOPTION id="1" label="CashbackRewards"/>
            <WTOPTION id="2" label="SpecialAwards"/>
          </WTCOMBO>
        </WTROW>

        <WTROW>
          <WTRECORDSET col="1" graybar="true" prevnext="top" entity="Reward">
            <WTCOLUMN width="100" align="left"/>
             <WTROW height="24">
              <WTSTATIC col="1">
                <WTCODEGROUP>
                  <WTCONDITION expr="DATA(RewardType)" oper="equal" value="CONST(1)"/>
                  <WTIMAGE value="CONST(NXC.gif)" imgalign="absmiddle"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="DATA(RewardType)" oper="equal" value="CONST(2)"/>
                  <WTIMAGE value="CONST(points.gif)" imgalign="absmiddle"/>
                </WTCODEGROUP>
                <WTSTATIC space="1"/>
                <WTSTATIC value="DATA(Amount)" space="2"/>
                <WTSTATIC value="DATA(RewardDate)" space="2"/>
                <WTSTATIC value="DATA(Status)" fontcolor="green">
                  <WTCONDITION expr="DATA(Status)" oper="less-equal" value="CONST(1)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Status)" fontcolor="blue">
                  <WTCONDITION expr="DATA(Status)" oper="equal" value="CONST(2)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Status)">
                  <WTCONDITION expr="DATA(Status)" oper="equal" value="CONST(3)"/>
                </WTSTATIC>
                <WTSTATIC fontcolor="orange">
                  <WTCONDITION expr="DATA(Status)" oper="greater" value="CONST(3)"/>
                  <WTSTATIC value="DATA(Status)" space="1"/>
                  <WTSTATIC value="DATA(HoldDate)"/>
                </WTSTATIC>
                <WTSTATIC fontcolor="gray">
                  <WTSTATIC space="2"/>
                  <WTSTATIC value="DATA(MerchantName)">
                    <WTCONDITION expr="DATA(MerchantID)" oper="not-equal" value="CONST(0)"/>
                  </WTSTATIC>
                  <WTSTATIC value="DATA(Note)">
                    <WTCONDITION expr="DATA(MerchantID)" oper="equal" value="CONST(0)"/>
                  </WTSTATIC>
                  <WTSTATIC space="2"/>
                  <WTSTATIC value="DATA(AwardName)"/>
                  <WTCODEGROUP>
                    <WTCONDITION expr="DATA(Reference)" oper="not-equal" value="CONST('')"/>
                    <WTSTATIC space="2"/>
                    <WTSTATIC value="DATA(Reference)"/>
                  </WTCODEGROUP>
                </WTSTATIC>
              </WTSTATIC>
             </WTROW>

          </WTRECORDSET>
        </WTROW>
      </WTCONTENT>
    </WTWEBPAGE>

    <!--============================================================================================-->
		<WTWEBPAGE name="15202" caption="Give Reward" header="false" footer="false" navbar="false" wrapper="wrapper600"
		 aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLAdd.xsl">
      <!--============================================================================================-->
			<WTPARAM name="MerchantID" datatype="number"/>
			<WTPARAM name="ConsumerID" datatype="number"/>
			<WTPARAM name="ConsumerName" datatype="text"/>
			<WTPARAM name="LogonConsumer" datatype="text"/>
			<WTPARAM name="AwardID" datatype="number"/>
			<WTPARAM name="Purchase" datatype="text"/>
			<WTPARAM name="Reward" datatype="currency"/>

			<WTSUB name="GetConsumerName">
				<WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Logon2">
						<WTPARAM name="Email" direction="input" value="PARAM(LogonConsumer)"/>
						<WTPARAM name="Result" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="greater" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(Result)"/>
						<WTMETHOD name="Load">
							<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
						<WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000002)"/>
						<WTERROR number="10129" message="Oops, The Email could not be found."/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000003)"/>
						<WTERROR number="10134" message="Oops, The Phone Number could not be found."/>
					</WTCODEGROUP>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="NewReward">
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="Load">
						<WTPARAM name="RewardID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(RewardDate)" value="SYS(Now)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlReward" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Awards" project="ptsAwardUser" class="CAwards">
					<WTMETHOD name="EnumMerchant">
						<WTPARAM name="xmlAwards" direction="return" concat="true" datatype="text" />
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)" />
						<WTPARAM name="AwardType" direction="input" value="CONST(1)" />
						<WTPARAM name="ItemID" direction="input" value="CONST()" />
						<WTPARAM name="Element" direction="input" value="CONST()" />
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="AddReward">
				<WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
					<WTMETHOD name="Load">
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(IsAwards)" value="ATTR(IsAwards)"/>
				</WTOBJECT>
				<WTOBJECT name="Award" project="ptsAwardUser" class="CAward">
					<WTMETHOD name="Load">
						<WTPARAM name="AwardID" direction="input" value="PARAM(AwardID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
          <WTSETATTRIBUTE name="CONST(AwardAmount)" value="ATTR(Amount)"/>
          <WTSETATTRIBUTE name="CONST(tmpCap)" value="ATTR(Cap)"/>
        </WTOBJECT>
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="Load">
						<WTPARAM name="RewardID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(MerchantID)" value="PARAM(MerchantID)"/>
					<WTSETATTRIBUTE name="ATTR(ConsumerID)" value="PARAM(ConsumerID)"/>
					<WTSETATTRIBUTE name="ATTR(Status)" value="CONST(1)"/>
					<WTSETATTRIBUTE name="ATTR(RewardType)" value="CONST(1)"/>
					<WTSETATTRIBUTES/>
					<WTSETATTRIBUTE name="CONST(Rate)" value="CONST(CCUR(AwardAmount) / 100)"/>
          <WTSETATTRIBUTE name="CONST(tmpAmount)" value="CONST(Round(reqPurchase * Rate,2))"/>
          <WTSETATTRIBUTE name="CONST(tmpNote)" value="CONST(CSTR(reqPurchase) + &quot; * &quot; + CSTR(Rate) + &quot;% &quot;)"/>
          <WTCOEDGROUP>
            <WTCONDITION expr="CONST(tmpCap)" oper="greater" value="CONST(0)"/>
            <WTSETATTRIBUTE name="CONST(tmpAmount)" value="CONST(tmpCap)">
              <WTCONDITION expr="CONST(tmpAmount)" oper="greater" value="CONST(tmpCap)"/>
            </WTSETATTRIBUTE>
            <WTSETATTRIBUTE name="CONST(tmpNote)" value="CONST(tmpNote + &quot;(&quot; + CSTR(tmpCap) + &quot;) &quot;)"/>
          </WTCOEDGROUP>
          <WTSETATTRIBUTE name="ATTR(Note)" value="CONST(tmpNote + .Note)"/>
          <WTSETATTRIBUTE name="ATTR(Amount)" value="CONST(toSatoshi( tmpAmount ))"/>
          <WTMETHOD name="Add">
						<WTPARAM name="RewardID" direction="return" datatype="number"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Reward)" value="CONST(FormatCurrency(tmpAmount))">
						<WTCONDITION expr="NoErrors"/>
					</WTSETATTRIBUTE>
					<WTMETHOD name="XML">
						<WTCONDITION expr="IsErrors"/>
						<WTPARAM name="xmlReward" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
					<WTOBJECT name="Awards" project="ptsAwardUser" class="CAwards">
						<WTCONDITION expr="IsErrors"/>
						<WTMETHOD name="EnumMerchant">
							<WTPARAM name="xmlAwards" direction="return" concat="true" datatype="text" />
							<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)" />
							<WTPARAM name="AwardType" direction="input" value="CONST(1)" />
							<WTPARAM name="ItemID" direction="input" value="CONST()" />
							<WTPARAM name="Element" direction="input" value="CONST()" />
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
						</WTMETHOD>
					</WTOBJECT>
					<WTCODEGROUP>
						<WTCONDITION expr="NoErrors"/>
						<WTCONDITION expr="CONST(IsAwards)" oper="not-equal" value="CONST(0)" connector="and"/>
						<WTSETATTRIBUTE name="ATTR(RewardType)" value="CONST(2)"/>
						<WTMETHOD name="Add">
							<WTPARAM name="RewardID" direction="return" datatype="number"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
					</WTCODEGROUP>
				</WTOBJECT>
			</WTSUB>

			<WTACTION id="0" name="New" type="New">
			</WTACTION>

			<WTACTION id="1" name="Consumer" type="New">
				<WTCALLSUB name="GetConsumerName"/>
				<WTCALLSUB name="NewReward">
					<WTCONDITION expr="PARAM(ConsumerName)" oper="not-equal" value="CONST(&quot;&quot;)"/>
				</WTCALLSUB>
			</WTACTION>

			<WTACTION id="2" name="Add" type="Add">
				<WTCALLSUB name="AddReward"/>
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="4" name="NotConsumer" type="New">
				<WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(0)"/>
			</WTACTION>

			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="100" align="right"/>
				<WTCOLUMN width="500" align="left"/>

				<!-- Convert input to digits only if no @ sign for an email -->
				<WTFUNCTION name="LogonDigitsOnly(obj)">
					var val = obj.value;
					if(val.indexOf('@') === -1)	{
					obj.value = val.replace(/\D/g,'');
					}
				</WTFUNCTION>

				<WTROW>
					<WTHIDDEN value="PARAM(MerchantID)"/>
					<WTHIDDEN value="PARAM(ConsumerID)"/>
					<WTHIDDEN value="PARAM(ConsumerName)"/>
				</WTROW>

				<WTROW>
					<WTSTATIC col="1" merge="2" label="NewReward" class="PageHeading" align="left"/>
				</WTROW>
				<WTROW margin-bottom="3">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(ConsumerName)" oper="equal" value="CONST('')"/>

					<WTROW margin-top="12" margin-bottom="12">
						<WTTABLE col="1" merge="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
							<WTCOLUMN width="200" align="right"/>
							<WTCOLUMN width="200" align="left"/>
							<WTROW>
								<WTSTATIC col="1" merge="2" label="WhoConsumer" align="center" fontsize="4"/>
							</WTROW>
							<WTROW margin-top="12">
								<WTSTATIC col="1" tag="LogonConsumer" align="right"/>
								<WTTEXT col="2" value="PARAM(LogonConsumer)" align="left" size="20">
									<WTEXIT>LogonDigitsOnly(this);</WTEXIT>
								</WTTEXT>
							</WTROW>
							<WTROW margin-top="12" margin-bottom="12">
								<WTBUTTON col="1" merge="2" action="1" value="CONST(Continue)" align="center" btnclass="bigbutton"/>
								<WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)" btnclass="bigbutton"/>
							</WTROW>
						</WTTABLE>
					</WTROW>
				</WTCODEGROUP>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Reward)" oper="equal" value="CONST('')"/>

					<WTCODEGROUP>
						<WTCONDITION expr="PARAM(ConsumerName)" oper="not-equal" value="CONST('')"/>

						<WTROW margin-top="12" margin-bottom="12">
							<WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
								<WTSTATIC tag="ConsumerName"/>
								<WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
								<WTCODEGROUP>
									<WTBUTTON action="4" value="CONST(Change)" btnclass="smbutton"/>
								</WTCODEGROUP>
							</WTSTATIC>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="RewardDate"/>
							<WTTEXT col="2" value="ATTR(Reward.RewardDate)" size="15"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="RewardType"/>
							<WTCOMBO col="2" value="PARAM(AwardID)" datapath="/DATA/TXN/PTSAWARDS/ENUM" setselected="true"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="Purchase"/>
							<WTTEXT col="2" value="PARAM(Purchase)"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="Reference"/>
							<WTTEXT col="2" value="ATTR(Reward.Reference)"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="Note"/>
							<WTMEMO col="2" value="ATTR(Reward.Note)" rows="2" cols="50"/>
						</WTROW>

						<WTROW margin-top="12" margin-bottom="12">
							<WTBUTTON col="1" merge="2" action="2" value="CONST(Add)" align="center" btnclass="bigbutton"/>
							<WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)"/>
						</WTROW>
					</WTCODEGROUP>
				</WTCODEGROUP>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Reward)" oper="not-equal" value="CONST('')"/>
					<WTROW margin-top="12">
						<WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
							<WTSTATIC tag="ConsumerName"/>
							<WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-top="12" margin-bottom="12">
						<WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="green">
							<WTSTATIC tag="Reward"/>
							<WTSTATIC value="PARAM(Reward)" bold="true"/>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-bottom="12">
						<WTBUTTON col="1" merge="2" action="3" value="CONST(Continue)" btnclass="bigbutton" align="center"/>
					</WTROW>
				</WTCODEGROUP>

			</WTCONTENT>
		</WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="15205" caption="Special Award" header="false" footer="false" navbar="false" wrapper="wrapper600"
		 aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLAdd.xsl">
      <!--============================================================================================-->
      <WTPARAM name="MerchantID" datatype="number"/>
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="ShopperID" datatype="text"/>
      <WTPARAM name="ConsumerName" datatype="text"/>
      <WTPARAM name="Amount" datatype="text"/>
      <WTPARAM name="Logon" datatype="text"/>
      <WTPARAM name="Reference" datatype="text"/>
      <WTPARAM name="Note" datatype="text"/>
      <WTPARAM name="Step" datatype="number"/>

      <WTSUB name="GetConsumerName">
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(ShopperID)" oper="not-equal" value="CONST(&quot;&quot;)"/>
            <WTSETATTRIBUTE name="CONST(Result)" value="PARAM(ShopperID)"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(ShopperID)" oper="equal" value="CONST(&quot;&quot;)"/>
            <WTMETHOD name="Logon2">
              <WTPARAM name="Email" direction="input" value="PARAM(Logon)"/>
              <WTPARAM name="Result" direction="return" datatype="number"/>
            </WTMETHOD>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="greater" value="CONST(0)"/>
            <WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(Result)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(NameFirst)" oper="not-equal" value="CONST(&quot;&quot;)"/>
              <WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
            </WTCODEGROUP>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(NameFirst)" oper="equal" value="CONST(&quot;&quot;)"/>
              <WTERROR number="10154" message="Oops, The Shopper could not be found."/>
            </WTCODEGROUP>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000002)"/>
            <WTERROR number="10129" message="Oops, The Email could not be found."/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000003)"/>
            <WTERROR number="10134" message="Oops, The Phone Number could not be found."/>
          </WTCODEGROUP>
        </WTOBJECT>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="GiveReward">
        <WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
          <WTMETHOD name="Load">
            <WTPARAM name="RewardID" direction="input" value="CONST(0)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(MerchantID)" value="PARAM(MerchantID)"/>
          <WTSETATTRIBUTE name="ATTR(ConsumerID)" value="PARAM(ConsumerID)"/>
          <WTSETATTRIBUTE name="ATTR(Payment2ID)" value="CONST(0)"/>
          <WTSETATTRIBUTE name="ATTR(AwardID)" value="CONST(0)"/>
          <WTSETATTRIBUTE name="ATTR(RewardType)" value="CONST(2)"/>
          <WTSETATTRIBUTE name="ATTR(Status)" value="CONST(3)"/>
          <WTSETATTRIBUTE name="ATTR(RewardDate)" value="SYS(Now)"/>
          <WTSETATTRIBUTE name="ATTR(HoldDate)" value="CONST(0)"/>
          <WTSETATTRIBUTE name="ATTR(Reference)" value="PARAM(Reference)"/>
          <WTSETATTRIBUTE name="ATTR(Note)" value="PARAM(Note)"/>
          <WTSETATTRIBUTE name="ATTR(Amount)" value="CONST( toSatoshi(reqAmount) )"/>
          <WTMETHOD name="Add">
            <WTPARAM name="RewardID" direction="return" datatype="number"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTSETATTRIBUTE name="PARAM(Step)" value="CONST(0)"/>
      </WTACTION>

      <WTACTION id="1" name="Consumer" type="New">
        <WTCALLSUB name="GetConsumerName"/>
        <WTSETATTRIBUTE name="PARAM(Step)" value="CONST(1)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
      </WTACTION>

      <WTACTION id="2" name="Add" type="Add">
        <WTCALLSUB name="GiveReward"/>
        <WTSETATTRIBUTE name="PARAM(Step)" value="CONST(2)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="600" align="center"/>

        <!-- Convert input to digits only if no @ sign for an email -->
        <WTFUNCTION name="LogonDigitsOnly(obj)">
          var val = obj.value;
          if(val.indexOf('@') === -1)	{
          obj.value = val.replace(/\D/g,'');
          }
        </WTFUNCTION>

        <WTROW>
          <WTHIDDEN value="PARAM(MerchantID)"/>
          <WTHIDDEN value="PARAM(ConsumerID)"/>
          <WTHIDDEN value="PARAM(ConsumerName)"/>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" label="GiveSpecialAward" class="PageHeading" align="center"/>
        </WTROW>

        <!-- *******************-->
        <!-- GET THE RECIPIENT  -->
        <!-- *******************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Step)" oper="equal" value="CONST(0)"/>
          <WTROW margin-top="12" margin-bottom="12">
            <WTTABLE col="1" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
              <WTCOLUMN width="550" align="center"/>
              <WTROW>
                <WTSTATIC col="1" label="WhoConsumer" align="center" fontsize="4"/>
              </WTROW>
              <WTROW margin-top="12">
                <WTSTATIC col="1" tag="TansferRecipient"/>
                <WTTEXT col="1" value="PARAM(Logon)" align="left" size="20">
                  <WTEXIT>LogonDigitsOnly(this);</WTEXIT>
                </WTTEXT>
              </WTROW>
              <WTROW margin-top="12">
                <WTSTATIC col="1" tag="TansferShopperID"/>
                <WTTEXT col="1" value="PARAM(ShopperID)" align="left" size="5">
                  <WTEXIT>LogonDigitsOnly(this);</WTEXIT>
                </WTTEXT>
              </WTROW>
              <WTROW margin-top="12">
                <WTBUTTON col="1" action="1" value="CONST(Continue)" align="center" btnclass="hugebutton"/>
                <WTBUTTON col="1" value="CONST(Close)" align="center">
                  <WTCLICK>window.close()</WTCLICK>
                </WTBUTTON>
              </WTROW>
            </WTTABLE>
          </WTROW>
        </WTCODEGROUP>

        <!-- ******************************-->
        <!-- GET THE SPECIAL AWARD AMOUNT  -->
        <!-- ******************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Step)" oper="equal" value="CONST(1)"/>

          <WTROW margin-top="12" margin-bottom="6">
            <WTSTATIC col="1" value="PARAM(ConsumerName)" align="center" fontsize="3" fontcolor="blue" bold="true"/>
            <WTBUTTON col="1" action="0" value="CONST(Change)" btnclass="smbutton"/>
          </WTROW>
          <WTROW margin-top="6" margin-bottom="6">
            <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
          </WTROW>

          <WTROW margin-bottom="6">
            <WTSTATIC col="1" tag="SpecialAwardPoints" fontsize="3"/>
            <WTTEXT col="1" value="PARAM(Amount)" size="10" prespace="false"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" tag="Reference" fontsize="3"/>
            <WTTEXT col="1" value="PARAM(Reference)" size="20" prespace="false"/>
          </WTROW>
          <WTROW>
            <WTSTATIC col="1" tag="SpecialAwardNote" valign="top" fontsize="3"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTMEMO col="1" value="PARAM(Note)" cols="40" rows="2" prespace="false"/>
          </WTROW>

          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" action="2" value="CONST(GiveSpecialAward)" align="center" btnclass="bigbutton"/>
            <WTBUTTON col="1" value="CONST(Close)" align="center">
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
          </WTROW>

        </WTCODEGROUP>

        <!-- **************************-->
        <!-- CONFIRM THE SEPCIAL AWARD -->
        <!-- **************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Step)" oper="equal" value="CONST(2)"/>
          <WTROW margin-top="12" margin-bottom="12">
            <WTSTATIC col="1" value="PARAM(ConsumerName)" bold="true" align="center" fontsize="3"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" label="SuccessfulSpecialAward" align="center" fontsize="4" fontcolor="blue"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" value="PARAM(Amount)" fontsize="4" space="1" bold="true"/>
            <WTSTATIC col="1" label="SpecialAwardPoints" fontsize="3"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="Reference" fontsize="3"/>
            <WTSTATIC col="1" value="PARAM(Reference)" fontsize="3" bold="true" prespace="false"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="Note" fontsize="3"/>
            <WTSTATIC col="1" value="PARAM(Note)" fontsize="3" bold="true" prespace="false"/>
          </WTROW>
          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" value="CONST(Close)" align="center">
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--============================================================================================-->
		<WTWEBPAGE name="m_15202" caption="Give Reward" page-left="0" page-top="0" navbar="false" header="false" footer="false" wrapper="false"
			page-width="100%" margin-width="0" navbar-width="0" content-width="100%" viewport="width=device-width"
		   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLAdd.xsl">
			<!--============================================================================================-->
			<WTPARAM name="MerchantID" datatype="number"/>
			<WTPARAM name="ConsumerID" datatype="number"/>
			<WTPARAM name="ConsumerName" datatype="text"/>
			<WTPARAM name="LogonConsumer" datatype="text"/>
			<WTPARAM name="AwardID" datatype="number"/>
			<WTPARAM name="Purchase" datatype="text"/>
			<WTPARAM name="Reward" datatype="currency"/>

			<WTSUB name="GetConsumerName">
				<WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Logon2">
						<WTPARAM name="Email" direction="input" value="PARAM(LogonConsumer)"/>
						<WTPARAM name="Result" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="greater" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(Result)"/>
						<WTMETHOD name="Load">
							<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
						<WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000002)"/>
						<WTERROR number="10129" message="Oops, The Email could not be found."/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000003)"/>
						<WTERROR number="10134" message="Oops, The Phone Number could not be found."/>
					</WTCODEGROUP>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="NewReward">
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="Load">
						<WTPARAM name="RewardID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(RewardDate)" value="SYS(Now)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlReward" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Awards" project="ptsAwardUser" class="CAwards">
					<WTMETHOD name="EnumMerchant">
						<WTPARAM name="xmlAwards" direction="return" concat="true" datatype="text" />
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)" />
						<WTPARAM name="AwardType" direction="input" value="CONST(1)" />
						<WTPARAM name="ItemID" direction="input" value="CONST()" />
						<WTPARAM name="Element" direction="input" value="CONST()" />
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="AddReward">
				<WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
					<WTMETHOD name="Load">
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(IsAwards)" value="ATTR(IsAwards)"/>
				</WTOBJECT>
				<WTOBJECT name="Award" project="ptsAwardUser" class="CAward">
					<WTMETHOD name="Load">
						<WTPARAM name="AwardID" direction="input" value="PARAM(AwardID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(AwardAmount)" value="ATTR(Amount)"/>
          <WTSETATTRIBUTE name="CONST(tmpCap)" value="ATTR(Cap)"/>
        </WTOBJECT>
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="Load">
						<WTPARAM name="RewardID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(MerchantID)" value="PARAM(MerchantID)"/>
					<WTSETATTRIBUTE name="ATTR(ConsumerID)" value="PARAM(ConsumerID)"/>
					<WTSETATTRIBUTE name="ATTR(Status)" value="CONST(1)"/>
					<WTSETATTRIBUTE name="ATTR(RewardType)" value="CONST(1)"/>
					<WTSETATTRIBUTES/>
					<WTSETATTRIBUTE name="CONST(Rate)" value="CONST(CCUR(AwardAmount) / 100)"/>
					<WTSETATTRIBUTE name="CONST(tmpAmount)" value="CONST(Round(reqPurchase * Rate,2))"/>
          <WTSETATTRIBUTE name="CONST(tmpNote)" value="CONST(CSTR(reqPurchase) + &quot; * &quot; + CSTR(Rate) + &quot;% &quot;)"/>
          <WTCOEDGROUP>
            <WTCONDITION expr="CONST(tmpCap)" oper="greater" value="CONST(0)"/>
            <WTSETATTRIBUTE name="CONST(tmpAmount)" value="CONST(tmpCap)">
              <WTCONDITION expr="CONST(tmpAmount)" oper="greater" value="CONST(tmpCap)"/>
            </WTSETATTRIBUTE>
            <WTSETATTRIBUTE name="CONST(tmpNote)" value="CONST(tmpNote + &quot;(&quot; + CSTR(tmpCap) + &quot;) &quot;)"/>
          </WTCOEDGROUP>
          <WTSETATTRIBUTE name="ATTR(Note)" value="CONST(tmpNote + .Note)"/>
          <WTSETATTRIBUTE name="ATTR(Amount)" value="CONST(toSatoshi( tmpAmount ))"/>
          <WTMETHOD name="Add">
						<WTPARAM name="RewardID" direction="return" datatype="number"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Reward)" value="CONST(FormatCurrency(tmpAmount))">
						<WTCONDITION expr="NoErrors"/>
					</WTSETATTRIBUTE>
					<WTMETHOD name="XML">
						<WTCONDITION expr="IsErrors"/>
						<WTPARAM name="xmlReward" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
					<WTOBJECT name="Awards" project="ptsAwardUser" class="CAwards">
						<WTCONDITION expr="IsErrors"/>
						<WTMETHOD name="EnumMerchant">
							<WTPARAM name="xmlAwards" direction="return" concat="true" datatype="text" />
							<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)" />
							<WTPARAM name="AwardType" direction="input" value="CONST(1)" />
							<WTPARAM name="ItemID" direction="input" value="CONST()" />
							<WTPARAM name="Element" direction="input" value="CONST()" />
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
						</WTMETHOD>
					</WTOBJECT>
					<WTCODEGROUP>
						<WTCONDITION expr="NoErrors"/>
						<WTCONDITION expr="CONST(IsAwards)" oper="not-equal" value="CONST(0)" connector="and"/>
						<WTSETATTRIBUTE name="ATTR(RewardType)" value="CONST(2)"/>
						<WTMETHOD name="Add">
							<WTPARAM name="RewardID" direction="return" datatype="number"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
					</WTCODEGROUP>
				</WTOBJECT>
			</WTSUB>

			<WTACTION id="0" name="New" type="New">
			</WTACTION>

			<WTACTION id="1" name="Consumer" type="New">
				<WTCALLSUB name="GetConsumerName"/>
				<WTCALLSUB name="NewReward">
					<WTCONDITION expr="PARAM(ConsumerName)" oper="not-equal" value="CONST(&quot;&quot;)"/>
				</WTCALLSUB>
			</WTACTION>

			<WTACTION id="2" name="Add" type="Add">
				<WTCALLSUB name="AddReward"/>
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="4" name="NotConsumer" type="New">
				<WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(0)"/>
			</WTACTION>

			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="25" align="right"/>
				<WTCOLUMN width="75" align="left"/>

				<!-- Convert input to digits only if no @ sign for an email -->
				<WTFUNCTION name="LogonDigitsOnly(obj)">
					var val = obj.value;
					if(val.indexOf('@') === -1)	{
					obj.value = val.replace(/\D/g,'');
					}
				</WTFUNCTION>

				<WTROW>
					<WTHIDDEN value="PARAM(MerchantID)"/>
					<WTHIDDEN value="PARAM(ConsumerID)"/>
					<WTHIDDEN value="PARAM(ConsumerName)"/>
				</WTROW>

				<WTROW>
					<WTSTATIC col="1" merge="2" label="NewReward" class="PageHeading" align="left"/>
				</WTROW>
				<WTROW margin-bottom="3">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(ConsumerName)" oper="equal" value="CONST('')"/>

					<WTROW margin-top="12" margin-bottom="12">
						<WTTABLE col="1" merge="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:5px; BACKGROUND-COLOR: #d1fa99">
							<WTCOLUMN width="50" align="right"/>
							<WTCOLUMN width="50" align="left"/>
							<WTROW>
								<WTSTATIC col="1" merge="2" label="WhoConsumer" align="center" fontsize="4"/>
							</WTROW>
							<WTROW margin-top="12">
								<WTSTATIC col="1" merge="2" tag="LogonConsumer" align="center"/>
							</WTROW>
							<WTROW>
								<WTTEXT col="1" merge="2" value="PARAM(LogonConsumer)" align="center" size="20" textclass="bigtext">
									<WTEXIT>LogonDigitsOnly(this);</WTEXIT>
								</WTTEXT>
							</WTROW>
							<WTROW margin-top="12" margin-bottom="12">
								<WTBUTTON col="1" merge="2" action="1" value="CONST(Continue)" align="center" btnclass="bigbutton"/>
								<WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)" btnclass="bigbutton"/>
							</WTROW>
						</WTTABLE>
					</WTROW>
				</WTCODEGROUP>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Reward)" oper="equal" value="CONST('')"/>

					<WTCODEGROUP>
						<WTCONDITION expr="PARAM(ConsumerName)" oper="not-equal" value="CONST('')"/>

						<WTROW margin-top="12" margin-bottom="12">
							<WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
								<WTSTATIC tag="ConsumerName"/>
								<WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
								<WTCODEGROUP>
									<WTBUTTON action="4" value="CONST(Change)" btnclass="smbutton"/>
								</WTCODEGROUP>
							</WTSTATIC>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="RewardDate"/>
							<WTTEXT col="2" value="ATTR(Reward.RewardDate)" size="13" textclass="bigtext"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="RewardType"/>
							<WTCOMBO col="2" value="PARAM(AwardID)" datapath="/DATA/TXN/PTSAWARDS/ENUM" setselected="true" comboclass="bigtext"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="Purchase"/>
							<WTTEXT col="2" value="PARAM(Purchase)" size="13" textclass="bigtext"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="Reference"/>
							<WTTEXT col="2" value="ATTR(Reward.Reference)" size="13" textclass="bigtext"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" merge="2" tag="Note" align="left"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTMEMO col="1" merge="2" value="ATTR(Reward.Note)" rows="2" cols="35" align="left"/>
						</WTROW>

						<WTROW margin-top="12" margin-bottom="12">
							<WTBUTTON col="1" merge="2" action="2" value="CONST(Add)" align="center" btnclass="bigbutton"/>
							<WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)" btnclass="bigbutton"/>
						</WTROW>
					</WTCODEGROUP>
				</WTCODEGROUP>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Reward)" oper="not-equal" value="CONST('')"/>
					<WTROW margin-top="12">
						<WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
							<WTSTATIC tag="ConsumerName"/>
							<WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-top="12" margin-bottom="12">
						<WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="green">
							<WTSTATIC tag="Reward"/>
							<WTSTATIC value="PARAM(Reward)" bold="true"/>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-bottom="12">
						<WTBUTTON col="1" merge="2" action="3" value="CONST(Continue)" btnclass="bigbutton" align="center"/>
					</WTROW>
				</WTCODEGROUP>

			</WTCONTENT>
		</WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="15212" caption="New Order" header="false" footer="false" navbar="false" wrapper="wrapper600"
		 aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLAdd.xsl">
      <!--============================================================================================-->
      <WTPARAM name="MerchantID" datatype="number"/>
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="CompanyID" datatype="number"/>
      <WTPARAM name="ConsumerName" datatype="text"/>
      <WTPARAM name="LogonConsumer" datatype="text"/>
      <WTPARAM name="AwardID" datatype="number"/>
      <WTPARAM name="TotalAmount" datatype="text"/>
      <WTPARAM name="NetAmount" datatype="text"/>
      <WTPARAM name="PayDate" datatype="date"/>
      <WTPARAM name="PayType" datatype="number"/>
      <WTPARAM name="CoinType" datatype="number"/>
      <WTPARAM name="Description" datatype="text"/>
      <WTPARAM name="Notes" datatype="text"/>
      <WTPARAM name="OrderType" datatype="number"/>
      <WTPARAM name="OrderProcess" datatype="number"/>
      <WTPARAM name="Payment2ID" datatype="number"/>
      <WTPARAM name="Popup" datatype="number"/>
      <WTPARAM name="User2FA" datatype="number"/>

      <WTPARAM name="Reward" datatype="currency"/>
      <WTPARAM name="Award" datatype="currency"/>
      <WTPARAM name="Redeem" datatype="currency"/>
      <WTPARAM name="TotalReward" datatype="currency"/>
      <WTPARAM name="TotalAward" datatype="currency"/>

      <WTPARAM name="IsAwards" datatype="number"/>
      <WTPARAM name="IsPin" datatype="number"/>
      <WTPARAM name="IsTicket" datatype="number"/>
      <WTPARAM name="IsApprove" datatype="number"/>
      <WTPARAM name="IsShopperOrder" datatype="number"/>
      <WTPARAM name="PinNumber" datatype="text"/>
      <WTPARAM name="TicketNumber" datatype="text"/>
      <WTPARAM name="MerchantName" datatype="text"/>
      <WTPARAM name="StaffID" datatype="number"/>
      <WTPARAM name="StaffName" datatype="text"/>
      <WTPARAM name="AcceptedCoins" datatype="text"/>
      <WTPARAM name="Terms" datatype="text"/>
      <WTPARAM name="CurrencyCode" datatype="text"/>
      <WTPARAM name="PendingOrders" datatype="number"/>

      <WTPARAM name="CoinPrice" datatype="text"/>
      <WTPARAM name="BTC" datatype="currency"/>
      <WTPARAM name="NXC" datatype="currency"/>
      <WTPARAM name="RewardPoints" datatype="currency"/>
      <WTPARAM name="RewardValue" datatype="currency"/>
      <WTPARAM name="RewardValueRaw" datatype="currency"/>

      <WTPARAM name="RedeemPswd" datatype="text"/>
      <WTPARAM name="QR_Name" datatype="text"/>
      <WTPARAM name="QR_URL" datatype="text"/>
      <WTPARAM name="QR_Address" datatype="text"/>
      <WTPARAM name="QR_Amount" datatype="currency"/>
      <WTPARAM name="QR_Label" datatype="text"/>
      <WTPARAM name="QR_Msg" datatype="text"/>
      <WTPARAM name="CoinToken" datatype="text"/>
      <WTPARAM name="ReplaceURL" datatype="text"/>

      <WTPARAM name="CryptoStatus" datatype="text"/>
      <WTPARAM name="IsDemo" datatype="number"/>

      <WTINCLUDE name="LimitedAccess.asp"/>
      <WTINCLUDE name="Coins.asp"/>
      <WTINCLUDE name="2FA.asp"/>
      <WTINCLUDE name="Comm.asp"/>
      <WTINCLUDE name="RewardOrder.asp"/>

      <WTJAVASCRIPT name="AJAX.js"/>
      <WTJAVASCRIPT name="clipboard.min.js"/>
      <WTJAVASCRIPT name="RewardOrder.js"/>

      <WTDATATXN name="Awards"/>

      <!-- ************************************ -->
      <!-- OrderProcess: 0 - New Shopper        -->
      <!-- OrderProcess: 1 - Get Order Info     -->
      <!-- OrderProcess: 2 - Get Crypto Payment -->
      <!-- OrderProcess: 3 - Confirm Order      -->
      <!-- OrderType: 0 - Crypto                -->
      <!-- OrderType: 1 - Cash                  -->
      <!-- OrderType: 2 - Redeem Rewards        -->
      <!-- OrderType: 3 - Redeem Awards         -->
      <!-- ************************************ -->

      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(CompanyID)" value="SYSCON(NEXXUS)"/>
      </WTCODEGROUP>

      <WTCODEGROUP>
        <WTCONDITION expr="NotEmployee"/>
        <WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
        <WTCONDITION expr="NotOrgManagerOnly" connector="and"/>
        <WTGETCACHE name="CONST(SysMerchantID)" value="MERCHANT" datatype="number"/>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(SysMerchantID)"/>
          <WTCUSTOM>AbortUser()</WTCUSTOM>
        </WTCODEGROUP>
      </WTCODEGROUP>
<!-- TEMPORARILY ENABLE 2FA -->      
      <WTCODEGROUP>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(1)"/>
      </WTCODEGROUP>
      <!--      
      <WTCODEGROUP>
        <WTCONDITION expr="NotEmployee"/>
				<WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
				<WTCONDITION expr="NotOrgManagerOnly" connector="and"/>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(Is2FAMerchant(reqMerchantID))"/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="IsEmployee"/>
				<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
				<WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(1)"/>
      </WTCODEGROUP>
-->
      <!-- **************************************************************************************************-->
      <WTSUB function="NewShopper(opt)">
        <WTCALLSUB name="GetMerchant reqMerchantID, reqOrderType, reqMerchantName, reqTerms, reqCurrencyCode, reqIsAwards, reqIsPin, reqIsTicket, reqIsApprove, reqIsShopperOrder, reqAcceptedCoins, reqPendingOrders, reqIsDemo"/>
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
        <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-NEW)"/>
        <WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(Payment2ID)" value="CONST(0)"/>
        <!-- Test Cryptocurrency processing support -->
<!--        
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CryptoStatus)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTCALLSUB name="GetCryptoStatus reqCryptoStatus"/>
        </WTCODEGROUP>
-->        
        <WTCODEGROUP>
          <WTCONDITION expr="CONST(opt)" oper="not-equal" value="CONST(0)"/>
          <WTGETCACHE name="PARAM(LogonConsumer)" value="CONSUMERLOGON"/>
        </WTCODEGROUP>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="SetupOrder">
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(LogonConsumer)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTERROR number="10149" message="Oops, Please enter a shopper phone number or email."/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTCONDITION expr="PARAM(IsPin)" oper="not-equal" value="CONST(0)" connector="and"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(PinNumber)" oper="equal" value="CONST(&quot;&quot;)"/>
            <WTERROR number="10150" message="Oops, Please enter your numeric PIN Code."/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(IsNumeric(reqPinNumber))" oper="equal" value="CONST(0)"/>
            <WTERROR number="10151" message="Oops, Please enter numbers only for your PIN Code."/>
            <WTSETATTRIBUTE name="PARAM(PinNumber)" value="CONST(&quot;&quot;)"/>
          </WTCODEGROUP>
          <WTCALLSUB name="ValidPin reqMerchantID, reqPinNumber, reqStaffID, reqStaffName">
            <WTCONDITION expr="NoErrors"/>
          </WTCALLSUB>
        </WTCODEGROUP>
        <WTCALLSUB name="GetShopper reqMerchantID, reqLogonConsumer, reqOrderType, reqCurrencyCode, reqConsumerID, reqConsumerName, reqBTC, reqCoinPrice, reqRewardPoints, reqNXC, reqRewardValueRaw, reqRewardValue, reqPayType, reqIsDemo">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-ORDER)"/>
          <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETCACHE name="CONSUMERLOGON" value="PARAM(LogonConsumer)"/>
        </WTCODEGROUP>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="SetupCryptoPayment">
        <WTSETATTRIBUTE name="PARAM(CoinType)" value="CONST(reqPayType-2)"/>
        <WTSETATTRIBUTE name="CONST(Price)" value="CONST(CoinPrice( reqCoinType, reqCurrencyCode ))"/>
        <WTSETATTRIBUTE name="CONST(Coins)" value="CONST( Round(reqTotalAmount / Price,8) )"/>
        <WTSETATTRIBUTE name="PARAM(QR_Amount)" value="CONST(Coins)"/>
        <!-- QR_Address set in AddOrder() -->
        <!-- <WTSETATTRIBUTE name="PARAM(QR_Address)" value="ATTR(Address)"/>-->
        <WTSETATTRIBUTE name="PARAM(QR_Label)" value="PARAM(MerchantName)"/>
        <WTSETATTRIBUTE name="PARAM(QR_Msg)" value="PARAM(Description)"/>
        <WTSETATTRIBUTE name="PARAM(ReplaceURL)" value="CONST(CoinQR(reqCoinType, reqQR_Address, &quot;{amt}&quot;, reqQR_Label, reqQR_Msg, 0 ))"/>
        <WTSETATTRIBUTE name="PARAM(QR_URL)" value="CONST(Replace( reqReplaceURL, &quot;{amt}&quot;, reqQR_Amount ))"/>
        <WTSETATTRIBUTE name="PARAM(QR_Name)" value="CONST(CoinName(reqCoinType))"/>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="NewShopper(0)"/>
      </WTACTION>

      <WTACTION id="13" name="CancelOrder" type="New">
        <WTCALLSUB name="NewShopper(1)"/>
      </WTACTION>

      <WTACTION id="1" name="Order_Cash" type="New">
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-CASH)"/>
        <WTCALLSUB name="SetupOrder"/>
      </WTACTION>

      <WTACTION id="2" name="Order_Crypto" type="New">
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
        <WTCALLSUB name="SetupOrder"/>
      </WTACTION>

      <WTACTION id="12" name="Order_Redeem" type="New">
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-REDEEM)"/>
        <WTCALLSUB name="SetupOrder"/>
      </WTACTION>

      <WTACTION id="3" name="Order_Award" type="New">
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-AWARD)"/>
        <WTCALLSUB name="SetupOrder"/>
      </WTACTION>

      <WTACTION id="4" name="Payment_Redeem" type="New">
        <WTCALLSUB name="ValidOrder reqOrderType, reqIsTicket, reqTicketNumber, reqTotalAmount, reqNetAmount"/>
        <WTCALLSUB name="ValidRedeem reqConsumerID, reqRedeemPswd, reqRewardValueRaw, reqTotalAmount, reqNetAmount">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
<!--          <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-REDEEM)"/>-->
          <WTCALLSUB name="AddOrder reqOrderType, reqMerchantID, reqConsumerID, reqAwardID, reqPayDate, reqStaffID, reqDescription, reqTotalAmount, reqNetAmount, reqTicketNumber, reqPayType, reqCurrencyCode, reqCoinType, reqQR_Address, reqPayment2ID, reqCoinToken, reqIsDemo"/>
          <WTCALLSUB name="ProcessOrder reqCompanyID, reqPayment2ID, reqReward, reqAward, reqRedeem, reqTotalReward, reqTotalAward">
            <WTCONDITION expr="NoErrors"/>
          </WTCALLSUB>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
        </WTCODEGROUP>
        <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
      </WTACTION>

      <WTACTION id="5" name="Payment_Add" type="Add">
        <WTCALLSUB name="ValidOrder reqOrderType, reqIsTicket, reqTicketNumber, reqTotalAmount, reqNetAmount"/>
        <WTCALLSUB name="AddOrder reqOrderType, reqMerchantID, reqConsumerID, reqAwardID, reqPayDate, reqStaffID, reqDescription, reqTotalAmount, reqNetAmount, reqTicketNumber, reqPayType, reqCurrencyCode, reqCoinType, reqQR_Address, reqPayment2ID, reqCoinToken, reqIsDemo">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
            <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-PAYMENT)"/>
            <WTCALLSUB name="SetupCryptoPayment"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CASH)"/>
            <WTCALLSUB name="ProcessOrder reqCompanyID, reqPayment2ID, reqReward, reqAward, reqRedeem, reqTotalReward, reqTotalAward">
              <WTCONDITION expr="NoErrors"/>
            </WTCALLSUB>
            <WTCODEGROUP>
              <WTCONDITION expr="NoErrors"/>
              <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
              <WTCALLSUB name="ApproveOrder reqPayment2ID">
                <WTCONDITION expr="PARAM(IsApprove)" oper="equal" value="CONST(1)"/>
              </WTCALLSUB>
            </WTCODEGROUP>
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
      </WTACTION>

      <WTACTION id="6" name="Payment_Crypto" type="New">
        <WTCALLSUB name="ProcessOrder reqCompanyID, reqPayment2ID, reqReward, reqAward, reqRedeem, reqTotalReward, reqTotalAward"/>
        <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-CONFIRM)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
        <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
      </WTACTION>

      <WTACTION id="7" name="Payment_AddAward" type="New">
        <WTCALLSUB name="ValidOrder reqOrderType, reqIsTicket, reqTicketNumber, reqTotalAmount, reqNetAmount"/>
        <WTCALLSUB name="ValidAward reqConsumerID, reqRedeemPswd">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCALLSUB name="AddAward reqMerchantID, reqConsumerID, reqPayDate, reqAwardID, reqRewardPoints, reqAward">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
        </WTCODEGROUP>
        <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
      </WTACTION>

      <WTACTION id="9" name="Cancel" type="Cancel">
        <WTRETURN/>
      </WTACTION>

      <WTACTION id="10" name="Logout" type="New">
        <WTSETCACHE name="MERCHANT" value="CONST(0)"/>
        <WTRETURN>
          <WTLINK name="m_15005" return="false"/>
        </WTRETURN>
      </WTACTION>

      <WTACTION id="11" name="RetryCryptoStatus" type="New">
        <WTSETATTRIBUTE name="PARAM(CryptoStatus)" value="CONST(&quot;&quot;)"/>
        <WTCALLSUB name="NewShopper"/>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="100" align="right"/>
        <WTCOLUMN width="500" align="left"/>

        <!-- Convert input to digits only if no @ sign for an email -->
        <WTFUNCTION name="LogonDigitsOnly(obj)">
          var val = obj.value;
          if(val.indexOf('@') === -1)	{
          obj.value = val.replace(/\D/g,'');
          }
        </WTFUNCTION>
        
        <WTFUNCTION name="NewShopper(auto)">
          var mid = document.getElementById('MerchantID').value;
          var cid = document.getElementById('ConsumerID').value;
          var url = "NewShopper.asp?m=" + mid + "&amp;s=" + cid;
          if( auto == 1 ) {url = url + "&amp;auto=1";}
          var win = window.open(url);
        </WTFUNCTION>
        
        <WTFUNCTION name="GetCoinPrice()">
          var coin = document.getElementById('PayType').value - 2;
          var url = "CoinPrice.asp?c=" + coin
          var xmlhttp;
          if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
          }
          else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
          }
          xmlhttp.onreadystatechange = function () {
            if (this.readyState == 4 &amp;&amp; this.status == 200) {
              document.getElementById('CoinPrice').value = this.responseText;
            }
          };
          xmlhttp.open("GET", url, true);
          xmlhttp.send();
        </WTFUNCTION>

        <WTFUNCTION name="OrderInfo()">
          var pid = document.getElementById('Payment2ID').value;
          var url = "16504.asp?payment2id=" + pid
          var win = window.open(url,"OrderInfo","top=100,left=100,height=350,width=425,resizable=yes,status=no,toolbar=no,menubar=no,location=no,titlebar=no,scrollbars=1")
        </WTFUNCTION>

        <WTFUNCTION name="Init()">
          var orderprocess = document.getElementById('OrderProcess').value;
          var ordertype = document.getElementById('OrderType').value;
          if( orderprocess == 2 ) {
            try {
              GetCryptoPayment();
              new Clipboard('#CopyButton');
              var isdemo = document.getElementById('IsDemo').value;
              if( isdemo == 0 ) { UpdateTimer(); }
            }
            catch(err) {
              alert(err.message);
            }  
          };
        </WTFUNCTION>

        <WTFUNCTION name="CopyTotalAmount()">
          var amt = document.getElementById('TotalAmount').value; 
          document.getElementById('NetAmount').value = amt;
        </WTFUNCTION>

        <WTLOAD>
					Init();
				</WTLOAD>

        <WTROW>
          <WTHIDDEN value="PARAM(MerchantID)"/>
          <WTHIDDEN value="PARAM(ConsumerID)"/>
          <WTHIDDEN value="PARAM(ConsumerName)"/>
          <WTHIDDEN value="PARAM(MerchantName)"/>
          <WTHIDDEN value="PARAM(StaffName)"/>
          <WTHIDDEN value="PARAM(StaffID)"/>
          <WTHIDDEN value="PARAM(IsPin)"/>
          <WTHIDDEN value="PARAM(IsTicket)"/>
          <WTHIDDEN value="PARAM(IsApprove)"/>
          <WTHIDDEN value="PARAM(IsAwards)"/>
          <WTHIDDEN value="PARAM(AcceptedCoins)"/>
          <WTHIDDEN value="PARAM(NXC)"/>
          <WTHIDDEN value="PARAM(RewardPoints)"/>
          <WTHIDDEN value="PARAM(RewardValue)"/>
          <WTHIDDEN value="PARAM(RewardValueRaw)"/>
          <WTHIDDEN value="PARAM(OrderType)"/>
          <WTHIDDEN value="PARAM(OrderProcess)"/>
          <WTHIDDEN value="PARAM(Payment2ID)"/>
          <WTHIDDEN value="PARAM(CoinType)"/>
          <WTHIDDEN value="PARAM(CryptoStatus)"/>
          <WTHIDDEN value="PARAM(CoinToken)"/>
          <WTHIDDEN value="PARAM(CurrencyCode)"/>
          <WTHIDDEN value="PARAM(IsDemo)"/>
          <WTHIDDEN value="PARAM(ReplaceURL)"/>
        </WTROW>

        <WTSTATIC label="ViewOrderInfo"/>
        <WTSTATIC label="CheckPayment"/>
        <WTSTATIC label="CopyTotal"/>

        <WTROW>
          <WTSTATIC col="1" merge="2" class="PageHeading" align="center">
            <WTSTATIC tag="NewOrder"/>
            <WTSTATIC value="PARAM(MerchantName)" space="1"/>
            <WTSTATIC value="CONST(#&lt;xsl:value-of select=&quot;/DATA/PARAM/@merchantid&quot;/&gt;)"/>
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(IsDemo)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC space="1"/>
              <WTSTATIC label="Demo" fontcolor="red"/>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>
        <WTROW>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-PAYMENT)"/>
          <WTBUTTON col="1" merge="2" value="CONST(ProcessCryptoPaymentButton)" align="center" class="PageHeading">
            <WTCLICK>ProcessCryptoPayment()</WTCLICK>
          </WTBUTTON>
          <WTSTATIC col="1" merge="2" space="2"/>
          <WTBUTTON col="1" merge="2" value="CONST(OrderInfoButton)" align="center">
            <WTCLICK>OrderInfo()</WTCLICK>
          </WTBUTTON>
        </WTROW>

        <!-- **************************************************************************************************-->
        <!-- GET THE SHOPPER, STAFF AND TYPE OF ORDER                                                          -->
        <!-- **************************************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-NEW)"/>

          <WTROW margin-top="12" margin-bottom="12">
            <WTIMAGE col="1" value="CONST(NXC50.png)" align="center"/>
            <WTIMAGE col="1" value="CONST(mobile.png)">
              <WTLINK name="m_15212" return="false">
                <WTPARAM name="MerchantID" value="PARAM(MerchantID)"/>
                <WTPARAM name="Popup" value="PARAM(Popup)"/>
              </WTLINK>
            </WTIMAGE>
            <WTSTATIC col="1" newline="2"/>
            <WTIMAGE col="1" value="CONST(LogonConsumer.png)" align="center"/>
            <WTBUTTON col="1" value="CONST(NewShopper)"  btnclass="bigbutton">
              <WTCLICK>NewShopper(0)</WTCLICK>
            </WTBUTTON>
            <WTBUTTON col="1" value="CONST(AutoShopper)"  btnclass="bigbutton">
              <WTCLICK>NewShopper(1)</WTCLICK>
            </WTBUTTON>
            <WTSTATIC col="1" newline="1"/>
            <WTBUTTON col="1" action="9" value="CONST(Return)" align="center"  btnclass="bigbutton">
              <WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)"/>
            </WTBUTTON>
            <WTBUTTON col="1" value="CONST(Close)" align="center" btnclass="bigbutton">
              <WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(1)"/>
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
            <WTBUTTON col="1" action="10" value="CONST(Logoff)" align="center"  btnclass="bigbutton">
              <WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(2)"/>
            </WTBUTTON>
            <WTTABLE col="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
              <WTCOLUMN width="225" align="right"/>
              <WTCOLUMN width="225" align="left"/>
              <WTCODEGROUP>
                <WTCONDITION expr="NotUser2FA"/>
                <WTROW margin-top="24" margin-bottom="24">
                  <WTSTATIC col="1" merge="2" label="2FARequired" align="center" fontsize="4" fontcolor="red"/>
                </WTROW>
              </WTCODEGROUP>
              <WTCODEGROUP>
                <WTCONDITION expr="IsUser2FA"/>
                <WTROW>
                  <WTSTATIC col="1" merge="2" label="WhoConsumer" align="center" fontsize="4"/>
                </WTROW>
                <WTROW margin-top="12">
                  <WTSTATIC col="1" tag="LogonConsumer" align="right"/>
                  <WTTEXT col="2" value="PARAM(LogonConsumer)" align="left" size="20">
                    <WTEXIT>LogonDigitsOnly(this);</WTEXIT>
                  </WTTEXT>
                  <WTIMAGE col="2" value="CONST(clear24a.png)" imgalign="absmiddle" prespace="false">
                    <WTLINK name="document.getElementById('LogonConsumer').value = '';" click="true" />
                  </WTIMAGE>
                </WTROW>
                <WTROW margin-top="12">
                  <WTCONDITION expr="PARAM(IsPin)" oper="not-equal" value="CONST(0)"/>
                  <WTSTATIC col="1" tag="StaffPin" align="right"/>
                  <WTTEXT col="2" value="PARAM(PinNumber)" align="left" size="5" secure="true"/>
                </WTROW>
              
                <WTROW margin-top="12">
                  <WTCONDITION expr="PARAM(Terms)" oper="not-equal" value="CONST('')"/>
                  <WTSTATIC col="1" merge="2" value="PARAM(Terms)" align="center" bold="true" fontsize="4"/>
                </WTROW>

                <WTROW margin-top="12">
                  <WTBUTTON col="1" merge="2" action="1" value="CONST(CashOrder)" align="center" btnclass="hugebutton"/>
                </WTROW>
                <WTROW margin-top="12">
                  <WTBUTTON col="1" merge="2" action="12" value="CONST(RewardsOrder)" align="center" btnclass="hugebutton"/>
                </WTROW>
<!--                
                <WTROW margin-top="12">
                  <WTCONDITION expr="PARAM(CryptoStatus)" oper="equal" value="CONST('OK')"/>
                  <WTBUTTON col="1" merge="2" action="2" value="CONST(CryptoOrder)" align="center" btnclass="hugebutton"/>
                </WTROW>
                <WTROW margin-top="12">
                  <WTCONDITION expr="PARAM(CryptoStatus)" oper="not-equal" value="CONST('OK')"/>
                  <WTSTATIC col="1" merge="2" value="PARAM(CryptoStatus)" align="center" bold="true" fontsize="4"/>
                  <WTBUTTON col="1" merge="2" action="11" value="CONST(Retry)" align="center" btnclass="smbutton"/>
                </WTROW>
-->                
                <WTROW margin-top="12">
                  <WTCONDITION expr="PARAM(IsAwards)" oper="not-equal" value="CONST(0)"/>
                  <WTBUTTON col="1" merge="2" action="3" value="CONST(AwardsOrder)" align="center" btnclass="hugebutton"/>
                </WTROW>
              </WTCODEGROUP>
              <WTROW margin-top="24">
                <WTCONDITION expr="PARAM(PendingOrders)" oper="not-equal" value="CONST(0)"/>
                <WTSTATIC col="1" merge="2" align="center" fontsize="3">
                  <WTSTATIC value="PARAM(PendingOrders)" space="1" bold="true"/>
                  <WTSTATIC label="PendingOrders"/>
                </WTSTATIC>
              </WTROW>

            </WTTABLE>
          </WTROW>
        </WTCODEGROUP>

        <!-- **************************************************************************************************-->
        <!-- GET THE ORDER DETAIL INFORMATION FOR THE TYPE OF ORDER                                                          -->
        <!-- **************************************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-ORDER)"/>

          <WTROW margin-top="12" margin-bottom="6">
            <WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
              <WTSTATIC tag="ConsumerName"/>
              <WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
              <WTCODEGROUP>
                <WTBUTTON action="0" value="CONST(Change)" btnclass="smbutton"/>
              </WTCODEGROUP>
              <WTCODEGROUP>
                <WTCONDITION expr="PARAM(StaffName)" oper="not-equal" value="CONST('')"/>
                <WTSTATIC space="2"/>
                <WTSTATIC tag="Staff"/>
                <WTSTATIC value="PARAM(StaffName)" bold="true"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
              <WTSTATIC value="PARAM(RewardPoints)" bold="true" space="1"/>
              <WTSTATIC label="RewardPoints" space="1"/>
              <WTSTATIC value="PARAM(RewardValue)" bold="true" space="2"/>
              <WTSTATIC fontsize="2">
                <WTSTATIC label="PointValue"/>
                <WTSTATIC value="PARAM(NXC)" space="1"/>
                <WTSTATIC label="PointValue2"/>
              </WTSTATIC>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
              <WTSTATIC value="PARAM(RewardPoints)" bold="true" space="1"/>
              <WTSTATIC label="SpecialAwardPoints"/>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-top="6" margin-bottom="6">
            <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
          </WTROW>

          <!-- **************************************************************************************************-->
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="PayDate"/>
              <WTTEXT col="2" value="PARAM(PayDate)" type="date"/>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="Award"/>
              <WTCOMBO col="2" value="PARAM(AwardID)" datapath="/DATA/TXN/PTSAWARDS/ENUM" setselected="true"/>
            </WTROW>
            <WTROW>
              <WTTABLE col="1" merge="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
                <WTCOLUMN width="400" align="center"/>
                <WTROW>
                  <WTSTATIC col="1" tag="RedeemPswd" bold="true"/>
                  <WTTEXT col="1" value="PARAM(RedeemPswd)" align="left" size="15" secure="true" prespace="false"/>
                </WTROW>
              </WTTABLE>
            </WTROW>
            <WTROW margin-top="12" margin-bottom="12">
              <WTBUTTON col="1" merge="2" action="7" value="CONST(AddAward)" align="center" btnclass="bigbutton"/>
              <WTBUTTON col="1" merge="2" action="13" value="CONST(Cancel)"/>
            </WTROW>
          </WTCODEGROUP>  
            
          <!-- **************************************************************************************************-->
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="not-equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="PayDate"/>
              <WTTEXT col="2" value="PARAM(PayDate)" type="date"/>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="RewardType"/>
              <WTCOMBO col="2" value="PARAM(AwardID)" datapath="/DATA/TXN/PTSAWARDS/ENUM" setselected="true"/>
            </WTROW>
            
            <WTROW margin-bottom="6">
              <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
              <WTSTATIC col="1" tag="PayType"/>
              <WTCOMBO col="2" value="PARAM(PayType)" class="prompt">
                <WTCHANGE>GetCoinPrice();</WTCHANGE>
                <WTOPTION id="3" label="Coin1"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',1,'))"/></WTOPTION>
                <WTOPTION id="4" label="Coin2"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',2,'))"/></WTOPTION>
                <WTOPTION id="5" label="Coin3"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',3,'))"/></WTOPTION>
                <WTOPTION id="6" label="Coin4"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',4,'))"/></WTOPTION>
                <WTOPTION id="7" label="Coin5"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',5,'))"/></WTOPTION>
                <WTOPTION id="8" label="Coin6"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',6,'))"/></WTOPTION>
                <WTOPTION id="9" label="Coin7"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',7,'))"/></WTOPTION>
                <WTOPTION id="10" label="Coin8"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',8,'))"/></WTOPTION>
                <WTOPTION id="11" label="Coin9"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',9,'))"/></WTOPTION>
                <WTOPTION id="12" label="Coin10"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',10,'))"/></WTOPTION>
              </WTCOMBO>
              <WTTEXT col="2" value="PARAM(CoinPrice)" style="BORDER:none;background:transparent;"/>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CASH)"/>
              <WTCONDITION expr="PARAM(IsTicket)" oper="not-equal" value="CONST(0)" connector="and"/>
              <WTSTATIC col="1" tag="TicketNumber" bold="true"/>
              <WTTEXT col="2" value="PARAM(TicketNumber)" size="10" class="prompt"/>
              <WTSTATIC col="2" label="TicketNumberText"/>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
              <WTSTATIC col="1" tag="Available"/>
              <WTSTATIC col="2" value="PARAM(RewardValue)" fontsize="4"/>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="TotalAmount"/>
              <WTTEXT col="2" value="PARAM(TotalAmount)" size="10" class="prompt">
                <WTKEY>CopyTotalAmount();</WTKEY>
              </WTTEXT>
              <WTSTATIC col="2">
                <WTSTATIC label="TotalAmountText">
                  <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
                </WTSTATIC>
                <WTSTATIC label="TotalAmountText2">
                  <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CASH)"/>
                </WTSTATIC>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="NetAmount"/>
              <WTTEXT col="2" value="PARAM(NetAmount)" size="10" class="prompt"/>
<!--              
              <WTIMAGE col="2" value="CONST(copy.gif)" alt="CopyTotal" imgalign="absmiddle">
                <WTLINK name="CopyTotalAmount()" click="true" />
              </WTIMAGE>
-->              
              <WTSTATIC col="2" label="NetAmountText"/>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="Description"/>
              <WTTEXT col="2" value="PARAM(Description)" size="60" class="prompt"/>
              <WTSTATIC col="2" label="DescriptionText"/>
            </WTROW>

            <WTROW id="RedeemRow">
              <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
              <WTTABLE col="1" merge="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
                <WTCOLUMN width="400" align="center"/>
                <WTROW>
                  <WTSTATIC col="1" tag="RedeemPswd" bold="true"/>
                  <WTTEXT col="1" value="PARAM(RedeemPswd)" align="left" size="15" secure="true" prespace="false"/>
                </WTROW>
              </WTTABLE>
            </WTROW>
            
            <WTROW margin-top="12" margin-bottom="12">
              <WTBUTTON col="1" merge="2" action="5" value="CONST(AddCrypto)" align="center" btnclass="bigbutton">
                <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
              </WTBUTTON>
              <WTBUTTON col="1" merge="2" action="5" value="CONST(AddCash)" align="center" btnclass="bigbutton">
                <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CASH)"/>
              </WTBUTTON>
              <WTBUTTON col="1" merge="2" action="4" value="CONST(Redeem)" align="center" btnclass="bigbutton">
                <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
              </WTBUTTON>
              <WTBUTTON col="1" merge="2" action="13" value="CONST(Cancel)"/>
            </WTROW>
              
          </WTCODEGROUP>  
        </WTCODEGROUP>

        <!-- **************************************************************************************************-->
        <!-- GET CRYPTO PAYMENT FROM THE SHOPPER                                                               -->
        <!-- **************************************************************************************************-->

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-PAYMENT)"/>
          <WTROW id="MessageRow" style="background:darkblue">
            <WTTEXT col="1" merge="2" name="MessageBox" value="CONST(15:00 Awaiting Payment...)" style="BORDER:none;background:transparent;color:white;text-align:center;width:100%"/>
          </WTROW>
          
          <WTROW margin-top="12">
            <WTSTATIC col="1" merge="2" label="QRtext" align="center" fontsize="4" fontcolor="blue"/>
          </WTROW>
          <WTROW margin-top="12" margin-bottom="12">
						<WTIMAGE col="1" merge="2" id="QRCode" align="center" value="CONST(&lt;xsl:value-of select=&quot;/DATA/PARAM/@qr_url&quot;/&gt;)" imgpath=""/>
          </WTROW>
          <WTROW margin-bottom="24">
            <WTSTATIC col="1" merge="2" align="center">
              <WTCODEGROUP>
                <WTIMAGE value="CONST(Coin&lt;xsl:value-of select=&quot;/DATA/PARAM/@cointype&quot;/&gt;.gif)" imgalign="absmiddle"/>
                <WTSTATIC space="2"/>
                <WTSTATIC value="PARAM(QR_Name)" fontsize="4" bold="true"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
<!--              <WTSTATIC tag="QR_Amount"/>-->
              <WTCODEGROUP>
              <WTTEXT name="QRAmount" value="CONST(Coins: &lt;xsl:value-of select=&quot;/DATA/PARAM/@qr_amount&quot;/&gt;)" style="BORDER:none;background:transparent;color:black;text-align:center;" size="20" textclass="bigtext"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
              <WTSTATIC tag="QR_Label"/>
              <WTSTATIC value="PARAM(QR_Label)" bold="true"/>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTCONDITION expr="PARAM(QR_Msg)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
                <WTSTATIC tag="QR_Msg"/>
                <WTSTATIC value="PARAM(QR_Msg)" bold="true"/>
            </WTSTATIC>
          </WTROW>
          
          <WTROW margin-top="12" margin-bottom="12">
            <WTSTATIC col="1" merge="2" label="QRtext2" align="center" fontsize="4" fontcolor="blue"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" merge="2" align="center">
              <WTCODEGROUP>
                <WTSTATIC tag="QR_Address" fontsize="3"/>
                <WTTEXT value="PARAM(QR_Address)" size="40"/>
                <WTBUTTON id="CopyButton" value="CONST(Copy)" clipboard="#QR_Address"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" merge="2" align="center">
              <WTCODEGROUP>
                <WTSTATIC tag="QR_Amount" fontsize="3"/>
                <WTTEXT value="PARAM(QR_Amount)" size="37"/>
                <WTBUTTON id="CopyButton" value="CONST(Copy)" clipboard="#QR_Amount"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>

          <WTROW margin-bottom="12">
            <WTBUTTON col="1" merge="2" action="13" value="CONST(Cancel)" align="center"/>
          </WTROW>
        </WTCODEGROUP>

        <!-- **************************************************************************************************-->
        <!-- CONFIRM THE ORDER AND START A NEW ORDER OR QUIT                                                          -->
        <!-- **************************************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
              <WTSTATIC tag="ConsumerName"/>
              <WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-top="12">
            <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="blue">
              <WTSTATIC label="SuccessfulOrder"/>
            </WTSTATIC>
          </WTROW>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="not-equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTROW margin-top="12">
              <WTCONDITION expr="PARAM(Redeem)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="red">
                <WTSTATIC value="PARAM(Redeem)" bold="true" space="1"/>
                <WTSTATIC label="RedeemedRewardPoints"/>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-top="12">
              <WTCONDITION expr="PARAM(Reward)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="green">
                <WTSTATIC value="PARAM(Reward)" bold="true" space="1"/>
                <WTSTATIC label="CashbackRewardPoints" space="1"/>
                <WTSTATIC value="CONST(()"/>
                <WTSTATIC value="PARAM(TotalReward)" bold="true" space="1"/>
                <WTSTATIC label="total"/>
                <WTSTATIC value="CONST())"/>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-top="12">
              <WTCONDITION expr="PARAM(Award)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="green">
                <WTSTATIC value="PARAM(Award)" bold="true" space="1"/>
                <WTSTATIC label="SpecialAwardPoints" space="1"/>
                <WTSTATIC value="CONST(()"/>
                <WTSTATIC value="PARAM(TotalAward)" bold="true" space="1"/>
                <WTSTATIC label="total"/>
                <WTSTATIC value="CONST())"/>
              </WTSTATIC>
            </WTROW>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTROW margin-top="12">
              <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="red">
                <WTSTATIC value="PARAM(Award)" bold="true" space="1"/>
                <WTSTATIC label="RedeemedAwardPoints"/>
              </WTSTATIC>
            </WTROW>
          </WTCODEGROUP>
          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" merge="2" action="0" value="CONST(NewOrder)" btnclass="bigbutton" align="center"/>
          </WTROW>
        </WTCODEGROUP>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="m_15212" caption="New Order" page-left="0" page-top="0" navbar="false" header="false" footer="false"  wrapper="wrapperMobile"
			page-width="100%" margin-width="0%" navbar-width="0%" content-width="100%" viewport="width=device-width"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" focus="false">
      <!--============================================================================================-->
      <WTPARAM name="MerchantID" datatype="number"/>
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="CompanyID" datatype="number"/>
      <WTPARAM name="ConsumerName" datatype="text"/>
      <WTPARAM name="LogonConsumer" datatype="text"/>
      <WTPARAM name="AwardID" datatype="number"/>
      <WTPARAM name="TotalAmount" datatype="text"/>
      <WTPARAM name="NetAmount" datatype="text"/>
      <WTPARAM name="PayDate" datatype="date"/>
      <WTPARAM name="PayType" datatype="number"/>
      <WTPARAM name="CoinType" datatype="number"/>
      <WTPARAM name="Description" datatype="text"/>
      <WTPARAM name="Notes" datatype="text"/>
      <WTPARAM name="OrderType" datatype="number"/>
      <WTPARAM name="OrderProcess" datatype="number"/>
      <WTPARAM name="Payment2ID" datatype="number"/>
      <WTPARAM name="Popup" datatype="number"/>
      <WTPARAM name="User2FA" datatype="number"/>

      <WTPARAM name="Reward" datatype="currency"/>
      <WTPARAM name="Award" datatype="currency"/>
      <WTPARAM name="Redeem" datatype="currency"/>
      <WTPARAM name="TotalReward" datatype="currency"/>
      <WTPARAM name="TotalAward" datatype="currency"/>

      <WTPARAM name="IsAwards" datatype="number"/>
      <WTPARAM name="IsPin" datatype="number"/>
      <WTPARAM name="IsTicket" datatype="number"/>
      <WTPARAM name="IsApprove" datatype="number"/>
      <WTPARAM name="IsShopperOrder" datatype="number"/>
      <WTPARAM name="PinNumber" datatype="text"/>
      <WTPARAM name="TicketNumber" datatype="text"/>
      <WTPARAM name="MerchantName" datatype="text"/>
      <WTPARAM name="StaffID" datatype="number"/>
      <WTPARAM name="StaffName" datatype="text"/>
      <WTPARAM name="AcceptedCoins" datatype="text"/>
      <WTPARAM name="Terms" datatype="text"/>
      <WTPARAM name="CurrencyCode" datatype="text"/>
      <WTPARAM name="PendingOrders" datatype="number"/>

      <WTPARAM name="CoinPrice" datatype="text"/>
      <WTPARAM name="BTC" datatype="currency"/>
      <WTPARAM name="NXC" datatype="currency"/>
      <WTPARAM name="RewardPoints" datatype="currency"/>
      <WTPARAM name="RewardValue" datatype="currency"/>
      <WTPARAM name="RewardValueRaw" datatype="currency"/>

      <WTPARAM name="RedeemPswd" datatype="text"/>
      <WTPARAM name="QR_Name" datatype="text"/>
      <WTPARAM name="QR_URL" datatype="text"/>
      <WTPARAM name="QR_Address" datatype="text"/>
      <WTPARAM name="QR_Amount" datatype="currency"/>
      <WTPARAM name="QR_Label" datatype="text"/>
      <WTPARAM name="QR_Msg" datatype="text"/>
      <WTPARAM name="CoinToken" datatype="text"/>
      <WTPARAM name="ReplaceURL" datatype="text"/>

      <WTPARAM name="CryptoStatus" datatype="text"/>
      <WTPARAM name="IsDemo" datatype="number"/>

      <WTINCLUDE name="LimitedAccess.asp"/>
      <WTINCLUDE name="Coins.asp"/>
      <WTINCLUDE name="2FA.asp"/>
      <WTINCLUDE name="Comm.asp"/>
      <WTINCLUDE name="RewardOrder.asp"/>

      <WTJAVASCRIPT name="AJAX.js"/>
      <WTJAVASCRIPT name="clipboard.min.js"/>
      <WTJAVASCRIPT name="RewardOrder.js"/>

      <WTDATATXN name="Awards"/>

      <!-- ************************************ -->
      <!-- OrderProcess: 0 - New Shopper        -->
      <!-- OrderProcess: 1 - Get Order Info     -->
      <!-- OrderProcess: 2 - Get Crypto Payment -->
      <!-- OrderProcess: 3 - Confirm Order      -->
      <!-- OrderType: 0 - Crypto                -->
      <!-- OrderType: 1 - Cash                  -->
      <!-- OrderType: 2 - Redeem Rewards        -->
      <!-- OrderType: 3 - Redeem Awards         -->
      <!-- ************************************ -->

      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(CompanyID)" value="SYSCON(NEXXUS)"/>
      </WTCODEGROUP>

      <WTCODEGROUP>
        <WTCONDITION expr="NotEmployee"/>
        <WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
        <WTCONDITION expr="NotOrgManagerOnly" connector="and"/>
        <WTGETCACHE name="CONST(SysMerchantID)" value="MERCHANT" datatype="number"/>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(SysMerchantID)"/>
          <WTCUSTOM>AbortUser()</WTCUSTOM>
        </WTCODEGROUP>
      </WTCODEGROUP>

      <!-- TEMPORARILY ENABLE 2FA -->
      <WTCODEGROUP>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(1)"/>
      </WTCODEGROUP>
      <!--      
      <WTCODEGROUP>
        <WTCONDITION expr="NotEmployee"/>
				<WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
				<WTCONDITION expr="NotOrgManagerOnly" connector="and"/>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(Is2FAMerchant(reqMerchantID))"/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="IsEmployee"/>
				<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
				<WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(1)"/>
      </WTCODEGROUP>
-->
      
      <!-- **************************************************************************************************-->
      <WTSUB function="NewShopper(opt)">
        <WTCALLSUB name="GetMerchant reqMerchantID, reqOrderType, reqMerchantName, reqTerms, reqCurrencyCode, reqIsAwards, reqIsPin, reqIsTicket, reqIsApprove, reqIsShopperOrder, reqAcceptedCoins, reqPendingOrders, reqIsDemo"/>
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
        <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-NEW)"/>
        <WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(Payment2ID)" value="CONST(0)"/>
        <!-- Test Cryptocurrency processing support -->
<!--
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CryptoStatus)" oper="equal" value="CONST(&quot;&quot;)"/>
           <WTCALLSUB name="GetCryptoStatus reqCryptoStatus"/>
        </WTCODEGROUP>
-->        
        <WTCODEGROUP>
          <WTCONDITION expr="CONST(opt)" oper="not-equal" value="CONST(0)"/>
          <WTGETCACHE name="PARAM(LogonConsumer)" value="CONSUMERLOGON"/>
        </WTCODEGROUP>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="SetupOrder">
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(LogonConsumer)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTERROR number="10149" message="Oops, Please enter a shopper phone number or email."/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTCONDITION expr="PARAM(IsPin)" oper="not-equal" value="CONST(0)" connector="and"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(PinNumber)" oper="equal" value="CONST(&quot;&quot;)"/>
            <WTERROR number="10150" message="Oops, Please enter your numeric PIN Code."/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(IsNumeric(reqPinNumber))" oper="equal" value="CONST(0)"/>
            <WTERROR number="10151" message="Oops, Please enter numbers only for your PIN Code."/>
            <WTSETATTRIBUTE name="PARAM(PinNumber)" value="CONST(&quot;&quot;)"/>
          </WTCODEGROUP>
          <WTCALLSUB name="ValidPin reqMerchantID, reqPinNumber, reqStaffID, reqStaffName">
            <WTCONDITION expr="NoErrors"/>
          </WTCALLSUB>
        </WTCODEGROUP>
        <WTCALLSUB name="GetShopper reqMerchantID, reqLogonConsumer, reqOrderType, reqCurrencyCode, reqConsumerID, reqConsumerName, reqBTC, reqCoinPrice, reqRewardPoints, reqNXC, reqRewardValueRaw, reqRewardValue, reqPayType, reqIsDemo">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-ORDER)"/>
          <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETCACHE name="CONSUMERLOGON" value="PARAM(LogonConsumer)"/>
        </WTCODEGROUP>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="SetupCryptoPayment">
        <WTSETATTRIBUTE name="PARAM(CoinType)" value="CONST(reqPayType-2)"/>
        <WTSETATTRIBUTE name="CONST(Price)" value="CONST(CoinPrice( reqCoinType, reqCurrencyCode ))"/>
        <WTSETATTRIBUTE name="CONST(Coins)" value="CONST( Round(reqTotalAmount / Price,8) )"/>
        <WTSETATTRIBUTE name="PARAM(QR_Amount)" value="CONST(Coins)"/>
        <!-- QR_Address set in AddOrder() -->
        <!-- <WTSETATTRIBUTE name="PARAM(QR_Address)" value="ATTR(Address)"/>-->
        <WTSETATTRIBUTE name="PARAM(QR_Label)" value="PARAM(MerchantName)"/>
        <WTSETATTRIBUTE name="PARAM(QR_Msg)" value="PARAM(Description)"/>
        <WTSETATTRIBUTE name="PARAM(ReplaceURL)" value="CONST(CoinQR(reqCoinType, reqQR_Address, &quot;{amt}&quot;, reqQR_Label, reqQR_Msg, 0 ))"/>
        <WTSETATTRIBUTE name="PARAM(QR_URL)" value="CONST(Replace( reqReplaceURL, &quot;{amt}&quot;, reqQR_Amount ))"/>
        <WTSETATTRIBUTE name="PARAM(QR_Name)" value="CONST(CoinName(reqCoinType))"/>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="NewShopper(0)"/>
      </WTACTION>

      <WTACTION id="13" name="CancelOrder" type="New">
        <WTCALLSUB name="NewShopper(1)"/>
      </WTACTION>

      <WTACTION id="1" name="Order_Cash" type="New">
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-CASH)"/>
        <WTCALLSUB name="SetupOrder"/>
      </WTACTION>

      <WTACTION id="2" name="Order_Crypto" type="New">
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
        <WTCALLSUB name="SetupOrder"/>
      </WTACTION>

      <WTACTION id="12" name="Order_Redeem" type="New">
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-REDEEM)"/>
        <WTCALLSUB name="SetupOrder"/>
      </WTACTION>

      <WTACTION id="3" name="Order_Award" type="New">
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-AWARD)"/>
        <WTCALLSUB name="SetupOrder"/>
      </WTACTION>

      <WTACTION id="4" name="Payment_Redeem" type="New">
        <WTCALLSUB name="ValidOrder reqOrderType, reqIsTicket, reqTicketNumber, reqTotalAmount, reqNetAmount"/>
        <WTCALLSUB name="ValidRedeem reqConsumerID, reqRedeemPswd, reqRewardValueRaw, reqTotalAmount, reqNetAmount">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <!--          <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-REDEEM)"/>-->
          <WTCALLSUB name="AddOrder reqOrderType, reqMerchantID, reqConsumerID, reqAwardID, reqPayDate, reqStaffID, reqDescription, reqTotalAmount, reqNetAmount, reqTicketNumber, reqPayType, reqCurrencyCode, reqCoinType, reqQR_Address, reqPayment2ID, reqCoinToken, reqIsDemo"/>
          <WTCALLSUB name="ProcessOrder reqCompanyID, reqPayment2ID, reqReward, reqAward, reqRedeem, reqTotalReward, reqTotalAward">
            <WTCONDITION expr="NoErrors"/>
          </WTCALLSUB>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
        </WTCODEGROUP>
        <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
      </WTACTION>

      <WTACTION id="5" name="Payment_Add" type="Add">
        <WTCALLSUB name="ValidOrder reqOrderType, reqIsTicket, reqTicketNumber, reqTotalAmount, reqNetAmount"/>
        <WTCALLSUB name="AddOrder reqOrderType, reqMerchantID, reqConsumerID, reqAwardID, reqPayDate, reqStaffID, reqDescription, reqTotalAmount, reqNetAmount, reqTicketNumber, reqPayType, reqCurrencyCode, reqCoinType, reqQR_Address, reqPayment2ID, reqCoinToken, reqIsDemo">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
            <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-PAYMENT)"/>
            <WTCALLSUB name="SetupCryptoPayment"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CASH)"/>
            <WTCALLSUB name="ProcessOrder reqCompanyID, reqPayment2ID, reqReward, reqAward, reqRedeem, reqTotalReward, reqTotalAward">
              <WTCONDITION expr="NoErrors"/>
            </WTCALLSUB>
            <WTCODEGROUP>
              <WTCONDITION expr="NoErrors"/>
              <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
              <WTCALLSUB name="ApproveOrder reqPayment2ID">
                <WTCONDITION expr="PARAM(IsApprove)" oper="equal" value="CONST(1)"/>
              </WTCALLSUB>
            </WTCODEGROUP>
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
      </WTACTION>

      <WTACTION id="6" name="Payment_Crypto" type="New">
        <WTCALLSUB name="ProcessOrder reqCompanyID, reqPayment2ID, reqReward, reqAward, reqRedeem, reqTotalReward, reqTotalAward"/>
        <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-CONFIRM)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
        <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
      </WTACTION>

      <WTACTION id="7" name="Payment_AddAward" type="New">
        <WTCALLSUB name="ValidOrder reqOrderType, reqIsTicket, reqTicketNumber, reqTotalAmount, reqNetAmount"/>
        <WTCALLSUB name="ValidAward reqConsumerID, reqRedeemPswd">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCALLSUB name="AddAward reqMerchantID, reqConsumerID, reqPayDate, reqAwardID, reqRewardPoints, reqAward">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
        </WTCODEGROUP>
        <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
      </WTACTION>

      <WTACTION id="9" name="Cancel" type="Cancel">
        <WTRETURN/>
      </WTACTION>

      <WTACTION id="10" name="Logout" type="New">
        <WTSETCACHE name="MERCHANT" value="CONST(0)"/>
        <WTRETURN>
          <WTLINK name="m_15005" return="false"/>
        </WTRETURN>
      </WTACTION>

      <WTACTION id="11" name="RetryCryptoStatus" type="New">
        <WTSETATTRIBUTE name="PARAM(CryptoStatus)" value="CONST(&quot;&quot;)"/>
        <WTCALLSUB name="NewShopper"/>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="17" align="right"/>
        <WTCOLUMN width="83" align="left"/>

        <!-- Convert input to digits only if no @ sign for an email -->
        <WTFUNCTION name="LogonDigitsOnly(obj)">
          var val = obj.value;
          if(val.indexOf('@') === -1)	{
          obj.value = val.replace(/\D/g,'');
          }
        </WTFUNCTION>

        <WTFUNCTION name="NewShopper(auto)">
          var mid = document.getElementById('MerchantID').value;
          var cid = document.getElementById('ConsumerID').value;
          var url = "m_NewShopper.asp?m=" + mid + "&amp;s=" + cid;
          if( auto == 1 ) {url = url + "&amp;auto=1";}
          var win = window.open(url);
        </WTFUNCTION>

        <WTFUNCTION name="GetCoinPrice()">
          var coin = document.getElementById('PayType').value - 2;
          var url = "CoinPrice.asp?c=" + coin
          var xmlhttp;
          if (window.XMLHttpRequest) {
          // code for IE7+, Firefox, Chrome, Opera, Safari
          xmlhttp = new XMLHttpRequest();
          }
          else {
          // code for IE6, IE5
          xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
          }
          xmlhttp.onreadystatechange = function () {
          if (this.readyState == 4 &amp;&amp; this.status == 200) {
          document.getElementById('CoinPrice').value = this.responseText;
          }
          };
          xmlhttp.open("GET", url, true);
          xmlhttp.send();
        </WTFUNCTION>

        <WTFUNCTION name="OrderInfo()">
          var pid = document.getElementById('Payment2ID').value;
          var url = "16504.asp?payment2id=" + pid
          var win = window.open(url,"OrderInfo","top=100,left=100,height=350,width=425,resizable=yes,status=no,toolbar=no,menubar=no,location=no,titlebar=no,scrollbars=1")
        </WTFUNCTION>

        <WTFUNCTION name="Init()">
          var orderprocess = document.getElementById('OrderProcess').value;
          var ordertype = document.getElementById('OrderType').value;
          if( orderprocess == 2 ) {
            try {
              GetCryptoPayment();
              new Clipboard('#CopyButton');
              var isdemo = document.getElementById('IsDemo').value;
              if( isdemo == 0 ) { UpdateTimer(); }
            }
            catch(err) {
              alert(err.message);
            }  
          };
        </WTFUNCTION>

        <WTFUNCTION name="CopyTotalAmount()">
          var amt = document.getElementById('TotalAmount').value;
          document.getElementById('NetAmount').value = amt;
        </WTFUNCTION>

        <WTLOAD>
          Init();
        </WTLOAD>

        <WTROW>
          <WTHIDDEN value="PARAM(MerchantID)"/>
          <WTHIDDEN value="PARAM(ConsumerID)"/>
          <WTHIDDEN value="PARAM(ConsumerName)"/>
          <WTHIDDEN value="PARAM(MerchantName)"/>
          <WTHIDDEN value="PARAM(StaffName)"/>
          <WTHIDDEN value="PARAM(StaffID)"/>
          <WTHIDDEN value="PARAM(IsPin)"/>
          <WTHIDDEN value="PARAM(IsTicket)"/>
          <WTHIDDEN value="PARAM(IsApprove)"/>
          <WTHIDDEN value="PARAM(IsAwards)"/>
          <WTHIDDEN value="PARAM(AcceptedCoins)"/>
          <WTHIDDEN value="PARAM(NXC)"/>
          <WTHIDDEN value="PARAM(RewardPoints)"/>
          <WTHIDDEN value="PARAM(RewardValue)"/>
          <WTHIDDEN value="PARAM(RewardValueRaw)"/>
          <WTHIDDEN value="PARAM(OrderType)"/>
          <WTHIDDEN value="PARAM(OrderProcess)"/>
          <WTHIDDEN value="PARAM(Payment2ID)"/>
          <WTHIDDEN value="PARAM(CoinType)"/>
          <WTHIDDEN value="PARAM(CryptoStatus)"/>
          <WTHIDDEN value="PARAM(CoinToken)"/>
          <WTHIDDEN value="PARAM(CurrencyCode)"/>
          <WTHIDDEN value="PARAM(IsDemo)"/>
          <WTHIDDEN value="PARAM(ReplaceURL)"/>
      </WTROW>

        <WTSTATIC label="ViewOrderInfo"/>
        <WTSTATIC label="CheckPayment"/>
        <WTSTATIC label="CopyTotal"/>

        <WTROW>
          <WTSTATIC col="1" merge="2" class="PageHeading" align="center">
            <WTSTATIC tag="NewOrder"/>
            <WTSTATIC value="PARAM(MerchantName)" space="1"/>
            <WTSTATIC value="CONST(#&lt;xsl:value-of select=&quot;/DATA/PARAM/@merchantid&quot;/&gt;)"/>
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(IsDemo)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC space="1"/>
              <WTSTATIC label="Demo" fontcolor="red"/>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>
        <WTROW>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-PAYMENT)"/>
          <WTBUTTON col="1" merge="2" value="CONST(ProcessCryptoPaymentButton)" align="center" class="PageHeading">
            <WTCLICK>ProcessCryptoPayment()</WTCLICK>
          </WTBUTTON>
          <WTSTATIC col="1" merge="2" space="2"/>
          <WTBUTTON col="1" merge="2" value="CONST(OrderInfoButton)" align="center">
            <WTCLICK>OrderInfo()</WTCLICK>
          </WTBUTTON>
        </WTROW>

        <!-- **************************************************************************************************-->
        <!-- GET THE SHOPPER, STAFF AND TYPE OF ORDER                                                          -->
        <!-- **************************************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-NEW)"/>

          <WTROW margin-top="12" margin-bottom="12">
            <WTTABLE col="1" merge="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
              <WTCOLUMN width="48" align="right"/>
              <WTCOLUMN width="48" align="left"/>
              <WTCODEGROUP>
                <WTCONDITION expr="NotUser2FA"/>
                <WTROW margin-top="24" margin-bottom="24">
                  <WTSTATIC col="1" merge="2" label="2FARequired" align="center" fontsize="4" fontcolor="red"/>
                </WTROW>
              </WTCODEGROUP>
              <WTCODEGROUP>
                <WTCONDITION expr="IsUser2FA"/>
                <WTROW margin-bottom="6">
                  <WTIMAGE col="1" merge="2" value="CONST(NXC50.png)" align="center"/>
                </WTROW>
                <WTROW>
                  <WTSTATIC col="1" merge="2" label="WhoConsumer" align="center" fontsize="4"/>
                </WTROW>
                <WTROW margin-top="12">
                  <WTSTATIC col="1" tag="LogonConsumer" align="right"/>
                  <WTTEXT col="2" value="PARAM(LogonConsumer)" align="left" size="8" textclass="bigtext">
                    <WTEXIT>LogonDigitsOnly(this);</WTEXIT>
                  </WTTEXT>
                  <WTIMAGE col="2" value="CONST(clear24.png)" imgalign="absmiddle" prespace="false">
                    <WTLINK name="document.getElementById('LogonConsumer').value = '';" click="true" />
                  </WTIMAGE>
                </WTROW>
                <WTROW margin-top="12">
                  <WTCONDITION expr="PARAM(IsPin)" oper="not-equal" value="CONST(0)"/>
                  <WTSTATIC col="1" tag="StaffPin" align="right"/>
                  <WTTEXT col="2" value="PARAM(PinNumber)" align="left" size="5" secure="true" textclass="bigtext"/>
                </WTROW>

                <WTROW margin-top="12">
                  <WTCONDITION expr="PARAM(Terms)" oper="not-equal" value="CONST('')"/>
                  <WTSTATIC col="1" merge="2" value="PARAM(Terms)" align="center" bold="true" fontsize="4"/>
                </WTROW>

                <WTROW margin-top="12">
                  <WTBUTTON col="1" merge="2" action="1" value="CONST(CashOrder)" align="center" btnclass="hugebutton"/>
                </WTROW>
                <WTROW margin-top="12">
                  <WTBUTTON col="1" merge="2" action="12" value="CONST(RewardsOrder)" align="center" btnclass="hugebutton"/>
                </WTROW>
<!--
                <WTROW margin-top="12">
                  <WTCONDITION expr="PARAM(CryptoStatus)" oper="equal" value="CONST('OK')"/>
                  <WTBUTTON col="1" merge="2" action="2" value="CONST(CryptoOrder)" align="center" btnclass="hugebutton"/>
                </WTROW>
                <WTROW margin-top="12">
                  <WTCONDITION expr="PARAM(CryptoStatus)" oper="not-equal" value="CONST('OK')"/>
                  <WTSTATIC col="1" merge="2" value="PARAM(CryptoStatus)" align="center" bold="true" fontsize="4"/>
                  <WTBUTTON col="1" merge="2" action="11" value="CONST(Retry)" align="center" btnclass="smbutton"/>
                </WTROW>
-->
                <WTROW margin-top="12">
                  <WTCONDITION expr="PARAM(IsAwards)" oper="not-equal" value="CONST(0)"/>
                  <WTBUTTON col="1" merge="2" action="3" value="CONST(AwardsOrder)" align="center" btnclass="hugebutton"/>
                </WTROW>
                <WTROW margin-top="24">
                  <WTCONDITION expr="PARAM(PendingOrders)" oper="not-equal" value="CONST(0)"/>
                  <WTSTATIC col="1" merge="2" align="center" fontsize="3">
                    <WTSTATIC value="PARAM(PendingOrders)" space="1" bold="true"/>
                    <WTSTATIC label="PendingOrders"/>
                  </WTSTATIC>
                </WTROW>
                <WTROW margin-top="24">
                  <WTBUTTON col="1" merge="2" value="CONST(NewShopper)"  btnclass="bigbutton" align="center">
                    <WTCLICK>NewShopper(0)</WTCLICK>
                  </WTBUTTON>
                  <WTBUTTON col="1" merge="2" value="CONST(AutoShopper)"  btnclass="bigbutton" align="center">
                    <WTCLICK>NewShopper(1)</WTCLICK>
                  </WTBUTTON>
                </WTROW>
                <WTROW margin-top="24">
                  <WTBUTTON col="1" merge="2" action="10" value="CONST(Logoff)" align="center"  btnclass="bigbutton"/>
                </WTROW>
              </WTCODEGROUP>

            </WTTABLE>
          </WTROW>
        </WTCODEGROUP>

        <!-- **************************************************************************************************-->
        <!-- GET THE ORDER DETAIL INFORMATION FOR THE TYPE OF ORDER                                                          -->
        <!-- **************************************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-ORDER)"/>

          <WTROW margin-top="12" margin-bottom="6">
            <WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
              <WTSTATIC tag="ConsumerName"/>
              <WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
              <WTCODEGROUP>
                <WTBUTTON action="0" value="CONST(Change)" btnclass="smbutton"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTCONDITION expr="PARAM(StaffName)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
                <WTSTATIC tag="Staff"/>
                <WTSTATIC value="PARAM(StaffName)" bold="true"/>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
            <WTCONDITION expr="PARAM(RewardPoints)" oper="not-equal" value="CONST(0)" connector="and"/>
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
              <WTSTATIC value="PARAM(RewardPoints)" bold="true" space="1"/>
              <WTSTATIC label="RewardPoints" space="1"/>
              <WTSTATIC value="PARAM(RewardValue)" bold="true" space="2"/>
              <WTSTATIC fontsize="2">
                <WTSTATIC label="PointValue"/>
                <WTSTATIC value="PARAM(NXC)" space="1"/>
                <WTSTATIC label="PointValue2"/>
              </WTSTATIC>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
              <WTSTATIC value="PARAM(RewardPoints)" bold="true" space="1"/>
              <WTSTATIC label="SpecialAwardPoints"/>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-top="6" margin-bottom="6">
            <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
          </WTROW>

          <!-- **************************************************************************************************-->
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="PayDate"/>
              <WTTEXT col="2" value="PARAM(PayDate)" type="date" textclass="bigtext"/>
            </WTROW>

            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="Award"/>
              <WTCOMBO col="2" value="PARAM(AwardID)" datapath="/DATA/TXN/PTSAWARDS/ENUM" setselected="true" comboclass="bigtext"/>
            </WTROW>
            <WTROW>
              <WTTABLE col="1" merge="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
                <WTCOLUMN width="90" align="center"/>
                <WTROW>
                  <WTSTATIC col="1" tag="RedeemPswd" bold="true"/>
                  <WTTEXT col="1" value="PARAM(RedeemPswd)" align="left" size="15" secure="true" prespace="false" textclass="bigtext"/>
                </WTROW>
              </WTTABLE>
            </WTROW>
            <WTROW margin-top="12" margin-bottom="12">
              <WTBUTTON col="1" merge="2" action="7" value="CONST(AddAward)" align="center" btnclass="bigbutton"/>
              <WTBUTTON col="1" merge="2" action="13" value="CONST(Cancel)"/>
            </WTROW>
          </WTCODEGROUP>

          <!-- **************************************************************************************************-->
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="not-equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="PayDate"/>
              <WTTEXT col="2" value="PARAM(PayDate)" type="date" textclass="bigtext"/>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="RewardType"/>
              <WTCOMBO col="2" value="PARAM(AwardID)" datapath="/DATA/TXN/PTSAWARDS/ENUM" setselected="true" comboclass="bigtext"/>
            </WTROW>

            <WTROW margin-bottom="6">
              <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
              <WTSTATIC col="1" tag="PayType"/>
              <WTCOMBO col="2" value="PARAM(PayType)" class="prompt" comboclass="bigtext">
                <WTCHANGE>GetCoinPrice();</WTCHANGE>
                <WTOPTION id="3" label="Coin1">
                  <WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',1,'))"/>
                </WTOPTION>
                <WTOPTION id="4" label="Coin2">
                  <WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',2,'))"/>
                </WTOPTION>
                <WTOPTION id="5" label="Coin3">
                  <WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',3,'))"/>
                </WTOPTION>
                <WTOPTION id="6" label="Coin4">
                  <WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',4,'))"/>
                </WTOPTION>
                <WTOPTION id="7" label="Coin5">
                  <WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',5,'))"/>
                </WTOPTION>
                <WTOPTION id="8" label="Coin6">
                  <WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',6,'))"/>
                </WTOPTION>
                <WTOPTION id="9" label="Coin7">
                  <WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',7,'))"/>
                </WTOPTION>
                <WTOPTION id="10" label="Coin8">
                  <WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',8,'))"/>
                </WTOPTION>
                <WTOPTION id="11" label="Coin9">
                  <WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',9,'))"/>
                </WTOPTION>
                <WTOPTION id="12" label="Coin10">
                  <WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',10,'))"/>
                </WTOPTION>
              </WTCOMBO>
              <WTTEXT col="2" value="PARAM(CoinPrice)" style="BORDER:none;background:transparent;" size="5"/>
            </WTROW>
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CASH)"/>
              <WTCONDITION expr="PARAM(IsTicket)" oper="not-equal" value="CONST(0)" connector="and"/>
              <WTROW>
                <WTSTATIC col="1" tag="mTicketNumber" bold="true"/>
                <WTTEXT col="2" value="PARAM(TicketNumber)" size="10" textclass="bigtext"/>
              </WTROW>
              <WTROW margin-bottom="6">
                <WTSTATIC col="1"/>
                <WTSTATIC col="2" label="TicketNumberText" class="prompt"/>
              </WTROW>
            </WTCODEGROUP>
            <WTROW margin-bottom="6">
              <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
              <WTSTATIC col="1" tag="Available"/>
              <WTSTATIC col="2" value="PARAM(RewardValue)" fontsize="4"/>
            </WTROW>
            <WTROW>
              <WTSTATIC col="1"/>
              <WTSTATIC col="2" class="prompt" bold="true">
                <WTSTATIC label="TotalAmountText">
                  <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
                </WTSTATIC>
                <WTSTATIC label="TotalAmountText2">
                  <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CASH)"/>
                </WTSTATIC>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="mTotalAmount"/>
              <WTTEXT col="2" value="PARAM(TotalAmount)" size="10" textclass="bigtext">
                <WTKEY>CopyTotalAmount();</WTKEY>
              </WTTEXT>
            </WTROW>
            <WTROW>
              <WTSTATIC col="1"/>
              <WTSTATIC col="2" label="NetAmountText" class="prompt" bold="true"/>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="mNetAmount"/>
              <WTTEXT col="2" value="PARAM(NetAmount)" size="10" textclass="bigtext"/>
            </WTROW>
            <WTROW>
              <WTSTATIC col="1"/>
              <WTSTATIC col="2" label="DescriptionText" class="prompt" bold="true"/>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" tag="Description"/>
              <WTMEMO col="2" value="PARAM(Description)" cols="30" rows="2" memoclass="bigtext"/>
            </WTROW>

            <WTROW id="RedeemRow">
              <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
              <WTTABLE col="1" merge="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
                <WTCOLUMN width="75" align="center"/>
                <WTROW>
                  <WTSTATIC col="1" tag="RedeemPswd" bold="true"/>
                  <WTTEXT col="1" value="PARAM(RedeemPswd)" align="left" size="15" secure="true" prespace="false"/>
                </WTROW>
              </WTTABLE>
            </WTROW>

            <WTROW margin-top="12" margin-bottom="12">
<!--              
              <WTBUTTON col="1" merge="2" action="5" value="CONST(AddCrypto)" align="center" btnclass="bigbutton">
                <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
              </WTBUTTON>
-->              
              <WTBUTTON col="1" merge="2" action="5" value="CONST(AddCash)" align="center" btnclass="bigbutton">
                <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CASH)"/>
              </WTBUTTON>
              <WTBUTTON col="1" merge="2" action="4" value="CONST(Redeem)" align="center" btnclass="bigbutton">
                <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
              </WTBUTTON>
              <WTBUTTON col="1" merge="2" action="13" value="CONST(Cancel)"/>
            </WTROW>

          </WTCODEGROUP>
        </WTCODEGROUP>

        <!-- **************************************************************************************************-->
        <!-- GET CRYPTO PAYMENT FROM THE SHOPPER                                                               -->
        <!-- **************************************************************************************************-->

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-PAYMENT)"/>
          <WTROW id="MessageRow" style="background:darkblue">
            <WTTEXT col="1" merge="2" name="MessageBox" value="CONST(15:00 Awaiting Payment...)" style="BORDER:none;background:transparent;color:white;text-align:center;width:100%"/>
          </WTROW>

          <WTROW margin-top="12" margin-bottom="12">
            <WTSTATIC col="1" merge="2" label="QRtext" align="center" fontsize="4" fontcolor="blue"/>
          </WTROW>
          <WTROW margin-top="12" margin-bottom="12">
            <WTIMAGE col="1" merge="2" id="QRCode" align="center" value="CONST(&lt;xsl:value-of select=&quot;/DATA/PARAM/@qr_url&quot;/&gt;)" imgpath=""/>
          </WTROW>
          <WTROW margin-bottom="24">
            <WTSTATIC col="1" merge="2" align="center">
              <WTCODEGROUP>
                <WTIMAGE value="CONST(Coin&lt;xsl:value-of select=&quot;/DATA/PARAM/@cointype&quot;/&gt;.gif)" imgalign="absmiddle"/>
                <WTSTATIC space="2"/>
                <WTSTATIC value="PARAM(QR_Name)" fontsize="4" bold="true"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
<!--              <WTSTATIC tag="QR_Amount"/>-->
              <WTCODEGROUP>
              <WTTEXT name="QRAmount" value="CONST(Coins: &lt;xsl:value-of select=&quot;/DATA/PARAM/@qr_amount&quot;/&gt;)" style="BORDER:none;background:transparent;color:black;text-align:center;" size="20" textclass="bigtext"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
              <WTSTATIC tag="QR_Label"/>
              <WTSTATIC value="PARAM(QR_Label)" bold="true"/>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTCONDITION expr="PARAM(QR_Msg)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
              <WTSTATIC tag="QR_Msg"/>
              <WTSTATIC value="PARAM(QR_Msg)" bold="true"/>
            </WTSTATIC>
          </WTROW>

          <WTROW margin-top="12" margin-bottom="12">
            <WTSTATIC col="1" merge="2" label="QRtext2" align="center" fontsize="4" fontcolor="blue"/>
          </WTROW>
          <WTROW>
            <WTSTATIC col="1" merge="2" tag="QR_Address" fontsize="3" align="center"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" merge="2" align="center">
              <WTCODEGROUP>
                <WTTEXT value="PARAM(QR_Address)" size="35" class="bigtext"/>
                <WTBUTTON id="CopyButton" value="CONST(Copy)" clipboard="#QR_Address"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" merge="2" align="center">
              <WTCODEGROUP>
                <WTSTATIC tag="QR_Amount" fontsize="3"/>
                <WTTEXT value="PARAM(QR_Amount)" size="20" class="bigtext"/>
                <WTBUTTON id="CopyButton" value="CONST(Copy)" clipboard="#QR_Amount"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>

          <WTROW margin-bottom="12">
            <WTBUTTON col="1" merge="2" action="13" value="CONST(Cancel)" align="center"/>
          </WTROW>
        </WTCODEGROUP>

        <!-- **************************************************************************************************-->
        <!-- CONFIRM THE ORDER AND START A NEW ORDER OR QUIT                                                          -->
        <!-- **************************************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
              <WTSTATIC tag="ConsumerName"/>
              <WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
            </WTSTATIC>
          </WTROW>
          <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="blue">
            <WTSTATIC label="SuccessfulOrder"/>
          </WTSTATIC>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="not-equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTROW margin-top="12">
              <WTCONDITION expr="PARAM(Redeem)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="red">
                <WTSTATIC value="PARAM(Redeem)" bold="true" space="1"/>
                <WTSTATIC label="RedeemedRewardPoints"/>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-top="12">
              <WTCONDITION expr="PARAM(Reward)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="green">
                <WTSTATIC value="PARAM(Reward)" bold="true" space="1"/>
                <WTSTATIC label="CashbackRewardPoints" space="1"/>
                <WTSTATIC value="CONST(()"/>
                <WTSTATIC value="PARAM(TotalReward)" bold="true" space="1"/>
                <WTSTATIC label="total"/>
                <WTSTATIC value="CONST())"/>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-top="12">
              <WTCONDITION expr="PARAM(Award)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="green">
                <WTSTATIC value="PARAM(Award)" bold="true" space="1"/>
                <WTSTATIC label="SpecialAwardPoints" space="1"/>
                <WTSTATIC value="CONST(()"/>
                <WTSTATIC value="PARAM(TotalAward)" bold="true" space="1"/>
                <WTSTATIC label="total"/>
                <WTSTATIC value="CONST())"/>
              </WTSTATIC>
            </WTROW>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTROW margin-top="12">
              <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="red">
                <WTSTATIC value="PARAM(Award)" bold="true" space="1"/>
                <WTSTATIC label="RedeemedAwardPoints"/>
              </WTSTATIC>
            </WTROW>
          </WTCODEGROUP>
          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" merge="2" action="0" value="CONST(NewOrder)" btnclass="bigbutton" align="center"/>
          </WTROW>
        </WTCODEGROUP>

      </WTCONTENT>
    </WTWEBPAGE>


    <!--============================================================================================-->
    <WTWEBPAGE name="m_15212s" caption="New Order" page-left="0" page-top="0" navbar="false" header="false" footer="false"  wrapper="wrapperMobile"
			page-width="100%" margin-width="0%" navbar-width="0%" content-width="100%" viewport="width=device-width"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" focus="false">
      <!--============================================================================================-->
      <WTPARAM name="MerchantID" datatype="number"/>
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="CompanyID" datatype="number"/>
      <WTPARAM name="ConsumerName" datatype="text"/>
      <WTPARAM name="LogonConsumer" datatype="text"/>
      <WTPARAM name="AwardID" datatype="number"/>
      <WTPARAM name="RewardName" datatype="text"/>
      <WTPARAM name="TotalAmount" datatype="text"/>
      <WTPARAM name="NetAmount" datatype="text"/>
      <WTPARAM name="PayDate" datatype="date"/>
      <WTPARAM name="PayType" datatype="number"/>
      <WTPARAM name="CoinType" datatype="number"/>
      <WTPARAM name="Description" datatype="text"/>
      <WTPARAM name="Notes" datatype="text"/>
      <WTPARAM name="OrderType" datatype="number"/>
      <WTPARAM name="OrderProcess" datatype="number"/>
      <WTPARAM name="Payment2ID" datatype="number"/>
      <WTPARAM name="Popup" datatype="number"/>
      <WTPARAM name="User2FA" datatype="number"/>

      <WTPARAM name="Reward" datatype="currency"/>
      <WTPARAM name="Award" datatype="currency"/>
      <WTPARAM name="Redeem" datatype="currency"/>
      <WTPARAM name="TotalReward" datatype="currency"/>
      <WTPARAM name="TotalAward" datatype="currency"/>

      <WTPARAM name="IsAwards" datatype="number"/>
      <WTPARAM name="IsPin" datatype="number"/>
      <WTPARAM name="IsTicket" datatype="number"/>
      <WTPARAM name="IsApprove" datatype="number"/>
      <WTPARAM name="IsShopperOrder" datatype="number"/>
      <WTPARAM name="PinNumber" datatype="text"/>
      <WTPARAM name="TicketNumber" datatype="text"/>
      <WTPARAM name="MerchantName" datatype="text"/>
      <WTPARAM name="StaffID" datatype="number"/>
      <WTPARAM name="StaffName" datatype="text"/>
      <WTPARAM name="AcceptedCoins" datatype="text"/>
      <WTPARAM name="Terms" datatype="text"/>
      <WTPARAM name="CurrencyCode" datatype="text"/>
      <WTPARAM name="PendingOrders" datatype="number"/>

      <WTPARAM name="CoinPrice" datatype="text"/>
      <WTPARAM name="BTC" datatype="currency"/>
      <WTPARAM name="NXC" datatype="currency"/>
      <WTPARAM name="RewardPoints" datatype="currency"/>
      <WTPARAM name="RewardValue" datatype="currency"/>
      <WTPARAM name="RewardValueRaw" datatype="currency"/>

      <WTPARAM name="RedeemPswd" datatype="text"/>
      <WTPARAM name="QR_Name" datatype="text"/>
      <WTPARAM name="QR_URL" datatype="text"/>
      <WTPARAM name="QR_Address" datatype="text"/>
      <WTPARAM name="QR_Amount" datatype="currency"/>
      <WTPARAM name="QR_Label" datatype="text"/>
      <WTPARAM name="QR_Msg" datatype="text"/>
      <WTPARAM name="CoinToken" datatype="text"/>
      <WTPARAM name="ReplaceURL" datatype="text"/>

      <WTPARAM name="CryptoStatus" datatype="text"/>
      <WTPARAM name="IsDemo" datatype="number"/>

      <WTINCLUDE name="LimitedAccess.asp"/>
      <WTINCLUDE name="Coins.asp"/>
      <WTINCLUDE name="2FA.asp"/>
      <WTINCLUDE name="Comm.asp"/>
      <WTINCLUDE name="RewardOrder.asp"/>
      <WTINCLUDE name="IP.asp"/>

      <WTJAVASCRIPT name="AJAX.js"/>
      <WTJAVASCRIPT name="clipboard.min.js"/>
      <WTJAVASCRIPT name="RewardOrder.js"/>

      <WTDATATXN name="Awards"/>

      <!-- ************************************ -->
      <!-- OrderProcess: 0 - New Shopper        -->
      <!-- OrderProcess: 1 - Get Order Info     -->
      <!-- OrderProcess: 2 - Get Crypto Payment -->
      <!-- OrderProcess: 3 - Confirm Order      -->
      <!-- OrderType: 0 - Crypto                -->
      <!-- OrderType: 1 - Cash                  -->
      <!-- OrderType: 2 - Redeem Rewards        -->
      <!-- OrderType: 3 - Redeem Awards         -->
      <!-- ************************************ -->

      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(CompanyID)" value="SYSCON(NEXXUS)"/>
      </WTCODEGROUP>

      <!-- TEMPORARILY ENABLE 2FA -->
      <WTCODEGROUP>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(1)"/>
      </WTCODEGROUP>

      <!-- **************************************************************************************************-->
      <WTSUB function="NewShopper(opt)">
        <WTCALLSUB name="GetMerchant reqMerchantID, reqOrderType, reqMerchantName, reqTerms, reqCurrencyCode, reqIsAwards, reqIsPin, reqIsTicket, reqIsApprove, reqIsShopperOrder, reqAcceptedCoins, reqPendingOrders, reqIsDemo"/>
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
        <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-NEW)"/>
        <WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(Payment2ID)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(RedeemPswd)" value="CONST(&quot;&quot;)"/>
        <!-- Set a Dummy Ticket Number, if required -->
        <WTSETATTRIBUTE name="PARAM(TicketNumber)" value="CONST(&quot;xxxx&quot;)">
          <WTCONDITION expr="PARAM(IsTicket)" oper="not-equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(IsShopperOrder)" oper="equal" value="CONST(0)"/>
          <WTCUSTOM>
            response.write "Merchant Doesn't Support - Shopper Initiated Orders"
            response.end
          </WTCUSTOM>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTGETCOOKIE name="PARAM(LogonConsumer)" value="CONSUMERLOGON"/>
        </WTCODEGROUP>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="SetupOrder">
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(LogonConsumer)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTERROR number="10149" message="Oops, Please enter a shopper phone number or email."/>
        </WTCODEGROUP>
        <WTCALLSUB name="GetShopper reqMerchantID, reqLogonConsumer, reqOrderType, reqCurrencyCode, reqConsumerID, reqConsumerName, reqBTC, reqCoinPrice, reqRewardPoints, reqNXC, reqRewardValueRaw, reqRewardValue, reqPayType, reqIsDemo">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-ORDER)"/>
          <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards"/>
          <WTCUSTOM>
            pos = InStr(xmlAwards, "id=")
            If pos &gt; 0 Then
              pos = pos + 4
              pos2 = InStr(pos, xmlAwards, """")
              reqAwardID = Mid( xmlAwards, pos, pos2-pos)
            End If
            pos = InStr(xmlAwards, "name=")
            If pos &gt; 0 Then
              pos = pos + 6
              pos2 = InStr(pos, xmlAwards, """")
              reqRewardName = Mid( xmlAwards, pos, pos2-pos)
            End If
          </WTCUSTOM>          
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETCOOKIE name="CONSUMERLOGON" value="PARAM(LogonConsumer)"/>
        </WTCODEGROUP>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="ValidStaff">
        <!-- Validate Staff Pin Code -->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(PinNumber)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTERROR number="10150" message="Oops, Please enter your numeric PIN Code."/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="CONST(IsNumeric(reqPinNumber))" oper="equal" value="CONST(0)"/>
          <WTERROR number="10151" message="Oops, Please enter numbers only for your PIN Code."/>
          <WTSETATTRIBUTE name="PARAM(PinNumber)" value="CONST(&quot;&quot;)"/>
        </WTCODEGROUP>
        <WTCALLSUB name="ValidPin reqMerchantID, reqPinNumber, reqStaffID, reqStaffName">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETCOOKIE name="CONST(BADPIN)" value="CONST(0)"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="IsErrors"/>
          <WTGETCOOKIE name="CONST(tmpBadPin)" value="CONST(BADPIN)" datatype="number"/>
          <WTSETATTRIBUTE name="CONST(tmpBadPin)" value="CONST(tmpBadPin + 1)"/>
          <WTSETCOOKIE name="CONST(BADPIN)" value="CONST(tmpBadPin)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(tmpBadPin)" oper="greater-equal" value="CONST(3)"/>
            <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
              <WTMETHOD name="Load">
                <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
                <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
              </WTMETHOD>
              <WTSETATTRIBUTE name="ATTR(Status)" value="CONST(3)"/>
              <WTMETHOD name="Save">
                <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
              </WTMETHOD>
            </WTOBJECT>
            <WTCUSTOM>
              response.write "Invalid Access - Membership Cancelled - Contact support@NexxusRewards.com"
              response.end
            </WTCUSTOM>
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTSETATTRIBUTE name="PARAM(PinNumber)" value="CONST(&quot;&quot;)"/>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="NewShopper(0)"/>
      </WTACTION>

      <WTACTION id="13" name="CancelOrder" type="New">
        <WTCALLSUB name="NewShopper(1)"/>
      </WTACTION>

      <WTACTION id="1" name="Order_Cash" type="New">
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-CASH)"/>
        <WTCALLSUB name="SetupOrder"/>
      </WTACTION>

      <WTACTION id="12" name="Order_Redeem" type="New">
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-REDEEM)"/>
        <WTCALLSUB name="SetupOrder"/>
      </WTACTION>

      <WTACTION id="44" name="Payment_RedeemPswd" type="New">
        <WTCALLSUB name="ValidRedeem reqConsumerID, reqRedeemPswd, 1, 1, 1"/>
        <WTSETATTRIBUTE name="PARAM(RedeemPswd)" value="CONST(&quot;&quot;)">
          <WTCONDITION expr="IsErrors"/>
        </WTSETATTRIBUTE>
      </WTACTION>

      <WTACTION id="4" name="Payment_Redeem" type="New">
        <WTCALLSUB name="ValidStaff"/>

        <WTCALLSUB name="ValidOrder reqOrderType, reqIsTicket, reqTicketNumber, reqTotalAmount, reqNetAmount">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCALLSUB name="ValidRedeem reqConsumerID, reqRedeemPswd, reqRewardValueRaw, reqTotalAmount, reqNetAmount">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <!-- Set Flag to log IP Info -->
          <WTSETATTRIBUTE name="PARAM(Payment2ID)" value="CONST(-1)"/>
          <WTCALLSUB name="AddOrder reqOrderType, reqMerchantID, reqConsumerID, reqAwardID, reqPayDate, reqStaffID, reqDescription, reqTotalAmount, reqNetAmount, reqTicketNumber, reqPayType, reqCurrencyCode, reqCoinType, reqQR_Address, reqPayment2ID, reqCoinToken, reqIsDemo"/>
          <WTCALLSUB name="ProcessOrder reqCompanyID, reqPayment2ID, reqReward, reqAward, reqRedeem, reqTotalReward, reqTotalAward">
            <WTCONDITION expr="NoErrors"/>
          </WTCALLSUB>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
        </WTCODEGROUP>
        <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
      </WTACTION>

      <WTACTION id="5" name="Payment_Add" type="Add">
        <WTCALLSUB name="ValidStaff"/>

        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(TotalAmount)" value="PARAM(NetAmount)">
            <WTCONDITION expr="PARAM(TotalAmount)" oper="equal" value="CONST(&quot;&quot;)"/>
          </WTSETATTRIBUTE>
          <WTCALLSUB name="ValidOrder reqOrderType, reqIsTicket, reqTicketNumber, reqTotalAmount, reqNetAmount"/>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <!-- Set Flag to log IP Info -->
            <WTSETATTRIBUTE name="PARAM(Payment2ID)" value="CONST(-1)"/>
            <WTCALLSUB name="AddOrder reqOrderType, reqMerchantID, reqConsumerID, reqAwardID, reqPayDate, reqStaffID, reqDescription, reqTotalAmount, reqNetAmount, reqTicketNumber, reqPayType, reqCurrencyCode, reqCoinType, reqQR_Address, reqPayment2ID, reqCoinToken, reqIsDemo"/>
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>

          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CASH)"/>
            <WTCALLSUB name="ProcessOrder reqCompanyID, reqPayment2ID, reqReward, reqAward, reqRedeem, reqTotalReward, reqTotalAward">
              <WTCONDITION expr="NoErrors"/>
            </WTCALLSUB>
            <WTCODEGROUP>
              <WTCONDITION expr="NoErrors"/>
              <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
              <WTCALLSUB name="ApproveOrder reqPayment2ID">
                <WTCONDITION expr="PARAM(IsApprove)" oper="equal" value="CONST(1)"/>
              </WTCALLSUB>
            </WTCODEGROUP>
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
      </WTACTION>

      <WTACTION id="9" name="Cancel" type="Cancel">
        <WTRETURN/>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="17" align="right"/>
        <WTCOLUMN width="83" align="left"/>

        <!-- Convert input to digits only if no @ sign for an email -->
        <WTFUNCTION name="LogonDigitsOnly(obj)">
          var val = obj.value;
          if(val.indexOf('@') === -1)	{
          obj.value = val.replace(/\D/g,'');
          }
        </WTFUNCTION>

        <WTFUNCTION name="GetCoinPrice()">
          var coin = document.getElementById('PayType').value - 2;
          var url = "CoinPrice.asp?c=" + coin
          var xmlhttp;
          if (window.XMLHttpRequest) {
          // code for IE7+, Firefox, Chrome, Opera, Safari
          xmlhttp = new XMLHttpRequest();
          }
          else {
          // code for IE6, IE5
          xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
          }
          xmlhttp.onreadystatechange = function () {
          if (this.readyState == 4 &amp;&amp; this.status == 200) {
          document.getElementById('CoinPrice').value = this.responseText;
          }
          };
          xmlhttp.open("GET", url, true);
          xmlhttp.send();
        </WTFUNCTION>

        <WTFUNCTION name="OrderInfo()">
          var pid = document.getElementById('Payment2ID').value;
          var url = "16504.asp?payment2id=" + pid
          var win = window.open(url,"OrderInfo","top=100,left=100,height=350,width=425,resizable=yes,status=no,toolbar=no,menubar=no,location=no,titlebar=no,scrollbars=1")
        </WTFUNCTION>

        <WTFUNCTION name="Init()">
          var orderprocess = document.getElementById('OrderProcess').value;
          var ordertype = document.getElementById('OrderType').value;
          if( orderprocess == 2 ) {
          try {
          GetCryptoPayment();
          new Clipboard('#CopyButton');
          var isdemo = document.getElementById('IsDemo').value;
          if( isdemo == 0 ) { UpdateTimer(); }
          }
          catch(err) {
          alert(err.message);
          }
          };
        </WTFUNCTION>

        <WTFUNCTION name="CopyTotalAmount()">
          var amt = document.getElementById('TotalAmount').value;
          document.getElementById('NetAmount').value = amt;
        </WTFUNCTION>

        <WTLOAD>
          Init();
        </WTLOAD>

        <WTROW>
          <WTHIDDEN value="PARAM(MerchantID)"/>
          <WTHIDDEN value="PARAM(ConsumerID)"/>
          <WTHIDDEN value="PARAM(ConsumerName)"/>
          <WTHIDDEN value="PARAM(MerchantName)"/>
          <WTHIDDEN value="PARAM(StaffName)"/>
          <WTHIDDEN value="PARAM(StaffID)"/>
          <WTHIDDEN value="PARAM(IsPin)"/>
          <WTHIDDEN value="PARAM(IsTicket)"/>
          <WTHIDDEN value="PARAM(IsApprove)"/>
          <WTHIDDEN value="PARAM(IsAwards)"/>
          <WTHIDDEN value="PARAM(AcceptedCoins)"/>
          <WTHIDDEN value="PARAM(NXC)"/>
          <WTHIDDEN value="PARAM(RewardPoints)"/>
          <WTHIDDEN value="PARAM(RewardValue)"/>
          <WTHIDDEN value="PARAM(RewardValueRaw)"/>
          <WTHIDDEN value="PARAM(OrderType)"/>
          <WTHIDDEN value="PARAM(OrderProcess)"/>
          <WTHIDDEN value="PARAM(Payment2ID)"/>
          <WTHIDDEN value="PARAM(CoinType)"/>
          <WTHIDDEN value="PARAM(CryptoStatus)"/>
          <WTHIDDEN value="PARAM(CoinToken)"/>
          <WTHIDDEN value="PARAM(CurrencyCode)"/>
          <WTHIDDEN value="PARAM(IsDemo)"/>
          <WTHIDDEN value="PARAM(ReplaceURL)"/>
          
          <WTHIDDEN value="PARAM(PayDate)"/>
          <WTHIDDEN value="PARAM(AwardID)"/>
          <WTHIDDEN value="PARAM(RewardName)"/>
          <WTHIDDEN value="PARAM(Terms)"/>
        </WTROW>

        <WTSTATIC label="ViewOrderInfo"/>
        <WTSTATIC label="CheckPayment"/>
        <WTSTATIC label="CopyTotal"/>

        <WTROW>
          <WTSTATIC col="1" merge="2" class="PageHeading" align="center">
<!--            <WTSTATIC tag="NewOrder"/>-->
            <WTSTATIC value="PARAM(MerchantName)" space="1"/>
            <WTSTATIC value="CONST(#&lt;xsl:value-of select=&quot;/DATA/PARAM/@merchantid&quot;/&gt;)"/>
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(IsDemo)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC space="1"/>
              <WTSTATIC label="Demo" fontcolor="red"/>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>

        <!-- **************************************************************************************************-->
        <!-- GET THE SHOPPER AND TYPE OF ORDER                                                          -->
        <!-- **************************************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-NEW)"/>

          <WTROW margin-top="12" margin-bottom="12">
            <WTTABLE col="1" merge="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
              <WTCOLUMN width="48" align="right"/>
              <WTCOLUMN width="48" align="left"/>
              <WTCODEGROUP>
                <WTCONDITION expr="NotUser2FA"/>
                <WTROW margin-top="24" margin-bottom="24">
                  <WTSTATIC col="1" merge="2" label="2FARequired" align="center" fontsize="4" fontcolor="red"/>
                </WTROW>
              </WTCODEGROUP>
              <WTCODEGROUP>
                <WTCONDITION expr="IsUser2FA"/>
                <WTROW margin-bottom="6">
                  <WTIMAGE col="1" merge="2" value="CONST(NXC50.png)" align="center"/>
                </WTROW>
                <WTROW margin-top="12">
                  <WTSTATIC col="1" merge="2" tag="LogonConsumer2" align="center" fontsize="4"/>
                </WTROW>
                <WTROW>
                  <WTTEXT col="1" merge="2" value="PARAM(LogonConsumer)" align="center" size="15" textclass="bigtext" prespace="false">
                    <WTEXIT>LogonDigitsOnly(this);</WTEXIT>
                  </WTTEXT>
                </WTROW>
                <WTROW margin-top="12">
                  <WTCONDITION expr="PARAM(Terms)" oper="not-equal" value="CONST('')"/>
                  <WTSTATIC col="1" merge="2" value="PARAM(Terms)" align="center" fontsize="3"/>
                </WTROW>

                <WTROW margin-top="12">
                  <WTBUTTON col="1" merge="2" action="1" value="CONST(ShopperRequestReward)" align="center" btnclass="hugebutton"/>
                </WTROW>
                <WTROW margin-top="12">
                  <WTBUTTON col="1" merge="2" action="12" value="CONST(ShopperRedeemReward)" align="center" btnclass="hugebutton"/>
                </WTROW>
                <WTROW margin-top="24">
                  <WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
                    <WTCLICK>window.close()</WTCLICK>
                  </WTBUTTON>
                </WTROW>
                
              </WTCODEGROUP>

            </WTTABLE>
          </WTROW>
        </WTCODEGROUP>

        <!-- **************************************************************************************************-->
        <!-- GET THE ORDER DETAIL INFORMATION FOR THE TYPE OF ORDER                                                          -->
        <!-- **************************************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-ORDER)"/>

          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
            <WTCONDITION expr="PARAM(RedeemPswd)" oper="equal" value="CONST('')" connector="and"/>
            <WTROW margin-top="12" margin-bottom="6">
              <WTSTATIC col="1" merge="2" tag="RedeemPswd" bold="true" align="center"/>
              <WTTEXT col="1" value="PARAM(RedeemPswd)" align="left" size="10" secure="true" prespace="false"/>
              <WTBUTTON col="1" action="44" value="CONST(Submit)"/>
            </WTROW>
          </WTCODEGROUP>
          
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="not-equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
            <WTCONDITION expr="PARAM(RedeemPswd)" oper="not-equal" value="CONST('')" connector="or"/>

            <WTROW>
              <WTHIDDEN value="PARAM(RedeemPswd)"/>
            </WTROW>
            
            <WTROW margin-top="12" margin-bottom="6">
              <WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
                <WTSTATIC tag="ConsumerName"/>
                <WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
                <WTCODEGROUP>
                  <WTBUTTON action="0" value="CONST(Change)" btnclass="smbutton"/>
                </WTCODEGROUP>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
              <WTCONDITION expr="PARAM(RewardPoints)" oper="not-equal" value="CONST(0)" connector="and"/>
              <WTSTATIC col="1" merge="2" align="center" fontsize="3">
                <WTSTATIC value="PARAM(RewardPoints)" bold="true" space="1"/>
                <WTSTATIC label="RewardPoints" space="1"/>
                <WTSTATIC value="PARAM(RewardValue)" bold="true" space="2"/>
                <WTSTATIC fontsize="2">
                  <WTSTATIC label="PointValue"/>
                  <WTSTATIC value="PARAM(NXC)" space="1"/>
                  <WTSTATIC label="PointValue2"/>
                </WTSTATIC>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-top="6" margin-bottom="6">
              <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
            </WTROW>

            <!-- **************************************************************************************************-->
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" merge="2" value="PARAM(RewardName)" fontsize="4" align="center"/>
            </WTROW>
            
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
              <WTROW margin-bottom="6">
                <WTSTATIC col="1" merge="2" tag="Available" align="center" fontsize="5"/>
                <WTSTATIC col="1" value="PARAM(RewardValue)" fontsize="5" prespace="false"/>
              </WTROW>
              <WTROW>
                <WTSTATIC col="1" merge="2" label="TotalAmountText2" class="prompt" bold="true" align="center"/>
              </WTROW>
              <WTROW margin-bottom="6">
                <WTSTATIC col="1" merge="2" tag="mTotalAmount" align="center"/>
                <WTTEXT col="1" value="PARAM(TotalAmount)" size="10" textclass="bigtext" prespace="false">
                  <WTKEY>CopyTotalAmount();</WTKEY>
                </WTTEXT>
              </WTROW>
            </WTCODEGROUP>
            <WTROW>
              <WTSTATIC col="1" merge="2" label="NetAmountText" class="prompt" bold="true" align="center"/>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" merge="2" tag="mNetAmount" align="center"/>
              <WTTEXT col="1" value="PARAM(NetAmount)" size="10" textclass="bigtext" prespace="false"/>
            </WTROW>
            <WTROW margin-top="12" id="RedeemRow">
              <WTTABLE col="1" merge="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
                <WTCOLUMN width="80" align="center"/>
                <WTROW>
                  <WTSTATIC col="1" label="BusinessUseOnly" align="center" fontsize="2" bold="true"/>
                </WTROW>
                <WTROW margin-top="6">
                  <WTSTATIC col="1" tag="ApprovalCode" align="center"/>
                  <WTTEXT col="1" value="PARAM(PinNumber)" size="5" secure="true" textclass="bigtext" prespace="false"/>
                </WTROW>
                <WTROW margin-top="6">
                  <WTBUTTON col="1" action="5" value="CONST(Approve)" align="center" btnclass="bigbutton">
                    <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CASH)"/>
                    <WTCLICK>doSubmit(5,&quot;&quot;); this.disabled = true;</WTCLICK>
                  </WTBUTTON>
                  <WTBUTTON col="1" action="4" value="CONST(Approve)" align="center" btnclass="bigbutton">
                    <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-REDEEM)"/>
                    <WTCLICK>doSubmit(4,&quot;&quot;); this.disabled = true;</WTCLICK>
                  </WTBUTTON>
                </WTROW>
              </WTTABLE>
            </WTROW>

          </WTCODEGROUP>

          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
              <WTCLICK>window.open('','_self').close()</WTCLICK>
            </WTBUTTON>
          </WTROW>

        </WTCODEGROUP>

        <!-- **************************************************************************************************-->
        <!-- CONFIRM THE ORDER AND CLOSE                                                          -->
        <!-- **************************************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1" merge="2" align="center" fontsize="3">
              <WTSTATIC tag="ConsumerName"/>
              <WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
            </WTSTATIC>
          </WTROW>
          <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="blue">
            <WTSTATIC label="SuccessfulOrder"/>
          </WTSTATIC>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="not-equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTROW margin-top="12">
              <WTCONDITION expr="PARAM(Redeem)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="red">
                <WTSTATIC value="PARAM(Redeem)" bold="true" space="1"/>
                <WTSTATIC label="RedeemedRewardPoints"/>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-top="12">
              <WTCONDITION expr="PARAM(Reward)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="green">
                <WTSTATIC value="PARAM(Reward)" bold="true" space="1"/>
                <WTSTATIC label="CashbackRewardPoints" space="1"/>
                <WTSTATIC value="CONST(()"/>
                <WTSTATIC value="PARAM(TotalReward)" bold="true" space="1"/>
                <WTSTATIC label="total"/>
                <WTSTATIC value="CONST())"/>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-top="12">
              <WTCONDITION expr="PARAM(Award)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="green">
                <WTSTATIC value="PARAM(Award)" bold="true" space="1"/>
                <WTSTATIC label="SpecialAwardPoints" space="1"/>
                <WTSTATIC value="CONST(()"/>
                <WTSTATIC value="PARAM(TotalAward)" bold="true" space="1"/>
                <WTSTATIC label="total"/>
                <WTSTATIC value="CONST())"/>
              </WTSTATIC>
            </WTROW>
          </WTCODEGROUP>
<!--          
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTROW margin-top="12">
              <WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="red">
                <WTSTATIC value="PARAM(Award)" bold="true" space="1"/>
                <WTSTATIC label="RedeemedAwardPoints"/>
              </WTSTATIC>
            </WTROW>
          </WTCODEGROUP>
          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" merge="2" action="0" value="CONST(NewOrder)" btnclass="bigbutton" align="center"/>
          </WTROW>
-->
          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--============================================================================================-->
		<WTWEBPAGE name="15204" caption="Redeem Reward" header="false" footer="false" navbar="false" wrapper="wrapper600"
		 aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLAdd.xsl">
			<!--============================================================================================-->
			<WTPARAM name="MerchantID" datatype="number"/>
			<WTPARAM name="ConsumerID" datatype="number"/>
			<WTPARAM name="ConsumerName" datatype="text"/>
			<WTPARAM name="LogonConsumer" datatype="text"/>
			<WTPARAM name="Password" datatype="text"/>
			<WTPARAM name="IsAwards" datatype="number"/>
			<WTPARAM name="Purchase" datatype="text"/>
			<WTPARAM name="TotalCashBack" datatype="currency"/>
			<WTPARAM name="TotalAwards" datatype="currency"/>
			<WTPARAM name="RewardType" datatype="number"/>
			<WTPARAM name="Reward" datatype="currency"/>

			<WTSUB name="GetConsumerName">
				<WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Logon">
						<WTPARAM name="Email" direction="input" value="PARAM(LogonConsumer)"/>
						<WTPARAM name="Password" direction="input" value="PARAM(Password)"/>
						<WTPARAM name="Result" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="greater" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(Result)"/>
						<WTMETHOD name="Load">
							<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
						<WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000002)"/>
						<WTERROR number="10129" message="Oops, The Email Address could not be found."/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000003)"/>
						<WTERROR number="10134" message="Oops, The Phone Number could not be found."/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000004)"/>
						<WTERROR number="10130" message="Oops, The Password is incorrect."/>
					</WTCODEGROUP>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="NewReward">
				<WTSETATTRIBUTE name="PARAM(RewardType)" value="CONST(1)"/>
				<WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
					<WTMETHOD name="Load">
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(IsAwards)" value="ATTR(IsAwards)"/>
				</WTOBJECT>
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="Load">
						<WTPARAM name="RewardID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(RewardDate)" value="SYS(Now)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlReward" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="TotalReward">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="MerchantID" direction="input" value="CONST(0)"/>
						<WTPARAM name="reqTotalCashBack" direction="return" datatype="currency"/>
					</WTMETHOD>
					<WTMETHOD name="TotalReward">
						<WTCONDITION expr="PARAM(IsAwards)" oper="not-equal" value="CONST(0)"/>
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
						<WTPARAM name="reqTotalAwards" direction="return" datatype="currency"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="AddReward">
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="Load">
						<WTPARAM name="RewardID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(MerchantID)" value="PARAM(MerchantID)"/>
					<WTSETATTRIBUTE name="ATTR(ConsumerID)" value="PARAM(ConsumerID)"/>
					<WTSETATTRIBUTE name="ATTR(Status)" value="CONST(1)"/>
					<WTSETATTRIBUTE name="ATTR(RewardType)" value="PARAM(RewardType)"/>
					<WTSETATTRIBUTES/>
          <WTSETATTRIBUTE name="CONST(tmpAmount)" value="CONST(Round(reqPurchase * -1,2))"/>
          <WTSETATTRIBUTE name="ATTR(Amount)" value="CONST(toSatoshi(tmpAmount))"/>
          <WTMETHOD name="Add">
						<WTPARAM name="RewardID" direction="return" datatype="number"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Reward)" value="CONST(FormatCurrency(tmpAmount))">
						<WTCONDITION expr="NoErrors"/>
					</WTSETATTRIBUTE>
					<WTMETHOD name="XML">
						<WTCONDITION expr="IsErrors"/>
						<WTPARAM name="xmlReward" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTACTION id="0" name="New" type="New">
			</WTACTION>

			<WTACTION id="1" name="Consumer" type="New">
				<WTCALLSUB name="GetConsumerName"/>
				<WTCALLSUB name="NewReward">
					<WTCONDITION expr="PARAM(ConsumerName)" oper="not-equal" value="CONST(&quot;&quot;)"/>
				</WTCALLSUB>
			</WTACTION>

			<WTACTION id="2" name="Add" type="Add">
				<WTCALLSUB name="AddReward"/>
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="4" name="NotConsumer" type="New">
				<WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(0)"/>
			</WTACTION>

      <!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="100" align="right"/>
				<WTCOLUMN width="500" align="left"/>

				<!-- Convert input to digits only if no @ sign for an email -->
				<WTFUNCTION name="LogonDigitsOnly(obj)">
					var val = obj.value;
					if(val.indexOf('@') === -1)	{
					obj.value = val.replace(/\D/g,'');
					}
				</WTFUNCTION>
				<WTFUNCTION name="ValidPurchase()">
					var rewardtype = document.getElementById('RewardType').value;
					var cashback = document.getElementById('TotalCashBack').value;
					var awards = document.getElementById('TotalAwards').value;
					var purchase = document.getElementById('Purchase').value;
					if(purchase == '') {
						alert('Please enter a purchase price');
					}
					if( rewardtype == 1) {
					if(Number(purchase) &gt; Number(cashback)) {
							document.getElementById('Purchase').value = cashback;
							alert('Purchase amount must not be greater than Cash Back Reward');
						}
					}
					if( rewardtype == 2) {
						if(Number(purchase) &gt; Number(awards)) {
							document.getElementById('Purchase').value = awards;
							alert('Purchase amount must not be greater than Award Points');
						}
					}
				</WTFUNCTION>

				<WTROW>
					<WTHIDDEN value="PARAM(MerchantID)"/>
					<WTHIDDEN value="PARAM(ConsumerID)"/>
					<WTHIDDEN value="PARAM(ConsumerName)"/>
					<WTHIDDEN value="PARAM(TotalCashBack)"/>
					<WTHIDDEN value="PARAM(TotalAwards)"/>
					<WTHIDDEN value="PARAM(IsAwards)"/>
				</WTROW>

				<WTROW>
					<WTSTATIC col="1" merge="2" label="RedeemReward" class="PageHeading" align="left"/>
				</WTROW>
				<WTROW margin-bottom="3">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(ConsumerName)" oper="equal" value="CONST('')"/>

					<WTROW margin-top="12" margin-bottom="12">
						<WTTABLE col="1" merge="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
							<WTCOLUMN width="200" align="right"/>
							<WTCOLUMN width="200" align="left"/>
							<WTROW>
								<WTSTATIC col="1" merge="2" label="WhoConsumer" align="center" fontsize="4"/>
							</WTROW>
							<WTROW margin-top="12" margin-bottom="6">
								<WTSTATIC col="1" tag="LogonConsumer" align="right"/>
								<WTTEXT col="2" value="PARAM(LogonConsumer)" align="left" size="20">
									<WTEXIT>LogonDigitsOnly(this);</WTEXIT>
								</WTTEXT>
							</WTROW>
							<WTROW>
								<WTSTATIC col="1" tag="Password" align="right"/>
								<WTTEXT col="2" value="PARAM(Password)" align="left" size="20" required="false" secure="true"/>
							</WTROW>
							<WTROW margin-top="12" margin-bottom="12">
								<WTBUTTON col="1" merge="2" action="1" value="CONST(Continue)" align="center" btnclass="bigbutton"/>
								<WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)" btnclass="bigbutton"/>
							</WTROW>
						</WTTABLE>
					</WTROW>
				</WTCODEGROUP>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Reward)" oper="equal" value="CONST('')"/>

					<WTCODEGROUP>
						<WTCONDITION expr="PARAM(ConsumerName)" oper="not-equal" value="CONST('')"/>

						<WTROW margin-top="12" margin-bottom="12">
							<WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
								<WTSTATIC tag="ConsumerName"/>
								<WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
								<WTCODEGROUP>
									<WTBUTTON action="4" value="CONST(Change)" btnclass="smbutton"/>
								</WTCODEGROUP>
							</WTSTATIC>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTRADIO col="1" group="RewardType" name="1" align="right" valign="top" datapathx="/DATA/PARAM/@rewardtype=1"/>
							<WTSTATIC col="2" fontsize="3">
								<WTSTATIC value="PARAM(TotalCashBack)" bold="true" space="1"/>
								<WTSTATIC label="TotalCashBack"/>
							</WTSTATIC>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTCONDITION expr="PARAM(IsAwards)" oper="not-equal" value="CONST(0)"/>
							<WTRADIO col="1" group="RewardType" name="2" align="right" valign="top" datapathx="/DATA/PARAM/@rewardtype=2"/>
							<WTSTATIC col="2" fontsize="3">
								<WTSTATIC value="PARAM(TotalAwards)" bold="true" space="1"/>
								<WTSTATIC label="TotalAwards"/>
							</WTSTATIC>
						</WTROW>
						<WTROW margin-top="6" margin-bottom="6">
							<WTSTATIC col="1" tag="RewardDate"/>
							<WTTEXT col="2" value="ATTR(Reward.RewardDate)" size="15"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="Purchase"/>
							<WTTEXT col="2" value="PARAM(Purchase)" size="15">
								<WTEXIT>ValidPurchase();</WTEXIT>
							</WTTEXT>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="Reference"/>
							<WTTEXT col="2" value="ATTR(Reward.Reference)" size="15"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="Note"/>
							<WTMEMO col="2" value="ATTR(Reward.Note)" rows="2" cols="50"/>
						</WTROW>

						<WTROW margin-top="12" margin-bottom="12">
							<WTBUTTON col="1" merge="2" action="2" value="CONST(Redeem)" align="center" btnclass="bigbutton"/>
							<WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)"/>
						</WTROW>
					</WTCODEGROUP>
				</WTCODEGROUP>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Reward)" oper="not-equal" value="CONST('')"/>
					<WTROW margin-top="12">
						<WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
							<WTSTATIC tag="ConsumerName"/>
							<WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-top="12" margin-bottom="12">
						<WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="red">
							<WTSTATIC tag="Reward"/>
							<WTSTATIC value="PARAM(Reward)" bold="true"/>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-bottom="12">
						<WTBUTTON col="1" merge="2" action="3" value="CONST(Continue)" btnclass="bigbutton" align="center"/>
					</WTROW>
				</WTCODEGROUP>

			</WTCONTENT>
		</WTWEBPAGE>

		<!--============================================================================================-->
		<WTWEBPAGE name="m_15204" caption="Redeem Reward" page-left="0" page-top="0" navbar="false" header="false" footer="false" wrapper="false"
			page-width="100%" margin-width="0" navbar-width="0" content-width="100%" viewport="width=device-width"
		   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLAdd.xsl">
			<!--============================================================================================-->
			<WTPARAM name="MerchantID" datatype="number"/>
			<WTPARAM name="ConsumerID" datatype="number"/>
			<WTPARAM name="ConsumerName" datatype="text"/>
			<WTPARAM name="LogonConsumer" datatype="text"/>
			<WTPARAM name="Password" datatype="text"/>
			<WTPARAM name="IsAwards" datatype="number"/>
			<WTPARAM name="Purchase" datatype="text"/>
			<WTPARAM name="TotalCashBack" datatype="currency"/>
			<WTPARAM name="TotalAwards" datatype="currency"/>
			<WTPARAM name="RewardType" datatype="number"/>
			<WTPARAM name="Reward" datatype="currency"/>

			<WTSUB name="GetConsumerName">
				<WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Logon">
						<WTPARAM name="Email" direction="input" value="PARAM(LogonConsumer)"/>
						<WTPARAM name="Password" direction="input" value="PARAM(Password)"/>
						<WTPARAM name="Result" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="greater" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(Result)"/>
						<WTMETHOD name="Load">
							<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
						<WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000002)"/>
						<WTERROR number="10129" message="Oops, The Email Address could not be found."/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000003)"/>
						<WTERROR number="10134" message="Oops, The Phone Number could not be found."/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000004)"/>
						<WTERROR number="10130" message="Oops, The Password is incorrect."/>
					</WTCODEGROUP>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="NewReward">
				<WTSETATTRIBUTE name="PARAM(RewardType)" value="CONST(1)"/>
				<WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
					<WTMETHOD name="Load">
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(IsAwards)" value="ATTR(IsAwards)"/>
				</WTOBJECT>
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="Load">
						<WTPARAM name="RewardID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(RewardDate)" value="SYS(Now)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlReward" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="TotalReward">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="MerchantID" direction="input" value="CONST(0)"/>
						<WTPARAM name="reqTotalCashBack" direction="return" datatype="currency"/>
					</WTMETHOD>
					<WTMETHOD name="TotalReward">
						<WTCONDITION expr="PARAM(IsAwards)" oper="not-equal" value="CONST(0)"/>
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
						<WTPARAM name="reqTotalAwards" direction="return" datatype="currency"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="AddReward">
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="Load">
						<WTPARAM name="RewardID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(MerchantID)" value="PARAM(MerchantID)"/>
					<WTSETATTRIBUTE name="ATTR(ConsumerID)" value="PARAM(ConsumerID)"/>
					<WTSETATTRIBUTE name="ATTR(Status)" value="CONST(1)"/>
					<WTSETATTRIBUTE name="ATTR(RewardType)" value="PARAM(RewardType)"/>
					<WTSETATTRIBUTES/>
          <WTSETATTRIBUTE name="CONST(tmpAmount)" value="CONST(Round(reqPurchase * -1,2))"/>
          <WTSETATTRIBUTE name="ATTR(Amount)" value="CONST(toSatoshi(tmpAmount))"/>
          <WTMETHOD name="Add">
						<WTPARAM name="RewardID" direction="return" datatype="number"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Reward)" value="CONST(FormatCurrency(tmpAmount))">
						<WTCONDITION expr="NoErrors"/>
					</WTSETATTRIBUTE>
					<WTMETHOD name="XML">
						<WTCONDITION expr="IsErrors"/>
						<WTPARAM name="xmlReward" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTACTION id="0" name="New" type="New">
			</WTACTION>

			<WTACTION id="1" name="Consumer" type="New">
				<WTCALLSUB name="GetConsumerName"/>
				<WTCALLSUB name="NewReward">
					<WTCONDITION expr="PARAM(ConsumerName)" oper="not-equal" value="CONST(&quot;&quot;)"/>
				</WTCALLSUB>
			</WTACTION>

			<WTACTION id="2" name="Add" type="Add">
				<WTCALLSUB name="AddReward"/>
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="4" name="NotConsumer" type="New">
				<WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(0)"/>
			</WTACTION>
			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="25" align="right"/>
				<WTCOLUMN width="75" align="left"/>

				<!-- Convert input to digits only if no @ sign for an email -->
				<WTFUNCTION name="LogonDigitsOnly(obj)">
					var val = obj.value;
					if(val.indexOf('@') === -1)	{
					obj.value = val.replace(/\D/g,'');
					}
				</WTFUNCTION>
				<WTFUNCTION name="ValidPurchase()">
					var rewardtype = document.getElementById('RewardType').value;
					var cashback = document.getElementById('TotalCashBack').value;
					var awards = document.getElementById('TotalAwards').value;
					var purchase = document.getElementById('Purchase').value;
					if(purchase == '') {
						alert('Please enter a purchase price');
					}
					if( rewardtype == 1) {
					if(Number(purchase) &gt; Number(cashback)) {
							document.getElementById('Purchase').value = cashback;
							alert('Purchase amount must not be greater than Cash Back Reward');
						}
					}
					if( rewardtype == 2) {
						if(Number(purchase) &gt; Number(awards)) {
							document.getElementById('Purchase').value = awards;
							alert('Purchase amount must not be greater than Award Points');
						}
					}
				</WTFUNCTION>

				<WTROW>
					<WTHIDDEN value="PARAM(MerchantID)"/>
					<WTHIDDEN value="PARAM(ConsumerID)"/>
					<WTHIDDEN value="PARAM(ConsumerName)"/>
					<WTHIDDEN value="PARAM(TotalCashBack)"/>
					<WTHIDDEN value="PARAM(TotalAwards)"/>
					<WTHIDDEN value="PARAM(IsAwards)"/>
				</WTROW>

				<WTROW>
					<WTSTATIC col="1" merge="2" label="RedeemReward" class="PageHeading" align="left"/>
				</WTROW>
				<WTROW margin-bottom="3">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(ConsumerName)" oper="equal" value="CONST('')"/>

					<WTROW margin-top="12" margin-bottom="12">
						<WTTABLE col="1" merge="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:5px; BACKGROUND-COLOR: #d1fa99">
							<WTCOLUMN width="50" align="right"/>
							<WTCOLUMN width="50" align="left"/>
							<WTROW>
								<WTSTATIC col="1" merge="2" label="WhoConsumer" align="center" fontsize="4"/>
							</WTROW>
							<WTROW margin-top="12">
								<WTSTATIC col="1" merge="2" tag="LogonConsumer" align="center"/>
							</WTROW>
							<WTROW>
								<WTTEXT col="1" merge="2" value="PARAM(LogonConsumer)" align="center" size="15" textclass="bigtext">
									<WTEXIT>LogonDigitsOnly(this);</WTEXIT>
								</WTTEXT>
							</WTROW>
							<WTROW margin-top="12">
								<WTSTATIC col="1" merge="2" tag="Password" align="center"/>
								<WTTEXT col="1"  merge="2" value="PARAM(Password)" align="left" size="10" required="false" secure="true" textclass="bigtext"/>
							</WTROW>
							<WTROW margin-top="12" margin-bottom="12">
								<WTBUTTON col="1" merge="2" action="1" value="CONST(Continue)" align="center" btnclass="bigbutton"/>
								<WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)" btnclass="bigbutton"/>
							</WTROW>
						</WTTABLE>
					</WTROW>
				</WTCODEGROUP>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Reward)" oper="equal" value="CONST('')"/>
					
					<WTCODEGROUP>
						<WTCONDITION expr="PARAM(ConsumerName)" oper="not-equal" value="CONST('')"/>

						<WTROW margin-top="12" margin-bottom="12">
							<WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
								<WTSTATIC tag="ConsumerName"/>
								<WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
								<WTCODEGROUP>
									<WTBUTTON action="4" value="CONST(Change)" btnclass="smbutton"/>
								</WTCODEGROUP>
							</WTSTATIC>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
						</WTROW>
						<WTROW margin-bottom="12">
							<WTRADIO col="1" group="RewardType" name="1" align="right" valign="top" datapathx="/DATA/PARAM/@rewardtype=1"/>
							<WTSTATIC col="2" fontsize="3">
								<WTSTATIC value="PARAM(TotalCashBack)" bold="true" space="1"/>
								<WTSTATIC label="TotalCashBack"/>
							</WTSTATIC>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTCONDITION expr="PARAM(IsAwards)" oper="not-equal" value="CONST(0)"/>
							<WTRADIO col="1" group="RewardType" name="2" align="right" valign="top" datapathx="/DATA/PARAM/@rewardtype=2"/>
							<WTSTATIC col="2" fontsize="3">
								<WTSTATIC value="PARAM(TotalAwards)" bold="true" space="1"/>
								<WTSTATIC label="TotalAwards"/>
							</WTSTATIC>
						</WTROW>
						<WTROW margin-top="6" margin-bottom="6">
							<WTSTATIC col="1" tag="RewardDate"/>
							<WTTEXT col="2" value="ATTR(Reward.RewardDate)" size="13" textclass="bigtext"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="Purchase"/>
							<WTTEXT col="2" value="PARAM(Purchase)" size="13" textclass="bigtext">
								<WTEXIT>ValidPurchase();</WTEXIT>
							</WTTEXT>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" tag="Reference"/>
							<WTTEXT col="2" value="ATTR(Reward.Reference)" size="13" textclass="bigtext"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" merge="2" tag="Note" align="left"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTMEMO col="1" merge="2" value="ATTR(Reward.Note)" rows="2" cols="35" align="left"/>
						</WTROW>

						<WTROW margin-top="12" margin-bottom="12">
							<WTBUTTON col="1" merge="2" action="2" value="CONST(Redeem)" align="center" btnclass="bigbutton"/>
							<WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)" btnclass="bigbutton"/>
						</WTROW>
					</WTCODEGROUP>
				</WTCODEGROUP>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Reward)" oper="not-equal" value="CONST('')"/>
					<WTROW margin-top="12">
						<WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
							<WTSTATIC tag="ConsumerName"/>
							<WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-top="12" margin-bottom="12">
						<WTSTATIC col="1" merge="2" align="center" fontsize="4" fontcolor="red">
							<WTSTATIC tag="Reward"/>
							<WTSTATIC value="PARAM(Reward)" bold="true"/>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-bottom="12">
						<WTBUTTON col="1" merge="2" action="3" value="CONST(Continue)" btnclass="bigbutton" align="center"/>
					</WTROW>
				</WTCODEGROUP>
			</WTCONTENT>
		</WTWEBPAGE>

		<!--============================================================================================-->
		<WTWEBPAGE name="15203" caption="Reward" header="false" footer="false" navbar="false" wrapper="wrapper600"
		 aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl">
		<!--============================================================================================-->
			<WTPARAM name="RewardID" datatype="number"/>

			<WTACTION id="0" name="New" type="New">
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="Load">
						<WTPARAM name="RewardID" direction="input" value="PARAM(RewardID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlReward" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="1" name="Update" type="Update">
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="Load">
						<WTPARAM name="RewardID" direction="input" value="PARAM(RewardID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTES/>
          <!-- Must Convert Coins Back to Satoshis (XML() converts them from Satoshis) -->
          <WTSETATTRIBUTE name="ATTR(Amount)" value="CONST(toSatoshi(.Amount))"/>
          <WTMETHOD name="Save">
						<WTCONDITION expr="NoErrors"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="XML">
						<WTCONDITION expr="IsErrors"/>
						<WTPARAM name="xmlReward" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
				</WTRETURN>
			</WTACTION>

			<WTACTION id="3" name="Return" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="4" name="Delete" type="Delete">
				<WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
					<WTMETHOD name="Delete">
						<WTPARAM name="RewardID" direction="input" value="PARAM(RewardID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
				</WTRETURN>
			</WTACTION>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="100" align="right"/>
				<WTCOLUMN width="500" align="left"/>

				<WTROW>
					<WTSTATIC col="1" merge="2" class="PageHeading" align="left">
            <WTSTATIC tag="Reward" value="ATTR(Reward.RewardID)" space="2"/>
            <WTSTATIC tag="Payment2ID" value="ATTR(Reward.Payment2ID)" fontcolor="blue"/>
          </WTSTATIC>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="ConsumerName"/>
					<WTSTATIC col="2" value="ATTR(Reward.ConsumerName)" bold="true"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="RewardDate"/>
					<WTTEXT col="2" value="ATTR(Reward.RewardDate)" size="15"/>
					<WTSTATIC col="2" tag="HoldDate"/>
					<WTTEXT col="2" value="ATTR(Reward.HoldDate)" prespace="false"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="RewardType"/>
					<WTCOMBO col="2" value="ATTR(Reward.RewardType)"/>
					<WTSTATIC col="2" tag="Status"/>
					<WTCOMBO col="2" value="ATTR(Reward.Status)" prespace="false"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1">
						<WTSTATIC tag="Amount">
							<WTCONDITION expr="ATTR(Reward.RewardType)" oper="equal" value="CONST(1)"/>
						</WTSTATIC>
						<WTSTATIC tag="Points">
							<WTCONDITION expr="ATTR(Reward.RewardType)" oper="equal" value="CONST(2)"/>
						</WTSTATIC>
					</WTSTATIC>
					<WTTEXT col="2" value="ATTR(Reward.Amount)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Reference"/>
					<WTTEXT col="2" value="ATTR(Reward.Reference)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Note"/>
					<WTMEMO col="2" value="ATTR(Reward.Note)" rows="2" cols="50"/>
				</WTROW>

				<WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" merge="2" action="1" value="CONST(Update)" align="center">
						<WTCONDITION expr="IsActive"/>
					</WTBUTTON>
					<WTBUTTON col="1" merge="2" action="3" value="CONST(Return)"/>
					<WTBUTTON col="1" merge="2" action="4" value="CONST(Delete)" align="center" msg="ConfirmDelete">
						<WTCONDITION expr="IsManager"/>
					</WTBUTTON>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="15211" caption="Consumer Awards" page-width="400" page-left="10" margin-width="0" navbar="false" header="false" footer="false"
		aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl">
    <!--============================================================================================-->
      <WTPARAM name="ConsumerID" datatype="number"/>

      <WTACTION name="New" type="New" id="0">
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(2)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTOBJECT name="Rewards" project="ptsRewardUser" class="CRewards">
          <WTMETHOD name="ListPointsSummary">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlRewards" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="300" align="left"/>
        <WTCOLUMN width="80" align="right"/>

        <WTFUNCTION name="ViewAwards(id)">
          var  url = "15312.asp?merchantid=" + id
          var win = window.open(url,"Awards","top=100,left=100,height=400,width=425,resizable=yes,status=no,toolbar=no,menubar=no,location=no,titlebar=no,scrollbars=1");
          win.focus();
        </WTFUNCTION>

        <WTROW margin-bottom="3">
          <WTSTATIC col="1" merge="2" class="PageHeading" align="center">
            <WTCODEGROUP>
              <WTIMAGE value="CONST(prize24.gif)" imgalign="absmiddle"/>
              <WTSTATIC space="1"/>
              <WTSTATIC label="AwardPoints"/>
              <WTSTATIC newline="1"/>
              <WTSTATIC value="ATTR(Consumer.NameFirst)" space="1"/>
              <WTSTATIC value="ATTR(Consumer.NameLast)"/>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>

        <WTREPEAT entity="Reward">
          <WTROW height="24">
            <WTSTATIC col="1" fontsize="2" bold="true">
              <WTSTATIC value="DATA(MerchantName)" space="1"/>
              <WTCODEGROUP>
                <WTIMAGE value="CONST(gift24.png)" imgalign="absmiddle">
                  <WTLINK name="ViewAwards(&lt;xsl:value-of select=&quot;@merchantid&quot;/&gt;)" click="true" />
                </WTIMAGE>
              </WTCODEGROUP>
            </WTSTATIC>
            <WTSTATIC col="2" value="DATA(Points)" bold="true" fontcolor="green"/>
          </WTROW>
        </WTREPEAT>

        <WTROW margin-top="12" margin-bottom="12">
          <WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="CryptoPay2" caption="Crypto Payment" header="false" footer="false" navbar="false" wrapper="wrapper600"
		 aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLAdd.xsl">
      <!--============================================================================================-->
      <WTPARAM name="Merchant" datatype="number"/>
      <WTPARAM name="Pin" datatype="number"/>
      <WTPARAM name="Ticket" datatype="text"/>
      <WTPARAM name="Total" datatype="text"/>
      <WTPARAM name="Net" datatype="text"/>
      <WTPARAM name="Coin" datatype="number"/>
      <WTPARAM name="AwardID" datatype="number"/>
      <WTPARAM name="Desc" datatype="text"/>
      
      <WTPARAM name="MerchantID" datatype="number"/>
      <WTPARAM name="PinNumber" datatype="number"/>
      <WTPARAM name="TicketNumber" datatype="text"/>
      <WTPARAM name="TotalAmount" datatype="text"/>
      <WTPARAM name="NetAmount" datatype="text"/>
      <WTPARAM name="CoinType" datatype="number"/>
      <WTPARAM name="Description" datatype="text"/>

      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="CompanyID" datatype="number"/>

      <WTPARAM name="CryptoStatus" datatype="text"/>
      <WTPARAM name="AwardName" datatype="text"/>

<!-- ********************************************* -->      
      <WTPARAM name="ConsumerName" datatype="text"/>
      <WTPARAM name="LogonConsumer" datatype="text"/>
      <WTPARAM name="PayDate" datatype="date"/>
      <WTPARAM name="PayType" datatype="number"/>
      <WTPARAM name="Notes" datatype="text"/>
      <WTPARAM name="OrderType" datatype="number"/>
      <WTPARAM name="OrderProcess" datatype="number"/>
      <WTPARAM name="Payment2ID" datatype="number"/>
      <WTPARAM name="Popup" datatype="number"/>
      <WTPARAM name="User2FA" datatype="number"/>

      <WTPARAM name="Reward" datatype="currency"/>
      <WTPARAM name="Award" datatype="currency"/>
      <WTPARAM name="Redeem" datatype="currency"/>
      <WTPARAM name="TotalReward" datatype="currency"/>
      <WTPARAM name="TotalAward" datatype="currency"/>

      <WTPARAM name="IsAwards" datatype="number"/>
      <WTPARAM name="IsPin" datatype="number"/>
      <WTPARAM name="IsTicket" datatype="number"/>
      <WTPARAM name="IsApprove" datatype="number"/>
      <WTPARAM name="IsShopperOrder" datatype="number"/>
      <WTPARAM name="MerchantName" datatype="text"/>
      <WTPARAM name="StaffID" datatype="number"/>
      <WTPARAM name="StaffName" datatype="text"/>
      <WTPARAM name="AcceptedCoins" datatype="text"/>
      <WTPARAM name="Terms" datatype="text"/>
      <WTPARAM name="CurrencyCode" datatype="text"/>
      <WTPARAM name="PendingOrders" datatype="number"/>

      <WTPARAM name="CoinPrice" datatype="text"/>
      <WTPARAM name="BTC" datatype="currency"/>
      <WTPARAM name="NXC" datatype="currency"/>
      <WTPARAM name="RewardPoints" datatype="currency"/>
      <WTPARAM name="RewardValue" datatype="currency"/>
      <WTPARAM name="RewardValueRaw" datatype="currency"/>

      <WTPARAM name="RedeemPswd" datatype="text"/>
      <WTPARAM name="QR_Name" datatype="text"/>
      <WTPARAM name="QR_URL" datatype="text"/>
      <WTPARAM name="QR_Address" datatype="text"/>
      <WTPARAM name="QR_Amount" datatype="currency"/>
      <WTPARAM name="QR_Label" datatype="text"/>
      <WTPARAM name="QR_Msg" datatype="text"/>
      <WTPARAM name="CoinToken" datatype="text"/>
      <WTPARAM name="ReplaceURL" datatype="text"/>

      <WTPARAM name="IsDemo" datatype="number"/>
      <WTPARAM name="TotalAmountFormat" datatype="text"/>
      <WTPARAM name="NetAmountFormat" datatype="text"/>

      <WTINCLUDE name="LimitedAccess.asp"/>
      <WTINCLUDE name="Coins.asp"/>
      <WTINCLUDE name="2FA.asp"/>
      <WTINCLUDE name="Comm.asp"/>
      <WTINCLUDE name="RewardOrder.asp"/>

      <WTJAVASCRIPT name="AJAX.js"/>
      <WTJAVASCRIPT name="clipboard.min.js"/>
      <WTJAVASCRIPT name="RewardOrder.js"/>

      <!-- ************************************ -->
      <!-- OrderProcess: 0 - New Shopper        -->
      <!-- OrderProcess: 1 - Get Order Info     -->
      <!-- OrderProcess: 2 - Get Crypto Payment -->
      <!-- OrderProcess: 3 - Confirm Order      -->
      <!-- OrderType: 0 - Crypto                -->
      <!-- OrderType: 1 - Cash                  -->
      <!-- OrderType: 2 - Redeem Rewards        -->
      <!-- OrderType: 3 - Redeem Awards         -->
      <!-- ************************************ -->
      <!-- *** ERROR CODE ******************************* -->
      <!-- -99	System Unavailable                        --> 
      <!-- -1	Missing or Invalid/Inactive Merchant Number -->
      <!-- -3	Invalid Price                               -->
      <!-- -4	Invalid Net Price                           -->
      <!-- -5	Missing or Invalid Staff PIN Code           -->
      <!-- -7	Invalid Cryptocurrency selected             -->
      <!-- -8	Invalid Award number                        -->
      <!-- ********************************************** -->

      <WTCODEGROUP>
        <WTSETATTRIBUTE name="PARAM(MerchantID)" value="PARAM(Merchant)"/>
        <WTSETATTRIBUTE name="PARAM(PinNumber)" value="PARAM(Pin)"/>
        <WTSETATTRIBUTE name="PARAM(TicketNumber)" value="PARAM(Ticket)"/>
        <WTSETATTRIBUTE name="PARAM(TotalAmount)" value="PARAM(Total)"/>
        <WTSETATTRIBUTE name="PARAM(NetAmount)" value="PARAM(Net)"/>
        <WTSETATTRIBUTE name="PARAM(CoinType)" value="PARAM(Coin)"/>
        <WTSETATTRIBUTE name="PARAM(Description)" value="PARAM(Desc)"/>
      </WTCODEGROUP>
        
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(CompanyID)" value="SYSCON(NEXXUS)"/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(MerchantID)" oper="equal" value="CONST(0)"/>
        <WTCUSTOM>
          response.write "Missing MerchantID"
          response.end
        </WTCUSTOM>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(PinNumber)" oper="equal" value="CONST(0)"/>
        <WTCUSTOM>
          response.write "Missing PinNumber"
          response.end
        </WTCUSTOM>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(AwardID)" oper="equal" value="CONST(0)"/>
        <WTCUSTOM>
          response.write "Missing AwardID"
          response.end
        </WTCUSTOM>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(TotalAmount)" oper="equal" value="CONST(&quot;&quot;)"/>
        <WTCUSTOM>
          response.write "Missing TotalAmount"
          response.end
        </WTCUSTOM>
      </WTCODEGROUP>
      
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(AwardName)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(PayDate)" value="SYS(Now)"/>
				  <WTOBJECT name="Award" project="ptsAwardUser" class="CAward">
					  <WTMETHOD name="Load">
						  <WTPARAM name="AwardID" direction="input" value="PARAM(AwardID)"/>
						  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					  </WTMETHOD>
            <WTSETATTRIBUTE name="PARAM(AwardName)" value="CONST(.Amount + &quot;%  &quot; + .Description)"/>
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(CLng(.MerchantID))"/>
              <WTCONDITION expr="ATTR(AwardType)" oper="not-equal" value="CONST(1)" connector="or"/>
              <WTCONDITION expr="ATTR(Status)" oper="not-equal" value="CONST(1)" connector="or"/>
              <WTCUSTOM>
                response.write "Invalid AwardID"
                response.end
              </WTCUSTOM>
            </WTCODEGROUP>
				  </WTOBJECT>
      </WTCODEGROUP>
        
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(NetAmount)" oper="equal" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(NetAmount)" value="PARAM(TotalAmount)"/>
      </WTCODEGROUP>

      <WTCODEGROUP>
        <WTSETATTRIBUTE name="PARAM(TotalAmountFormat)" value="CONST(FormatCurrency(reqTotalAmount,2))"/>
        <WTSETATTRIBUTE name="PARAM(NetAmountFormat)" value="CONST(FormatCurrency(reqNetAmount,2))"/>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(1)"/>
      </WTCODEGROUP>

      <!-- **************************************************************************************************-->
      <WTSUB function="NotifyMerchant()">
				<WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
					<WTMETHOD name="Load">
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
          <WTSETATTRIBUTE name="CONST(tmpTo)" value="ATTR(Email3)"/>
          <WTSETATTRIBUTE name="CONST(tmpOptions)" value="ATTR(Options)"/>
        </WTOBJECT>
				<WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
          <WTCONDITION expr="CONST(InStr(tmpOptions,&quot;C&quot;))" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
          <WTSETATTRIBUTE name="CONST(tmpSender)" value="ATTR(Email)"/>
          <WTSETATTRIBUTE name="CONST(tmpFrom)" value="ATTR(Email)"/>
          <WTCODEGROUP>
            <WTCUSTOM>
              If InStr(tmpTo, "@") &gt; 0 Then
              If InStr(tmpFrom, "@") = 0 Then tmpFrom = tmpTo
              tmpSubject = "New Cryptocurrency Order #" + CStr(reqPayment2ID)
              tmpBody = reqConsumerName + " " + FormatCurrency(reqTotalAmount,2) + " " + reqDescription + " " + CStr(reqTicketNumber)
              SendEmail bvCompanyID, tmpSender, tmpFrom, tmpTo, "", "", tmpSubject, tmpBody
              End If
            </WTCUSTOM>
          </WTCODEGROUP>
				</WTOBJECT>
      </WTSUB>
      
      <!-- **************************************************************************************************-->
      <WTSUB function="NewShopper()">
        <WTCALLSUB name="GetMerchant reqMerchantID, reqOrderType, reqMerchantName, reqTerms, reqCurrencyCode, reqIsAwards, reqIsPin, reqIsTicket, reqIsApprove, reqIsShopperOrder, reqAcceptedCoins, reqPendingOrders, reqIsDemo"/>
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
        <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-NEW)"/>
        <WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(ConsumerID)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(Payment2ID)" value="CONST(0)"/>
        <!-- Test Cryptocurrency processing support -->
<!--        
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CryptoStatus)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTCALLSUB name="GetCryptoStatus reqCryptoStatus"/>
        </WTCODEGROUP>
-->
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="SetupOrder">
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(LogonConsumer)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTERROR number="10149" message="Oops, Please enter a shopper phone number or email."/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTCONDITION expr="PARAM(IsPin)" oper="not-equal" value="CONST(0)" connector="and"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(PinNumber)" oper="equal" value="CONST(&quot;&quot;)"/>
            <WTERROR number="10150" message="Oops, Please enter your numeric PIN Code."/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(IsNumeric(reqPinNumber))" oper="equal" value="CONST(0)"/>
            <WTERROR number="10151" message="Oops, Please enter numbers only for your PIN Code."/>
            <WTSETATTRIBUTE name="PARAM(PinNumber)" value="CONST(&quot;&quot;)"/>
          </WTCODEGROUP>
          <WTCALLSUB name="ValidPin reqMerchantID, reqPinNumber, reqStaffID, reqStaffName">
            <WTCONDITION expr="NoErrors"/>
          </WTCALLSUB>
        </WTCODEGROUP>
        <WTCALLSUB name="GetShopper reqMerchantID, reqLogonConsumer, reqOrderType, reqCurrencyCode, reqConsumerID, reqConsumerName, reqBTC, reqCoinPrice, reqRewardPoints, reqNXC, reqRewardValueRaw, reqRewardValue, reqPayType, reqIsDemo">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-ORDER)"/>
<!--          <WTCALLSUB name="NewOrder reqMerchantID, reqOrderType, reqPayDate, reqPayType, xmlAwards"/>-->
        </WTCODEGROUP>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="SetupCryptoPayment">
        <WTSETATTRIBUTE name="PARAM(CoinType)" value="CONST(reqPayType-2)"/>
        <WTSETATTRIBUTE name="CONST(Price)" value="CONST(CoinPrice( reqCoinType, reqCurrencyCode ))"/>
        <WTSETATTRIBUTE name="CONST(Coins)" value="CONST( Round(reqTotalAmount / Price,8) )"/>
        <WTSETATTRIBUTE name="PARAM(QR_Amount)" value="CONST(Coins)"/>
        <!-- QR_Address set in AddOrder() -->
        <!-- <WTSETATTRIBUTE name="PARAM(QR_Address)" value="ATTR(Address)"/>-->
        <WTSETATTRIBUTE name="PARAM(QR_Label)" value="PARAM(MerchantName)"/>
        <WTSETATTRIBUTE name="PARAM(QR_Msg)" value="PARAM(Description)"/>
        <WTSETATTRIBUTE name="PARAM(ReplaceURL)" value="CONST(CoinQR(reqCoinType, reqQR_Address, &quot;{amt}&quot;, reqQR_Label, reqQR_Msg, 0 ))"/>
        <WTSETATTRIBUTE name="PARAM(QR_URL)" value="CONST(Replace( reqReplaceURL, &quot;{amt}&quot;, reqQR_Amount ))"/>
        <WTSETATTRIBUTE name="PARAM(QR_Name)" value="CONST(CoinName(reqCoinType))"/>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="NewShopper()"/>
      </WTACTION>

      <WTACTION id="2" name="Order_Crypto" type="New">
        <WTSETATTRIBUTE name="PARAM(OrderType)" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
        <WTCALLSUB name="SetupOrder"/>
      </WTACTION>

      <WTACTION id="5" name="Payment_Add" type="Add">
        <WTCALLSUB name="ValidOrder reqOrderType, reqIsTicket, reqTicketNumber, reqTotalAmount, reqNetAmount"/>
        <WTCALLSUB name="AddOrder reqOrderType, reqMerchantID, reqConsumerID, reqAwardID, reqPayDate, reqStaffID, reqDescription, reqTotalAmount, reqNetAmount, reqTicketNumber, reqPayType, reqCurrencyCode, reqCoinType, reqQR_Address, reqPayment2ID, reqCoinToken, reqIsDemo">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-CRYPTO)"/>
            <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-PAYMENT)"/>
            <WTCALLSUB name="SetupCryptoPayment"/>
          </WTCODEGROUP>
        </WTCODEGROUP>
      </WTACTION>

      <WTACTION id="6" name="Payment_Crypto" type="New">
        <WTCALLSUB name="ProcessOrder reqCompanyID, reqPayment2ID, reqReward, reqAward, reqRedeem, reqTotalReward, reqTotalAward"/>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTCALLSUB name="NotifyMerchant"/>
          <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
        </WTCODEGROUP>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="600" align="center"/>

        <!-- Convert input to digits only if no @ sign for an email -->
        <WTFUNCTION name="LogonDigitsOnly(obj)">
          var val = obj.value;
          if(val.indexOf('@') === -1)	{
          obj.value = val.replace(/\D/g,'');
          }
        </WTFUNCTION>

        <WTFUNCTION name="NewShopper()">
          var mid = document.getElementById('MerchantID').value;
          var url = "NewShopper.asp?m=" + mid
          var win = window.open(url);
        </WTFUNCTION>

        <WTFUNCTION name="GetCoinPrice()">
          var coin = document.getElementById('PayType').value - 2;
          var url = "CoinPrice.asp?c=" + coin
          var xmlhttp;
          if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
          }
          else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
          }
          xmlhttp.onreadystatechange = function () {
            if (this.readyState == 4 &amp;&amp; this.status == 200) {
              document.getElementById('CoinPrice').value = this.responseText;
            }
          };
          xmlhttp.open("GET", url, true);
          xmlhttp.send();
        </WTFUNCTION>


        <WTFUNCTION name="Init()">
          var orderprocess = document.getElementById('OrderProcess').value;
          var ordertype = document.getElementById('OrderType').value;
          if( orderprocess == 2 ) {
            try {
              GetCryptoPayment();
              new Clipboard('#CopyButton');
              var isdemo = document.getElementById('IsDemo').value;
              if( isdemo == 0 ) { UpdateTimer(); }
            }
            catch(err) {
              alert(err.message);
            }  
          };
        </WTFUNCTION>

        <WTLOAD>
					Init();
				</WTLOAD>

        <WTROW>
          <WTHIDDEN value="PARAM(MerchantID)"/>
          <WTHIDDEN value="PARAM(ConsumerID)"/>
          <WTHIDDEN value="PARAM(ConsumerName)"/>
          <WTHIDDEN value="PARAM(MerchantName)"/>
          <WTHIDDEN value="PARAM(StaffName)"/>
          <WTHIDDEN value="PARAM(StaffID)"/>
          <WTHIDDEN value="PARAM(IsPin)"/>
          <WTHIDDEN value="PARAM(IsTicket)"/>
          <WTHIDDEN value="PARAM(IsApprove)"/>
          <WTHIDDEN value="PARAM(IsAwards)"/>
          <WTHIDDEN value="PARAM(AcceptedCoins)"/>
          <WTHIDDEN value="PARAM(NXC)"/>
          <WTHIDDEN value="PARAM(RewardPoints)"/>
          <WTHIDDEN value="PARAM(RewardValue)"/>
          <WTHIDDEN value="PARAM(RewardValueRaw)"/>
          <WTHIDDEN value="PARAM(OrderType)"/>
          <WTHIDDEN value="PARAM(OrderProcess)"/>
          <WTHIDDEN value="PARAM(Payment2ID)"/>
          <WTHIDDEN value="PARAM(CoinType)"/>
          <WTHIDDEN value="PARAM(CryptoStatus)"/>
          <WTHIDDEN value="PARAM(CoinToken)"/>
          <WTHIDDEN value="PARAM(CurrencyCode)"/>
          <WTHIDDEN value="PARAM(IsDemo)"/>
          <WTHIDDEN value="PARAM(ReplaceURL)"/>
          <WTHIDDEN value="PARAM(PayDate)"/>
          <WTHIDDEN value="PARAM(AwardName)"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" class="PageHeading" align="center">
            <WTSTATIC tag="NewOrder3"/>
            <WTSTATIC value="PARAM(MerchantName)" space="1"/>
            <WTSTATIC value="CONST(#&lt;xsl:value-of select=&quot;/DATA/PARAM/@merchantid&quot;/&gt;)"/>
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(IsDemo)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC space="1"/>
              <WTSTATIC label="Demo" fontcolor="red"/>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>
        <WTROW>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-PAYMENT)"/>
          <WTBUTTON col="1" value="CONST(ProcessCryptoPaymentButton3)" align="center" class="PageHeading">
            <WTCLICK>ProcessCryptoPayment()</WTCLICK>
          </WTBUTTON>
        </WTROW>

        <!-- *************************************************************************-->
        <!-- GET THE SHOPPER                                                          -->
        <!-- *************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-NEW)"/>

          <WTROW margin-top="12" margin-bottom="12">
            <WTTABLE col="1" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
              <WTCOLUMN width="550" align="center"/>
              <WTCODEGROUP>
                <WTCONDITION expr="PARAM(CryptoStatus)" oper="equal" value="CONST('OK')"/>
                <WTROW>
                  <WTSTATIC col="1" label="ExistingMember" align="center" fontsize="4"/>
                </WTROW>
                <WTROW margin-top="12">
                  <WTSTATIC col="1" tag="LogonConsumer3"/>
                  <WTTEXT col="1" value="PARAM(LogonConsumer)" align="left" size="20">
                    <WTEXIT>LogonDigitsOnly(this);</WTEXIT>
                  </WTTEXT>
                </WTROW>
                <WTROW margin-top="12">
                  <WTBUTTON col="1" action="2" value="CONST(Continue)" align="center" btnclass="hugebutton"/>
                  <WTBUTTON col="1" value="CONST(NewMember)"  btnclass="bigbutton">
                    <WTCLICK>NewShopper()</WTCLICK>
                  </WTBUTTON>
                </WTROW>
              </WTCODEGROUP>
<!--
              <WTCODEGROUP>
                <WTCONDITION expr="PARAM(CryptoStatus)" oper="not-equal" value="CONST('OK')"/>
                <WTROW margin-top="12">
                  <WTSTATIC col="1" value="PARAM(CryptoStatus)" align="center" bold="true" fontsize="4"/>
                </WTROW>
                <WTROW margin-top="12">
                  <WTBUTTON col="1" value="CONST(Close)" align="center">
                    <WTCLICK>window.close()</WTCLICK>
                  </WTBUTTON>
                </WTROW>
              </WTCODEGROUP>
-->  
            </WTTABLE>
          </WTROW>
        </WTCODEGROUP>

        <!-- **************************************************************************************************-->
        <!-- GET THE ORDER DETAIL INFORMATION FOR THE CRYPTO PAYMENT                                                          -->
        <!-- **************************************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-ORDER)"/>

          <WTROW margin-top="12" margin-bottom="6">
            <WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
              <WTSTATIC tag="ConsumerName"/>
              <WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
              <WTCODEGROUP>
                <WTBUTTON action="0" value="CONST(Change)" btnclass="smbutton"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-top="6" margin-bottom="12">
            <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
          </WTROW>

          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="PayDate"/>
            <WTSTATIC col="1" value="PARAM(PayDate)" fontsize="3" prespace="false"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="RewardType"/>
            <WTSTATIC col="1" value="PARAM(AwardName)" fontsize="3" prespace="false"/>
          </WTROW>
            
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="PayType"/>
            <WTCOMBO col="1" value="PARAM(PayType)" prespace="false">
              <WTCHANGE>GetCoinPrice();</WTCHANGE>
              <WTOPTION id="3" label="Coin1"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',1,'))"/></WTOPTION>
              <WTOPTION id="4" label="Coin2"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',2,'))"/></WTOPTION>
              <WTOPTION id="5" label="Coin3"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',3,'))"/></WTOPTION>
              <WTOPTION id="6" label="Coin4"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',4,'))"/></WTOPTION>
              <WTOPTION id="7" label="Coin5"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',5,'))"/></WTOPTION>
              <WTOPTION id="8" label="Coin6"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',6,'))"/></WTOPTION>
              <WTOPTION id="9" label="Coin7"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',7,'))"/></WTOPTION>
              <WTOPTION id="10" label="Coin8"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',8,'))"/></WTOPTION>
              <WTOPTION id="11" label="Coin9"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',9,'))"/></WTOPTION>
              <WTOPTION id="12" label="Coin10"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',10,'))"/></WTOPTION>
            </WTCOMBO>
            <WTTEXT col="1" value="PARAM(CoinPrice)" style="BORDER:none;background:transparent;color:blue"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="TotalAmount"/>
            <WTSTATIC col="1" value="PARAM(TotalAmountFormat)" fontsize="3" prespace="false" newline="1"/>
            <WTSTATIC col="1" label="TotalAmountText3" fontcolor="blue"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="NetAmount"/>
            <WTSTATIC col="1" value="PARAM(NetAmountFormat)" fontsize="3" prespace="false" newline="1"/>
            <WTSTATIC col="1" label="NetAmountText3" fontcolor="blue"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTCONDITION expr="PARAM(Description)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" tag="Description"/>
            <WTSTATIC col="1" value="PARAM(Description)" fontsize="3" prespace="false"/>
          </WTROW>

          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" action="5" value="CONST(AddCrypto)" align="center" btnclass="bigbutton"/>
            <WTBUTTON col="1" action="0" value="CONST(StartOver)"/>
            <WTBUTTON col="1" value="CONST(Close)" align="center">
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
          </WTROW>
              
        </WTCODEGROUP>

        <!-- **************************************************************************************************-->
        <!-- GET CRYPTO PAYMENT FROM THE SHOPPER                                                               -->
        <!-- **************************************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-PAYMENT)"/>
          <WTROW id="MessageRow" style="background:darkblue">
            <WTTEXT col="1" name="MessageBox" value="CONST(15:00 Awaiting Payment...)" style="BORDER:none;background:transparent;color:white;text-align:center;width:100%"/>
          </WTROW>
          
          <WTROW margin-top="12">
            <WTSTATIC col="1" label="QRtext" align="center" fontsize="4" fontcolor="blue"/>
          </WTROW>
          <WTROW margin-top="12" margin-bottom="12">
						<WTIMAGE col="1" id="QRCode" align="center" value="CONST(&lt;xsl:value-of select=&quot;/DATA/PARAM/@qr_url&quot;/&gt;)" imgpath=""/>
          </WTROW>
          <WTROW margin-bottom="24">
            <WTSTATIC col="1" align="center">
              <WTCODEGROUP>
                <WTIMAGE value="CONST(Coin&lt;xsl:value-of select=&quot;/DATA/PARAM/@cointype&quot;/&gt;.gif)" imgalign="absmiddle"/>
                <WTSTATIC space="2"/>
                <WTSTATIC value="PARAM(QR_Name)" fontsize="4" bold="true"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" align="center" fontsize="3">
<!--              <WTSTATIC tag="QR_Amount"/>-->
              <WTCODEGROUP>
              <WTTEXT name="QRAmount" value="CONST(Coins: &lt;xsl:value-of select=&quot;/DATA/PARAM/@qr_amount&quot;/&gt;)" style="BORDER:none;background:transparent;color:black;text-align:center;" size="20" textclass="bigtext"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" align="center" fontsize="3">
              <WTSTATIC tag="QR_Label"/>
              <WTSTATIC value="PARAM(QR_Label)" bold="true"/>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTCONDITION expr="PARAM(QR_Msg)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" align="center" fontsize="3">
                <WTSTATIC tag="QR_Msg"/>
                <WTSTATIC value="PARAM(QR_Msg)" bold="true"/>
            </WTSTATIC>
          </WTROW>
          
          <WTROW margin-top="12" margin-bottom="12">
            <WTSTATIC col="1" label="QRtext2" align="center" fontsize="4" fontcolor="blue"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" align="center">
              <WTCODEGROUP>
                <WTSTATIC tag="QR_Address" fontsize="3"/>
                <WTTEXT value="PARAM(QR_Address)" size="40"/>
                <WTBUTTON id="CopyButton" value="CONST(Copy)" clipboard="#QR_Address"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" align="center">
              <WTCODEGROUP>
                <WTSTATIC tag="QR_Amount" fontsize="3"/>
                <WTTEXT value="PARAM(QR_Amount)" size="37"/>
                <WTBUTTON id="CopyButton" value="CONST(Copy)" clipboard="#QR_Amount"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>

          <WTROW margin-bottom="12">
            <WTBUTTON col="1" action="0" value="CONST(StartOver)"/>
            <WTBUTTON col="1" value="CONST(Close)" align="center">
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

        <!-- **************************************************************************************************-->
        <!-- CONFIRM THE ORDER AND START A NEW ORDER OR QUIT                                                          -->
        <!-- **************************************************************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1" align="center" fontsize="3">
              <WTSTATIC tag="ConsumerName"/>
              <WTSTATIC value="PARAM(ConsumerName)" bold="true" space="2"/>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-top="12">
            <WTSTATIC col="1" align="center" fontsize="4" fontcolor="blue">
              <WTSTATIC label="SuccessfulOrder"/>
            </WTSTATIC>
          </WTROW>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="not-equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTROW margin-top="12">
              <WTCONDITION expr="PARAM(Redeem)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC col="1" align="center" fontsize="4" fontcolor="red">
                <WTSTATIC value="PARAM(Redeem)" bold="true" space="1"/>
                <WTSTATIC label="RedeemedRewardPoints"/>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-top="12">
              <WTCONDITION expr="PARAM(Reward)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC col="1" align="center" fontsize="4" fontcolor="green">
                <WTSTATIC value="PARAM(Reward)" bold="true" space="1"/>
                <WTSTATIC label="CashbackRewardPoints" space="1"/>
                <WTSTATIC value="CONST(()"/>
                <WTSTATIC value="PARAM(TotalReward)" bold="true" space="1"/>
                <WTSTATIC label="total"/>
                <WTSTATIC value="CONST())"/>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-top="12">
              <WTCONDITION expr="PARAM(Award)" oper="not-equal" value="CONST(0)"/>
              <WTSTATIC col="1" align="center" fontsize="4" fontcolor="green">
                <WTSTATIC value="PARAM(Award)" bold="true" space="1"/>
                <WTSTATIC label="SpecialAwardPoints" space="1"/>
                <WTSTATIC value="CONST(()"/>
                <WTSTATIC value="PARAM(TotalAward)" bold="true" space="1"/>
                <WTSTATIC label="total"/>
                <WTSTATIC value="CONST())"/>
              </WTSTATIC>
            </WTROW>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OrderType)" oper="equal" value="SYSCON(ORDER-TYPE-AWARD)"/>
            <WTROW margin-top="12">
              <WTSTATIC col="1" align="center" fontsize="4" fontcolor="red">
                <WTSTATIC value="PARAM(Award)" bold="true" space="1"/>
                <WTSTATIC label="RedeemedAwardPoints"/>
              </WTSTATIC>
            </WTROW>
          </WTCODEGROUP>
          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" value="CONST(Close)" align="center">
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="CryptoPay" caption="Crypto Payment" header="false" footer="false" navbar="false" wrapper="wrapper600"
		 aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLAdd.xsl">
      <!--============================================================================================-->
      <WTPARAM name="PaymentID" datatype="number"/>
      <WTPARAM name="OwnerType" datatype="number"/>
      <WTPARAM name="OwnerID" datatype="number"/>
      <WTPARAM name="Amount" datatype="text"/>
      <WTPARAM name="CoinType" datatype="number"/>
      <WTPARAM name="PayDate" datatype="date"/>
      <WTPARAM name="PayStatus" datatype="number"/>
      <WTPARAM name="Description" datatype="text"/>
      <WTPARAM name="CompanyID" datatype="number"/>
      <WTPARAM name="CompanyName" datatype="text"/>
      <WTPARAM name="UserName" datatype="text"/>
      <WTPARAM name="CryptoStatus" datatype="text"/>
      <WTPARAM name="AmountFormat" datatype="text"/>
      <WTPARAM name="Result" datatype="text"/>

      <!-- ********************************************* -->
      <WTPARAM name="OrderProcess" datatype="number"/>
      <WTPARAM name="Popup" datatype="number"/>

      <WTPARAM name="AcceptedCoins" datatype="text"/>
      <WTPARAM name="CurrencyCode" datatype="text"/>
      <WTPARAM name="CoinPrice" datatype="text"/>

      <WTPARAM name="QR_Name" datatype="text"/>
      <WTPARAM name="QR_URL" datatype="text"/>
      <WTPARAM name="QR_Address" datatype="text"/>
      <WTPARAM name="QR_Amount" datatype="currency"/>
      <WTPARAM name="QR_Label" datatype="text"/>
      <WTPARAM name="QR_Msg" datatype="text"/>
      <WTPARAM name="CoinToken" datatype="text"/>
      <WTPARAM name="ReplaceURL" datatype="text"/>

      <WTINCLUDE name="Coins.asp"/>
      <WTINCLUDE name="Comm.asp"/>

      <WTJAVASCRIPT name="AJAX.js"/>
      <WTJAVASCRIPT name="clipboard.min.js"/>
      <WTJAVASCRIPT name="RewardOrder.js"/>

      <!-- ************************************ -->
      <!-- OrderProcess: 0 - New Order          -->
      <!-- OrderProcess: 1 - Get Order Info     -->
      <!-- OrderProcess: 2 - Get Crypto Payment -->
      <!-- OrderProcess: 3 - Confirm Order      -->
      <!-- ************************************ -->

      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(PaymentID)" oper="equal" value="CONST(0)"/>
        <WTCUSTOM>
          response.write "Missing PaymentID"
          response.end
        </WTCUSTOM>
      </WTCODEGROUP>

      <!-- **************************************************************************************************-->
      <WTSUB name="SetupOrder">
        <!-- Test Cryptocurrency processing support -->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CryptoStatus)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(CryptoStatus)" value="CONST(CoinTest(1))"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CryptoStatus)" oper="equal" value="CONST(&quot;OK&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-ORDER)"/>
          
          <WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
            <WTMETHOD name="Load">
              <WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(Status)" oper="not-equal" value="CONST(1)"/>
              <WTCONDITION expr="ATTR(Status)" oper="not-equal" value="CONST(2)" connector="and"/>
              <WTCONDITION expr="ATTR(Status)" oper="not-equal" value="CONST(7)" connector="and"/>
              <WTCUSTOM>
                response.write "Invalid Payment"
                response.end
              </WTCUSTOM>
            </WTCODEGROUP>
            <WTSETATTRIBUTE name="PARAM(PayStatus)" value="ATTR(Status)"/>
            <WTSETATTRIBUTE name="PARAM(CompanyID)" value="ATTR(CompanyID)"/>
            <WTSETATTRIBUTE name="PARAM(OwnerType)" value="ATTR(OwnerType)"/>
            <WTSETATTRIBUTE name="PARAM(OwnerID)" value="ATTR(OwnerID)"/>
            <WTSETATTRIBUTE name="PARAM(PayDate)" value="ATTR(PayDate)"/>
            <WTSETATTRIBUTE name="CONST(tmpPurpose)" value="ATTR(Purpose)"/>
            <WTSETATTRIBUTE name="PARAM(Amount)" value="ATTR(Amount)"/>
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="SYSCON(NEXXUS)"/>
              <WTSETATTRIBUTE name="PARAM(Amount)" value="CONST(10)">
                <WTCONDITION expr="PARAM(Amount)" oper="equal" value="CONST(11)"/>
              </WTSETATTRIBUTE>
              <WTSETATTRIBUTE name="PARAM(Amount)" value="CONST(25)">
                <WTCONDITION expr="PARAM(Amount)" oper="equal" value="CONST(27)"/>
              </WTSETATTRIBUTE>
              <WTSETATTRIBUTE name="PARAM(Amount)" value="CONST(50)">
                <WTCONDITION expr="PARAM(Amount)" oper="equal" value="CONST(53)"/>
              </WTSETATTRIBUTE>
            </WTCODEGROUP>
            <WTSETATTRIBUTE name="PARAM(AmountFormat)" value="CONST(FormatCurrency(reqAmount,2))"/>
          </WTOBJECT>
          <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
            <WTCONDITION expr="PARAM(OwnerType)" oper="equal" value="ENTITY(Member)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="MemberID" direction="input" value="PARAM(OwnerID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="PARAM(UserName)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
          </WTOBJECT>
          <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
            <WTCONDITION expr="PARAM(OwnerType)" oper="equal" value="ENTITY(Consumer)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="ConsumerID" direction="input" value="PARAM(OwnerID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="PARAM(UserName)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
          </WTOBJECT>
          <WTOBJECT name="Product" project="ptsProductUser" class="CProduct">
            <WTCONDITION expr="CONST(tmpPurpose)" oper="not-equal" value="CONST(&quot;&quot;)"/>
            <WTMETHOD name="FetchCode">
              <WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
              <WTPARAM name="Code" direction="input" value="CONST(tmpPurpose)"/>
            </WTMETHOD>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(ProductID)" oper="not-equal" value="CONST(0)"/>
              <WTMETHOD name="Load">
                <WTPARAM name="ProductID" direction="input" value="ATTR(ProductID)"/>
                <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
              </WTMETHOD>
              <WTSETATTRIBUTE name="PARAM(Description)" value="ATTR(ProductName)"/>
            </WTCODEGROUP>
          </WTOBJECT>

          <WTSETATTRIBUTE name="PARAM(CompanyName)" value="CONST(&quot;Nexxus Rewards&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(AcceptedCoins)" value="CONST(&quot;,1,&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(CoinPrice)" value="CONST(FormatCurrency(CoinPrice(1,reqCurrencyCode)))"/>
        </WTCODEGROUP>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="SetupCryptoPayment">
        <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-PAYMENT)"/>
        <WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
          <WTMETHOD name="Load">
            <WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(QR_Address)" value="ATTR(Reference)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(QR_Address)" oper="equal" value="CONST(&quot;&quot;)"/>
            <WTSETATTRIBUTE name="PARAM(QR_Address)" value="CONST(CoinAddress(reqCoinType, CSTR(reqPaymentID)))"/>
            <WTSETATTRIBUTE name="ATTR(Reference)" value="PARAM(QR_Address)"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="ATTR(Notes)" oper="not-equal" value="CONST(&quot;&quot;)"/>
            <WTCUSTOM>
              aCoins = Split(.Notes, "|")
              If IsNumeric( aCoins(0) ) Then
                PayCoins = 0
                PaidCoins = 0
                If UBOUND(aCoins) >= 0 Then
                  If IsNumeric(aCoins(0)) Then PayCoins = CDBL(aCoins(0))
                End If  
                If UBOUND(aCoins) >= 1 Then
                  If IsNumeric(aCoins(1)) Then PaidCoins = CDBL(aCoins(1))
                End If  
                Coins = fromSatoshi(PayCoins - PaidCoins)
              Else
                .Notes = ""              
              End If
            </WTCUSTOM>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="ATTR(Notes)" oper="equal" value="CONST(&quot;&quot;)"/>
            <WTSETATTRIBUTE name="CONST(Price)" value="CONST(CoinPrice( reqCoinType, reqCurrencyCode ))"/>
            <WTSETATTRIBUTE name="CONST(Coins)" value="CONST( Round(reqAmount / Price,8) )"/>
            <WTSETATTRIBUTE name="ATTR(Notes)" value="CONST(CStr(toSatoshi(Coins)))"/>
          </WTCODEGROUP>
          <WTSETATTRIBUTE name="ATTR(PayType)" value="CONST(reqCoinType + 21)"/>
          <WTSETATTRIBUTE name="ATTR(Total)" value="PARAM(Amount)"/>
          <WTSETATTRIBUTE name="ATTR(Amount)" value="PARAM(Amount)"/>
          <WTMETHOD name="Save">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTSETATTRIBUTE name="PARAM(QR_Amount)" value="CONST(Coins)"/>
        <WTSETATTRIBUTE name="PARAM(QR_Label)" value="PARAM(CompanyName)"/>
        <WTSETATTRIBUTE name="PARAM(QR_Msg)" value="PARAM(Description)"/>
        <WTSETATTRIBUTE name="PARAM(ReplaceURL)" value="CONST(CoinQR(reqCoinType, reqQR_Address, &quot;{amt}&quot;, reqQR_Label, reqQR_Msg, 0 ))"/>
        <WTSETATTRIBUTE name="PARAM(QR_URL)" value="CONST(Replace( reqReplaceURL, &quot;{amt}&quot;, reqQR_Amount ))"/>
        <WTSETATTRIBUTE name="PARAM(QR_Name)" value="CONST(CoinName(reqCoinType))"/>
        <WTSETATTRIBUTE name="CONST(key)" value="CONST( reqPaymentID + reqOwnerID )"/>
        <WTSETATTRIBUTE name="PARAM(CoinToken)" value="CONST( CoinToken( reqCoinType, reqQR_Address, key) )"/>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="SetupOrder"/>
      </WTACTION>

      <WTACTION id="5" name="Payment_Add" type="Add">
        <WTCALLSUB name="SetupCryptoPayment"/>
      </WTACTION>

      <WTACTION id="6" name="Payment_Crypto" type="New">
        <WTSETATTRIBUTE name="PARAM(OrderProcess)" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="600" align="center"/>

        <WTFUNCTION name="DoResult()">
          var result = document.getElementById('Result').value;
          if( result.length != 0 ) {
            if( result == '1' ) {
              window.parent.opener.location.reload();
            }
            else {
              window.parent.opener.DoResult(result);
            }
          }
          window.close();
        </WTFUNCTION>

        <WTFUNCTION name="GetCoinPrice()">
          var coin = document.getElementById('CoinType').value;
          var url = "CoinPrice.asp?c=" + coin
          var xmlhttp;
          if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
          }
          else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
          }
         xmlhttp.onreadystatechange = function () {
            if (this.readyState == 4 &amp;&amp; this.status == 200) {
              document.getElementById('CoinPrice').value = this.responseText;
            }
          }
          xmlhttp.open("GET", url, true);
          xmlhttp.send();
        </WTFUNCTION>

        <WTFUNCTION name="Init()">
          var orderprocess = document.getElementById('OrderProcess').value;
          if( orderprocess == 2 ) {
            try {
              SetPaymentType(1);
              GetCryptoPayment();
              new Clipboard('#CopyButton');
              UpdateTimer();
            }
            catch(err) {
              alert(err.message);
            }
          }
        </WTFUNCTION>

        <WTLOAD>
          Init();
        </WTLOAD>

        <WTROW>
          <WTHIDDEN value="PARAM(PaymentID)"/>
          <WTHIDDEN value="PARAM(Amount)"/>
          <WTHIDDEN value="PARAM(PayDate)"/>
          <WTHIDDEN value="PARAM(Description)"/>
          <WTHIDDEN value="PARAM(CompanyName)"/>
          <WTHIDDEN value="PARAM(UserName)"/>
          <WTHIDDEN value="PARAM(AcceptedCoins)"/>
          <WTHIDDEN value="PARAM(OrderProcess)"/>
          <WTHIDDEN value="PARAM(CoinToken)"/>
          <WTHIDDEN value="PARAM(CurrencyCode)"/>
          <WTHIDDEN value="PARAM(CryptoStatus)"/>
          <WTHIDDEN value="PARAM(ReplaceURL)"/>
          <WTHIDDEN value="PARAM(Result)"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" class="PageHeading" align="center">
            <WTSTATIC tag="NewOrder3"/>
            <WTSTATIC value="PARAM(CompanyName)"/>
          </WTSTATIC>
        </WTROW>
        <WTROW>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-PAYMENT)"/>
          <WTBUTTON col="1" value="CONST(ProcessCryptoPaymentButton3)" align="center" class="PageHeading">
            <WTCLICK>ProcessCryptoPayment()</WTCLICK>
          </WTBUTTON>
        </WTROW>
        <WTROW>
          <WTCONDITION expr="PARAM(CryptoStatus)" oper="not-equal" value="CONST('OK')"/>
          <WTSTATIC col="1" label="NoCryptoProcessing" class="PageHeading" fontcolor="red"/>
        </WTROW>

        <!-- **********************************************************-->
        <!-- GET THE ORDER DETAIL INFORMATION FOR THE CRYPTO PAYMENT   -->
        <!-- **********************************************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-ORDER)"/>

          <WTROW margin-top="12" margin-bottom="6">
            <WTSTATIC col="1" merge="2" value="PARAM(UserName)" align="center" fontsize="3" fontcolor="blue" bold="true"/>
          </WTROW>
          <WTROW margin-top="6" margin-bottom="12">
            <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
          </WTROW>

          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="PayDate"/>
            <WTSTATIC col="1" value="PARAM(PayDate)" fontsize="3" prespace="false"/>
          </WTROW>

          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="CoinType"/>
            <WTCOMBO col="1" value="PARAM(CoinType)" prespace="false">
              <WTCHANGE>GetCoinPrice();</WTCHANGE>
              <WTOPTION id="1" label="Coin1"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',1,'))"/></WTOPTION>
              <WTOPTION id="2" label="Coin2"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',2,'))"/></WTOPTION>
              <WTOPTION id="3" label="Coin3"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',3,'))"/></WTOPTION>
              <WTOPTION id="4" label="Coin4"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',4,'))"/></WTOPTION>
              <WTOPTION id="5" label="Coin5"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',5,'))"/></WTOPTION>
              <WTOPTION id="6" label="Coin6"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',6,'))"/></WTOPTION>
              <WTOPTION id="7" label="Coin7"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',7,'))"/></WTOPTION>
              <WTOPTION id="8" label="Coin8"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',8,'))"/></WTOPTION>
              <WTOPTION id="9" label="Coin9"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',9,'))"/></WTOPTION>
              <WTOPTION id="10" label="Coin10"><WTCONDITION expr="CONST(contains)" value="CONST((/DATA/PARAM/@acceptedcoins, ',10,'))"/></WTOPTION>
            </WTCOMBO>
            <WTTEXT col="1" value="PARAM(CoinPrice)" style="BORDER:none;background:transparent;color:blue" size="10"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="Amount"/>
            <WTSTATIC col="1" value="PARAM(AmountFormat)" fontsize="3" prespace="false" newline="1"/>
            <WTSTATIC col="1" fontcolor="blue">
              <WTSTATIC label="TotalAmountText3"/>
              <WTCODEGROUP>
                <WTCONDITION expr="PARAM(PayStatus)" oper="equal" value="CONST(7)"/>
                <WTSTATIC newline="1"/>
                <WTSTATIC label="PartialPayment"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTCONDITION expr="PARAM(Description)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" tag="Description"/>
            <WTSTATIC col="1" value="PARAM(Description)" fontsize="3" prespace="false"/>
          </WTROW>

          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" action="5" value="CONST(AddCrypto)" align="center" btnclass="bigbutton"/>
            <WTBUTTON col="1" value="CONST(Close)" align="center">
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
          </WTROW>

        </WTCODEGROUP>

        <!-- *********************-->
        <!-- GET CRYPTO PAYMENT   -->
        <!-- *********************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-PAYMENT)"/>
          <WTROW id="MessageRow" style="background:darkblue">
            <WTTEXT col="1" name="MessageBox" value="CONST(15:00 Awaiting Payment...)" style="BORDER:none;background:transparent;color:white;text-align:center;width:100%"/>
          </WTROW>

          <WTROW margin-top="12">
            <WTSTATIC col="1" label="QRtext" align="center" fontsize="4" fontcolor="blue"/>
          </WTROW>
          <WTROW margin-top="6">
            <WTSTATIC col="1" label="Processingtext" align="center" fontsize="4" fontcolor="red"/>
          </WTROW>
          <WTROW margin-top="12" margin-bottom="12">
            <WTIMAGE col="1" id="QRCode" align="center" value="CONST(&lt;xsl:value-of select=&quot;/DATA/PARAM/@qr_url&quot;/&gt;)" imgpath=""/>
          </WTROW>
          <WTROW margin-bottom="24">
            <WTSTATIC col="1" align="center">
              <WTCODEGROUP>
                <WTIMAGE value="CONST(Coin&lt;xsl:value-of select=&quot;/DATA/PARAM/@cointype&quot;/&gt;.gif)" imgalign="absmiddle"/>
                <WTSTATIC space="2"/>
                <WTSTATIC value="PARAM(QR_Name)" fontsize="4" bold="true"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" align="center" fontsize="3">
              <WTCODEGROUP>
                <WTTEXT name="QRAmount" value="CONST(Coins: &lt;xsl:value-of select=&quot;/DATA/PARAM/@qr_amount&quot;/&gt;)" style="BORDER:none;background:transparent;color:black;text-align:center;" size="20" textclass="bigtext"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" align="center" fontsize="3">
              <WTSTATIC tag="QR_Label"/>
              <WTSTATIC value="PARAM(QR_Label)" bold="true"/>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTCONDITION expr="PARAM(QR_Msg)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" align="center" fontsize="3">
              <WTSTATIC tag="QR_Msg"/>
              <WTSTATIC value="PARAM(QR_Msg)" bold="true"/>
            </WTSTATIC>
          </WTROW>

          <WTROW margin-top="12" margin-bottom="12">
            <WTSTATIC col="1" label="QRtext2" align="center" fontsize="4" fontcolor="blue"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" align="center">
              <WTCODEGROUP>
                <WTSTATIC tag="QR_Address" fontsize="3"/>
                <WTTEXT value="PARAM(QR_Address)" size="40"/>
                <WTBUTTON id="CopyButton" value="CONST(Copy)" clipboard="#QR_Address"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" align="center">
              <WTCODEGROUP>
                <WTSTATIC tag="QR_Amount" fontsize="3"/>
                <WTTEXT value="PARAM(QR_Amount)" size="37"/>
                <WTBUTTON id="CopyButton" value="CONST(Copy)" clipboard="#QR_Amount"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>

          <WTROW margin-bottom="12">
            <WTBUTTON col="1" value="CONST(Close)" align="center">
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

        <!-- *********************-->
        <!-- CONFIRM THE ORDER    -->
        <!-- *********************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(OrderProcess)" oper="equal" value="SYSCON(ORDER-PROCESS-CONFIRM)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1" value="PARAM(UserName)" bold="true" align="center" fontsize="3"/>
          </WTROW>
          <WTROW margin-top="12">
            <WTSTATIC col="1" align="center" fontsize="4" fontcolor="blue">
              <WTSTATIC label="SuccessfulOrder"/>
            </WTSTATIC>
          </WTROW>
          
          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" value="CONST(Close)" align="center">
              <WTCLICK>DoResult();</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="15225" caption="Rewards Transfer" header="false" footer="false" navbar="false" wrapper="wrapper600"
		 aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLAdd.xsl">
      <!--============================================================================================-->
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="RecipientID" datatype="number"/>
      <WTPARAM name="Sender" datatype="text"/>
      <WTPARAM name="Recipient" datatype="text"/>
      <WTPARAM name="Logon" datatype="text"/>
      <WTPARAM name="ShopperID" datatype="text"/>
      <WTPARAM name="Amount" datatype="text"/>
      <WTPARAM name="Points" datatype="text"/>
      <WTPARAM name="Total" datatype="text"/>
      <WTPARAM name="Note" datatype="text"/>
      <WTPARAM name="Value" datatype="text"/>
      <WTPARAM name="NXCPrice" datatype="text"/>
      <WTPARAM name="NXCFormat" datatype="text"/>
      <WTPARAM name="Step" datatype="number"/>
      <WTPARAM name="Consumer2FA" datatype="number"/>

      <WTINCLUDE name="Coins.asp"/>
      <WTINCLUDE name="Comm.asp"/>
      <WTINCLUDE name="2FA.asp"/>

      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(Consumer2FA)" oper="equal" value="CONST(0)"/>
        <WTCALLSUB name="reqConsumer2FA = Is2FAConsumer( reqConsumerID )"/>
        <WTCODEGROUP>
          <WTCONDITION expr="IsEmployee"/>
          <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
          <WTSETATTRIBUTE name="PARAM(Consumer2FA)" value="CONST(1)"/>
        </WTCODEGROUP>
      </WTCODEGROUP>
        
      <!-- *********************** -->
      <!-- Step: 0 - 2FA           -->
      <!-- Step: 1 - Get Recipient -->
      <!-- Step: 2 - Get Amount    -->
      <!-- Step: 3 - Do Transfer   -->
      <!-- Step: 4 - Confirmation  -->
      <!-- *********************** -->

      <!-- **************************************************************************************************-->
      <WTSUB name="SetupTransfer">
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(Sender)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
        </WTOBJECT>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="GetTransferTotal">
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTMETHOD name="Custom">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="Status" direction="input" value="CONST(3)"/>
            <WTPARAM name="MemberID" direction="input" value="CONST(0)"/>
            <WTPARAM name="EnrollDate" direction="input" value="CONST(0)"/>
            <WTPARAM name="Email" direction="input" value="CONST(&quot;&quot;)"/>
            <WTPARAM name="reqTotal" direction="return" datatype="text"/>
          </WTMETHOD>
          <!-- get the current price of the Nexxus coin -->
          <WTSETATTRIBUTE name="PARAM(NXCPrice)" value="CONST(CoinPrice( 2, &quot;USD&quot; ))"/>
          <WTSETATTRIBUTE name="PARAM(NXCPrice)" value="CONST(.1)">
            <WTCONDITION expr="PARAM(NXCPrice)" oper="equal" value="CONST(0)"/>
          </WTSETATTRIBUTE>
          <WTSETATTRIBUTE name="PARAM(NXCFormat)" value="CONST(FormatCurrency(reqNXCPrice))"/>
          <WTSETATTRIBUTE name="PARAM(Value)" value="CONST(FormatCurrency(reqTotal * reqNXCPrice))"/>
        </WTOBJECT>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="GetRecipient">
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(ShopperID)" oper="not-equal" value="CONST(&quot;&quot;)"/>
            <WTSETATTRIBUTE name="CONST(Result)" value="PARAM(ShopperID)"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(ShopperID)" oper="equal" value="CONST(&quot;&quot;)"/>
            <WTMETHOD name="Logon2">
              <WTPARAM name="Email" direction="input" value="PARAM(Logon)"/>
              <WTPARAM name="Result" direction="return" datatype="number"/>
            </WTMETHOD>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="greater" value="CONST(0)"/>
            <WTSETATTRIBUTE name="PARAM(RecipientID)" value="CONST(Result)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="ConsumerID" direction="input" value="PARAM(RecipientID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(NameFirst)" oper="not-equal" value="CONST(&quot;&quot;)"/>
              <WTSETATTRIBUTE name="PARAM(Recipient)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
            </WTCODEGROUP>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(NameFirst)" oper="equal" value="CONST(&quot;&quot;)"/>
              <WTERROR number="10154" message="Oops, The Shopper could not be found."/>
            </WTCODEGROUP>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000002)"/>
            <WTERROR number="10129" message="Oops, The Email could not be found."/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000003)"/>
            <WTERROR number="10134" message="Oops, The Phone Number could not be found."/>
          </WTCODEGROUP>
        </WTOBJECT>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="ValidTransfer">
        <WTCALLSUB name="GetTransferTotal"/>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Amount)" oper="equal" value="CONST(&quot;0&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(Amount)" value="CONST(&quot;&quot;)"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Amount)" oper="not-equal" value="CONST(&quot;&quot;)"/>
          <WTSETATTRIBUTE name="CONST(tmpAmount)" value="CONST(CDBL(reqAmount) / CDBL(reqNXCPrice) )"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Amount)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTSETATTRIBUTE name="CONST(tmpAmount)" value="CONST(reqPoints)"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="CONST(CDBL(tmpAmount))" oper="less-equal" value="CONST(0)"/>
          <WTERROR number="10152" message="Oops, Please enter an amount greater than zero to transfer."/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="CONST(CDBL(tmpAmount))" oper="greater" value="CONST(CDBL(reqTotal))"/>
          <WTERROR number="10153" message="Oops, Please enter an amount less or equal to the total points available."/>
        </WTCODEGROUP>
        <WTSETATTRIBUTE name="PARAM(Amount)" value="CONST(tmpAmount)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="DoTransfer">
        <WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
          <WTMETHOD name="Load">
            <WTPARAM name="RewardID" direction="input" value="CONST(0)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(MerchantID)" value="CONST(0)"/>
          <WTSETATTRIBUTE name="ATTR(Payment2ID)" value="CONST(0)"/>
          <WTSETATTRIBUTE name="ATTR(AwardID)" value="CONST(18)"/>
          <WTSETATTRIBUTE name="ATTR(RewardType)" value="CONST(1)"/>
          <WTSETATTRIBUTE name="ATTR(Status)" value="CONST(3)"/>
          <WTSETATTRIBUTE name="ATTR(RewardDate)" value="SYS(Now)"/>
          <WTSETATTRIBUTE name="ATTR(HoldDate)" value="CONST(0)"/>
          <WTSETATTRIBUTE name="ATTR(Note)" value="PARAM(Note)"/>

          <!-- Create Sender Debit -->
          <WTSETATTRIBUTE name="ATTR(ConsumerID)" value="PARAM(ConsumerID)"/>
          <WTSETATTRIBUTE name="ATTR(Amount)" value="CONST( toSatoshi(reqAmount * -1) )"/>
          <WTSETATTRIBUTE name="ATTR(Reference)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="Add">
            <WTPARAM name="SenderRewardID" direction="return" datatype="number"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>

          <!-- Create Recipient Credit -->
          <WTSETATTRIBUTE name="ATTR(ConsumerID)" value="PARAM(RecipientID)"/>
          <WTSETATTRIBUTE name="ATTR(Amount)" value="CONST( toSatoshi(reqAmount) )"/>
          <WTSETATTRIBUTE name="ATTR(Reference)" value="CONST(CSTR(SenderRewardID))"/>
          <WTMETHOD name="Add">
            <WTPARAM name="RewardID" direction="return" datatype="number"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>

          <!-- Update Sender Reference -->
          <WTMETHOD name="Load">
            <WTPARAM name="RewardID" direction="input" value="CONST(SenderRewardID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(Reference)" value="CONST(CSTR(RewardID))"/>
          <WTMETHOD name="Save">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>

        </WTOBJECT>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTSETATTRIBUTE name="PARAM(Step)" value="CONST(0)"/>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Consumer2FA)" oper="not-equal" value="CONST(0)"/>
          <WTCALLSUB name="SetupTransfer"/>
          <WTSETATTRIBUTE name="PARAM(Step)" value="CONST(1)"/>
        </WTCODEGROUP>
      </WTACTION>

      <WTACTION id="1" name="TransferAmount" type="Add">
        <WTCALLSUB name="GetTransferTotal"/>
        <WTCALLSUB name="GetRecipient"/>
        <WTSETATTRIBUTE name="PARAM(Step)" value="CONST(2)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
      </WTACTION>

      <WTACTION id="2" name="DoTransfer" type="Add">
        <WTCALLSUB name="ValidTransfer"/>
        <WTCALLSUB name="DoTransfer">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTSETATTRIBUTE name="PARAM(Step)" value="CONST(3)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="600" align="center"/>

        <!-- Convert input to digits only if no @ sign for an email -->
        <WTFUNCTION name="LogonDigitsOnly(obj)">
          var val = obj.value;
          if(val.indexOf('@') === -1)	{
          obj.value = val.replace(/\D/g,'');
          }
        </WTFUNCTION>

        <WTFUNCTION name="Setup2FA()">
          var id = document.getElementById('ConsumerID').value
          var url = "0108.asp?consumerid=" + id
          var win = window.open(url);
          win.focus();
        </WTFUNCTION>

        <WTROW>
          <WTHIDDEN value="PARAM(ConsumerID)"/>
          <WTHIDDEN value="PARAM(RecipientID)"/>
          <WTHIDDEN value="PARAM(Sender)"/>
          <WTHIDDEN value="PARAM(Recipient)"/>
          <WTHIDDEN value="PARAM(Total)"/>
          <WTHIDDEN value="PARAM(Value)"/>
          <WTHIDDEN value="PARAM(Step)"/>
          <WTHIDDEN value="PARAM(Consumer2FA)"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" class="PageHeading" align="center">
            <WTSTATIC tag="Transfer"/>
            <WTSTATIC value="PARAM(Sender)"/>
          </WTSTATIC>
        </WTROW>

        <!-- *******************-->
        <!-- NO 2FA             -->
        <!-- *******************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Step)" oper="equal" value="CONST(0)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1" label="No2FA" align="center" fontsize="4" fontcolor="red"/>
          </WTROW>
          <WTROW margin-top="24" margin-bottom="12">
            <WTBUTTON col="1" value="CONST(Setup2FA)" align="center">
              <WTCLICK>Setup2FA();</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

        <!-- *******************-->
        <!-- GET THE RECIPIENT  -->
        <!-- *******************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Step)" oper="equal" value="CONST(1)"/>
          <WTROW margin-top="12" margin-bottom="12">
            <WTTABLE col="1" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
              <WTCOLUMN width="550" align="center"/>
              <WTROW>
                <WTSTATIC col="1" label="WhoTransferTo" align="center" fontsize="4"/>
              </WTROW>
              <WTROW margin-top="12">
                <WTSTATIC col="1" tag="TansferRecipient"/>
                <WTTEXT col="1" value="PARAM(Logon)" align="left" size="20">
                  <WTEXIT>LogonDigitsOnly(this);</WTEXIT>
                </WTTEXT>
              </WTROW>
              <WTROW margin-top="12">
                <WTSTATIC col="1" tag="TansferShopperID"/>
                <WTTEXT col="1" value="PARAM(ShopperID)" align="left" size="5">
                  <WTEXIT>LogonDigitsOnly(this);</WTEXIT>
                </WTTEXT>
              </WTROW>
              <WTROW margin-top="12">
                <WTBUTTON col="1" action="1" value="CONST(Continue)" align="center" btnclass="hugebutton"/>
                <WTBUTTON col="1" value="CONST(Close)" align="center">
                  <WTCLICK>window.close()</WTCLICK>
                </WTBUTTON>
              </WTROW>
            </WTTABLE>
          </WTROW>
       </WTCODEGROUP>

        <!-- ************************-->
        <!-- GET THE TRANFER AMOUNT  -->
        <!-- ************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Step)" oper="equal" value="CONST(2)"/>

          <WTROW margin-top="12" margin-bottom="6">
            <WTSTATIC col="1" value="PARAM(Recipient)" align="center" fontsize="3" fontcolor="blue" bold="true"/>
            <WTBUTTON col="1" action="0" value="CONST(Change)" btnclass="smbutton"/>
          </WTROW>
          <WTROW margin-top="6" margin-bottom="6">
            <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" tag="TransferTotal" fontsize="3"/>
            <WTSTATIC col="1" value="PARAM(Total)" fontsize="4" prespace="false"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" tag="TransferNXC" fontsize="3"/>
            <WTSTATIC col="1" value="PARAM(NXCFormat)" fontsize="4" prespace="false"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="TransferValue" fontsize="3"/>
            <WTSTATIC col="1" value="PARAM(Value)" fontsize="4" prespace="false"/>
          </WTROW>

          <WTROW margin-bottom="6">
            <WTSTATIC col="1" tag="TransferAmount" fontsize="3"/>
            <WTTEXT col="1" value="PARAM(Amount)" size="10" prespace="false"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" tag="TransferPoints" fontsize="3"/>
            <WTTEXT col="1" value="PARAM(Points)" size="10" prespace="false"/>
          </WTROW>
          <WTROW>
            <WTSTATIC col="1" tag="TransferNote" valign="top" fontsize="3"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTMEMO col="1" value="PARAM(Note)" cols="40" rows="2" prespace="false"/>
          </WTROW>

          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" action="2" value="CONST(Transfer)" align="center" btnclass="bigbutton"/>
            <WTBUTTON col="1" value="CONST(Close)" align="center">
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
          </WTROW>

        </WTCODEGROUP>

        <!-- *********************-->
        <!-- CONFIRM THE ORDER    -->
        <!-- *********************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Step)" oper="equal" value="CONST(3)"/>
          <WTROW margin-top="12" margin-bottom="12">
              <WTSTATIC col="1" value="PARAM(Recipient)" bold="true" align="center" fontsize="3"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" label="SuccessfulTransfer" align="center" fontsize="4" fontcolor="blue"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" value="PARAM(Amount)" fontsize="4" space="1" bold="true"/>
            <WTSTATIC col="1" label="TransferedPoints" fontsize="3"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" value="PARAM(Note)" fontsize="3" space="1"/>
          </WTROW>

          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" value="CONST(Close)" align="center">
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--============================================================================================-->
      <WTWEBPAGE name="m_15225" caption="Rewards Transfer" page-left="3" page-top="0" navbar="false" header="false" footer="false"
      page-width="100%" margin-width="0%" navbar-width="0%" content-width="100%" viewport="width=device-width"
      aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl">                 
      <!--============================================================================================-->
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="RecipientID" datatype="number"/>
      <WTPARAM name="Sender" datatype="text"/>
      <WTPARAM name="Recipient" datatype="text"/>
      <WTPARAM name="Logon" datatype="text"/>
      <WTPARAM name="ShopperID" datatype="text"/>
      <WTPARAM name="Amount" datatype="text"/>
      <WTPARAM name="Points" datatype="text"/>
      <WTPARAM name="Total" datatype="text"/>
      <WTPARAM name="Note" datatype="text"/>
      <WTPARAM name="Value" datatype="text"/>
      <WTPARAM name="NXCPrice" datatype="text"/>
      <WTPARAM name="NXCFormat" datatype="text"/>
      <WTPARAM name="Step" datatype="number"/>
      <WTPARAM name="Consumer2FA" datatype="number"/>

      <WTINCLUDE name="Coins.asp"/>
      <WTINCLUDE name="Comm.asp"/>
      <WTINCLUDE name="2FA.asp"/>

      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(Consumer2FA)" oper="equal" value="CONST(0)"/>
        <WTCALLSUB name="reqConsumer2FA = Is2FAConsumer( reqConsumerID )"/>
        <WTCODEGROUP>
          <WTCONDITION expr="IsEmployee"/>
          <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
          <WTSETATTRIBUTE name="PARAM(Consumer2FA)" value="CONST(1)"/>
        </WTCODEGROUP>
      </WTCODEGROUP>

      <!-- *********************** -->
      <!-- Step: 0 - 2FA           -->
      <!-- Step: 1 - Get Recipient -->
      <!-- Step: 2 - Get Amount    -->
      <!-- Step: 3 - Do Transfer   -->
      <!-- Step: 4 - Confirmation  -->
      <!-- *********************** -->

      <!-- **************************************************************************************************-->
      <WTSUB name="SetupTransfer">
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(Sender)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
        </WTOBJECT>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="GetTransferTotal">
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTMETHOD name="Custom">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="Status" direction="input" value="CONST(3)"/>
            <WTPARAM name="MemberID" direction="input" value="CONST(0)"/>
            <WTPARAM name="EnrollDate" direction="input" value="CONST(0)"/>
            <WTPARAM name="Email" direction="input" value="CONST(&quot;&quot;)"/>
            <WTPARAM name="reqTotal" direction="return" datatype="text"/>
          </WTMETHOD>
          <!-- get the current price of the Nexxus coin -->
          <WTSETATTRIBUTE name="PARAM(NXCPrice)" value="CONST(CoinPrice( 2, &quot;USD&quot; ))"/>
          <WTSETATTRIBUTE name="PARAM(NXCPrice)" value="CONST(.1)">
            <WTCONDITION expr="PARAM(NXCPrice)" oper="equal" value="CONST(0)"/>
          </WTSETATTRIBUTE>
          <WTSETATTRIBUTE name="PARAM(NXCFormat)" value="CONST(FormatCurrency(reqNXCPrice))"/>
          <WTSETATTRIBUTE name="PARAM(Value)" value="CONST(FormatCurrency(reqTotal * reqNXCPrice))"/>
        </WTOBJECT>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="GetRecipient">
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(ShopperID)" oper="not-equal" value="CONST(&quot;&quot;)"/>
            <WTSETATTRIBUTE name="CONST(Result)" value="PARAM(ShopperID)"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(ShopperID)" oper="equal" value="CONST(&quot;&quot;)"/>
            <WTMETHOD name="Logon2">
              <WTPARAM name="Email" direction="input" value="PARAM(Logon)"/>
              <WTPARAM name="Result" direction="return" datatype="number"/>
            </WTMETHOD>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="greater" value="CONST(0)"/>
            <WTSETATTRIBUTE name="PARAM(RecipientID)" value="CONST(Result)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="ConsumerID" direction="input" value="PARAM(RecipientID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(NameFirst)" oper="not-equal" value="CONST(&quot;&quot;)"/>
              <WTSETATTRIBUTE name="PARAM(Recipient)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
            </WTCODEGROUP>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(NameFirst)" oper="equal" value="CONST(&quot;&quot;)"/>
              <WTERROR number="10154" message="Oops, The Shopper could not be found."/>
            </WTCODEGROUP>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000002)"/>
            <WTERROR number="10129" message="Oops, The Email could not be found."/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000003)"/>
            <WTERROR number="10134" message="Oops, The Phone Number could not be found."/>
          </WTCODEGROUP>
        </WTOBJECT>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="ValidTransfer">
        <WTCALLSUB name="GetTransferTotal"/>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Amount)" oper="equal" value="CONST(&quot;0&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(Amount)" value="CONST(&quot;&quot;)"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Amount)" oper="not-equal" value="CONST(&quot;&quot;)"/>
          <WTSETATTRIBUTE name="CONST(tmpAmount)" value="CONST(CDBL(reqAmount) / CDBL(reqNXCPrice) )"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Amount)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTSETATTRIBUTE name="CONST(tmpAmount)" value="CONST(reqPoints)"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="CONST(CDBL(tmpAmount))" oper="less-equal" value="CONST(0)"/>
          <WTERROR number="10152" message="Oops, Please enter an amount greater than zero to transfer."/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="CONST(CDBL(tmpAmount))" oper="greater" value="CONST(CDBL(reqTotal))"/>
          <WTERROR number="10153" message="Oops, Please enter an amount less or equal to the total points available."/>
        </WTCODEGROUP>
        <WTSETATTRIBUTE name="PARAM(Amount)" value="CONST(tmpAmount)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
      </WTSUB>

      <!-- **************************************************************************************************-->
      <WTSUB name="DoTransfer">
        <WTOBJECT name="Reward" project="ptsRewardUser" class="CReward">
          <WTMETHOD name="Load">
            <WTPARAM name="RewardID" direction="input" value="CONST(0)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(MerchantID)" value="CONST(0)"/>
          <WTSETATTRIBUTE name="ATTR(Payment2ID)" value="CONST(0)"/>
          <WTSETATTRIBUTE name="ATTR(AwardID)" value="CONST(18)"/>
          <WTSETATTRIBUTE name="ATTR(RewardType)" value="CONST(1)"/>
          <WTSETATTRIBUTE name="ATTR(Status)" value="CONST(3)"/>
          <WTSETATTRIBUTE name="ATTR(RewardDate)" value="SYS(Now)"/>
          <WTSETATTRIBUTE name="ATTR(HoldDate)" value="CONST(0)"/>
          <WTSETATTRIBUTE name="ATTR(Note)" value="PARAM(Note)"/>

          <!-- Create Sender Debit -->
          <WTSETATTRIBUTE name="ATTR(ConsumerID)" value="PARAM(ConsumerID)"/>
          <WTSETATTRIBUTE name="ATTR(Amount)" value="CONST( toSatoshi(reqAmount * -1) )"/>
          <WTSETATTRIBUTE name="ATTR(Reference)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="Add">
            <WTPARAM name="SenderRewardID" direction="return" datatype="number"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>

          <!-- Create Recipient Credit -->
          <WTSETATTRIBUTE name="ATTR(ConsumerID)" value="PARAM(RecipientID)"/>
          <WTSETATTRIBUTE name="ATTR(Amount)" value="CONST( toSatoshi(reqAmount) )"/>
          <WTSETATTRIBUTE name="ATTR(Reference)" value="CONST(CSTR(SenderRewardID))"/>
          <WTMETHOD name="Add">
            <WTPARAM name="RewardID" direction="return" datatype="number"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>

          <!-- Update Sender Reference -->
          <WTMETHOD name="Load">
            <WTPARAM name="RewardID" direction="input" value="CONST(SenderRewardID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(Reference)" value="CONST(CSTR(RewardID))"/>
          <WTMETHOD name="Save">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>

        </WTOBJECT>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTSETATTRIBUTE name="PARAM(Step)" value="CONST(0)"/>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Consumer2FA)" oper="not-equal" value="CONST(0)"/>
          <WTCALLSUB name="SetupTransfer"/>
          <WTSETATTRIBUTE name="PARAM(Step)" value="CONST(1)"/>
        </WTCODEGROUP>
      </WTACTION>

      <WTACTION id="1" name="TransferAmount" type="Add">
        <WTCALLSUB name="GetTransferTotal"/>
        <WTCALLSUB name="GetRecipient"/>
        <WTSETATTRIBUTE name="PARAM(Step)" value="CONST(2)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
      </WTACTION>

      <WTACTION id="2" name="DoTransfer" type="Add">
        <WTCALLSUB name="ValidTransfer"/>
        <WTCALLSUB name="DoTransfer">
          <WTCONDITION expr="NoErrors"/>
        </WTCALLSUB>
        <WTSETATTRIBUTE name="PARAM(Step)" value="CONST(3)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="100" align="center"/>

        <!-- Convert input to digits only if no @ sign for an email -->
        <WTFUNCTION name="LogonDigitsOnly(obj)">
          var val = obj.value;
          if(val.indexOf('@') === -1)	{
          obj.value = val.replace(/\D/g,'');
          }
        </WTFUNCTION>

        <WTFUNCTION name="Setup2FA()">
          var id = document.getElementById('ConsumerID').value
          var url = "m_0108.asp?consumerid=" + id
          var win = window.open(url);
          win.focus();
        </WTFUNCTION>

        <WTROW>
          <WTHIDDEN value="PARAM(ConsumerID)"/>
          <WTHIDDEN value="PARAM(RecipientID)"/>
          <WTHIDDEN value="PARAM(Sender)"/>
          <WTHIDDEN value="PARAM(Recipient)"/>
          <WTHIDDEN value="PARAM(Total)"/>
          <WTHIDDEN value="PARAM(Value)"/>
          <WTHIDDEN value="PARAM(Step)"/>
          <WTHIDDEN value="PARAM(Consumer2FA)"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" class="PageHeading" align="center">
            <WTSTATIC tag="Transfer"/>
            <WTSTATIC value="PARAM(Sender)"/>
          </WTSTATIC>
        </WTROW>

        <!-- *******************-->
        <!-- NO 2FA             -->
        <!-- *******************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Step)" oper="equal" value="CONST(0)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1" label="No2FA" align="center" fontsize="4" fontcolor="red"/>
          </WTROW>
          <WTROW margin-top="24" margin-bottom="12">
            <WTBUTTON col="1" value="CONST(Setup2FA)" align="center">
              <WTCLICK>Setup2FA();</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

        <!-- *******************-->
        <!-- GET THE RECIPIENT  -->
        <!-- *******************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Step)" oper="equal" value="CONST(1)"/>
          <WTROW margin-top="12" margin-bottom="12">
            <WTTABLE col="1" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
              <WTCOLUMN width="90" align="center"/>
              <WTROW>
                <WTSTATIC col="1" label="WhoTransferTo" align="center" fontsize="4"/>
              </WTROW>
              <WTROW margin-top="12">
                <WTSTATIC col="1" tag="TansferRecipient"/>
              </WTROW>
              <WTROW>
                <WTTEXT col="1" value="PARAM(Logon)" size="20">
                  <WTEXIT>LogonDigitsOnly(this);</WTEXIT>
                </WTTEXT>
              </WTROW>
              <WTROW margin-top="12">
                <WTSTATIC col="1" tag="TansferShopperID"/>
              </WTROW>
              <WTROW>
                <WTTEXT col="1" value="PARAM(ShopperID)" size="5">
                  <WTEXIT>LogonDigitsOnly(this);</WTEXIT>
                </WTTEXT>
              </WTROW>
              <WTROW margin-top="12">
                <WTBUTTON col="1" action="1" value="CONST(Continue)" align="center" btnclass="hugebutton"/>
                <WTBUTTON col="1" value="CONST(Close)" align="center">
                  <WTCLICK>window.close()</WTCLICK>
                </WTBUTTON>
              </WTROW>
            </WTTABLE>
          </WTROW>
        </WTCODEGROUP>

        <!-- ************************-->
        <!-- GET THE TRANFER AMOUNT  -->
        <!-- ************************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Step)" oper="equal" value="CONST(2)"/>

          <WTROW margin-top="12" margin-bottom="6">
            <WTSTATIC col="1" value="PARAM(Recipient)" align="center" fontsize="3" fontcolor="blue" bold="true"/>
            <WTBUTTON col="1" action="0" value="CONST(Change)" btnclass="smbutton"/>
          </WTROW>
          <WTROW margin-top="6" margin-bottom="6">
            <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" tag="TransferTotal" fontsize="3"/>
            <WTSTATIC col="1" value="PARAM(Total)" fontsize="4" prespace="false"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" tag="TransferNXC" fontsize="3"/>
            <WTSTATIC col="1" value="PARAM(NXCFormat)" fontsize="4" prespace="false"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="TransferValue" fontsize="3"/>
            <WTSTATIC col="1" value="PARAM(Value)" fontsize="4" prespace="false"/>
          </WTROW>

          <WTROW margin-bottom="6">
            <WTSTATIC col="1" tag="TransferAmount" fontsize="3"/>
            <WTTEXT col="1" value="PARAM(Amount)" size="10" prespace="false"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" tag="TransferPoints" fontsize="3"/>
            <WTTEXT col="1" value="PARAM(Points)" size="10" prespace="false"/>
          </WTROW>
          <WTROW>
            <WTSTATIC col="1" tag="TransferNote" valign="top" fontsize="3"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTMEMO col="1" value="PARAM(Note)" cols="30" rows="3" prespace="false"/>
          </WTROW>

          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" action="2" value="CONST(Transfer)" align="center" btnclass="bigbutton"/>
            <WTBUTTON col="1" value="CONST(Close)" align="center">
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
          </WTROW>

        </WTCODEGROUP>

        <!-- *********************-->
        <!-- CONFIRM THE ORDER    -->
        <!-- *********************-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Step)" oper="equal" value="CONST(3)"/>
          <WTROW margin-top="12" margin-bottom="12">
            <WTSTATIC col="1" value="PARAM(Recipient)" bold="true" align="center" fontsize="3"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" label="SuccessfulTransfer" align="center" fontsize="4" fontcolor="blue"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" value="PARAM(Amount)" fontsize="4" space="1" bold="true"/>
            <WTSTATIC col="1" label="TransferedPoints" fontsize="3"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" value="PARAM(Note)" fontsize="3" space="1"/>
          </WTROW>

          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" value="CONST(Close)" align="center">
              <WTCLICK>window.close()</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

      </WTCONTENT>
    </WTWEBPAGE>

  </WTWEBPAGES>
</WTROOT>