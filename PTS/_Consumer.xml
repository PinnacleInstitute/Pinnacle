<WTROOT prefix="pts" system="Pinnacle">
	<WTENTITY id="151" name="Consumer" alias="csm">

		<!--Identity-->
		<WTATTRIBUTE id="15101" name="ConsumerID" type="number" identity="true" min="1" title="true" required="true" source="entity"/>

		<!--Foreign Keys-->
		<WTATTRIBUTE id="15102" name="MemberID" type="number" source="entity"/>
		<WTATTRIBUTE id="15103" name="MerchantID" type="number" source="entity"/>
		<WTATTRIBUTE id="15104" name="ReferID" type="number" source="entity"/>
		<WTATTRIBUTE id="15105" name="CountryID" type="number" source="entity"/>
    <WTATTRIBUTE id="15106" name="CountryID2" type="number" source="entity"/>
    <WTATTRIBUTE id="15107" name="AffiliateID" type="number" source="entity"/>

    <!--Foreign Table Fields-->
		<WTATTRIBUTE id="15108" name="CountryName" type="text" length="50" source="join">
			<WTJOIN entity="Country" name="CountryName"/>
		</WTATTRIBUTE>

		<!--Attributes-->
		<WTATTRIBUTE id="15110" name="NameLast" type="text" length="30" min="1" max="30" source="entity"/>
		<WTATTRIBUTE id="15111" name="NameFirst" type="text" length="30" min="1" max="30" source="entity"/>
		<WTATTRIBUTE id="15112" name="ConsumerName" type="text" length="62" min="1" max="62" source="entity">
			<WTCOMPUTE name="NameLast"/>
			<WTCOMPUTE text=", "/>
			<WTCOMPUTE name="NameFirst"/>
		</WTATTRIBUTE>
		<WTATTRIBUTE id="15113" name="Email" type="text" length="80" min="1" max="80" source="entity"/>
		<WTATTRIBUTE id="15114" name="Email2" type="text" length="80" min="1" max="80" source="entity"/>
		<WTATTRIBUTE id="15115" name="Phone" type="text" length="20" min="1" max="20" source="entity"/>
		<WTATTRIBUTE id="15116" name="Provider" type="number" source="entity"/>
		<WTATTRIBUTE id="15117" name="Password" type="text" length="20" min="1" max="20" source="entity"/>
		<WTATTRIBUTE id="15118" name="Status" type="number" source="entity">
			<WTENUM id="1" name="Setup"/>
			<WTENUM id="2" name="Active"/>
			<WTENUM id="3" name="Cancelled"/>
			<WTENUM id="4" name="Removed"/>
		</WTATTRIBUTE>
		<WTATTRIBUTE id="15119" name="Messages" type="number" source="entity">
			<WTENUM id="1" name="msgAll"/>
			<WTENUM id="2" name="msgNoRewards"/>
			<WTENUM id="3" name="msgNoPromotions"/>
			<WTENUM id="4" name="msgNone"/>
		</WTATTRIBUTE>
		<WTATTRIBUTE id="15120" name="Street1" type="text" length="60" min="1" max="60" source="entity"/>
		<WTATTRIBUTE id="15121" name="Street2" type="text" length="60" min="1" max="60" source="entity"/>
		<WTATTRIBUTE id="15122" name="City" type="text" length="30" min="1" max="30" source="entity"/>
		<WTATTRIBUTE id="15123" name="State" type="text" length="30" min="1"  max="30" source="entity"/>
		<WTATTRIBUTE id="15124" name="Zip" type="text" length="20" min="1"  max="20" source="entity"/>
		<WTATTRIBUTE id="15125" name="City2" type="text" length="30" min="1" max="30" source="entity"/>
		<WTATTRIBUTE id="15126" name="State2" type="text" length="30" min="1"  max="30" source="entity"/>
		<WTATTRIBUTE id="15127" name="Zip2" type="text" length="20" min="1"  max="20" source="entity"/>
		<WTATTRIBUTE id="15128" name="Referrals" type="number" source="entity"/>
		<WTATTRIBUTE id="15129" name="Cash" type="currency" min="-999999.99" max="999999.99" source="entity">
      <WTFORMAT value="###,###,##0.00" />
    </WTATTRIBUTE>
    <WTATTRIBUTE id="15130" name="Points" type="currency" min="-999999.99" max="999999.99" source="entity">
			<WTFORMAT value="###,###,##0.00" />
		</WTATTRIBUTE>
		<WTATTRIBUTE id="15131" name="VisitDate" type="date" source="entity">
			<WTFORMAT value="m-d-yy h:mm am/pm"/>
		</WTATTRIBUTE>
    <WTATTRIBUTE id="15132" name="EnrollDate" type="date" source="entity">
      <WTFORMAT value="m-d-yy h:mm am/pm"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="15133" name="UserKey" type="text" length="40" min="1" max="40" source="entity" language="false"/>
    <WTATTRIBUTE id="15134" name="Barter" type="text" length="100" min="1" max="100" source="entity" language="false"/>

    <!-- Non Persist Fields -->
    <WTATTRIBUTE id="15190" name="CompanyID" type="number" source="entity" persist="false"/>
    <WTATTRIBUTE id="15191" name="TargetArea" type="number" source="entity" persist="false"/>
    <WTATTRIBUTE id="15192" name="TargetType" type="number" source="entity" persist="false"/>
    <WTATTRIBUTE id="15193" name="TargetDays" type="number" source="entity" persist="false"/>
    <WTATTRIBUTE id="15194" name="Target" type="text" length="200" min="1"  max="200" source="entity" persist="false"/>

		<WTINDEX name="Email">
			<WTATTRIBUTE name="Email"/>
		</WTINDEX>
		<WTINDEX name="Phone">
			<WTATTRIBUTE name="Phone"/>
		</WTINDEX>
		<WTINDEX name="MemberID">
			<WTATTRIBUTE name="MemberID"/>
      <WTATTRIBUTE name="ReferID"/>
    </WTINDEX>
		<WTINDEX name="MerchantID">
			<WTATTRIBUTE name="MerchantID"/>
      <WTATTRIBUTE name="ReferID"/>
    </WTINDEX>
		<WTINDEX name="ReferID">
			<WTATTRIBUTE name="ReferID"/>
		</WTINDEX>
		<WTINDEX name="Zip">
			<WTATTRIBUTE name="CountryID"/>
			<WTATTRIBUTE name="Zip"/>
		</WTINDEX>
		<WTINDEX name="Zip2">
			<WTATTRIBUTE name="CountryID2"/>
			<WTATTRIBUTE name="Zip2"/>
		</WTINDEX>
		<WTINDEX name="City2">
			<WTATTRIBUTE name="CountryID2"/>
			<WTATTRIBUTE name="City2"/>
		</WTINDEX>
		<WTINDEX name="State2">
			<WTATTRIBUTE name="CountryID2"/>
			<WTATTRIBUTE name="State2"/>
		</WTINDEX>

		<WTRELATIONSHIPS>
			<WTRELATIONSHIP name="Consumer" entity="Consumer" alias="csm"/>
			<WTRELATIONSHIP name="Common" entity="Consumer" alias="csm">
				<WTENTITY name="Country" entity="Country" alias="cou">
					<WTATTRIBUTE alias="csm" name="CountryID" relalias="cou" relname="CountryID"/>
				</WTENTITY>
			</WTRELATIONSHIP>
		</WTRELATIONSHIPS>

		<WTENUM id="1" type="find">
			<WTATTRIBUTE name="ConsumerName" default="true"/>
			<WTATTRIBUTE name="NameFirst"/>
			<WTATTRIBUTE name="Email"/>
			<WTATTRIBUTE name="Phone"/>
		</WTENUM>

  </WTENTITY>

	<WTPROCEDURES>
		<!--==================================================================================================================-->
		<WTPROCEDURE type="Add" name="Add" style="GenerateDataProc.xsl" template="new">
			<WTDECLARE name="Now" datatype="date"/>
			<WTDECLARE name="NewID" datatype="number"/>
			<WTSETVALUE name="Now" value="SYS(timestamp)"/>
			<WTCODEGROUP>
				<WTINSERT/>
				<WTSETVALUE name="NewID" value="SYS(identity)"/>
				<WTSETVALUE name="PARAM(ConsumerID)" value="NewID"/>
				<WTPROCEDURE name="Consumer_SetReferral">
					<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
				</WTPROCEDURE>
			</WTCODEGROUP>
		</WTPROCEDURE>
		<!--==================================================================================================================-->
		<WTPROCEDURE type="Delete" name="Delete" style="GenerateDataProc.xsl"/>
		<!--==================================================================================================================-->
		<WTPROCEDURE type="Fetch" name="Fetch" style="GenerateDataProc.xsl">
			<WTJOIN name="Common"/>
		</WTPROCEDURE>
		<!--================================================================================================-->
		<WTPROCEDURE name="FetchEmail" type="Fetch" style="GenerateDataProc.xsl" template="new">
			<WTPARAM name="ATTR(Email)" direction="input"/>
			<WTPARAM name="ATTR(ConsumerID)" direction="output"/>
			<WTDECLARE name="ConsumerID" datatype="number"/>
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE name="ConsumerID" value="ATTR(Consumer.ConsumerID)"/>
					<WTJOIN name="Consumer" lock="false"/>
					<WTCONDITION expr="ATTR(Consumer.Email)" oper="equal" value="PARAM(Email)"/>
				</WTSELECT>
				<WTSETVALUE name="PARAM(ConsumerID)" value="ConsumerID" null="0"/>
			</WTCODEGROUP>
		</WTPROCEDURE>
		<!--================================================================================================-->
		<WTPROCEDURE name="FetchPhone" type="Fetch" style="GenerateDataProc.xsl" template="new">
			<WTPARAM name="ATTR(Phone)" direction="input"/>
			<WTPARAM name="ATTR(ConsumerID)" direction="output"/>
			<WTDECLARE name="ConsumerID" datatype="number"/>
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE name="ConsumerID" value="ATTR(Consumer.ConsumerID)"/>
					<WTJOIN name="Consumer" lock="false"/>
					<WTCONDITION expr="ATTR(Consumer.Phone)" oper="equal" value="PARAM(Phone)"/>
				</WTSELECT>
				<WTSETVALUE name="PARAM(ConsumerID)" value="ConsumerID" null="0"/>
			</WTCODEGROUP>
		</WTPROCEDURE>
		<!--================================================================================================-->
		<WTPROCEDURE type="Find" name="Find" style="GenerateDataProc.xsl">
			<WTBOOKMARK name=""/>
			<WTPARAM name="SYS(userid)" direction="input"/>
			<WTJOIN name="Common"/>
		</WTPROCEDURE>
		<!--================================================================================================-->
		<WTPROCEDURE type="Find" name="FindMerchant" style="GenerateDataProc.xsl">
			<WTBOOKMARK name=""/>
			<WTPARAM name="ATTR(MerchantID)" direction="input"/>
			<WTPARAM name="SYS(userid)" direction="input"/>
			<WTJOIN name="Common"/>
			<WTCONDITION expr="ATTR(Member.MerchantID)" oper="equal" value="PARAM(MerchantID)" connector="and"/>
      <WTCONDITION expr="ATTR(Member.ReferID)" oper="equal" value="CONST(0)" connector="and"/>
    </WTPROCEDURE>
		<!--================================================================================================-->
		<WTPROCEDURE type="Find" name="FindMember" style="GenerateDataProc.xsl">
			<WTBOOKMARK name=""/>
			<WTPARAM name="ATTR(MemberID)" direction="input"/>
			<WTPARAM name="SYS(userid)" direction="input"/>
			<WTJOIN name="Common"/>
			<WTCONDITION expr="ATTR(Member.MemberID)" oper="equal" value="PARAM(MemberID)" connector="and"/>
      <WTCONDITION expr="ATTR(Member.ReferID)" oper="equal" value="CONST(0)" connector="and"/>
    </WTPROCEDURE>
		<!--================================================================================================-->
		<WTPROCEDURE type="Find" name="FindRefer" style="GenerateDataProc.xsl">
			<WTBOOKMARK name=""/>
			<WTPARAM name="ATTR(ReferID)" direction="input"/>
			<WTPARAM name="SYS(userid)" direction="input"/>
			<WTJOIN name="Common"/>
			<WTCONDITION expr="ATTR(Member.ReferID)" oper="equal" value="PARAM(ReferID)" connector="and"/>
		</WTPROCEDURE>
		<!--==========================================================================================-->
		<WTPROCEDURE type="Update" name="Update" style="GenerateDataProc.xsl"/>
		<!--===================================================================================-->
		<WTPROCEDURE name="Logon" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
			<WTPARAM name="ATTR(Email)" direction="input"/>
			<WTPARAM name="ATTR(Password)" direction="input"/>
			<WTPARAM name="Result" direction="output" datatype="number"/>
		</WTPROCEDURE>
		<!--===================================================================================-->
		<WTPROCEDURE name="Logon2" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
			<WTPARAM name="ATTR(Email)" direction="input"/>
			<WTPARAM name="Result" direction="output" datatype="number"/>
		</WTPROCEDURE>
		<!--===================================================================================-->
		<WTPROCEDURE name="SetReferral" type="Command" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
			<WTPARAM name="ATTR(ConsumerID)" direction="input"/>
		</WTPROCEDURE>
		<!--===================================================================================-->
		<WTPROCEDURE name="SetReferrals" type="Command" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
			<WTPARAM name="ATTR(CompanyID)" direction="input"/>
		</WTPROCEDURE>
		<!--==================================================================-->
		<WTPROCEDURE type="List" name="ListEmail" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
			<WTPARAM name="ATTR(MerchantID)" direction="input"/>
      <WTPARAM name="ATTR(TargetArea)" direction="input"/>
      <WTPARAM name="ATTR(TargetType)" direction="input"/>
      <WTPARAM name="ATTR(TargetDays)" direction="input"/>
      <WTPARAM name="ATTR(Target)" direction="input"/>
			<WTPARAM name="ATTR(CountryID)" direction="input"/>
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE value="ATTR(Consumer.ConsumerID)"/>
					<WTATTRIBUTE value="ATTR(Consumer.Email2)"/>
					<WTATTRIBUTE value="ATTR(Consumer.NameLast)"/>
					<WTATTRIBUTE value="ATTR(Consumer.NameFirst)"/>
					<WTJOIN name="Consumer" lock="false"/>
				</WTSELECT>
			</WTCODEGROUP>
		</WTPROCEDURE>
		<!--===================================================================================-->
		<WTPROCEDURE name="CountEmail" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
			<WTPARAM name="ATTR(MerchantID)" direction="input"/>
      <WTPARAM name="ATTR(TargetArea)" direction="input"/>
      <WTPARAM name="ATTR(TargetType)" direction="input"/>
      <WTPARAM name="ATTR(TargetDays)" direction="input"/>
      <WTPARAM name="ATTR(Target)" direction="input"/>
			<WTPARAM name="ATTR(CountryID)" direction="input"/>
			<WTPARAM name="Result" direction="output" datatype="number"/>
		</WTPROCEDURE>
    <!--==================================================================-->
    <WTPROCEDURE type="List" name="ListMarketEmail" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
      <WTPARAM name="ATTR(CompanyID)" direction="input"/>
      <WTPARAM name="ATTR(Target)" direction="input"/>
      <WTPARAM name="ATTR(CountryID)" direction="input"/>
      <WTCODEGROUP>
        <WTSELECT>
          <WTATTRIBUTE value="ATTR(Consumer.ConsumerID)"/>
          <WTATTRIBUTE value="ATTR(Consumer.MemberID)"/>
          <WTATTRIBUTE value="ATTR(Consumer.Email)"/>
          <WTATTRIBUTE value="ATTR(Consumer.NameLast)"/>
          <WTATTRIBUTE value="ATTR(Consumer.NameFirst)"/>
          <WTJOIN name="Consumer" lock="false"/>
        </WTSELECT>
      </WTCODEGROUP>
    </WTPROCEDURE>
    <!--===================================================================================-->
    <WTPROCEDURE name="CountMarketEmail" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
      <WTPARAM name="ATTR(CompanyID)" direction="input"/>
      <WTPARAM name="ATTR(Target)" direction="input"/>
      <WTPARAM name="ATTR(CountryID)" direction="input"/>
      <WTPARAM name="Result" direction="output" datatype="number"/>
    </WTPROCEDURE>
    <!--==================================================================================================-->
    <WTPROCEDURE name="Custom" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
      <WTPARAM name="ATTR(ConsumerID)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(Status)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(MemberID)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(EnrollDate)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(Email)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="Result" direction="output" datatype="text" length="1000"/>
    </WTPROCEDURE>
  </WTPROCEDURES>

	<WTWEBPAGES>
		<!--============================================================================================-->
    <WTWEBPAGE name="15101" caption="FindConsumer" action="5" navbar="false" header="false" footer="false" wrapper="wrapper1000"
		aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" focus="false" track="0">
		<!--============================================================================================-->
			<WTPARAM name="MerchantID" datatype="number"/>
			<WTPARAM name="MemberID" datatype="number"/>
			<WTPARAM name="ReferID" datatype="number"/>
			<WTPARAM name="SearchText" datatype="text"/>
			<WTPARAM name="FindTypeID" datatype="number"/>
			<WTPARAM name="Bookmark" datatype="text"/>
      <WTPARAM name="Direction" datatype="number"/>

      <WTPARAM name="Title" datatype="text"/>
      <WTPARAM name="Personal" datatype="number"/>
      <WTPARAM name="Group" datatype="number"/>
      <WTPARAM name="Merchants" datatype="number"/>

      <WTINCLUDE name="2FA.asp"/>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
        <WTCALLSUB name="Check2FAMerchant reqMerchantID"/>
      </WTCODEGROUP>

      <WTSETATTRIBUTE name="PARAM(FindTypeID)" value="FINDID(ConsumerName)">
				<WTCONDITION expr="PARAM(FindTypeID)" oper="equal" value="CONST(0)"/>
			</WTSETATTRIBUTE>

      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
        <WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)" connector="or"/>
        <WTCONDITION expr="PARAM(ReferID)" oper="not-equal" value="CONST(0)" connector="or"/>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Title)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
            <WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="MemberID" direction="input" value="PARAM(MemberID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="PARAM(Title)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
          </WTOBJECT>
          <WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
            <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="PARAM(Title)" value="ATTR(MerchantName)"/>
          </WTOBJECT>
          <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
            <WTCONDITION expr="PARAM(ReferID)" oper="not-equal" value="CONST(0)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="ConsumerID" direction="input" value="PARAM(ReferID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="PARAM(Title)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
          </WTOBJECT>
        </WTCODEGROUP>
      </WTCODEGROUP>

      <WTSUB name="GetReferralCounts">
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(ReferID)" oper="not-equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="CONST(tmpConsumerID)" value="PARAM(ReferID)"/>
          <WTSETATTRIBUTE name="CONST(tmpType)" value="CONST(1)"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="CONST(tmpConsumerID)" value="PARAM(MerchantID)"/>
          <WTSETATTRIBUTE name="CONST(tmpType)" value="CONST(2)"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="CONST(tmpConsumerID)" value="PARAM(MemberID)"/>
          <WTSETATTRIBUTE name="CONST(tmpType)" value="CONST(3)"/>
        </WTCODEGROUP>
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTMETHOD name="Custom">
            <WTPARAM name="ConsumerID" direction="input" value="CONST(tmpConsumerID)"/>
            <WTPARAM name="Status" direction="input" value="CONST(2)"/>
            <WTPARAM name="MemberID" direction="input" value="CONST(tmpType)"/>
            <WTPARAM name="EnrollDate" direction="input" value="CONST(0)"/>
            <WTPARAM name="Email" direction="input" value="CONST(&quot;&quot;)"/>
            <WTPARAM name="Result" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTSETATTRIBUTE name="CONST(a)" value="CONST(Split(Result, &quot;|&quot;))"/>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(ReferID)" oper="not-equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="PARAM(Personal)" value="CONST(a(0))"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="PARAM(Personal)" value="CONST(a(0))"/>
          <WTSETATTRIBUTE name="PARAM(Group)" value="CONST(a(1))"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="PARAM(Personal)" value="CONST(a(0))"/>
          <WTSETATTRIBUTE name="PARAM(Group)" value="CONST(a(1))"/>
          <WTSETATTRIBUTE name="PARAM(Merchants)" value="CONST(a(2))"/>
        </WTCODEGROUP>
      </WTSUB>
      
      <WTACTION id="0" name="New" type="New">
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
				<WTOBJECT name="Consumers" project="ptsConsumerUser" class="CConsumers">
					<WTSETATTRIBUTE name="CONST(.FindTypeID)" value="PARAM(FindTypeID)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlConsumers" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(14)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark"/>
        <WTCALLSUB name="GetReferralCounts">
          <WTCONDITION expr="PARAM(ReferID)" oper="not-equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)" connector="or"/>
          <WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)" connector="or"/>
        </WTCALLSUB>
      </WTACTION>

			<WTACTION id="5" name="Find" type="New">
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTACTION id="6" name="Previous" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(2)"/>
			</WTACTION>

			<WTACTION id="7" name="Next" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTOBJECT name="Consumers" project="ptsConsumerUser" class="CConsumers">
				<WTMETHOD name="Find">
					<WTCONDITION expr="PARAM(MerchantID)" oper="equal" value="CONST(0)"/>
					<WTCONDITION expr="PARAM(MemberID)" oper="equal" value="CONST(0)" connector="and"/>
					<WTCONDITION expr="PARAM(ReferID)" oper="equal" value="CONST(0)" connector="and"/>
					<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
					<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
					<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
					<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
					<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
					<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
				</WTMETHOD>
				<WTMETHOD name="FindMerchant">
					<WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
					<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
					<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
					<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
					<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
					<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
					<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
					<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
				</WTMETHOD>
				<WTMETHOD name="FindMember">
					<WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)"/>
					<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
					<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
					<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
					<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
					<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
					<WTPARAM name="MemberID" direction="input" value="PARAM(MemberID)"/>
					<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
				</WTMETHOD>
				<WTMETHOD name="FindRefer">
					<WTCONDITION expr="PARAM(ReferID)" oper="not-equal" value="CONST(0)"/>
					<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
					<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
					<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
					<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
					<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
					<WTPARAM name="ReferID" direction="input" value="PARAM(ReferID)"/>
					<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
				</WTMETHOD>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlConsumers" direction="return" datatype="text"/>
					<WTPARAM name="Option" direction="input" value="CONST(15)"/>
				</WTMETHOD>
			</WTOBJECT>
			<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark">
				<WTSETATTRIBUTE name="ATTR(LastBookmark)" value="PARAM(Bookmark)"/>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlBookmark" direction="return" datatype="text"/>
				</WTMETHOD>
			</WTOBJECT>

	 		<!--**********************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="1000" align="left"/>

        <WTFUNCTION name="NewConsumer()">
          var med = document.getElementById('MerchantID').value;
          var mid = document.getElementById('MemberID').value;
          var rid = document.getElementById('ReferID').value;
          var url = "NewShopper.asp?m=" + med + "&amp;a=" + mid + "&amp;s=" + rid + "&amp;ret=1";
          var win = window.location = url + "&amp;returnurl=15101.asp?merchantid=" + med + "%26memberid=" + mid + "%26referid=" + rid;
        </WTFUNCTION>
        <WTFUNCTION name="QRCode()">
          var mid = document.getElementById('MerchantID').value;
          var aid = document.getElementById('MemberID').value;
          var sid = document.getElementById('ReferID').value;
          var url = "15104.asp?m=" + mid + "&amp;a=" + aid + "&amp;s=" + sid;
          var win = window.open(url,"QRCode","top=100,left=500,height=400,width=400,resizable=yes,status=no,toolbar=no,menubar=no,location=no,titlebar=no,scrollbars=1");
        </WTFUNCTION>

        <WTROW>
          <WTHIDDEN name="MerchantID" value="PARAM(MerchantID)"/>
          <WTHIDDEN name="MemberID" value="PARAM(MemberID)"/>
          <WTHIDDEN name="ReferID" value="PARAM(ReferID)"/>
          <WTHIDDEN value="PARAM(Personal)"/>
          <WTHIDDEN value="PARAM(Group)"/>
          <WTHIDDEN value="PARAM(Merchants)"/>
        </WTROW>

        <WTSTATIC label="ViewQRCode"/>

        <WTROW margin-top="12">
          <WTTABLE col="1">
            <WTCOLUMN width="940" align="left"/>
            <WTCOLUMN width="60" align="center"/>
            <WTROW>
              <WTSTATIC col="1" fontsize="5">
                <WTCODEGROUP>
                  <WTIMAGE value="CONST(shopper48.gif)" imgalign="absmiddle"/>
                </WTCODEGROUP>
                <WTSTATIC space="1"/>
                <WTCODEGROUP>
                  <WTCONDITION expr="PARAM(Title)" oper="equal" value="CONST('')"/>
                  <WTSTATIC label="FindConsumer"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="PARAM(Title)" oper="not-equal" value="CONST('')"/>
                  <WTSTATIC value="PARAM(Title)" space="1"/>
                  <WTSTATIC fontcolor="blue" fontsize="3">
                    <WTCODEGROUP>
                      <WTCONDITION expr="PARAM(ReferID)" oper="not-equal" value="CONST(0)"/>
                      <WTSTATIC tag="FindConsumer" value="PARAM(Personal)"/>
                    </WTCODEGROUP>
                    <WTCODEGROUP>
                      <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
                      <WTSTATIC label="FindConsumer" space="3"/>
                      <WTSTATIC tag="PersonalReferrals" value="PARAM(Personal)" space="3"/>
                      <WTSTATIC tag="GroupReferrals" value="PARAM(Group)" space="3" fontcolor="purple"/>
                    </WTCODEGROUP>
                    <WTCODEGROUP>
                      <WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)"/>
                      <WTSTATIC label="FindConsumer" space="3"/>
                      <WTSTATIC tag="PersonalReferrals" value="PARAM(Personal)" space="3"/>
                      <WTSTATIC tag="GroupReferrals" value="PARAM(Group)" space="3" fontcolor="purple"/>
                      <WTSTATIC tag="MerchantReferrals" value="PARAM(Merchants)" space="3" fontcolor="green"/>
                    </WTCODEGROUP>
                  </WTSTATIC>
                </WTCODEGROUP>
              </WTSTATIC>
              <WTSTATIC col="2">
                <WTCODEGROUP>
                  <WTIMAGE value="CONST(qrcode48.png)" alt="ViewQRCode" imgalign="absmiddle">
                    <WTLINK name="QRCode()" click="true" />
                  </WTIMAGE>
                </WTCODEGROUP>
              </WTSTATIC>
            </WTROW>
          </WTTABLE>
        </WTROW>

        <WTROW margin-top="6" margin-bottom="6">
					<WTSTATIC col="1" tag="SearchBy" class="ColumnHeader" align="center"/>
					<WTCOMBO col="1" value="ATTR(Consumers.FindTypeID)" translate="true"/>
					<WTSTATIC col="1" tag="SearchFor" class="ColumnHeader"/>
					<WTTEXT col="1" value="ATTR(Bookmark.SearchText)" size="20" focus="true"/>
					<WTBUTTON col="1" action="5" value="CONST(View)" default="true"/>
          <WTBUTTON col="1" value="CONST(NewConsumer)">
            <WTCLICK>NewConsumer()</WTCLICK>
          </WTBUTTON>
          <WTBUTTON col="1" value="CONST(Close)">
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>
				
				<WTROW>
					<WTRECORDSET col="1" graybar="true" prevnext="top" entity="Consumer">
						<WTCOLUMN width="30" align="left" valign="top" label="ConsumerName"/>
						<WTCOLUMN width="30" align="left" valign="top" label="Email"/>
            <WTCOLUMN width="15" align="left" valign="top" label="Phone"/>
            <WTCOLUMN width="15" align="left" valign="top" label="EnrollDate"/>
            <WTCOLUMN width="10" align="left" valign="top" label="Referred"/>
						<WTROW height="24">
							<WTSTATIC col="1">
								<WTCODEGROUP>
									<WTIMAGE value="CONST(ConsumerStatus&lt;xsl:value-of select=&quot;@status&quot;/&gt;.gif)" imgalign="absmiddle"/>
								</WTCODEGROUP>
								<WTSTATIC space="1"/>
								<WTSTATIC value="DATA(NameFirst)" space="1"/>
								<WTSTATIC value="DATA(NameLast)" space="1"/>
                <WTSTATIC value="CONST(#&lt;xsl:value-of select=&quot;@consumerid&quot;/&gt;)" space="1" fontcolor="blue"/>
                <WTCODEGROUP>
                  <WTCONDITION expr="IsEmployee"/>
                  <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
                  <WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
                  <WTCODEGROUP>
                    <WTIMAGE value="CONST(Edit.gif)" alt="Edit" imgalign="absmiddle">
										<WTLINK name="15103">
											<WTPARAM name="ConsumerID" value="DATA(ConsumerID)"/>
                      <WTPARAM name="Return" value="CONST(1)"/>
                    </WTLINK>
  									</WTIMAGE>
	  							</WTCODEGROUP>
                  <WTSTATIC space="1"/>
                  <WTCODEGROUP>
                    <WTIMAGE value="CONST(Window.gif)" imgalign="absmiddle">
                      <WTLINK name="15100" return="false" target="_blank">
                        <WTPARAM name="ConsumerID" value="DATA(ConsumerID)"/>
                      </WTLINK>
                    </WTIMAGE>
                  </WTCODEGROUP>
                </WTCODEGROUP>
              </WTSTATIC>
							<WTSTATIC col="2" value="DATA(Email)"/>
              <WTSTATIC col="3" value="DATA(Phone)"/>
              <WTSTATIC col="4" value="DATA(EnrollDate)"/>
              <WTSTATIC col="5">
								<WTSTATIC label="Consumer">
									<WTCONDITION expr="DATA(ReferID)" oper="not-equal" value="CONST(0)"/>
								</WTSTATIC>
								<WTCODEGROUP>
									<WTCONDITION expr="DATA(ReferID)" oper="equal" value="CONST(0)"/>
									<WTSTATIC label="Merchant">
										<WTCONDITION expr="DATA(MerchantID)" oper="not-equal" value="CONST(0)"/>
									</WTSTATIC>
									<WTSTATIC label="Member">
										<WTCONDITION expr="DATA(MemberID)" oper="not-equal" value="CONST(0)"/>
									</WTSTATIC>
								</WTCODEGROUP>
							</WTSTATIC>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" merge="5" fontcolor="gray">
								<WTSTATIC space="5"/>
								<WTSTATIC value="DATA(Street1)" space="1"/>
								<WTSTATIC value="DATA(Street2)" space="1"/>
								<WTSTATIC value="DATA(City)" space="1"/>
								<WTSTATIC value="DATA(State)" space="1"/>
								<WTSTATIC value="DATA(Zip)" space="1"/>
								<WTSTATIC value="DATA(CountryName)" space="1"/>
								<WTSTATIC value="DATA(VisitDate)" space="1" fontcolor="purple"/>
								<WTSTATIC value="DATA(Messages)" space="1"/>
                <WTSTATIC value="DATA(AffiliateID)" fontcolor="blue">
                  <WTCONDITION expr="DATA(AffiliateID)" oper="not-equal" value="CONST(0)"/>
                </WTSTATIC>
              </WTSTATIC>
						</WTROW>
					</WTRECORDSET>
				</WTROW>

      </WTCONTENT>
		</WTWEBPAGE>

		<!--============================================================================================-->
      <WTWEBPAGE name="m_15101" caption="My Referrals" page-left="0" page-top="0" navbar="false" header="false" footer="false" wrapper="false"
        page-width="100%" margin-width="0%" navbar-width="0%" content-width="100%" viewport="width=device-width"
         aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl">
        <!--============================================================================================-->
			<WTPARAM name="MerchantID" datatype="number"/>
			<WTPARAM name="MemberID" datatype="number"/>
			<WTPARAM name="ReferID" datatype="number"/>
			<WTPARAM name="SearchText" datatype="text"/>
			<WTPARAM name="FindTypeID" datatype="number"/>
			<WTPARAM name="Bookmark" datatype="text"/>
			<WTPARAM name="Direction" datatype="number"/>

			<WTSETATTRIBUTE name="PARAM(FindTypeID)" value="FINDID(ConsumerName)">
				<WTCONDITION expr="PARAM(FindTypeID)" oper="equal" value="CONST(0)"/>
			</WTSETATTRIBUTE>

			<WTACTION id="0" name="New" type="New">
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
				<WTOBJECT name="Consumers" project="ptsConsumerUser" class="CConsumers">
					<WTSETATTRIBUTE name="CONST(.FindTypeID)" value="PARAM(FindTypeID)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlConsumers" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(14)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark"/>
			</WTACTION>

			<WTACTION id="5" name="Find" type="New">
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTACTION id="6" name="Previous" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(2)"/>
			</WTACTION>

			<WTACTION id="7" name="Next" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTOBJECT name="Consumers" project="ptsConsumerUser" class="CConsumers">
				<WTMETHOD name="Find">
					<WTCONDITION expr="PARAM(MerchantID)" oper="equal" value="CONST(0)"/>
					<WTCONDITION expr="PARAM(MemberID)" oper="equal" value="CONST(0)" connector="and"/>
					<WTCONDITION expr="PARAM(ReferID)" oper="equal" value="CONST(0)" connector="and"/>
					<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
					<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
					<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
					<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
					<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
					<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
				</WTMETHOD>
				<WTMETHOD name="FindMerchant">
					<WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
					<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
					<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
					<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
					<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
					<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
					<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
					<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
				</WTMETHOD>
				<WTMETHOD name="FindMember">
					<WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)"/>
					<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
					<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
					<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
					<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
					<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
					<WTPARAM name="MemberID" direction="input" value="PARAM(MemberID)"/>
					<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
				</WTMETHOD>
				<WTMETHOD name="FindRefer">
					<WTCONDITION expr="PARAM(ReferID)" oper="not-equal" value="CONST(0)"/>
					<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
					<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
					<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
					<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
					<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
					<WTPARAM name="ReferID" direction="input" value="PARAM(ReferID)"/>
					<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
				</WTMETHOD>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlConsumers" direction="return" datatype="text"/>
					<WTPARAM name="Option" direction="input" value="CONST(15)"/>
				</WTMETHOD>
			</WTOBJECT>
			<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark">
				<WTSETATTRIBUTE name="ATTR(LastBookmark)" value="PARAM(Bookmark)"/>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlBookmark" direction="return" datatype="text"/>
				</WTMETHOD>
			</WTOBJECT>

	 		<!--**********************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="100" align="center"/>

        <WTFUNCTION name="NewConsumer()">
          var url, win, mid;
          rid = document.getElementById('ReferID').value
          url = "m_NewShopper.asp?ret=1&amp;s=" + rid
          win = window.location = url + "&amp;returnurl=m_15101.asp?referid=" + rid
        </WTFUNCTION>

        <WTROW>
          <WTHIDDEN name="ReferID" value="PARAM(ReferID)"/>
        </WTROW>

        <WTROW margin-top="6" margin-bottom="6">
          <WTSTATIC col="1" tag="SearchBy" class="ColumnHeader"/>
          <WTCOMBO col="1" value="ATTR(Consumers.FindTypeID)" translate="true"/>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTSTATIC col="1" tag="SearchFor" class="ColumnHeader"/>
          <WTTEXT col="1" value="ATTR(Bookmark.SearchText)" size="20" focus="true"/>
          <WTBUTTON col="1" action="5" value="CONST(View)" default="true"/>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTBUTTON col="1" value="CONST(NewShopper)">
            <WTCLICK>NewConsumer()</WTCLICK>
          </WTBUTTON>
        </WTROW>

        <WTROW>
					<WTRECORDSET col="1" graybar="true" prevnext="top" entity="Consumer">
						<WTCOLUMN width="100" align="left"/>
						<WTROW height="24">
							<WTSTATIC col="1">
								<WTCODEGROUP>
									<WTIMAGE value="CONST(ConsumerStatus&lt;xsl:value-of select=&quot;@status&quot;/&gt;.gif)" imgalign="absmiddle"/>
								</WTCODEGROUP>
								<WTSTATIC space="1"/>
								<WTSTATIC value="DATA(NameFirst)" space="1"/>
								<WTSTATIC value="DATA(NameLast)" space="1"/>
                <WTSTATIC space="2"/>
                <WTSTATIC value="DATA(Email)" space="2"/>
                <WTSTATIC value="DATA(Phone)" space="2"/>
                <WTSTATIC value="DATA(EnrollDate)" space="2"/>
                <WTSTATIC fontcolor="gray">
                  <WTSTATIC value="DATA(City)" space="1"/>
                  <WTSTATIC value="DATA(State)" space="1"/>
                  <WTSTATIC value="DATA(Zip)" space="1"/>
                  <WTSTATIC value="DATA(CountryName)" space="1"/>
                  <WTSTATIC value="DATA(VisitDate)" fontcolor="purple"/>
                </WTSTATIC>
              </WTSTATIC>
						</WTROW>
					</WTRECORDSET>
				</WTROW>

      </WTCONTENT>
		</WTWEBPAGE>
    
		<!--============================================================================================-->
		<WTWEBPAGE name="NewShopper" caption="New Shopper" header="false" footer="false" navbar="false" wrapper="wrapper600"
		 aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLAdd.xsl">
      <!--============================================================================================-->
			<WTPARAM name="M" datatype="number"/>
			<WTPARAM name="A" datatype="number"/>
      <WTPARAM name="S" datatype="number"/>
      <WTPARAM name="AffiliateID" datatype="number"/>
      <WTPARAM name="CompanyID" datatype="number"/>
      <WTPARAM name="ReferM" datatype="number"/>
      <WTPARAM name="ReferA" datatype="number"/>
      <WTPARAM name="ReferredBy" datatype="text"/>
			<WTPARAM name="LogonMerchant" datatype="text"/>
			<WTPARAM name="LogonConsumer" datatype="text"/>
			<WTPARAM name="LogonMember" datatype="text"/>
			<WTPARAM name="Done" datatype="number"/>
      <WTPARAM name="IsMobilePromo" datatype="number"/>
      <WTPARAM name="IsShopperOrder" datatype="number"/>
      <WTPARAM name="Ret" datatype="number"/>
      <WTPARAM name="Advanced" datatype="number"/>
      <WTPARAM name="Auto" datatype="number"/>

      <WTINCLUDE name="Email.asp"/>
      <WTINCLUDE name="Comm.asp"/>
      <WTINCLUDE name="GeoCode.asp"/>
      <WTINCLUDE name="MobileBrowser.asp"/>

      <!-- Check for mobile device and redirect to mobile new shopper page -->
      <WTCODEGROUP>
        <WTSETATTRIBUTE name="CONST(tmpMobile)" value="CONST(IsMobileBrowser())"/>
        <WTCODEGROUP>
          <WTCONDITION expr="CONST(tmpMobile)" oper="not-equal" value="CONST(0)"/>
          <WTRETURN>
            <WTLINK name="m_NewShopper" return="false">
              <WTPARAM name="M" value="PARAM(M)"/>
              <WTPARAM name="A" value="PARAM(A)"/>
              <WTPARAM name="S" value="PARAM(S)"/>
            </WTLINK>
          </WTRETURN>
        </WTCODEGROUP>
      </WTCODEGROUP>

      <WTCODEGROUP>
        <WTSETATTRIBUTE name="PARAM(IsMobilePromo)" value="CONST(1)"/>
        <WTSETATTRIBUTE name="PARAM(CompanyID)" value="SYSCON(NEXXUS)">
          <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
        <WTSETATTRIBUTE name="PARAM(A)" value="PARAM(AffiliateID)">
          <WTCONDITION expr="PARAM(A)" oper="equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(AffiliateID)" oper="not-equal" value="CONST(0)" connector="and"/>
        </WTSETATTRIBUTE>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(M)" oper="equal" value="CONST(0)"/>
        <WTCONDITION expr="PARAM(A)" oper="equal" value="CONST(0)" connector="and"/>
        <WTCONDITION expr="PARAM(S)" oper="equal" value="CONST(0)" connector="and"/>
        <WTGETCACHE name="PARAM(M)" value="M" datatype="number"/>
        <WTGETCACHE name="PARAM(A)" value="A" datatype="number"/>
        <WTGETCACHE name="PARAM(S)" value="S" datatype="number"/>
      </WTCODEGROUP>

      <WTSUB name="SendWelcomeEmail">
        <WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
          <WTMETHOD name="Load">
            <WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="CONST(tmpSender)" value="ATTR(Company.Email)"/>
          <WTSETATTRIBUTE name="CONST(tmpFrom)" value="ATTR(Company.Email)"/>
        </WTOBJECT>
        <WTSETATTRIBUTE name="CONST(tmpEmail)" value="FORM(Email)"/>
        <WTSETATTRIBUTE name="CONST(tmpTo)" value="FORM(Email2)"/>
        <WTSETATTRIBUTE name="CONST(tmpPhone)" value="FORM(Phone)"/>
        <WTSETATTRIBUTE name="CONST(tmpPswd)" value="FORM(Password)"/>
        <WTCUSTOM>
          If InStr(tmpTo, "@") &gt; 0 Then
          If InStr(tmpFrom, "@") = 0 Then tmpFrom = tmpTo
          tmpSubject = "Nexxus Rewards"
          tmpBody = "Welcome to www.NexxusRewards.com! Login with your phone number: " + tmpPhone + " or your email: " + tmpEmail + " and your password: " + tmpPswd
          SendEmail reqCompanyID, tmpSender, tmpFrom, tmpTo, "", tmpEmail, tmpSubject, tmpBody
          End If
        </WTCUSTOM>
      </WTSUB>

      <WTSUB name="GetReferredBy">
				<WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
					<WTCONDITION expr="PARAM(M)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="MerchantID" direction="input" value="PARAM(M)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="ATTR(MerchantName)"/>
          <WTCODEGROUP>
            <WTCUSTOM>
              If InStr(.Options, "E") &gt; 0 Then reqIsShopperOrder = 1
            </WTCUSTOM>
          </WTCODEGROUP>
        </WTOBJECT>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTCONDITION expr="PARAM(S)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(S)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
          <WTSETATTRIBUTE name="PARAM(ReferM)" value="ATTR(MerchantID)"/>
          <WTSETATTRIBUTE name="PARAM(ReferA)" value="ATTR(MemberID)"/>
        </WTOBJECT>
				<WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
					<WTCONDITION expr="PARAM(A)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="MemberID" direction="input" value="PARAM(A)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
				</WTOBJECT>
				<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(Trim(reqReferredBy))"/>
			</WTSUB>
			
			<WTSUB name="GetReferLogon">
				<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(&quot;&quot;)"/>
				<WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
					<WTCONDITION expr="PARAM(LogonMerchant)" oper="not-equal" value="CONST(&quot;&quot;)"/>
					<WTSETATTRIBUTE name="PARAM(LogonConsumer)" value="CONST(&quot;&quot;)"/>
					<WTSETATTRIBUTE name="PARAM(LogonMember)" value="CONST(&quot;&quot;)"/>
					<WTMETHOD name="Logon2">
						<WTPARAM name="Email" direction="input" value="PARAM(LogonMerchant)"/>
						<WTPARAM name="Result" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="greater" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(M)" value="CONST(Result)"/>
						<WTMETHOD name="Load">
							<WTPARAM name="MerchantID" direction="input" value="PARAM(M)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
						<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="ATTR(MerchantName)"/>
            <WTCODEGROUP>
              <WTCUSTOM>
                If InStr(.Options, "E") &gt; 0 Then reqIsShopperOrder = 1
              </WTCUSTOM>
            </WTCODEGROUP>
          </WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000002)"/>
						<WTERROR number="10129" message="Oops, The Email could not be found."/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000003)"/>
						<WTERROR number="10135" message="Oops, The Account Number could not be found."/>
					</WTCODEGROUP>
				</WTOBJECT>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTCONDITION expr="PARAM(LogonConsumer)" oper="not-equal" value="CONST(&quot;&quot;)"/>
					<WTSETATTRIBUTE name="PARAM(LogonMerchant)" value="CONST(&quot;&quot;)"/>
					<WTSETATTRIBUTE name="PARAM(LogonMember)" value="CONST(&quot;&quot;)"/>
					<WTMETHOD name="Logon2">
						<WTPARAM name="Email" direction="input" value="PARAM(LogonConsumer)"/>
						<WTPARAM name="Result" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="greater" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(S)" value="CONST(Result)"/>
						<WTMETHOD name="Load">
							<WTPARAM name="ConsumerID" direction="input" value="PARAM(S)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
						<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
            <WTSETATTRIBUTE name="PARAM(ReferM)" value="ATTR(MerchantID)"/>
            <WTSETATTRIBUTE name="PARAM(ReferA)" value="ATTR(MemberID)"/>
          </WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000002)"/>
						<WTERROR number="10129" message="Oops, The Email could not be found."/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000003)"/>
						<WTERROR number="10134" message="Oops, The Phone Number could not be found."/>
					</WTCODEGROUP>
				</WTOBJECT>
				<WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
					<WTCONDITION expr="PARAM(LogonMember)" oper="not-equal" value="CONST(&quot;&quot;)"/>
					<WTSETATTRIBUTE name="PARAM(LogonMerchant)" value="CONST(&quot;&quot;)"/>
					<WTSETATTRIBUTE name="PARAM(LogonConsumer)" value="CONST(&quot;&quot;)"/>
					<WTMETHOD name="FetchLogon">
						<WTPARAM name="Logon" direction="input" value="PARAM(LogonMember)" />
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(MemberID)" oper="not-equal" value="CONST(0)" />
						<WTSETATTRIBUTE name="PARAM(A)" value="ATTR(MemberID)"/>
						<WTMETHOD name="Load">
							<WTPARAM name="MemberID" direction="input" value="PARAM(A)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
						<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(MemberID)" oper="equal" value="CONST(0)" />
						<WTERROR number="10137" message="Oops, The Username could not be found."/>
					</WTCODEGROUP>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="LoadList">
				<WTOBJECT name="Countrys" project="ptsCountryUser" class="CCountrys">
					<WTMETHOD name="EnumCompany">
						<WTPARAM name="xmlCountrys" direction="return" concat="true" datatype="text" />
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)" />
						<WTPARAM name="ItemID" direction="input" value="CONST()" />
						<WTPARAM name="Element" direction="input" value="CONST()" />
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>
			<WTSUB name="NewConsumer">
				<WTCALLSUB name="LoadList"/>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(CountryID)" value="CONST(224)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="AddConsumer">
        <WTSETATTRIBUTE name="PARAM(M)" value="FORM(M)"/>
        <WTSETATTRIBUTE name="PARAM(A)" value="FORM(A)"/>
        <WTSETATTRIBUTE name="PARAM(S)" value="FORM(S)"/>
        <WTSETATTRIBUTE name="PARAM(ReferM)" value="FORM(ReferM)"/>
        <WTSETATTRIBUTE name="PARAM(ReferA)" value="FORM(ReferA)"/>
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(EnrollDate)" value="SYS(now)"/>
          <WTSETATTRIBUTE name="ATTR(ReferID)" value="PARAM(S)"/>
          <WTSETATTRIBUTE name="ATTR(AffiliateID)" value="PARAM(AffiliateID)"/>
          <WTSETATTRIBUTE name="ATTR(Status)" value="CONST(2)"/>
					<WTSETATTRIBUTE name="ATTR(Messages)" value="CONST(1)"/>
          <!-- If referred by a shopper, save the shopper's referred merchant or member -->
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(S)" oper="not-equal" value="CONST(0)"/>
            <WTSETATTRIBUTE name="ATTR(MerchantID)" value="PARAM(ReferM)"/>
            <WTSETATTRIBUTE name="ATTR(MemberID)" value="PARAM(ReferA)"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(S)" oper="equal" value="CONST(0)"/>
            <WTSETATTRIBUTE name="ATTR(MerchantID)" value="PARAM(M)"/>
            <WTSETATTRIBUTE name="ATTR(MemberID)" value="PARAM(A)"/>
          </WTCODEGROUP>
          <WTSETATTRIBUTES/>
					<WTSETATTRIBUTE name="ATTR(CountryID2)" value="ATTR(CountryID)"/>
					<WTCUSTOM>
						If ValidEmail( .Email ) = 0 Then DoError 10122, "", "Oops, Invalid Email Address."
						If ValidEmail( .Email2 ) = 0 Then DoError 10122, "", "Oops, Invalid Email Address."
					</WTCUSTOM>
					<WTCODEGROUP>
						<WTCONDITION expr="NoErrors"/>
						<WTMETHOD name="FetchEmail">
							<WTPARAM name="Email" direction="input" value="ATTR(Email)"/>
						</WTMETHOD>
						<WTCODEGROUP>
							<WTCONDITION expr="CONST(CLng(.ConsumerID))" oper="not-equal" value="CONST(0)"/>
							<WTERROR number="10123" message="Oops, This email address is already assigned to someone else."/>
						</WTCODEGROUP>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="NoErrors"/>
						<WTMETHOD name="FetchPhone">
							<WTPARAM name="Phone" direction="input" value="ATTR(Phone)"/>
						</WTMETHOD>
						<WTCODEGROUP>
							<WTCONDITION expr="CONST(CLng(.ConsumerID))" oper="not-equal" value="CONST(0)"/>
							<WTERROR number="10136" message="Oops, This phone number is already assigned to someone else. Try adding your country code as a prefix."/>
						</WTCODEGROUP>
					</WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCODEGROUP>
              <WTCONDITION expr="CONST(LEN(.Password))" oper="less" value="CONST(6)"/>
              <WTERROR number="10124" message="Oops, Please enter at least 6 characters for the Password."/>
            </WTCODEGROUP>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCONDITION expr="PARAM(Advanced)" oper="equal" value="CONST(0)" connector="and"/>
            <WTCUSTOM>
              Result = GM_GetZip(.Zip, tmpCity, tmpState)
              .City = tmpCity
              .State = tmpState
            </WTCUSTOM>
          </WTCODEGROUP>
          <WTMETHOD name="Add">
						<WTCONDITION expr="NoErrors"/>
						<WTPARAM name="ConsumerID" direction="return" datatype="number"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCALLSUB name="SendWelcomeEmail"/>
            <!-- Initialize New Shopper -->
            <WTMETHOD name="Custom">
              <WTPARAM name="ConsumerID" direction="input" value="CONST(ConsumerID)"/>
              <WTPARAM name="Status" direction="input" value="CONST(99)"/>
              <WTPARAM name="MemberID" direction="input" value="CONST(0)"/>
              <WTPARAM name="EnrollDate" direction="input" value="CONST(0)"/>
              <WTPARAM name="Email" direction="input" value="CONST(&quot;&quot;)"/>
              <WTPARAM name="Result" direction="return" datatype="text"/>
            </WTMETHOD>
          </WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="IsErrors"/>
						<WTMETHOD name="XML">
							<WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
							<WTPARAM name="Option" direction="input" value="CONST(2)"/>
						</WTMETHOD>
						<WTCALLSUB name="LoadList"/>
					</WTCODEGROUP>
				</WTOBJECT>
        <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
          <WTCONDITION expr="NoErrors"/>
          <WTCONDITION expr="PARAM(AffiliateID)" oper="not-equal" value="CONST(0)" connector="and"/>
            <WTMETHOD name="Load">
              <WTPARAM name="MemberID" direction="input" value="PARAM(AffiliateID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="ATTR(SponsorID)" value="CONST(ConsumerID)"/>
          <WTMETHOD name="Save">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

			<WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="GetReferredBy">
          <WTCONDITION expr="PARAM(M)" oper="not-equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(S)" oper="not-equal" value="CONST(0)" connector="or"/>
          <WTCONDITION expr="PARAM(A)" oper="not-equal" value="CONST(0)" connector="or"/>
        </WTCALLSUB>
        <WTCALLSUB name="NewConsumer">
          <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(ReferredBy)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
        </WTCALLSUB>
			</WTACTION>

			<WTACTION id="1" name="Refer" type="New">
				<WTCALLSUB name="GetReferLogon"/>
				<WTCALLSUB name="NewConsumer">
					<WTCONDITION expr="PARAM(ReferredBy)" oper="not-equal" value="CONST(&quot;&quot;)"/>
				</WTCALLSUB>
			</WTACTION>

			<WTACTION id="2" name="Add" type="Add">
				<WTCALLSUB name="AddConsumer"/>
				<WTSETATTRIBUTE name="PARAM(Done)" value="CONST(1)">
					<WTCONDITION expr="NoErrors"/>
				</WTSETATTRIBUTE>
        <WTSETATTRIBUTE name="PARAM(Auto)" value="CONST(2)">
          <WTCONDITION expr="IsErrors"/>
          <WTCONDITION expr="PARAM(Auto)" oper="not-equal" value="CONST(0)" connector="and"/>
        </WTSETATTRIBUTE>
				<WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
					<WTCONDITION expr="NoErrors"/>
					<WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(&quot;Welcome1.htm&quot;)"/>
					<WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\Company\&quot; + CStr(reqCompanyID))"/>
					<WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)" />
					<WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)" />
					<WTMETHOD name="Load" />
					<WTMETHOD name="XML">
						<WTPARAM name="xmlHTMLFile" direction="return" datatype="text" />
					</WTMETHOD>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

      <WTACTION id="4" name="NotRefer" type="New">
        <WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(ReferM)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(ReferA)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(M)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(S)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(A)" value="CONST(0)"/>
      </WTACTION>

      <WTACTION id="5" name="StartStart" type="New">
        <WTSETATTRIBUTE name="PARAM(Auto)" value="CONST(2)"/>
        <WTCALLSUB name="NewConsumer"/>
      </WTACTION>

      <WTACTION id="6" name="NewAuto" type="New">
        <WTSETATTRIBUTE name="PARAM(Auto)" value="CONST(1)"/>
      </WTACTION>

      <!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="160" align="right"/>
				<WTCOLUMN width="440" align="left"/>

				<WTFUNCTION name="TitleCase(obj)">	
					var val = obj.value;
					obj.value = val.charAt(0).toUpperCase() + val.slice(1);
				</WTFUNCTION>
				<WTFUNCTION name="DigitsOnly(obj)">
					var val = obj.value;
					obj.value = val.replace(/\D/g,'');
				</WTFUNCTION>
				<!-- Convert input to digits only if no @ sign for an email -->
				<WTFUNCTION name="LogonDigitsOnly(obj)">
					var val = obj.value;
					if(val.indexOf('@') === -1)	{
						obj.value = val.replace(/\D/g,'');
					}
				</WTFUNCTION>
				<WTFUNCTION name="MobilePromo()">
					var ptext = '';
					if (document.getElementById('IsMobilePromo').checked) {
						var phone = document.getElementById('Phone').value;
						var obj = document.getElementById('Provider');
						var i = obj.selectedIndex;
						var provider = Number(obj[i].value);
						if( provider != 0) {
							switch (provider) {
							case 1: ptext = 'txt.att.net'; break;
							case 2: ptext = 'sms.bellsouth.com'; break;
							case 3: ptext = 'myboostmobile.com'; break;
							case 4: ptext = 'sbcemail.com'; break;
							case 5: ptext = 'sms.mycricket.com'; break;
							case 6: ptext = 'airmessage.net'; break;
							case 7: ptext = 'mymetropcs.com'; break;
							case 8: ptext = 'messaging.sprintpcs.com'; break;
							case 9: ptext = 'tmomail.net'; break;
							case 10: ptext = 'email.uscc.net'; break;
							case 11: ptext = 'vtext.com'; break;
							case 12: ptext = 'vmobl.com'; break;
							}
							if(ptext != '') {
								document.getElementById('Email2').value = phone + '@' + ptext;
							}
						}
					}
					if(ptext == '') {
						document.getElementById('Email2').value = document.getElementById('Email').value
					}
				</WTFUNCTION>

        <WTFUNCTION name="RequestRewards()">
          var mid = document.getElementById('M').value;
          var url = "m_15212s.asp?merchantid=" + mid
          window.location=url;
        </WTFUNCTION>

        <WTROW>
					<WTHIDDEN value="PARAM(A)"/>
					<WTHIDDEN value="PARAM(M)"/>
					<WTHIDDEN value="PARAM(S)"/>
          <WTHIDDEN value="PARAM(ReferredBy)"/>
          <WTHIDDEN value="PARAM(ReferM)"/>
          <WTHIDDEN value="PARAM(ReferA)"/>
          <WTHIDDEN value="PARAM(Advanced)"/>
          <WTHIDDEN value="PARAM(Auto)"/>
          <WTHIDDEN value="PARAM(IsShopperOrder)"/>
        </WTROW>
				
				<WTSTATIC label="IsMobilePromo"/>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Auto)" oper="not-equal" value="CONST(1)"/>
          <WTROW>
            <WTSTATIC col="1" merge="2" label="NewConsumer" class="PageHeading" align="left"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
          </WTROW>
        </WTCODEGROUP>

        <!-- Get the Referrer -->
        <WTCODEGROUP>
					<WTCONDITION expr="PARAM(ReferredBy)" oper="equal" value="CONST('')"/>

					<WTROW margin-top="12" margin-bottom="12">
            <WTIMAGE col="1" value="CONST(LogonConsumer.png)" align="right"/>
						<WTTABLE col="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
							<WTCOLUMN width="200" align="right"/>
							<WTCOLUMN width="200" align="left"/>
							<WTROW>
								<WTSTATIC col="1" merge="2" label="WhoReferred" align="center" fontsize="4"/>
							</WTROW>
							<WTROW margin-top="12">
								<WTSTATIC col="1" align="right">
									<WTSTATIC tag="LogonMerchantOrg" bold="true"/>
								</WTSTATIC>
								<WTTEXT col="2" value="PARAM(LogonMerchant)" align="left" size="20">
									<WTEXIT>LogonDigitsOnly(this);</WTEXIT>
								</WTTEXT>
							</WTROW>
							<WTROW margin-top="12">
								<WTSTATIC col="1" align="right">
									<WTSTATIC label="LogonConsumer" space="1" bold="true"/>
									<WTSTATIC tag="LogonConsumer2"/>
								</WTSTATIC>
								<WTTEXT col="2" value="PARAM(LogonConsumer)" align="left" size="20">
									<WTEXIT>LogonDigitsOnly(this);</WTEXIT>
								</WTTEXT>
							</WTROW>
							<WTROW margin-top="12">
								<WTSTATIC col="1" align="right">
									<WTSTATIC label="LogonMember" space="1" bold="true"/>
									<WTSTATIC tag="LogonMember2"/>
								</WTSTATIC>
								<WTTEXT col="2" value="PARAM(LogonMember)" align="left" size="20"/>
							</WTROW>
							<WTROW margin-top="12" margin-bottom="12">
								<WTBUTTON col="1" merge="2" action="1" value="CONST(Continue)" align="center" btnclass="bigbutton"/>
                <WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)" align="center">
                  <WTCONDITION expr="PARAM(Ret)" oper="not-equal" value="CONST(0)"/>
                </WTBUTTON>
                <WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
                  <WTCONDITION expr="PARAM(Ret)" oper="equal" value="CONST(0)"/>
                  <WTCLICK>window.close()</WTCLICK>
                </WTBUTTON>
              </WTROW>
						</WTTABLE>
					</WTROW>
				</WTCODEGROUP>

        <!-- We Have the Referrer -->
        <WTCODEGROUP>
					<WTCONDITION expr="PARAM(ReferredBy)" oper="not-equal" value="CONST('')"/>

          <!-- We're done registering the new shopper, so show the user confirmation -->
          <WTCODEGROUP>
						<WTCONDITION expr="PARAM(Done)" oper="not-equal" value="CONST(0)"/>
						<WTROW margin-top="6">
							<WTSTATIC col="1" merge="2" value="ATTR(HTMLFile.Data)" embedhtml="true" />
						</WTROW>
            <WTROW margin-top="12" margin-bottom="12">
              <WTBUTTON col="1" merge="2" align="center" value="CONST(RequestRewards)" btnclass="bigbutton">
                <WTCONDITION expr="PARAM(IsShopperOrder)" oper="not-equal" value="CONST(0)"/>
                <WTCLICK>RequestRewards()</WTCLICK>
              </WTBUTTON>
              <WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
                <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(0)"/>
                <WTCONDITION expr="PARAM(Ret)" oper="equal" value="CONST(0)" connector="and"/>
                <WTCLICK>window.close()</WTCLICK>
              </WTBUTTON>
              <WTBUTTON col="1" merge="2" action="3" value="CONST(Continue)" align="center">
                <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(0)"/>
                <WTCONDITION expr="PARAM(Ret)" oper="not-equal" value="CONST(0)" connector="and"/>
              </WTBUTTON>
              <WTBUTTON col="1" merge="2" action="6" value="CONST(Continue)" align="center">
                <WTCONDITION expr="PARAM(Auto)" oper="not-equal" value="CONST(0)"/>
              </WTBUTTON>
            </WTROW>
					</WTCODEGROUP>

          <!-- we're starting the new shopper registration -->
          <WTCODEGROUP>
						<WTCONDITION expr="PARAM(Done)" oper="equal" value="CONST(0)"/>

            <!-- We're in AUTO mode, so show a welcome page -->
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(1)"/>
              <WTROW margin-top="12" margin-bottom="24">
                <WTSTATIC col="1" merge="2" value="PARAM(ReferredBy)" align="center" fontsize="5" fontcolor="#000070"/>
              </WTROW>
              <WTROW margin-bottom="24">
                <WTSTATIC col="1" merge="2" label="RegisterText1" align="center" fontsize="5" fontcolor="#000070" bold="true"/>
              </WTROW>
              <WTROW margin-bottom="12">
                <WTSTATIC col="1" merge="2" label="RegisterText2" align="center" fontsize="4" fontcolor="#000070"/>
              </WTROW>
              <WTROW margin-bottom="12">
                <WTSTATIC col="1" merge="2" label="RegisterText3" align="center" fontsize="4" fontcolor="#000070"/>
              </WTROW>
              <WTROW margin-bottom="12">
                <WTSTATIC col="1" merge="2" label="RegisterText4" align="center" fontsize="4" fontcolor="#000070"/>
              </WTROW>
              <WTROW>
                <WTIMAGE col="1" merge="2" value="CONST(LogonConsumer.png)" align="center"/>
              </WTROW>
              <WTROW margin-bottom="24">
                <WTBUTTON col="1" merge="2" action="5" value="CONST(JoinNow)" align="center" btnclass="hugebutton"/>
              </WTROW>
            </WTCODEGROUP>

            <!-- Collect the new shopper information, if we are not showing the AUTO welcome page -->
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(Auto)" oper="not-equal" value="CONST(1)"/>
              <WTCODEGROUP>
                <WTCONDITION expr="PARAM(IsShopperOrder)" oper="not-equal" value="CONST(0)"/>
                <WTROW margin-top="12" margin-bottom="12">
                  <WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
                    <WTSTATIC label="AlreadyRegistered" fontsize="5" space="2"/>
                    <WTCODEGROUP>
                      <WTBUTTON value="CONST(RequestRewards)" btnclass="bigbutton">
                        <WTCLICK>RequestRewards()</WTCLICK>
                      </WTBUTTON>
                    </WTCODEGROUP>
                  </WTSTATIC>
                </WTROW>
                <WTROW margin-bottom="6">
                  <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
                </WTROW>
              </WTCODEGROUP>
              
              <WTROW margin-top="12" margin-bottom="12">
                <WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
                  <WTSTATIC tag="ReferredBy"/>
                  <WTSTATIC value="PARAM(ReferredBy)" bold="true" space="2"/>
                  <WTCODEGROUP>
                    <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(0)"/>
                    <WTBUTTON action="4" value="CONST(Change)" btnclass="smbutton"/>
                  </WTCODEGROUP>
                </WTSTATIC>
              </WTROW>
              <WTROW margin-bottom="6">
                <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
              </WTROW>
              <WTROW margin-bottom="6">
                <WTSTATIC col="1" tag="ContactName"/>
                <WTTEXT col="2" value="ATTR(Consumer.NameFirst)" width="200" label="NameFirst" size="25" required="false">
                  <WTEXIT>TitleCase(this);</WTEXIT>
                </WTTEXT>
                <WTTEXT col="2" value="ATTR(Consumer.NameLast)" width="240" label="NameLast" size="25" required="false">
                  <WTEXIT>TitleCase(this);</WTEXIT>
                </WTTEXT>
              </WTROW>
              <WTROW margin-top="6" margin-bottom="6">
                <WTSTATIC col="1" tag="Email"/>
                <WTTEXT col="2" value="ATTR(Consumer.Email)" required="false" class="prompt">
                  <WTEXIT>MobilePromo();</WTEXIT>
                </WTTEXT>
                <WTSTATIC col="2" label="Unique"/>
              </WTROW>
              <WTROW margin-bottom="6">
                <WTSTATIC col="1" tag="Phone"/>
                <WTTEXT col="2" value="ATTR(Consumer.Phone)" required="false" class="prompt">
                  <WTEXIT>DigitsOnly(this); MobilePromo();</WTEXIT>
                </WTTEXT>
                <WTSTATIC col="2" label="Unique"/>
              </WTROW>
              <WTROW margin-bottom="6">
                <WTSTATIC col="1" tag="Password"/>
                <WTTEXT col="2" value="ATTR(Consumer.Password)" required="false" class="prompt"/>
                <WTSTATIC col="2" label="PasswordText"/>
              </WTROW>
              <WTROW margin-bottom="6">
                <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
              </WTROW>
              <WTROW margin-bottom="6">
                <WTSTATIC col="1" tag="Provider"/>
                <WTCOMBO col="2" value="ATTR(Consumer.Provider)">
                  <WTCHANGE>MobilePromo();</WTCHANGE>
                  <WTOPTION id="0" label="None"/>
                  <WTOPTION id="1" label="ATT"/>
                  <WTOPTION id="2" label="Bellsouth"/>
                  <WTOPTION id="3" label="Boost"/>
                  <WTOPTION id="4" label="CellularOne"/>
                  <WTOPTION id="5" label="Cricket"/>
                  <WTOPTION id="6" label="GTE"/>
                  <WTOPTION id="7" label="MetroPCS"/>
                  <WTOPTION id="8" label="Sprint"/>
                  <WTOPTION id="9" label="T-Mobile"/>
                  <WTOPTION id="10" label="USCellular"/>
                  <WTOPTION id="11" label="Verizon"/>
                  <WTOPTION id="12" label="VirginMobile"/>
                </WTCOMBO>
                <WTCHECK col="2" value="PARAM(IsMobilePromo)">
                  <WTCLICK>MobilePromo();</WTCLICK>
                </WTCHECK>
              </WTROW>
              <WTROW margin-bottom="6">
                <WTSTATIC col="1" tag="Email2"/>
                <WTTEXT col="2" value="ATTR(Consumer.Email2)" required="false" class="prompt"/>
              </WTROW>
              <WTROW margin-bottom="6">
                <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
              </WTROW>
              <WTCODEGROUP>
                <WTCONDITION expr="PARAM(Advanced)" oper="not-equal" value="CONST(0)"/>
                <WTROW margin-bottom="6">
                  <WTSTATIC col="1" tag="Address"/>
                  <WTTEXT col="2" value="ATTR(Consumer.Street1)" size="60">
                    <WTEXIT>TitleCase(this);</WTEXIT>
                  </WTTEXT>
                </WTROW>
                <WTROW margin-bottom="6">
                  <WTSTATIC col="1"/>
                  <WTTEXT col="2" value="ATTR(Consumer.Street2)" size="60">
                    <WTEXIT>TitleCase(this);</WTEXIT>
                  </WTTEXT>
                </WTROW>
                <WTROW margin-bottom="6">
                  <WTSTATIC col="1"/>
                  <WTTEXT col="2" value="ATTR(Consumer.City)" width="200" label="City" size="25">
                    <WTEXIT>TitleCase(this);</WTEXIT>
                  </WTTEXT>
                  <WTTEXT col="2" value="ATTR(Consumer.State)" width="240" label="State" size="25">
                    <WTEXIT>TitleCase(this);</WTEXIT>
                  </WTTEXT>
                </WTROW>
              </WTCODEGROUP>

              <WTROW>
                <WTSTATIC col="1"/>
                <WTTEXT col="2" value="ATTR(Consumer.Zip)" width="100" label="Zip" size="8"/>
                <WTCOMBO col="2" value="ATTR(Consumer.CountryID)" width="340" label="CountryID" datapath="/DATA/TXN/PTSCOUNTRYS/ENUM" setselected="true"/>
              </WTROW>

              <WTCODEGROUP>
                <WTCONDITION expr="PARAM(Advanced)" oper="not-equal" value="CONST(0)"/>
                <WTROW margin-top="6" margin-bottom="6">
                  <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
                </WTROW>
                <WTROW margin-bottom="6">
                  <WTSTATIC col="1" merge="2" label="Zip2Text" class="prompt" align="left"/>
                </WTROW>
                <WTROW>
                  <WTSTATIC col="1" tag="City2"/>
                  <WTTEXT col="2" value="ATTR(Consumer.City2)" size="15"/>
                  <WTSTATIC col="2" tag="State2"/>
                  <WTTEXT col="2" value="ATTR(Consumer.State2)" size="15" prespace="false"/>
                  <WTSTATIC col="2" tag="Zip2"/>
                  <WTTEXT col="2" value="ATTR(Consumer.Zip2)" size="8" prespace="false"/>
                </WTROW>
              </WTCODEGROUP>
              <WTROW margin-top="24" margin-bottom="12">
                <WTBUTTON col="1" merge="2" action="2" value="CONST(Join)" align="center" btnclass="bigbutton">
						      <WTCLICK>doSubmit(2,&quot;&quot;); this.disabled = true;</WTCLICK>
                </WTBUTTON>
                <WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)" align="center">
                  <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(0)"/>
                  <WTCONDITION expr="PARAM(Ret)" oper="not-equal" value="CONST(0)" connector="and"/>
                </WTBUTTON>
                <WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
                  <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(0)"/>
                  <WTCONDITION expr="PARAM(Ret)" oper="equal" value="CONST(0)" connector="and"/>
                  <WTCLICK>window.close()</WTCLICK>
                </WTBUTTON>
                <WTBUTTON col="1" merge="2" action="6" value="CONST(Cancel)" align="center">
                  <WTCONDITION expr="PARAM(Auto)" oper="not-equal" value="CONST(0)"/>
                </WTBUTTON>
              </WTROW>
            </WTCODEGROUP>

					</WTCODEGROUP>
					
				</WTCODEGROUP>

			</WTCONTENT>
		</WTWEBPAGE>

		<!--============================================================================================-->
		<WTWEBPAGE name="m_NewShopper" caption="New Shopper" page-left="0" page-top="0" navbar="false" header="false" footer="false" wrapper="wrapperMobile"
			page-width="100%" margin-width="0%" navbar-width="0%" content-width="100%" viewport="width=device-width"
		   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLAdd.xsl">
			<!--============================================================================================-->
      <WTPARAM name="M" datatype="number"/>
      <WTPARAM name="A" datatype="number"/>
      <WTPARAM name="S" datatype="number"/>
      <WTPARAM name="AffiliateID" datatype="number"/>
      <WTPARAM name="CompanyID" datatype="number"/>
      <WTPARAM name="ReferM" datatype="number"/>
      <WTPARAM name="ReferA" datatype="number"/>
      <WTPARAM name="ReferredBy" datatype="text"/>
      <WTPARAM name="LogonMerchant" datatype="text"/>
      <WTPARAM name="LogonConsumer" datatype="text"/>
      <WTPARAM name="LogonMember" datatype="text"/>
      <WTPARAM name="Done" datatype="number"/>
      <WTPARAM name="IsMobilePromo" datatype="number"/>
      <WTPARAM name="IsShopperOrder" datatype="number"/>
      <WTPARAM name="Ret" datatype="number"/>
      <WTPARAM name="Advanced" datatype="number"/>
      <WTPARAM name="Auto" datatype="number"/>

      <WTINCLUDE name="Email.asp"/>
      <WTINCLUDE name="Comm.asp"/>
      <WTINCLUDE name="GeoCode.asp"/>

      <WTCODEGROUP>
        <WTSETATTRIBUTE name="PARAM(IsMobilePromo)" value="CONST(1)"/>
        <WTSETATTRIBUTE name="PARAM(CompanyID)" value="SYSCON(NEXXUS)">
          <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
        <WTSETATTRIBUTE name="PARAM(A)" value="PARAM(AffiliateID)">
          <WTCONDITION expr="PARAM(A)" oper="equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(AffiliateID)" oper="not-equal" value="CONST(0)" connector="and"/>
        </WTSETATTRIBUTE>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(M)" oper="equal" value="CONST(0)"/>
        <WTCONDITION expr="PARAM(A)" oper="equal" value="CONST(0)" connector="and"/>
        <WTCONDITION expr="PARAM(S)" oper="equal" value="CONST(0)" connector="and"/>
        <WTGETCACHE name="PARAM(M)" value="M" datatype="number"/>
        <WTGETCACHE name="PARAM(A)" value="A" datatype="number"/>
        <WTGETCACHE name="PARAM(S)" value="S" datatype="number"/>
      </WTCODEGROUP>

      <WTSUB name="SendWelcomeEmail">
        <WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
          <WTMETHOD name="Load">
            <WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="CONST(tmpSender)" value="ATTR(Company.Email)"/>
          <WTSETATTRIBUTE name="CONST(tmpFrom)" value="ATTR(Company.Email)"/>
        </WTOBJECT>
        <WTSETATTRIBUTE name="CONST(tmpEmail)" value="FORM(Email)"/>
        <WTSETATTRIBUTE name="CONST(tmpTo)" value="FORM(Email2)"/>
        <WTSETATTRIBUTE name="CONST(tmpPhone)" value="FORM(Phone)"/>
        <WTSETATTRIBUTE name="CONST(tmpPswd)" value="FORM(Password)"/>
        <WTCUSTOM>
          If InStr(tmpTo, "@") &gt; 0 Then
          If InStr(tmpFrom, "@") = 0 Then tmpFrom = tmpTo
          tmpSubject = "Nexxus Rewards"
          tmpBody = "Welcome to www.NexxusRewards.com! Login with your phone number: " + tmpPhone + " or your email: " + tmpEmail + " and your password: " + tmpPswd
          SendEmail reqCompanyID, tmpSender, tmpFrom, tmpTo, "", tmpEmail, tmpSubject, tmpBody
          End If
        </WTCUSTOM>
      </WTSUB>

      <WTSUB name="GetReferredBy">
        <WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
          <WTCONDITION expr="PARAM(M)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MerchantID" direction="input" value="PARAM(M)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(ReferredBy)" value="ATTR(MerchantName)"/>
          <WTCODEGROUP>
            <WTCUSTOM>
              If InStr(.Options, "E") &gt; 0 Then reqIsShopperOrder = 1
            </WTCUSTOM>
          </WTCODEGROUP>
        </WTOBJECT>
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTCONDITION expr="PARAM(S)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(S)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
          <WTSETATTRIBUTE name="PARAM(ReferM)" value="ATTR(MerchantID)"/>
          <WTSETATTRIBUTE name="PARAM(ReferA)" value="ATTR(MemberID)"/>
        </WTOBJECT>
        <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
          <WTCONDITION expr="PARAM(A)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MemberID" direction="input" value="PARAM(A)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
        </WTOBJECT>
        <WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(Trim(reqReferredBy))"/>
      </WTSUB>

      <WTSUB name="GetReferLogon">
        <WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(&quot;&quot;)"/>
        <WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
          <WTCONDITION expr="PARAM(LogonMerchant)" oper="not-equal" value="CONST(&quot;&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(LogonConsumer)" value="CONST(&quot;&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(LogonMember)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="Logon2">
            <WTPARAM name="Email" direction="input" value="PARAM(LogonMerchant)"/>
            <WTPARAM name="Result" direction="return" datatype="number"/>
          </WTMETHOD>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="greater" value="CONST(0)"/>
            <WTSETATTRIBUTE name="PARAM(M)" value="CONST(Result)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="MerchantID" direction="input" value="PARAM(M)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="PARAM(ReferredBy)" value="ATTR(MerchantName)"/>
            <WTCODEGROUP>
              <WTCUSTOM>
                If InStr(.Options, "E") &gt; 0 Then reqIsShopperOrder = 1
              </WTCUSTOM>
            </WTCODEGROUP>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000002)"/>
            <WTERROR number="10129" message="Oops, The Email could not be found."/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000003)"/>
            <WTERROR number="10135" message="Oops, The Account Number could not be found."/>
          </WTCODEGROUP>
        </WTOBJECT>
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTCONDITION expr="PARAM(LogonConsumer)" oper="not-equal" value="CONST(&quot;&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(LogonMerchant)" value="CONST(&quot;&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(LogonMember)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="Logon2">
            <WTPARAM name="Email" direction="input" value="PARAM(LogonConsumer)"/>
            <WTPARAM name="Result" direction="return" datatype="number"/>
          </WTMETHOD>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="greater" value="CONST(0)"/>
            <WTSETATTRIBUTE name="PARAM(S)" value="CONST(Result)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="ConsumerID" direction="input" value="PARAM(S)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
            <WTSETATTRIBUTE name="PARAM(ReferM)" value="ATTR(MerchantID)"/>
            <WTSETATTRIBUTE name="PARAM(ReferA)" value="ATTR(MemberID)"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000002)"/>
            <WTERROR number="10129" message="Oops, The Email could not be found."/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Result)" oper="equal" value="CONST(-1000003)"/>
            <WTERROR number="10134" message="Oops, The Phone Number could not be found."/>
          </WTCODEGROUP>
        </WTOBJECT>
        <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
          <WTCONDITION expr="PARAM(LogonMember)" oper="not-equal" value="CONST(&quot;&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(LogonMerchant)" value="CONST(&quot;&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(LogonConsumer)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="FetchLogon">
            <WTPARAM name="Logon" direction="input" value="PARAM(LogonMember)" />
          </WTMETHOD>
          <WTCODEGROUP>
            <WTCONDITION expr="ATTR(MemberID)" oper="not-equal" value="CONST(0)" />
            <WTSETATTRIBUTE name="PARAM(A)" value="ATTR(MemberID)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="MemberID" direction="input" value="PARAM(A)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="ATTR(MemberID)" oper="equal" value="CONST(0)" />
            <WTERROR number="10137" message="Oops, The Username could not be found."/>
          </WTCODEGROUP>
        </WTOBJECT>
      </WTSUB>

      <WTSUB name="LoadList">
        <WTOBJECT name="Countrys" project="ptsCountryUser" class="CCountrys">
          <WTMETHOD name="EnumCompany">
            <WTPARAM name="xmlCountrys" direction="return" concat="true" datatype="text" />
            <WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)" />
            <WTPARAM name="ItemID" direction="input" value="CONST()" />
            <WTPARAM name="Element" direction="input" value="CONST()" />
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>
      <WTSUB name="NewConsumer">
        <WTCALLSUB name="LoadList"/>
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="CONST(0)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(CountryID)" value="CONST(224)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(2)"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTSUB name="AddConsumer">
        <WTSETATTRIBUTE name="PARAM(M)" value="FORM(M)"/>
        <WTSETATTRIBUTE name="PARAM(A)" value="FORM(A)"/>
        <WTSETATTRIBUTE name="PARAM(S)" value="FORM(S)"/>
        <WTSETATTRIBUTE name="PARAM(ReferM)" value="FORM(ReferM)"/>
        <WTSETATTRIBUTE name="PARAM(ReferA)" value="FORM(ReferA)"/>
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="CONST(0)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(EnrollDate)" value="SYS(now)"/>
          <WTSETATTRIBUTE name="ATTR(ReferID)" value="PARAM(S)"/>
          <WTSETATTRIBUTE name="ATTR(AffiliateID)" value="PARAM(AffiliateID)"/>
          <WTSETATTRIBUTE name="ATTR(Status)" value="CONST(2)"/>
          <WTSETATTRIBUTE name="ATTR(Messages)" value="CONST(1)"/>
          <!-- If referred by a shopper, save the shopper's referred merchant or member -->
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(S)" oper="not-equal" value="CONST(0)"/>
            <WTSETATTRIBUTE name="ATTR(MerchantID)" value="PARAM(ReferM)"/>
            <WTSETATTRIBUTE name="ATTR(MemberID)" value="PARAM(ReferA)"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(S)" oper="equal" value="CONST(0)"/>
            <WTSETATTRIBUTE name="ATTR(MerchantID)" value="PARAM(M)"/>
            <WTSETATTRIBUTE name="ATTR(MemberID)" value="PARAM(A)"/>
          </WTCODEGROUP>
          <WTSETATTRIBUTES/>
          <WTSETATTRIBUTE name="ATTR(CountryID2)" value="ATTR(CountryID)"/>
          <WTCUSTOM>
            If ValidEmail( .Email ) = 0 Then DoError 10122, "", "Oops, Invalid Email Address."
            If ValidEmail( .Email2 ) = 0 Then DoError 10122, "", "Oops, Invalid Email Address."
          </WTCUSTOM>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTMETHOD name="FetchEmail">
              <WTPARAM name="Email" direction="input" value="ATTR(Email)"/>
            </WTMETHOD>
            <WTCODEGROUP>
              <WTCONDITION expr="CONST(CLng(.ConsumerID))" oper="not-equal" value="CONST(0)"/>
              <WTERROR number="10123" message="Oops, This email address is already assigned to someone else."/>
            </WTCODEGROUP>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTMETHOD name="FetchPhone">
              <WTPARAM name="Phone" direction="input" value="ATTR(Phone)"/>
            </WTMETHOD>
            <WTCODEGROUP>
              <WTCONDITION expr="CONST(CLng(.ConsumerID))" oper="not-equal" value="CONST(0)"/>
              <WTERROR number="10136" message="Oops, This phone number is already assigned to someone else."/>
            </WTCODEGROUP>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCODEGROUP>
              <WTCONDITION expr="CONST(LEN(.Password))" oper="less" value="CONST(6)"/>
              <WTERROR number="10124" message="Oops, Please enter at least 6 characters for the Password."/>
            </WTCODEGROUP>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCONDITION expr="PARAM(Advanced)" oper="equal" value="CONST(0)" connector="and"/>
            <WTCUSTOM>
              Result = GM_GetZip(.Zip, tmpCity, tmpState)
              .City = tmpCity
              .State = tmpState
            </WTCUSTOM>
          </WTCODEGROUP>
          <WTMETHOD name="Add">
            <WTCONDITION expr="NoErrors"/>
            <WTPARAM name="ConsumerID" direction="return" datatype="number"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCALLSUB name="SendWelcomeEmail"/>
            <!-- Initialize New Shopper -->
            <WTMETHOD name="Custom">
              <WTPARAM name="ConsumerID" direction="input" value="CONST(ConsumerID)"/>
              <WTPARAM name="Status" direction="input" value="CONST(99)"/>
              <WTPARAM name="MemberID" direction="input" value="CONST(0)"/>
              <WTPARAM name="EnrollDate" direction="input" value="CONST(0)"/>
              <WTPARAM name="Email" direction="input" value="CONST(&quot;&quot;)"/>
              <WTPARAM name="Result" direction="return" datatype="text"/>
            </WTMETHOD>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="IsErrors"/>
            <WTMETHOD name="XML">
              <WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
              <WTPARAM name="Option" direction="input" value="CONST(2)"/>
            </WTMETHOD>
            <WTCALLSUB name="LoadList"/>
          </WTCODEGROUP>
        </WTOBJECT>
        <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
          <WTCONDITION expr="NoErrors"/>
          <WTCONDITION expr="PARAM(AffiliateID)" oper="not-equal" value="CONST(0)" connector="and"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MemberID" direction="input" value="PARAM(AffiliateID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(SponsorID)" value="CONST(ConsumerID)"/>
          <WTMETHOD name="Save">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="GetReferredBy">
          <WTCONDITION expr="PARAM(M)" oper="not-equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(S)" oper="not-equal" value="CONST(0)" connector="or"/>
          <WTCONDITION expr="PARAM(A)" oper="not-equal" value="CONST(0)" connector="or"/>
        </WTCALLSUB>
        <WTCALLSUB name="NewConsumer">
          <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(ReferredBy)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
        </WTCALLSUB>
      </WTACTION>

      <WTACTION id="1" name="Refer" type="New">
        <WTCALLSUB name="GetReferLogon"/>
        <WTCALLSUB name="NewConsumer">
          <WTCONDITION expr="PARAM(ReferredBy)" oper="not-equal" value="CONST(&quot;&quot;)"/>
        </WTCALLSUB>
      </WTACTION>

      <WTACTION id="2" name="Add" type="Add">
        <WTCALLSUB name="AddConsumer"/>
        <WTSETATTRIBUTE name="PARAM(Done)" value="CONST(1)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
        <WTSETATTRIBUTE name="PARAM(Auto)" value="CONST(2)">
          <WTCONDITION expr="IsErrors"/>
          <WTCONDITION expr="PARAM(Auto)" oper="not-equal" value="CONST(0)" connector="and"/>
        </WTSETATTRIBUTE>
        <WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(&quot;Welcome1.htm&quot;)"/>
          <WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\Company\&quot; + CStr(reqCompanyID))"/>
          <WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)" />
          <WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)" />
          <WTMETHOD name="Load" />
          <WTMETHOD name="XML">
            <WTPARAM name="xmlHTMLFile" direction="return" datatype="text" />
          </WTMETHOD>
        </WTOBJECT>
      </WTACTION>

      <WTACTION id="3" name="Cancel" type="Cancel">
        <WTRETURN/>
      </WTACTION>

      <WTACTION id="4" name="NotRefer" type="New">
        <WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(ReferM)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(ReferA)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(M)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(S)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(A)" value="CONST(0)"/>
      </WTACTION>

      <WTACTION id="5" name="StartStart" type="New">
        <WTSETATTRIBUTE name="PARAM(Auto)" value="CONST(2)"/>
        <WTCALLSUB name="NewConsumer"/>
      </WTACTION>

      <WTACTION id="6" name="NewAuto" type="New">
        <WTSETATTRIBUTE name="PARAM(Auto)" value="CONST(1)"/>
      </WTACTION>

      <!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="33" align="right"/>
				<WTCOLUMN width="67" align="left"/>

				<WTFUNCTION name="TitleCase(obj)">
					var val = obj.value;
					obj.value = val.charAt(0).toUpperCase() + val.slice(1);
				</WTFUNCTION>
				<WTFUNCTION name="DigitsOnly(obj)">
					var val = obj.value;
					obj.value = val.replace(/\D/g,'');
				</WTFUNCTION>
				<!-- Convert input to digits only if no @ sign for an email -->
				<WTFUNCTION name="LogonDigitsOnly(obj)">
					var val = obj.value;
					if(val.indexOf('@') === -1)	{
					obj.value = val.replace(/\D/g,'');
					}
				</WTFUNCTION>
				<WTFUNCTION name="MobilePromo()">
					var ptext = '';
					if (document.getElementById('IsMobilePromo').checked) {
					var phone = document.getElementById('Phone').value;
					var obj = document.getElementById('Provider');
					var i = obj.selectedIndex;
					var provider = Number(obj[i].value);
					if( provider != 0) {
					switch (provider) {
					case 1: ptext = 'txt.att.net'; break;
					case 2: ptext = 'sms.bellsouth.com'; break;
					case 3: ptext = 'myboostmobile.com'; break;
					case 4: ptext = 'sbcemail.com'; break;
					case 5: ptext = 'sms.mycricket.com'; break;
					case 6: ptext = 'airmessage.net'; break;
					case 7: ptext = 'mymetropcs.com'; break;
					case 8: ptext = 'messaging.sprintpcs.com'; break;
					case 9: ptext = 'tmomail.net'; break;
					case 10: ptext = 'email.uscc.net'; break;
					case 11: ptext = 'vtext.com'; break;
					case 12: ptext = 'vmobl.com'; break;
					}
					if(ptext != '') {
					document.getElementById('Email2').value = phone + '@' + ptext;
					}
					}
					}
					if(ptext == '') {
					document.getElementById('Email2').value = document.getElementById('Email').value
					}
				</WTFUNCTION>
        <WTFUNCTION name="RequestRewards()">
          var mid = document.getElementById('M').value;
          var url = "m_15212s.asp?merchantid=" + mid
          window.location=url;
        </WTFUNCTION>

        <WTROW>
					<WTHIDDEN value="PARAM(A)"/>
					<WTHIDDEN value="PARAM(M)"/>
					<WTHIDDEN value="PARAM(S)"/>
          <WTHIDDEN value="PARAM(ReferredBy)"/>
          <WTHIDDEN value="PARAM(ReferM)"/>
          <WTHIDDEN value="PARAM(ReferA)"/>
          <WTHIDDEN value="PARAM(Advanced)"/>
          <WTHIDDEN value="PARAM(Auto)"/>
          <WTHIDDEN value="PARAM(IsShopperOrder)"/>
        </WTROW>

				<WTSTATIC label="IsMobilePromo"/>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Auto)" oper="not-equal" value="CONST(1)"/>
          <WTROW>
            <WTSTATIC col="1" merge="2" label="NewConsumer" class="PageHeading" align="center"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
          </WTROW>
        </WTCODEGROUP>

        <!-- Get the Referrer -->
        <WTCODEGROUP>
					<WTCONDITION expr="PARAM(ReferredBy)" oper="equal" value="CONST('')"/>

					<WTROW margin-top="12" margin-bottom="12">
						<WTTABLE col="1" merge="2" align="center" valign="top" padding="0" style="border:1px solid; border-radius:20px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #d1fa99">
							<WTCOLUMN width="48" align="right"/>
							<WTCOLUMN width="48" align="left"/>
							<WTROW>
								<WTSTATIC col="1" merge="2" label="WhoReferred" align="center" fontsize="4"/>
							</WTROW>
							<WTROW margin-top="12">
								<WTSTATIC col="1" align="right">
									<WTSTATIC label="LogonMerchantOrg" space="1" newline="1" bold="true"/>
									<WTSTATIC tag="LogonMerchant2"/>
								</WTSTATIC>
								<WTTEXT col="2" value="PARAM(LogonMerchant)" align="left" size="15" textclass="bigtext">
									<WTEXIT>LogonDigitsOnly(this);</WTEXIT>
								</WTTEXT>
							</WTROW>
							<WTROW margin-top="12">
								<WTSTATIC col="1" align="right">
									<WTSTATIC label="LogonConsumer" space="1" bold="true"/>
									<WTSTATIC tag="LogonConsumer2"/>
								</WTSTATIC>
								<WTTEXT col="2" value="PARAM(LogonConsumer)" align="left" size="15" textclass="bigtext">
									<WTEXIT>LogonDigitsOnly(this);</WTEXIT>
								</WTTEXT>
							</WTROW>
							<WTROW margin-top="12">
								<WTSTATIC col="1" align="right">
									<WTSTATIC label="LogonMember" space="1" bold="true"/>
									<WTSTATIC tag="LogonMember2"/>
								</WTSTATIC>
								<WTTEXT col="2" value="PARAM(LogonMember)" align="left" size="15" textclass="bigtext"/>
							</WTROW>
							<WTROW margin-top="12" margin-bottom="12">
								<WTBUTTON col="1" merge="2" action="1" value="CONST(Continue)" align="center" btnclass="bigbutton"/>
								<WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
									<WTCLICK>window.close()</WTCLICK>
								</WTBUTTON>
							</WTROW>
						</WTTABLE>
					</WTROW>
				</WTCODEGROUP>

        <!-- We Have the Referrer -->
        <WTCODEGROUP>
					<WTCONDITION expr="PARAM(ReferredBy)" oper="not-equal" value="CONST('')"/>

          <!-- We're done registering the new shopper, so show the user confirmation -->
          <WTCODEGROUP>
						<WTCONDITION expr="PARAM(Done)" oper="not-equal" value="CONST(0)"/>
						<WTROW margin-top="6">
							<WTSTATIC col="1" merge="2" value="ATTR(HTMLFile.Data)" embedhtml="true" />
						</WTROW>
            <WTROW margin-top="12" margin-bottom="12">
              <WTBUTTON col="1" merge="2" value="CONST(RequestRewards)" align="center" btnclass="bigbutton">
                <WTCLICK>RequestRewards()</WTCLICK>
              </WTBUTTON>
              <WTBUTTON col="1" merge="2" value="CONST(Close)" align="center" btnclass="bigbutton">
                <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(0)"/>
                <WTCONDITION expr="PARAM(Ret)" oper="equal" value="CONST(0)" connector="and"/>
                <WTCLICK>window.close()</WTCLICK>
              </WTBUTTON>
              <WTBUTTON col="1" merge="2" action="3" value="CONST(Continue)" align="center" btnclass="bigbutton">
                <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(0)"/>
                <WTCONDITION expr="PARAM(Ret)" oper="not-equal" value="CONST(0)" connector="and"/>
              </WTBUTTON>
              <WTBUTTON col="1" merge="2" action="6" value="CONST(Continue)" align="center" btnclass="bigbutton">
                <WTCONDITION expr="PARAM(Auto)" oper="not-equal" value="CONST(0)"/>
              </WTBUTTON>
						</WTROW>
					</WTCODEGROUP>

          <!-- we're starting the new shopper registration -->
          <WTCODEGROUP>
						<WTCONDITION expr="PARAM(Done)" oper="equal" value="CONST(0)"/>

            <!-- We're in AUTO mode, so show a welcome page -->
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(1)"/>
              <WTROW margin-top="12" margin-bottom="24">
                <WTSTATIC col="1" merge="2" value="PARAM(ReferredBy)" align="center" fontsize="5" fontcolor="#000070"/>
              </WTROW>
              <WTROW margin-bottom="24">
                <WTSTATIC col="1" merge="2" label="RegisterText1" align="center" fontsize="5" fontcolor="#000070" bold="true"/>
              </WTROW>
              <WTROW margin-bottom="12">
                <WTSTATIC col="1" merge="2" label="RegisterText2" align="center" fontsize="4" fontcolor="#000070"/>
              </WTROW>
              <WTROW margin-bottom="12">
                <WTSTATIC col="1" merge="2" label="RegisterText3" align="center" fontsize="4" fontcolor="#000070"/>
              </WTROW>
              <WTROW margin-bottom="12">
                <WTSTATIC col="1" merge="2" label="RegisterText4" align="center" fontsize="4" fontcolor="#000070"/>
              </WTROW>
              <WTROW>
                <WTIMAGE col="1" merge="2" value="CONST(LogonConsumer.png)" align="center"/>
              </WTROW>
              <WTROW margin-bottom="24">
                <WTBUTTON col="1" merge="2" action="5" value="CONST(JoinNow)" align="center" btnclass="hugebutton"/>
              </WTROW>
            </WTCODEGROUP>

            <!-- Collect the new shopper information, if we are not showing the AUTO welcome page -->
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(Auto)" oper="not-equal" value="CONST(1)"/>
              <WTCODEGROUP>
                <WTCONDITION expr="PARAM(IsShopperOrder)" oper="not-equal" value="CONST(0)"/>
                <WTROW margin-top="12" margin-bottom="6">
                  <WTSTATIC col="1" merge="2" label="AlreadyRegistered" align="center" fontsize="5" fontcolor="blue"/>
                </WTROW>
                <WTROW margin-bottom="12">
                  <WTBUTTON col="1" merge="2" value="CONST(RequestRewards)" align="center" btnclass="bigbutton">
                    <WTCLICK>RequestRewards()</WTCLICK>
                  </WTBUTTON>
                </WTROW>
                <WTROW margin-bottom="6">
                  <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
                </WTROW>
              </WTCODEGROUP>

              <WTROW margin-top="12" margin-bottom="12">
							  <WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
								  <WTSTATIC tag="ReferredBy"/>
								  <WTSTATIC value="PARAM(ReferredBy)" bold="true" space="2"/>
								  <WTCODEGROUP>
                    <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(0)"/>
                    <WTBUTTON action="4" value="CONST(Change)" btnclass="smbutton"/>
								  </WTCODEGROUP>
							  </WTSTATIC>
						  </WTROW>
						  <WTROW margin-bottom="6">
							  <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
						  </WTROW>
						  <WTROW margin-bottom="6">
							  <WTSTATIC col="1" tag="NameFirst"/>
							  <WTTEXT col="2" value="ATTR(Consumer.NameFirst)" size="20" focus="true" required="false" textclass="bigtext">
								  <WTEXIT>TitleCase(this);</WTEXIT>
							  </WTTEXT>
						  </WTROW>
						  <WTROW margin-bottom="6">
							  <WTSTATIC col="1" tag="NameLast"/>
							  <WTTEXT col="2" value="ATTR(Consumer.NameLast)" size="20" required="false" textclass="bigtext">
								  <WTEXIT>TitleCase(this);</WTEXIT>
							  </WTTEXT>
						  </WTROW>

						  <WTROW>
							  <WTSTATIC col="1" tag="Email"/>
							  <WTTEXT col="2" value="ATTR(Consumer.Email)" size="20" required="false" textclass="bigtext">
								  <WTEXIT>MobilePromo();</WTEXIT>
							  </WTTEXT>
						  </WTROW>
						  <WTROW margin-bottom="6">
							  <WTSTATIC col="1"/>
							  <WTSTATIC col="2" label="Unique" class="prompt"/>
						  </WTROW>
						  <WTROW>
							  <WTSTATIC col="1" tag="Phone"/>
							  <WTTEXT col="2" value="ATTR(Consumer.Phone)" size="20" required="false" textclass="bigtext">
								  <WTEXIT>DigitsOnly(this); MobilePromo();</WTEXIT>
							  </WTTEXT>
						  </WTROW>
						  <WTROW margin-bottom="6">
							  <WTSTATIC col="1"/>
							  <WTSTATIC col="2" label="Unique" class="prompt"/>
						  </WTROW>
						  <WTROW>
							  <WTSTATIC col="1" tag="Password"/>
							  <WTTEXT col="2" value="ATTR(Consumer.Password)" size="20" required="false" textclass="bigtext"/>
						  </WTROW>
						  <WTROW margin-bottom="6">
							  <WTSTATIC col="1"/>
							  <WTSTATIC col="2" label="PasswordText" class="prompt"/>
						  </WTROW>
						  <WTROW margin-bottom="6">
							  <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
						  </WTROW>
						
						  <WTROW>
							  <WTSTATIC col="1" tag="Provider"/>
							  <WTCOMBO col="2" value="ATTR(Consumer.Provider)" comboclass="bigtext">
								  <WTCHANGE>MobilePromo();</WTCHANGE>
								  <WTOPTION id="0" label="None"/>
								  <WTOPTION id="1" label="ATT"/>
								  <WTOPTION id="2" label="Bellsouth"/>
								  <WTOPTION id="3" label="Boost"/>
								  <WTOPTION id="4" label="CellularOne"/>
								  <WTOPTION id="5" label="Cricket"/>
								  <WTOPTION id="6" label="GTE"/>
								  <WTOPTION id="7" label="MetroPCS"/>
								  <WTOPTION id="8" label="Sprint"/>
								  <WTOPTION id="9" label="T-Mobile"/>
								  <WTOPTION id="10" label="USCellular"/>
								  <WTOPTION id="11" label="Verizon"/>
								  <WTOPTION id="12" label="VirginMobile"/>
							  </WTCOMBO>
						  </WTROW>
						  <WTROW margin-bottom="6">
							  <WTSTATIC col="1"/>
							  <WTCHECK col="2" value="PARAM(IsMobilePromo)">
								  <WTCLICK>MobilePromo();</WTCLICK>
							  </WTCHECK>
						  </WTROW>
              <WTROW margin-bottom="6">
                <WTSTATIC col="1" tag="mEmail2"/>
							  <WTTEXT col="2" value="ATTR(Consumer.Email2)" size="20" required="false" textclass="bigtext">
								  <WTEXIT>MobilePromo();</WTEXIT>
							  </WTTEXT>
						  </WTROW>

              <WTCODEGROUP>
                <WTCONDITION expr="PARAM(Advanced)" oper="not-equal" value="CONST(0)"/>
                <WTROW margin-bottom="6">
                  <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
                </WTROW>
                <WTROW margin-bottom="6">
                  <WTSTATIC col="1" tag="Address"/>
                  <WTTEXT col="2" value="ATTR(Consumer.Street1)" size="20" required="false" textclass="bigtext">
                    <WTEXIT>TitleCase(this);</WTEXIT>
                  </WTTEXT>
                </WTROW>
                <WTROW margin-bottom="6">
                  <WTSTATIC col="1" tag="Street2"/>
                  <WTTEXT col="2" value="ATTR(Consumer.Street2)" size="20" required="false" textclass="bigtext">
                    <WTEXIT>TitleCase(this);</WTEXIT>
                  </WTTEXT>
                </WTROW>
                <WTROW margin-bottom="6">
                  <WTSTATIC col="1" tag="City"/>
                  <WTTEXT col="2" value="ATTR(Consumer.City)" size="20" required="false" textclass="bigtext">
                    <WTEXIT>TitleCase(this);</WTEXIT>
                  </WTTEXT>
                </WTROW>
                <WTROW margin-bottom="6">
                  <WTSTATIC col="1" tag="State"/>
                  <WTTEXT col="2" value="ATTR(Consumer.State)" size="20" required="false" textclass="bigtext">
                    <WTEXIT>TitleCase(this);</WTEXIT>
                  </WTTEXT>
                </WTROW>
              </WTCODEGROUP>
            
						  <WTROW margin-bottom="6">
							  <WTSTATIC col="1" tag="Zip"/>
							  <WTTEXT col="2" value="ATTR(Consumer.Zip)" size="20" required="false" textclass="bigtext"/>
						  </WTROW>
						  <WTROW>
							  <WTSTATIC col="1" merge="2" tag="CountryID" align="center"/>
						  </WTROW>
						  <WTROW>
							  <WTCOMBO col="1" merge="2" value="ATTR(Consumer.CountryID)" datapath="/DATA/TXN/PTSCOUNTRYS/ENUM" setselected="true" align="center"/>
						  </WTROW>

              <WTCODEGROUP>
                <WTCONDITION expr="PARAM(Advanced)" oper="not-equal" value="CONST(0)"/>
                <WTROW margin-top="6" margin-bottom="6">
							    <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
						    </WTROW>
						    <WTROW margin-bottom="6">
							    <WTSTATIC col="1" merge="2" label="Zip2Text" class="prompt" align="left"/>
						    </WTROW>
						    <WTROW>
							    <WTSTATIC col="1" tag="City2"/>
							    <WTTEXT col="2" value="ATTR(Consumer.City2)" size="20" textclass="bigtext"/>
						    </WTROW>
						    <WTROW>
							    <WTSTATIC col="1" tag="State2"/>
							    <WTTEXT col="2" value="ATTR(Consumer.State2)" size="20" textclass="bigtext"/>
						    </WTROW>
						    <WTROW>
							    <WTSTATIC col="1" tag="Zip2"/>
							    <WTTEXT col="2" value="ATTR(Consumer.Zip2)" size="20" textclass="bigtext"/>
						    </WTROW>
              </WTCODEGROUP>

              <WTROW margin-top="24" margin-bottom="12">
                <WTBUTTON col="1" merge="2" action="2" value="CONST(Join)" align="center" btnclass="bigbutton">
						      <WTCLICK>doSubmit(2,&quot;&quot;); this.disabled = true;</WTCLICK>
                </WTBUTTON>
                <WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)" align="center">
                  <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(0)"/>
                  <WTCONDITION expr="PARAM(Ret)" oper="not-equal" value="CONST(0)" connector="and"/>
                </WTBUTTON>
                <WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
                  <WTCONDITION expr="PARAM(Auto)" oper="equal" value="CONST(0)"/>
                  <WTCONDITION expr="PARAM(Ret)" oper="equal" value="CONST(0)" connector="and"/>
                  <WTCLICK>window.close()</WTCLICK>
                </WTBUTTON>
                <WTBUTTON col="1" merge="2" action="6" value="CONST(Cancel)" align="center">
                  <WTCONDITION expr="PARAM(Auto)" oper="not-equal" value="CONST(0)"/>
                </WTBUTTON>
              </WTROW>

            </WTCODEGROUP>

          </WTCODEGROUP>

        </WTCODEGROUP>

			</WTCONTENT>
		</WTWEBPAGE>

		<!--============================================================================================-->
		<WTWEBPAGE name="15103" caption="Edit Shopper" header="false" footer="false" navbar="false" wrapper="wrapper600"
		 aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl">
		<!--============================================================================================-->
			<WTPARAM name="ConsumerID" datatype="number"/>
			<WTPARAM name="ShowPassword" datatype="number"/>
			<WTPARAM name="CompanyID" datatype="number"/>
			<WTPARAM name="MerchantID" datatype="number"/>
			<WTPARAM name="MemberID" datatype="number"/>
			<WTPARAM name="ReferID" datatype="number"/>
			<WTPARAM name="ReferredBy" datatype="text"/>
      <WTPARAM name="IsMobilePromo" datatype="number"/>
      <WTPARAM name="Return" datatype="number"/>
      <WTPARAM name="Txn" datatype="number"/>
      <WTPARAM name="Password" datatype="text"/>

      <WTINCLUDE name="Email.asp"/>

			<WTCODEGROUP>
				<WTCONDITION expr="IsSysAdmin"/>
				<WTSETATTRIBUTE name="PARAM(ShowPassword)" value="CONST(1)"/>
			</WTCODEGROUP>
			<WTSETATTRIBUTE name="PARAM(CompanyID)" value="SYSCON(NEXXUS)">
				<WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
			</WTSETATTRIBUTE>

			<WTSUB name="GetReferredBy">
				<WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
					<WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="ATTR(MerchantName)"/>
				</WTOBJECT>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTCONDITION expr="PARAM(ReferID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ReferID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
				</WTOBJECT>
				<WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
					<WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="MemberID" direction="input" value="PARAM(MemberID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
				</WTOBJECT>
				<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(Trim(reqReferredBy))"/>
			</WTSUB>

			<WTSUB name="LoadList">
				<WTOBJECT name="Countrys" project="ptsCountryUser" class="CCountrys">
					<WTMETHOD name="EnumCompany">
						<WTPARAM name="xmlCountrys" direction="return" concat="true" datatype="text" />
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)" />
						<WTPARAM name="ItemID" direction="input" value="CONST()" />
						<WTPARAM name="Element" direction="input" value="CONST()" />
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTACTION id="0" name="New" type="New">
				<WTCALLSUB name="LoadList"/>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(Email)" oper="not-equal" value="ATTR(Email2)"/>
						<WTCONDITION expr="ATTR(Provider)" oper="not-equal" value="CONST(0)" connector="and"/>
						<WTSETATTRIBUTE name="PARAM(IsMobilePromo)" value="CONST(1)"/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(ReferID)" oper="not-equal" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(ReferID)" value="ATTR(ReferID)"/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(ReferID)" oper="equal" value="CONST(0)"/>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(MerchantID)" oper="not-equal" value="CONST(0)"/>
							<WTSETATTRIBUTE name="PARAM(MerchantID)" value="ATTR(MerchantID)"/>
						</WTCODEGROUP>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(MemberID)" oper="not-equal" value="CONST(0)"/>
							<WTSETATTRIBUTE name="PARAM(MemberID)" value="ATTR(MemberID)"/>
						</WTCODEGROUP>
					</WTCODEGROUP>
					<WTCALLSUB name="GetReferredBy"/>
          <WTSETATTRIBUTE name="PARAM(Password)" value="ATTR(Password)">
            <WTCONDITION expr="IsEmployee"/>
            <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
          </WTSETATTRIBUTE>
          <WTSETATTRIBUTE name="ATTR(Password)" value="CONST(&quot;****&quot; + Right(.Password, 2))"/>
          <WTMETHOD name="XML">
						<WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="1" name="Update" type="Update">
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTSETATTRIBUTE name="ATTR(Email)" value="FORM(Email)"/>
					<WTSETATTRIBUTE name="ATTR(Email2)" value="FORM(Email2)"/>
					<WTSETATTRIBUTE name="ATTR(Phone)" value="FORM(Phone)"/>
					<WTCUSTOM>
	If ValidEmail( .Email ) = 0 Then DoError 10122, "", "Oops, Invalid Email Address."
	If ValidEmail( .Email2 ) = 0 Then DoError 10122, "", "Oops, Invalid Email Address."
</WTCUSTOM>
					<WTCODEGROUP>
						<WTCONDITION expr="NoErrors"/>
						<WTMETHOD name="FetchEmail">
							<WTPARAM name="Email" direction="input" value="ATTR(Email)"/>
						</WTMETHOD>
						<WTCODEGROUP>
							<WTCONDITION expr="CONST(CLng(.ConsumerID))" oper="not-equal" value="CONST(0)"/>
							<WTCONDITION expr="CONST(CLng(.ConsumerID))" oper="not-equal" value="PARAM(ConsumerID)" connector="and"/>
							<WTERROR number="10123" message="Oops, This email address is already assigned to another consumer."/>
						</WTCODEGROUP>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="NoErrors"/>
						<WTMETHOD name="FetchPhone">
							<WTPARAM name="Phone" direction="input" value="ATTR(Phone)"/>
						</WTMETHOD>
						<WTCODEGROUP>
							<WTCONDITION expr="CONST(CLng(.ConsumerID))" oper="not-equal" value="CONST(0)"/>
							<WTCONDITION expr="CONST(CLng(.ConsumerID))" oper="not-equal" value="PARAM(ConsumerID)" connector="and"/>
							<WTERROR number="10136" message="Oops, This phone number is already assigned to someone else."/>
						</WTCODEGROUP>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="NoErrors"/>
						<WTSETATTRIBUTE name="ATTR(Password)" value="FORM(Password)"/>
						<WTCODEGROUP>
							<WTCONDITION expr="CONST(LEN(.Password))" oper="less" value="CONST(6)"/>
							<WTERROR number="10124" message="Oops, Please enter at least 6 characters for the Password."/>
						</WTCODEGROUP>
					</WTCODEGROUP>

					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
          <WTSETATTRIBUTE name="CONST(oldPassword)" value="ATTR(Password)"/>
          <WTSETATTRIBUTES/>
          <WTCODEGROUP>
            <WTCONDITION expr="ATTR(Password)" oper="equal" value="CONST(&quot;****&quot; + Right(oldPassword, 2))"/>
            <WTSETATTRIBUTE name="ATTR(Password)" value="CONST(oldPassword)"/>
          </WTCODEGROUP>
          <WTMETHOD name="Save">
						<WTCONDITION expr="NoErrors"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="IsErrors"/>
            <WTCONDITION expr="PARAM(Return)" oper="equal" value="CONST(0)" connector="or"/>
            <WTMETHOD name="XML">
							<WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
							<WTPARAM name="Option" direction="input" value="CONST(2)"/>
						</WTMETHOD>
						<WTCALLSUB name="LoadList"/>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(ReferID)" oper="not-equal" value="CONST(0)"/>
							<WTSETATTRIBUTE name="PARAM(ReferID)" value="ATTR(ReferID)"/>
						</WTCODEGROUP>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(ReferID)" oper="equal" value="CONST(0)"/>
							<WTCODEGROUP>
								<WTCONDITION expr="ATTR(MerchantID)" oper="not-equal" value="CONST(0)"/>
								<WTSETATTRIBUTE name="PARAM(MerchantID)" value="ATTR(MerchantID)"/>
							</WTCODEGROUP>
							<WTCODEGROUP>
								<WTCONDITION expr="ATTR(MemberID)" oper="not-equal" value="CONST(0)"/>
								<WTSETATTRIBUTE name="PARAM(MemberID)" value="ATTR(MemberID)"/>
							</WTCODEGROUP>
						</WTCODEGROUP>
						<WTCALLSUB name="GetReferredBy"/>
					</WTCODEGROUP>
				</WTOBJECT>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(Txn)" value="CONST(1)"/>
        </WTCODEGROUP>
        <WTRETURN>
					<WTCONDITION expr="NoErrors"/>
          <WTCONDITION expr="PARAM(Return)" oper="not-equal" value="CONST(0)" connector="and"/>
        </WTRETURN>
			</WTACTION>

			<WTACTION id="3" name="Return" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="4" name="Delete" type="Delete">
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Delete">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTCONDITION expr="IsErrors"/>
					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTCODEGROUP>
					<WTCONDITION expr="IsErrors"/>
					<WTCALLSUB name="LoadList"/>
				</WTCODEGROUP>
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
				</WTRETURN>
			</WTACTION>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="160" align="right"/>
				<WTCOLUMN width="440" align="left"/>

				<WTFUNCTION name="TitleCase(obj)">
					var val = obj.value;
					obj.value = val.charAt(0).toUpperCase() + val.slice(1);
				</WTFUNCTION>
				<WTFUNCTION name="DigitsOnly(obj)">
					var val = obj.value;
					obj.value = val.replace(/\D/g,'');
				</WTFUNCTION>
				<!-- Convert input to digits only if no @ sign for an email -->
				<WTFUNCTION name="LogonDigitsOnly(obj)">
					var val = obj.value;
					if(val.indexOf('@') === -1)	{
					obj.value = val.replace(/\D/g,'');
					}
				</WTFUNCTION>
				<WTFUNCTION name="MobilePromo()">
					var ptext = '';
					if (document.getElementById('IsMobilePromo').checked) {
						var phone = document.getElementById('Phone').value;
						var obj = document.getElementById('Provider');
						var i = obj.selectedIndex;
						var provider = Number(obj[i].value);
						if( provider != 0) {
							switch (provider) {
							case 1: ptext = 'txt.att.net'; break;
							case 2: ptext = 'sms.bellsouth.com'; break;
							case 3: ptext = 'myboostmobile.com'; break;
							case 4: ptext = 'sbcemail.com'; break;
							case 5: ptext = 'sms.mycricket.com'; break;
							case 6: ptext = 'airmessage.net'; break;
							case 7: ptext = 'mymetropcs.com'; break;
							case 8: ptext = 'messaging.sprintpcs.com'; break;
							case 9: ptext = 'tmomail.net'; break;
							case 10: ptext = 'email.uscc.net'; break;
							case 11: ptext = 'vtext.com'; break;
							case 12: ptext = 'vmobl.com'; break;
							}
							if(ptext != '') {
								document.getElementById('Email2').value = phone + '@' + ptext;
							}
						}
					}
					if(ptext == '') {
					document.getElementById('Email2').value = document.getElementById('Email').value
					}
				</WTFUNCTION>

				<WTSTATIC label="IsMobilePromo"/>

				<WTROW>
					<WTSTATIC col="1" merge="2" class="PageHeading" align="left">
            <WTSTATIC tag="Consumer"/>
            <WTSTATIC value="ATTR(Consumer.NameFirst)" space="1"/>
            <WTSTATIC value="ATTR(Consumer.NameLast)" space="1"/>
            <WTSTATIC value="CONST((#)"/>
            <WTSTATIC value="ATTR(Consumer.ConsumerID)"/>
            <WTSTATIC value="CONST())" space="1"/>
            <WTSTATIC value="ATTR(Consumer.VisitDate)" fontcolor="purple" space="1"/>
            <WTSTATIC label="UPDATED" fontcolor="red">
              <WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(1)"/>
            </WTSTATIC>
          </WTSTATIC>
        </WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
				</WTROW>

        <WTROW margin-bottom="12">
          <WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
            <WTSTATIC tag="ReferredBy"/>
            <WTSTATIC value="PARAM(ReferredBy)" bold="true" space="2"/>
          </WTSTATIC>
        </WTROW>
        <WTROW margin-bottom="12">
          <WTCONDITION expr="ATTR(Consumer.AffiliateID)" oper="not-equal" value="CONST(0)"/>
          <WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
            <WTSTATIC label="AffiliateID"/>
            <WTSTATIC value="ATTR(Consumer.AffiliateID)"/>
          </WTSTATIC>
        </WTROW>
        <WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="IsEmployee"/>
					<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
					<WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
					<WTROW margin-bottom="3">
						<WTSTATIC col="1" tag="MerchantID"/>
						<WTTEXT col="2" value="ATTR(Consumer.MerchantID)"/>
					</WTROW>
					<WTROW margin-bottom="3">
						<WTSTATIC col="1" tag="MemberID"/>
						<WTTEXT col="2" value="ATTR(Consumer.MemberID)"/>
					</WTROW>
          <WTROW margin-bottom="3">
            <WTSTATIC col="1" tag="ReferID"/>
            <WTTEXT col="2" value="ATTR(Consumer.ReferID)"/>
          </WTROW>
          <WTROW margin-bottom="3">
            <WTSTATIC col="1" tag="AffiliateID"/>
            <WTTEXT col="2" value="ATTR(Consumer.AffiliateID)"/>
          </WTROW>
          <WTROW margin-bottom="3">
            <WTSTATIC col="1" tag="EnrollDate"/>
            <WTTEXT col="2" value="ATTR(Consumer.EnrollDate)" size="15"/>
          </WTROW>
          <WTROW margin-bottom="3">
            <WTSTATIC col="1" tag="Barter"/>
            <WTTEXT col="2" value="ATTR(Consumer.Barter)"/>
          </WTROW>
        </WTCODEGROUP>
				<WTROW>
					<WTCONDITION expr="NotEmployee"/>
					<WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
					<WTCONDITION expr="NotOrgManagerOnly" connector="and"/>
					<WTHIDDEN value="ATTR(Consumer.MemberID)"/>
					<WTHIDDEN value="ATTR(Consumer.MerchantID)"/>
          <WTHIDDEN value="ATTR(Consumer.ReferID)"/>
          <WTHIDDEN value="ATTR(Consumer.AffiliateID)"/>
          <WTHIDDEN value="ATTR(Consumer.Status)"/>
          <WTHIDDEN value="ATTR(Consumer.EnrollDate)"/>
          <WTHIDDEN value="ATTR(Consumer.Barter)"/>
        </WTROW>

				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="ContactName"/>
					<WTTEXT col="2" value="ATTR(Consumer.NameFirst)" width="200" label="NameFirst" size="25" required="false">
						<WTEXIT>TitleCase(this);</WTEXIT>
					</WTTEXT>
					<WTTEXT col="2" value="ATTR(Consumer.NameLast)" width="240" label="NameLast" size="25" required="false">
						<WTEXIT>TitleCase(this);</WTEXIT>
					</WTTEXT>
				</WTROW>
				<WTROW margin-top="6">
					<WTCONDITION expr="IsEmployee"/>
					<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
					<WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
					<WTSTATIC col="1" tag="Status"/>
					<WTCOMBO col="2" value="ATTR(Consumer.Status)"/>
				</WTROW>
				<WTROW margin-top="6" margin-bottom="6">
					<WTSTATIC col="1" tag="Email"/>
					<WTTEXT col="2" value="ATTR(Consumer.Email)" required="false" class="prompt">
						<WTEXIT>MobilePromo();</WTEXIT>
					</WTTEXT>
					<WTSTATIC col="2" label="Unique"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Phone"/>
					<WTTEXT col="2" value="ATTR(Consumer.Phone)" required="false" class="prompt">
						<WTEXIT>DigitsOnly(this); MobilePromo();</WTEXIT>
					</WTTEXT>
					<WTSTATIC col="2" label="Unique"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Password"/>
					<WTTEXT col="2" value="ATTR(Consumer.Password)" required="false" class="prompt"/>
          <WTSTATIC col="2">
            <WTSTATIC label="PasswordText" space="1"/>
            <WTSTATIC value="PARAM(Password)" fontcolor="purple"/>
          </WTSTATIC>
        </WTROW>

				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Messages"/>
					<WTCOMBO col="2" value="ATTR(Consumer.Messages)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Provider"/>
					<WTCOMBO col="2" value="ATTR(Consumer.Provider)">
						<WTCHANGE>MobilePromo();</WTCHANGE>
						<WTOPTION id="0" label="None"/>
						<WTOPTION id="1" label="ATT"/>
						<WTOPTION id="2" label="Bellsouth"/>
						<WTOPTION id="3" label="Boost"/>
						<WTOPTION id="4" label="CellularOne"/>
						<WTOPTION id="5" label="Cricket"/>
						<WTOPTION id="6" label="GTE"/>
						<WTOPTION id="7" label="MetroPCS"/>
						<WTOPTION id="8" label="Sprint"/>
						<WTOPTION id="9" label="T-Mobile"/>
						<WTOPTION id="10" label="USCellular"/>
						<WTOPTION id="11" label="Verizon"/>
						<WTOPTION id="12" label="VirginMobile"/>
					</WTCOMBO>
					<WTCHECK col="2" value="PARAM(IsMobilePromo)">
						<WTCLICK>MobilePromo();</WTCLICK>
					</WTCHECK>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Email2"/>
					<WTTEXT col="2" value="ATTR(Consumer.Email2)" required="false" class="prompt"/>
					<WTSTATIC col="2" label="PromoEmail"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Address"/>
					<WTTEXT col="2" value="ATTR(Consumer.Street1)" size="60">
						<WTEXIT>TitleCase(this);</WTEXIT>
					</WTTEXT>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1"/>
					<WTTEXT col="2" value="ATTR(Consumer.Street2)" size="60">
						<WTEXIT>TitleCase(this);</WTEXIT>
					</WTTEXT>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1"/>
					<WTTEXT col="2" value="ATTR(Consumer.City)" width="200" label="City" size="25">
						<WTEXIT>TitleCase(this);</WTEXIT>
					</WTTEXT>
					<WTTEXT col="2" value="ATTR(Consumer.State)" width="240" label="State" size="25">
						<WTEXIT>TitleCase(this);</WTEXIT>
					</WTTEXT>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1"/>
					<WTTEXT col="2" value="ATTR(Consumer.Zip)" width="100" label="Zip" size="8"/>
					<WTCOMBO col="2" value="ATTR(Consumer.CountryID)" width="340" label="CountryID" datapath="/DATA/TXN/PTSCOUNTRYS/ENUM" setselected="true"/>
				</WTROW>
				<WTROW margin-top="6" margin-bottom="6">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" merge="2" label="Zip2Text" class="prompt" align="left"/>
				</WTROW>
        <WTROW>
          <WTSTATIC col="1" tag="City2"/>
          <WTTEXT col="2" value="ATTR(Consumer.City2)" size="15"/>
          <WTSTATIC col="2" tag="State2"/>
          <WTTEXT col="2" value="ATTR(Consumer.State2)" size="15" prespace="false"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" tag="Zip2"/>
          <WTTEXT col="2" value="ATTR(Consumer.Zip2)" size="10"/>
        </WTROW>

        <WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" merge="2" action="1" value="CONST(Update)" align="center">
						<WTCONDITION expr="IsActive"/>
					</WTBUTTON>
          <WTBUTTON col="1" merge="2" action="3" value="CONST(Return)">
            <WTCONDITION expr="PARAM(Return)" oper="not-equal" value="CONST(0)"/>
          </WTBUTTON>
          <WTBUTTON col="1" merge="2" action="4" value="CONST(Delete)" align="center" msg="ConfirmDelete">
						<WTCONDITION expr="IsSysAdmin"/>
					</WTBUTTON>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>

      <!--============================================================================================-->
		<WTWEBPAGE name="m_15103" caption="Mobile Shopper" page-left="0" page-top="0" navbar="false" header="false" footer="false" wrapper="wrapperMobile"
			page-width="100%" margin-width="0%" navbar-width="0%" content-width="100%" viewport="width=device-width"
		   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl">
			<!--============================================================================================-->
			<WTPARAM name="ConsumerID" datatype="number"/>
			<WTPARAM name="ShowPassword" datatype="number"/>
			<WTPARAM name="CompanyID" datatype="number"/>
			<WTPARAM name="MerchantID" datatype="number"/>
			<WTPARAM name="MemberID" datatype="number"/>
			<WTPARAM name="ReferID" datatype="number"/>
			<WTPARAM name="ReferredBy" datatype="text"/>
      <WTPARAM name="IsMobilePromo" datatype="number"/>
      <WTPARAM name="Popup" datatype="number"/>
      <WTPARAM name="Txn" datatype="number"/>

      <WTINCLUDE name="Email.asp"/>

			<WTCODEGROUP>
				<WTCONDITION expr="IsSysAdmin"/>
				<WTSETATTRIBUTE name="PARAM(ShowPassword)" value="CONST(1)"/>
			</WTCODEGROUP>
			<WTSETATTRIBUTE name="PARAM(CompanyID)" value="SYSCON(NEXXUS)">
				<WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
			</WTSETATTRIBUTE>

			<WTSUB name="GetReferredBy">
				<WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
					<WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="ATTR(MerchantName)"/>
				</WTOBJECT>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTCONDITION expr="PARAM(ReferID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ReferID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
				</WTOBJECT>
				<WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
					<WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="MemberID" direction="input" value="PARAM(MemberID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
				</WTOBJECT>
				<WTSETATTRIBUTE name="PARAM(ReferredBy)" value="CONST(Trim(reqReferredBy))"/>
			</WTSUB>

			<WTSUB name="LoadList">
				<WTOBJECT name="Countrys" project="ptsCountryUser" class="CCountrys">
					<WTMETHOD name="EnumCompany">
						<WTPARAM name="xmlCountrys" direction="return" concat="true" datatype="text" />
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)" />
						<WTPARAM name="ItemID" direction="input" value="CONST()" />
						<WTPARAM name="Element" direction="input" value="CONST()" />
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTACTION id="0" name="New" type="New">
				<WTCALLSUB name="LoadList"/>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(Email)" oper="not-equal" value="ATTR(Email2)"/>
						<WTCONDITION expr="ATTR(Provider)" oper="not-equal" value="CONST(0)" connector="and"/>
						<WTSETATTRIBUTE name="PARAM(IsMobilePromo)" value="CONST(1)"/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(ReferID)" oper="not-equal" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(ReferID)" value="ATTR(ReferID)"/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(ReferID)" oper="equal" value="CONST(0)"/>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(MerchantID)" oper="not-equal" value="CONST(0)"/>
							<WTSETATTRIBUTE name="PARAM(MerchantID)" value="ATTR(MerchantID)"/>
						</WTCODEGROUP>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(MemberID)" oper="not-equal" value="CONST(0)"/>
							<WTSETATTRIBUTE name="PARAM(MemberID)" value="ATTR(MemberID)"/>
						</WTCODEGROUP>
					</WTCODEGROUP>
					<WTCALLSUB name="GetReferredBy"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="1" name="Update" type="Update">
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTSETATTRIBUTE name="ATTR(Email)" value="FORM(Email)"/>
					<WTSETATTRIBUTE name="ATTR(Email2)" value="FORM(Email2)"/>
					<WTSETATTRIBUTE name="ATTR(Phone)" value="FORM(Phone)"/>
					<WTCUSTOM>
						If ValidEmail( .Email ) = 0 Then DoError 10122, "", "Oops, Invalid Email Address."
						If ValidEmail( .Email2 ) = 0 Then DoError 10122, "", "Oops, Invalid Email Address."
					</WTCUSTOM>
					<WTCODEGROUP>
						<WTCONDITION expr="NoErrors"/>
						<WTMETHOD name="FetchEmail">
							<WTPARAM name="Email" direction="input" value="ATTR(Email)"/>
						</WTMETHOD>
						<WTCODEGROUP>
							<WTCONDITION expr="CONST(CLng(.ConsumerID))" oper="not-equal" value="CONST(0)"/>
							<WTCONDITION expr="CONST(CLng(.ConsumerID))" oper="not-equal" value="PARAM(ConsumerID)" connector="and"/>
							<WTERROR number="10123" message="Oops, This email address is already assigned to another consumer."/>
						</WTCODEGROUP>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="NoErrors"/>
						<WTMETHOD name="FetchPhone">
							<WTPARAM name="Phone" direction="input" value="ATTR(Phone)"/>
						</WTMETHOD>
						<WTCODEGROUP>
							<WTCONDITION expr="CONST(CLng(.ConsumerID))" oper="not-equal" value="CONST(0)"/>
							<WTCONDITION expr="CONST(CLng(.ConsumerID))" oper="not-equal" value="PARAM(ConsumerID)" connector="and"/>
							<WTERROR number="10136" message="Oops, This phone number is already assigned to someone else."/>
						</WTCODEGROUP>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="NoErrors"/>
						<WTSETATTRIBUTE name="ATTR(Password)" value="FORM(Password)"/>
						<WTCODEGROUP>
							<WTCONDITION expr="CONST(LEN(.Password))" oper="less" value="CONST(6)"/>
							<WTERROR number="10124" message="Oops, Please enter at least 6 characters for the Password."/>
						</WTCODEGROUP>
					</WTCODEGROUP>

					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTES/>
					<WTMETHOD name="Save">
						<WTCONDITION expr="NoErrors"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTSETATTRIBUTE name="PARAM(Txn)" value="CONST(1)"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
						<WTCONDITION expr="IsErrors"/>
            <WTCONDITION expr="PARAM(Popup)" oper="not-equal" value="CONST(0)" connector="or"/>
            <WTMETHOD name="XML">
							<WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
							<WTPARAM name="Option" direction="input" value="CONST(2)"/>
						</WTMETHOD>
						<WTCALLSUB name="LoadList"/>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(ReferID)" oper="not-equal" value="CONST(0)"/>
							<WTSETATTRIBUTE name="PARAM(ReferID)" value="ATTR(ReferID)"/>
						</WTCODEGROUP>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(ReferID)" oper="equal" value="CONST(0)"/>
							<WTCODEGROUP>
								<WTCONDITION expr="ATTR(MerchantID)" oper="not-equal" value="CONST(0)"/>
								<WTSETATTRIBUTE name="PARAM(MerchantID)" value="ATTR(MerchantID)"/>
							</WTCODEGROUP>
							<WTCODEGROUP>
								<WTCONDITION expr="ATTR(MemberID)" oper="not-equal" value="CONST(0)"/>
								<WTSETATTRIBUTE name="PARAM(MemberID)" value="ATTR(MemberID)"/>
							</WTCODEGROUP>
						</WTCODEGROUP>
						<WTCALLSUB name="GetReferredBy"/>
					</WTCODEGROUP>
				</WTOBJECT>
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
          <WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)" connector="and"/>
        </WTRETURN>
			</WTACTION>

			<WTACTION id="3" name="Return" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="4" name="Delete" type="Delete">
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Delete">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTCONDITION expr="IsErrors"/>
					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTCODEGROUP>
					<WTCONDITION expr="IsErrors"/>
					<WTCALLSUB name="LoadList"/>
				</WTCODEGROUP>
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
				</WTRETURN>
			</WTACTION>

			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="33" align="right"/>
				<WTCOLUMN width="67" align="left"/>

				<WTFUNCTION name="TitleCase(obj)">
					var val = obj.value;
					obj.value = val.charAt(0).toUpperCase() + val.slice(1);
				</WTFUNCTION>
				<WTFUNCTION name="DigitsOnly(obj)">
					var val = obj.value;
					obj.value = val.replace(/\D/g,'');
				</WTFUNCTION>
				<!-- Convert input to digits only if no @ sign for an email -->
				<WTFUNCTION name="LogonDigitsOnly(obj)">
					var val = obj.value;
					if(val.indexOf('@') === -1)	{
					obj.value = val.replace(/\D/g,'');
					}
				</WTFUNCTION>
				<WTFUNCTION name="MobilePromo()">
					var ptext = '';
					if (document.getElementById('IsMobilePromo').checked) {
					var phone = document.getElementById('Phone').value;
					var obj = document.getElementById('Provider');
					var i = obj.selectedIndex;
					var provider = Number(obj[i].value);
					if( provider != 0) {
					switch (provider) {
					case 1: ptext = 'txt.att.net'; break;
					case 2: ptext = 'sms.bellsouth.com'; break;
					case 3: ptext = 'myboostmobile.com'; break;
					case 4: ptext = 'sbcemail.com'; break;
					case 5: ptext = 'sms.mycricket.com'; break;
					case 6: ptext = 'airmessage.net'; break;
					case 7: ptext = 'mymetropcs.com'; break;
					case 8: ptext = 'messaging.sprintpcs.com'; break;
					case 9: ptext = 'tmomail.net'; break;
					case 10: ptext = 'email.uscc.net'; break;
					case 11: ptext = 'vtext.com'; break;
					case 12: ptext = 'vmobl.com'; break;
					}
					if(ptext != '') {
					document.getElementById('Email2').value = phone + '@' + ptext;
					}
					}
					}
					if(ptext == '') {
					document.getElementById('Email2').value = document.getElementById('Email').value
					}
				</WTFUNCTION>

				<WTSTATIC label="IsMobilePromo"/>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" merge="2" class="PageHeading" align="center">
            <WTSTATIC value="ATTR(Consumer.NameFirst)" space="1"/>
            <WTSTATIC value="ATTR(Consumer.NameLast)" space="1"/>
            <WTSTATIC fontcolor="red">
              <WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(1)"/>
              <WTSTATIC label="UPDATED"/>
            </WTSTATIC>
          </WTSTATIC>
        </WTROW>
        <WTROW margin-bottom="12">
          <WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
            <WTSTATIC tag="ReferredBy"/>
            <WTSTATIC value="PARAM(ReferredBy)" bold="true" space="2"/>
          </WTSTATIC>
        </WTROW>
        <WTROW margin-bottom="12">
          <WTCONDITION expr="ATTR(Consumer.AffiliateID)" oper="not-equal" value="CONST(0)"/>
          <WTSTATIC col="1" merge="2" align="center" fontsize="3" fontcolor="blue">
            <WTSTATIC label="AffiliateID"/>
            <WTSTATIC value="ATTR(Consumer.AffiliateID)"/>
          </WTSTATIC>
        </WTROW>

        <WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="NameFirst"/>
					<WTTEXT col="2" value="ATTR(Consumer.NameFirst)" size="15" focus="true" required="false" textclass="bigtext">
						<WTEXIT>TitleCase(this);</WTEXIT>
					</WTTEXT>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="NameLast"/>
					<WTTEXT col="2" value="ATTR(Consumer.NameLast)" size="15" required="false" textclass="bigtext">
						<WTEXIT>TitleCase(this);</WTEXIT>
					</WTTEXT>
				</WTROW>

				<WTROW>
					<WTSTATIC col="1" tag="Email"/>
					<WTTEXT col="2" value="ATTR(Consumer.Email)" size="15" required="false" textclass="bigtext">
						<WTEXIT>MobilePromo();</WTEXIT>
					</WTTEXT>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1"/>
					<WTSTATIC col="2" label="Unique" class="prompt"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Phone"/>
					<WTTEXT col="2" value="ATTR(Consumer.Phone)" size="15" required="false" textclass="bigtext">
						<WTEXIT>DigitsOnly(this); MobilePromo();</WTEXIT>
					</WTTEXT>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1"/>
					<WTSTATIC col="2" label="Unique" class="prompt"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Password"/>
					<WTTEXT col="2" value="ATTR(Consumer.Password)" size="15" required="false" textclass="bigtext"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1"/>
					<WTSTATIC col="2" label="PasswordText" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
				</WTROW>
        
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Messages"/>
					<WTCOMBO col="2" value="ATTR(Consumer.Messages)"/>
				</WTROW>

				<WTROW>
					<WTSTATIC col="1" tag="Provider"/>
					<WTCOMBO col="2" value="ATTR(Consumer.Provider)" comboclass="bigtext">
						<WTCHANGE>MobilePromo();</WTCHANGE>
						<WTOPTION id="0" label="None"/>
						<WTOPTION id="1" label="ATT"/>
						<WTOPTION id="2" label="Bellsouth"/>
						<WTOPTION id="3" label="Boost"/>
						<WTOPTION id="4" label="CellularOne"/>
						<WTOPTION id="5" label="Cricket"/>
						<WTOPTION id="6" label="GTE"/>
						<WTOPTION id="7" label="MetroPCS"/>
						<WTOPTION id="8" label="Sprint"/>
						<WTOPTION id="9" label="T-Mobile"/>
						<WTOPTION id="10" label="USCellular"/>
						<WTOPTION id="11" label="Verizon"/>
						<WTOPTION id="12" label="VirginMobile"/>
					</WTCOMBO>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1"/>
					<WTCHECK col="2" value="PARAM(IsMobilePromo)">
						<WTCLICK>MobilePromo();</WTCLICK>
					</WTCHECK>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="mEmail2"/>
					<WTTEXT col="2" value="ATTR(Consumer.Email2)" size="15" required="false" textclass="bigtext">
					</WTTEXT>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1"/>
					<WTSTATIC col="2" label="PromoEmail" class="prompt"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Address"/>
					<WTTEXT col="2" value="ATTR(Consumer.Street1)" size="15" required="false" textclass="bigtext">
						<WTEXIT>TitleCase(this);</WTEXIT>
					</WTTEXT>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Street2"/>
					<WTTEXT col="2" value="ATTR(Consumer.Street2)" size="15" required="false" textclass="bigtext">
						<WTEXIT>TitleCase(this);</WTEXIT>
					</WTTEXT>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="City"/>
					<WTTEXT col="2" value="ATTR(Consumer.City)" size="15" required="false" textclass="bigtext">
						<WTEXIT>TitleCase(this);</WTEXIT>
					</WTTEXT>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="State"/>
					<WTTEXT col="2" value="ATTR(Consumer.State)" size="15" required="false" textclass="bigtext">
						<WTEXIT>TitleCase(this);</WTEXIT>
					</WTTEXT>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Zip"/>
					<WTTEXT col="2" value="ATTR(Consumer.Zip)" size="15" required="false" textclass="bigtext"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" merge="2" tag="CountryID" align="center"/>
				</WTROW>
				<WTROW>
					<WTCOMBO col="1" merge="2" value="ATTR(Consumer.CountryID)" datapath="/DATA/TXN/PTSCOUNTRYS/ENUM" setselected="true" align="center"/>
				</WTROW>

				<WTROW margin-top="6" margin-bottom="6">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" merge="2" label="Zip2Text" class="prompt" align="left"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="City2"/>
					<WTTEXT col="2" value="ATTR(Consumer.City2)" size="15" textclass="bigtext"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="State2"/>
					<WTTEXT col="2" value="ATTR(Consumer.State2)" size="15" textclass="bigtext"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Zip2"/>
					<WTTEXT col="2" value="ATTR(Consumer.Zip2)" size="15" textclass="bigtext"/>
				</WTROW>

				<WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" merge="2" action="1" value="CONST(Update)" align="center" btnclass="bigbutton">
						<WTCONDITION expr="IsActive"/>
					</WTBUTTON>
					<WTBUTTON col="1" merge="2" action="3" value="CONST(Return)" btnclass="bigbutton">
            <WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)"/>
          </WTBUTTON>
          <WTBUTTON col="1" merge="2" action="4" value="CONST(Delete)" align="center" msg="ConfirmDelete">
						<WTCONDITION expr="IsSysAdmin"/>
					</WTBUTTON>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="15104" caption="Referral QRCode" page-width="400" page-left="10" margin-width="0" navbar="false" header="false" footer="false"
		aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl">
      <!--============================================================================================-->
      <WTPARAM name="M" datatype="number"/>
      <WTPARAM name="A" datatype="number"/>
      <WTPARAM name="S" datatype="number"/>
      <WTPARAM name="Link" datatype="text"/>
      <WTPARAM name="URL" datatype="text"/>

      <WTACTION name="New" type="New" id="0">
        <WTCODEGROUP>
          <WTCUSTOM>
            reqLink = "http://www.NexxusRewards.com/NewShopper.asp?"
            If reqM &gt; 0 Then reqLink = reqLink + "m=" + CStr(reqM)
            If reqA &gt; 0 Then reqLink = reqLink + "a=" + CStr(reqA)
            If reqS &gt; 0 Then reqLink = reqLink + "s=" + CStr(reqS)
            qrSize = 225
            reqURL = "https://chart.googleapis.com/chart?chs=" + CSTR(qrSize) + "x" + CSTR(qrSize) + "&amp;cht=qr&amp;chl=" + reqLink
          </WTCUSTOM>
        </WTCODEGROUP>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="400" align="center"/>

        <WTROW margin-top="12">
          <WTSTATIC col="1" label="YourQRCode" align="center" fontsize="4" fontcolor="blue"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" label="QRsave" align="center" class="prompt"/>
        </WTROW>
        <WTROW>
          <WTIMAGE col="1" value="CONST(&lt;xsl:value-of select=&quot;/DATA/PARAM/@url&quot;/&gt;)" imgpath=""/>
        </WTROW>
        <WTROW margin-top="12">
          <WTSTATIC col="1" merge="2" value="PARAM(Link)"/>
        </WTROW>
        <WTROW margin-top="12" margin-bottom="12">
          <WTBUTTON col="1" value="CONST(Close)" align="center">
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="15105" caption="Rewards Stats" page-width="400" page-left="10" margin-width="0" navbar="false" header="false" footer="false"
		aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl">
      <!--============================================================================================-->
      <WTPARAM name="Zips" datatype="text"/>
      <WTPARAM name="Shoppers" datatype="text"/>
      <WTPARAM name="Orgs" datatype="text"/>
      <WTPARAM name="Merchants" datatype="text"/>

      <WTACTION name="New" type="New" id="0">
        <WTGETCOOKIE name="PARAM(Zips)" value="CONST(STATZIPS)"/>
      </WTACTION>

      <WTACTION name="Update" type="Update" id="1">
        <WTSETCOOKIE name="CONST(STATZIPS)" value="PARAM(Zips)"/>
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTMETHOD name="Custom">
            <WTPARAM name="ConsumerID" direction="input" value="CONST(1)"/>
            <WTPARAM name="Status" direction="input" value="CONST(4)"/>
            <WTPARAM name="MemberID" direction="input" value="CONST(0)"/>
            <WTPARAM name="EnrollDate" direction="input" value="CONST(0)"/>
            <WTPARAM name="Email" direction="input" value="PARAM(Zips)"/>
            <WTPARAM name="Result" direction="return" datatype="text"/>
          </WTMETHOD>
          <WTCODEGROUP>
            <WTCUSTOM>
              a = Split(Result, ",")
              reqShoppers = FormatNumber(a(0),0)
              reqOrgs = FormatNumber(a(1),0)
              reqMerchants = FormatNumber(a(2),0)
            </WTCUSTOM>
          </WTCODEGROUP>
        </WTOBJECT>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="200" align="right"/>
        <WTCOLUMN width="200" align="left"/>

        <WTROW>
          <WTSTATIC col="1" merge="2" label="RewardsStats" class="PageHeading" align="center"/>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTSTATIC col="1" merge="2" label="StatsText" class="prompt" align="left"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" tag="Zips" align="left" fontsize="3"/>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTMEMO col="1" merge="2" value="PARAM(Zips)" cols="47" rows="2" align="left" valign="top"/>
        </WTROW>
        <WTROW margin-bottom="12">
          <WTBUTTON col="1" merge="2" action="1" value="CONST(Submit)" align="center"/>
          <WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>
        <WTCODEGROUP>
          <WTCONDITION expr="SYS(ActionCode)" oper="equal" value="CONST(1)"/>
          <WTROW margin-bottom="6">
            <WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" tag="Shoppers" fontsize="4"/>
            <WTSTATIC col="2" value="PARAM(Shoppers)" fontsize="4" bold="true"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTSTATIC col="1" tag="Orgs" fontsize="4"/>
            <WTSTATIC col="2" value="PARAM(Orgs)" fontsize="4" bold="true"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTSTATIC col="1" tag="Merchants" fontsize="4"/>
            <WTSTATIC col="2" value="PARAM(Merchants)" fontsize="4" bold="true"/>
          </WTROW>
        </WTCODEGROUP>
        
      </WTCONTENT>
    </WTWEBPAGE>

    <!--=============================================================================================-->
		<WTWEBPAGE name="15100" caption="Nexxus Shopper" header="false" navbar="false" footer="false" wrapper="wrapper1000"
			page-color="#777777" margin-width="0" navbar-width="0" content-width="1000"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" focus="false" langfile="15100" track="0">
			<!--=============================================================================================-->
			<WTPARAM name="ConsumerID" datatype="number"/>
			<WTPARAM name="CompanyID" datatype="number"/>
			<WTPARAM name="Header" datatype="text"/>
			<WTPARAM name="MenuBehindColor" datatype="text"/>
			<WTPARAM name="MenuBehindImage" datatype="text"/>
			<WTPARAM name="Title" datatype="text"/>
			<WTPARAM name="PageImage" datatype="text"/>
			<WTPARAM name="C" datatype="number"/>
      <WTPARAM name="MenuLogo" datatype="text"/>
      <WTPARAM name="User2FA" datatype="number"/>

      <WTPARAM name="HeaderPosition" datatype="number"/>
			<WTPARAM name="HeaderAlign" datatype="number"/>
			<WTPARAM name="MenuAlign" datatype="number"/>
			<WTPARAM name="MenuBackground" datatype="number"/>

      <!--			<WTINCLUDE name="CompanyHeader.asp"/>-->
			<WTINCLUDE name="Portal.asp"/>
			<WTINCLUDE name="MenuColors.asp"/>
      <WTINCLUDE name="2FA.asp"/>

      <!-- Security Checks -->
      <WTCODEGROUP>
        <WTCONDITION expr="NotEmployee"/>
        <WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
        <WTGETCACHE name="CONST(tmpConsumerID)" value="CONSUMER" datatype="number"/>
        <WTCODEGROUP>
          <WTCONDITION expr="IsMemberOnly"/>
          <WTCONDITION expr="CONST(tmpConsumerID)" oper="equal" value="CONST(0)" connector="and"/>
          <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
            <WTMETHOD name="Load">
              <WTPARAM name="MemberID" direction="input" value="SYS(MemberID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="CONST(tmpConsumerID)" value="ATTR(SponsorID)"/>
          </WTOBJECT>
          <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(Is2FAConsumer(reqConsumerID))"/>
          <WTCODEGROUP>
            <WTCONDITION expr="IsMemberOnly"/>
            <WTCONDITION expr="PARAM(User2FA)" oper="equal" value="CONST(1)" connector="and"/>
            <WTSETATTRIBUTE name="CONST(Member2FA)" value="CONST(Is2FA(reqSysUserID))"/>
            <WTSETATTRIBUTE name="CONST(tmpConsumerID)" value="CONST(0)">
              <WTCONDITION expr="CONST(Member2FA)" oper="equal" value="CONST(0)"/>
            </WTSETATTRIBUTE>
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(CLng(tmpConsumerID))"/>
          <WTSETCACHE name="CONSUMER" value="CONST(&quot;&quot;)"/>
          <WTRETURN><WTLINK name="15005" return="false"/></WTRETURN>
        </WTCODEGROUP>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="IsEmployee"/>
        <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(1)"/>
      </WTCODEGROUP>

      <WTCODEGROUP>
				<WTSETATTRIBUTE name="PARAM(C)" value="PARAM(ConsumerID)">
					<WTCONDITION expr="PARAM(C)" oper="equal" value="CONST(0)"/>
				</WTSETATTRIBUTE>
				<WTSETATTRIBUTE name="PARAM(CompanyID)" value="SYSCON(NEXXUS)">
					<WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
				</WTSETATTRIBUTE>
<!--				<WTCALLSUB name="reqHeader = GetCompanyHeader( reqCompanyID, &quot;en&quot; )"/>-->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="SYSCON(NEXXUS)"/>
          <WTSETATTRIBUTE name="PARAM(MenuLogo)" value="CONST(&quot;MenuLogo2.png&quot;)"/>
        </WTCODEGROUP>
      </WTCODEGROUP>

			<WTACTION id="0" name="New" type="New">
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Title)" value="CONST(CleanXML(.NameFirst + &quot; &quot; + .NameLast))"/>
          <WTSETCACHE name="MERCHANTSEARCH" value="ATTR(City)"/>
          <WTMETHOD name="XML">
						<WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>

				<WTCALLSUB name="GetPortal reqCompanyID, GroupID, reqHeaderPosition, reqHeaderAlign, reqMenuAlign, reqMenuBackground"/>
				<WTCALLSUB name="GetMenuColors reqCompanyID, GroupID, reqMenuBehindColor, MenuTopColor, MenuTopBGColor, MenuColor, MenuBGColor, MenuShadowColor, MenuBDColor, MenuOverColor, MenuOverBGColor, MenuDividerColor, reqMenuBehindImage, MenuTopImage, MenuImage"/>
			</WTACTION>
			<!--*******************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="1000" align="left" />

				<WTFUNCTION name="ShowTab(tab, shw)">
					var mid = document.getElementById('ConsumerID').value;
					var cid = document.getElementById('CompanyID').value;
					var frame, url, frm, src, page, target='', style='', compare=0, load=0, comingsoon=0;

					switch(tab) {
					case 'TabDashboard':
					frame = 'DashboardFrame';
					switch(shw) {
					case 1: url = '15110.asp?consumerid=' + mid + "&amp;companyid=" + cid; load=1; break;
          case 2: url = 'm_15100.asp?consumerid=' + mid; target='Mobile'; style='top=100,left=100,height=492,width=322,resizable=yes,status=no,toolbar=no,menubar=no,location=no,titlebar=no'; break;
          } break;
          case 'TabRewards':
          frame = 'RewardsFrame';
          switch(shw) {
          case 1: url = '16501.asp?consumerid=' + mid; target="Orders"; break;
          case 2: url = '15201.asp?consumerid=' + mid; break;
          case 3: url = '15225.asp?consumerid=' + mid; target="Transfer"; break;
          case 4: url = '17200.asp?consumerid=' + mid; target="Barter"; break;
          } break;
          case 'TabMerchants':
          frame = 'MerchantsFrame';
          switch(shw) {
          case 1: url = '15013.asp'; target='MerchantSearch'; break;
          case 2: url = 'xxxxx.asp?consumerid=' + mid; comingsoon=1; break;
          case 3: url = '15511.asp?c=' + mid; load=1; break;
          } break;
          case 'TabAccount':
          frame = 'AccountFrame';
          switch(shw) {
          case 1: url = '15103.asp?consumerid=' + mid; break;
          case 2: url = '15101.asp?referid=' + mid; target="Shopper"; break;
          case 3: url = '0108.asp?consumerid=' + mid; load=1; break;
          } break;
          case 'TabHelp':
          frame = 'HelpFrame';
          switch(shw) {
          case 1: url = 'p.asp?p=107'; target="Questions"; break;
          case 2: url = '9506.asp?contentpage=3' + '&amp;companyid=' + cid; target="SupportTickets"; break;
          } break;
          }
          if(comingsoon == 1) {
          alert('Coming Soon...');
          }
          else {
          if( target.length &gt; 0 ) {
					win = window.open(url,target,style);
					win.focus();
					}
					else {
					if( tab == 'TabDashboard')
					document.getElementById('TopMargin').style.display = 'none';
					else
					document.getElementById('TopMargin').style.display = '';

					frm = document.getElementById(frame);
					src = frm.src;
					if( compare == 0 ) { compare = url.indexOf('.') }
					page = url.substring(0,compare);
					if (load == 1 || src.indexOf(page) &lt; 0 ) {frm.src = url} else {ShowFrame(tab)}
					}
					}
				</WTFUNCTION>

				<WTFUNCTION name="ShowFrame(tab)">
					document.getElementById('TabDashboard').style.display = 'none';
					document.getElementById('TabRewards').style.display = 'none';
					document.getElementById('TabMerchants').style.display = 'none';
					document.getElementById('TabAccount').style.display = 'none';
					document.getElementById('TabHelp').style.display = 'none';
					document.getElementById(tab).style.display = '';
				</WTFUNCTION>

				<WTLOAD>
					ShowTab('TabDashboard',1);
				</WTLOAD>
        
        <WTMENU name="UserMenu" type="bar" menuwidth="125" height="30" top-color="CONST(MenuTopColor)" top-bgcolor="CONST(MenuTopBGColor)"
						color="CONST(MenuColor)" bgcolor="CONST(MenuBGColor)" shadow-color="CONST(MenuShadowColor)" bdcolor="CONST(MenuBDColor)"
						over-color="CONST(MenuOverColor)" over-bgcolor="CONST(MenuOverBGColor)" divider-color="CONST(MenuDividerColor)" top-bgimg="CONST(MenuTopImage)" bgimg="CONST(MenuImage)">
					<WTITEM label="mDashboard" width="75" menuwidth="200" height="30" menuheight="30">
						<WTIMAGE name="Home.gif" width="18" height="18"/>
						<WTITEM value="PARAM(Title)">
							<WTIMAGE name="Home.gif" width="18" height="18"/>
							<WTLINK name="JAVA(ShowTab('TabDashboard',1))"/>
						</WTITEM>
						<WTITEM label="mMobile">
							<WTIMAGE name="Mobile.gif" width="18" height="18"/>
							<WTLINK name="JAVA(ShowTab('TabDashboard',2))"/>
						</WTITEM>
					</WTITEM>
					<WTITEM label="mShopping" width="105" menuwidth="125" height="30" menuheight="30">
						<WTIMAGE name="ShoppingCart.gif" width="18" height="18"/>
            <WTITEM label="mPurchases">
              <WTIMAGE name="sales.gif" width="18" height="18"/>
              <WTLINK name="JAVA(ShowTab('TabRewards',1))"/>
            </WTITEM>
            <WTITEM label="mRewards">
              <WTIMAGE name="mNXC.gif" width="18" height="18"/>
              <WTLINK name="JAVA(ShowTab('TabRewards',2))"/>
            </WTITEM>
            <WTITEM label="mTransfer">
              <WTIMAGE name="mTransfer.gif" width="18" height="18"/>
              <WTITEM label="mRewards">
                <WTIMAGE name="mNXC.gif" width="18" height="18"/>
                <WTLINK name="JAVA(ShowTab('TabRewards',3))"/>
              </WTITEM>
            </WTITEM>
            <WTDIVIDER/>
            <WTITEM label="mBarter">
              <WTIMAGE name="sales.gif" width="18" height="18"/>
              <WTLINK name="JAVA(ShowTab('TabRewards',4))"/>
            </WTITEM>
          </WTITEM>
					<WTITEM label="mMerchants" width="115" menuwidth="125" height="30" menuheight="30">
						<WTIMAGE name="Prospect.gif" width="18" height="18"/>
						<WTITEM label="mSearch">
							<WTIMAGE name="Search.gif" width="18" height="18"/>
							<WTLINK name="JAVA(ShowTab('TabMerchants',1))"/>
						</WTITEM>
<!--            
						<WTITEM label="mMap">
							<WTIMAGE name="Prospect.gif" width="18" height="18"/>
							<WTLINK name="JAVA(ShowTab('TabMerchants',2))"/>
						</WTITEM>
-->            
						<WTITEM label="mBlocks">
							<WTIMAGE name="Block.gif" width="18" height="18"/>
							<WTLINK name="JAVA(ShowTab('TabMerchants',3))"/>
						</WTITEM>
					</WTITEM>
					<WTITEM label="mAccount" width="100" menuwidth="150" height="30" menuheight="30">
						<WTIMAGE name="MyInfo.gif" width="18" height="18"/>
						<WTITEM label="mProfile">
							<WTIMAGE name="MyInfo.gif" width="18" height="18"/>
							<WTLINK name="JAVA(ShowTab('TabAccount',1))"/>
						</WTITEM>
            <WTITEM label="mReferrals">
              <WTIMAGE name="Referrals.gif" width="18" height="18"/>
              <WTLINK name="JAVA(ShowTab('TabAccount',2))"/>
            </WTITEM>
            <WTDIVIDER/>
            <WTITEM label="m2FA"><WTIMAGE name="logon.gif" width="18" height="18"/><WTLINK name="JAVA(ShowTab('TabAccount',3))"/></WTITEM>
          </WTITEM>
					<WTITEM label="mHelp" width="100" menuwidth="175" height="30" menuheight="30">
						<WTIMAGE name="Help.gif" width="18" height="18"/>
						<WTITEM label="mFAQ">
							<WTIMAGE name="Question.gif" width="18" height="18"/>
							<WTLINK name="JAVA(ShowTab('TabHelp',1))"/>
						</WTITEM>
						<WTITEM label="mTickets">
							<WTIMAGE name="SupportTicket.gif" width="18" height="18"/>
							<WTLINK name="JAVA(ShowTab('TabHelp',2))"/>
						</WTITEM>
						<WTDIVIDER/>
						<WTITEM label="mSignout">
							<WTIMAGE name="close.gif" width="18" height="18"/>
							<WTLINK name="15005" nodata="true"/>
						</WTITEM>
					</WTITEM>
				</WTMENU>

				<WTROW>
					<WTHIDDEN value="PARAM(ConsumerID)"/>
					<WTHIDDEN value="PARAM(CompanyID)"/>
				</WTROW>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(HeaderPosition)" oper="equal" value="CONST(0)"/>
          <WTROW>
            <WTCONDITION expr="PARAM(HeaderAlign)" oper="equal" value="CONST(0)"/>
            <WTIMAGE col="1" align="left" valign="top" value="PARAM(Header)" path="CONST(Company/&lt;xsl:value-of select=&quot;/DATA/PARAM/@companyid&quot;/&gt;)"/>
          </WTROW>
          <WTROW>
            <WTCONDITION expr="PARAM(HeaderAlign)" oper="equal" value="CONST(1)"/>
            <WTIMAGE col="1" align="center" valign="top" value="PARAM(Header)" path="CONST(Company/&lt;xsl:value-of select=&quot;/DATA/PARAM/@companyid&quot;/&gt;)"/>
          </WTROW>
          <WTROW>
            <WTCONDITION expr="PARAM(HeaderAlign)" oper="equal" value="CONST(2)"/>
            <WTIMAGE col="1" align="right" valign="top" value="PARAM(Header)" path="CONST(Company/&lt;xsl:value-of select=&quot;/DATA/PARAM/@companyid&quot;/&gt;)"/>
          </WTROW>
        </WTCODEGROUP>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(MenuBackground)" oper="equal" value="CONST(0)"/>
          <WTROW>
            <WTDIVIDER col="1" merge="2" align="left" height="1" color="PARAM(MenuBehindColor)" />
          </WTROW>
          <WTROW height="65">
            <WTCONDITION expr="PARAM(MenuAlign)" oper="equal" value="CONST(0)"/>
            <WTSTATIC col="1" align="left" valign="middle" backcolor="PARAM(MenuBehindColor)" bgimg="PARAM(MenuBehindImage)">
              <WTCODEGROUP>
                <WTSTARTMENU name="UserMenu" type="bar"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW height="65">
            <WTCONDITION expr="PARAM(MenuAlign)" oper="equal" value="CONST(1)"/>
            <WTSTATIC col="1" align="center" valign="middle" backcolor="PARAM(MenuBehindColor)" bgimg="PARAM(MenuBehindImage)">
              <WTCODEGROUP>
                <WTSTARTMENU name="UserMenu" type="bar"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW height="65">
            <WTCONDITION expr="PARAM(MenuAlign)" oper="equal" value="CONST(2)"/>
            <WTSTATIC col="1" align="right" valign="middle" backcolor="PARAM(MenuBehindColor)" bgimg="PARAM(MenuBehindImage)">
              <WTCODEGROUP>
                <WTCONDITION expr="PARAM(MenuLogo)" oper="not-equal" value="CONST('')"/>
                <WTDIVISION style="float:left; margin-left:20px;">
                  <WTIMAGE value="PARAM(MenuLogo)" path="CONST(Company\&lt;xsl:value-of select=&quot;/DATA/PARAM/@companyid&quot;/&gt;)">
                    <WTLINK name="ShowTab('TabDashboard',1)" click="true" />
                  </WTIMAGE>
                </WTDIVISION>
                <WTDIVISION style="float:right">
                  <WTSTARTMENU name="UserMenu" type="bar"/>
                </WTDIVISION>
              </WTCODEGROUP>
              <WTCODEGROUP>
                <WTCONDITION expr="PARAM(MenuLogo)" oper="equal" value="CONST('')"/>
                <WTSTARTMENU name="UserMenu" type="bar"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW>
            <WTDIVIDER col="1" merge="2" align="left" height="1" color="PARAM(MenuBehindColor)" />
          </WTROW>
        </WTCODEGROUP>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(MenuBackground)" oper="not-equal" value="CONST(0)"/>
          <WTROW height="65">
            <WTCONDITION expr="PARAM(MenuAlign)" oper="equal" value="CONST(0)"/>
            <WTSTATIC col="1" align="left" valign="top">
              <WTCODEGROUP>
                <WTSTARTMENU name="UserMenu" type="bar"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW height="65">
            <WTCONDITION expr="PARAM(MenuAlign)" oper="equal" value="CONST(1)"/>
            <WTSTATIC col="1" align="center" valign="top">
              <WTCODEGROUP>
                <WTSTARTMENU name="UserMenu" type="bar"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW height="65">
            <WTCONDITION expr="PARAM(MenuAlign)" oper="equal" value="CONST(2)"/>
            <WTSTATIC col="1" align="right" valign="top">
              <WTCODEGROUP>
                <WTSTARTMENU name="UserMenu" type="bar"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
        </WTCODEGROUP>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(HeaderPosition)" oper="equal" value="CONST(1)"/>
          <WTROW>
            <WTCONDITION expr="PARAM(HeaderAlign)" oper="equal" value="CONST(0)"/>
            <WTIMAGE col="1" align="left" valign="top" value="PARAM(Header)" path="CONST(Company/&lt;xsl:value-of select=&quot;/DATA/PARAM/@companyid&quot;/&gt;)"/>
          </WTROW>
          <WTROW>
            <WTCONDITION expr="PARAM(HeaderAlign)" oper="equal" value="CONST(1)"/>
            <WTIMAGE col="1" align="center" valign="top" value="PARAM(Header)" path="CONST(Company/&lt;xsl:value-of select=&quot;/DATA/PARAM/@companyid&quot;/&gt;)"/>
          </WTROW>
          <WTROW>
            <WTCONDITION expr="PARAM(HeaderAlign)" oper="equal" value="CONST(2)"/>
            <WTIMAGE col="1" align="right" valign="top" value="PARAM(Header)" path="CONST(Company/&lt;xsl:value-of select=&quot;/DATA/PARAM/@companyid&quot;/&gt;)"/>
          </WTROW>
        </WTCODEGROUP>

				<WTROW id="TopMargin" height="6"/>

				<!-- ======================================================================= -->
				<WTROW id="TabDashboard">
					<WTFRAME col="1" src="" name="DashboardFrame" frmclass="FrameNoScroll" onload="ShowFrame('TabDashboard')" frmwidth="1000" frmheight="600" scrolling="no" label="NoFrameSupport" border="0"/>
				</WTROW>
				<!-- ======================================================================= -->
				<WTROW id="TabRewards">
					<WTFRAME col="1" src="" name="RewardsFrame" frmclass="FrameNoScroll" onload="ShowFrame('TabRewards')" frmwidth="1000" frmheight="2000" label="NoFrameSupport" border="0"/>
				</WTROW>
				<!-- ======================================================================= -->
				<WTROW id="TabMerchants">
					<WTFRAME col="1" src="" name="MerchantsFrame" frmclass="FrameNoScroll" onload="ShowFrame('TabMerchants')" frmwidth="1000" frmheight="2000" label="NoFrameSupport" border="0"/>
				</WTROW>
				<!-- ======================================================================= -->
				<WTROW id="TabAccount">
					<WTFRAME col="1" src="" name="AccountFrame" frmclass="FrameNoScroll" onload="ShowFrame('TabAccount')" frmwidth="1000" frmheight="2000" label="NoFrameSupport" border="0"/>
				</WTROW>
				<!-- ======================================================================= -->
				<WTROW id="TabHelp">
					<WTFRAME col="1" src="" name="HelpFrame" frmclass="FrameNoScroll" onload="ShowFrame('TabHelp')" frmwidth="1000" frmheight="2000" label="NoFrameSupport" border="0"/>
				</WTROW>
				<!-- ======================================================================= -->

				<WTROW>
					<WTSTATIC col="1" align="right">
						<WTCODEGROUP>
							<WTTRANSLATE/>
						</WTCODEGROUP>
					</WTSTATIC>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>

		<!--==================================================================-->
		<WTWEBPAGE name="m_15100" caption="Nexxus Rewards" page-left="5" page-top="0" navbar="false" header="false" footer="false"
			page-image="bg7.jpg" page-width="100%" margin-width="0%" navbar-width="0%" content-width="100%" viewport="width=device-width"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" focus="false" langfile="m_15100" mobile="m_15100.asp" track="0">
			<!--==================================================================-->
			<WTPARAM name="ConsumerID" datatype="number"/>
			<WTPARAM name="CompanyID" datatype="number"/>
			<WTPARAM name="Header" datatype="text"/>
			<WTPARAM name="MenuBehindColor" datatype="text"/>
			<WTPARAM name="MenuBehindImage" datatype="text"/>
			<WTPARAM name="Title" datatype="text"/>
			<WTPARAM name="PageImage" datatype="text"/>
			<WTPARAM name="C" datatype="number"/>
      <WTPARAM name="User2FA" datatype="number"/>

      <WTPARAM name="HeaderPosition" datatype="number"/>
			<WTPARAM name="HeaderAlign" datatype="number"/>
			<WTPARAM name="MenuAlign" datatype="number"/>
			<WTPARAM name="MenuBackground" datatype="number"/>

			<WTINCLUDE name="CompanyHeader.asp"/>
			<WTINCLUDE name="Portal.asp"/>
			<WTINCLUDE name="MenuColors.asp"/>
      <WTINCLUDE name="2FA.asp"/>

      <!-- Security Checks -->
      <WTCODEGROUP>
        <WTCONDITION expr="NotEmployee"/>
        <WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(Is2FAConsumer(reqConsumerID))"/>
        <WTGETCACHE name="CONST(tmpConsumerID)" value="CONSUMER" datatype="number"/>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(tmpConsumerID)"/>
          <WTSETCACHE name="CONSUMER" value="CONST(&quot;&quot;)"/>
          <WTRETURN><WTLINK name="15005" return="false"/></WTRETURN>
        </WTCODEGROUP>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="IsEmployee"/>
        <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(1)"/>
      </WTCODEGROUP>

      <WTCODEGROUP>
				<WTSETATTRIBUTE name="PARAM(C)" value="PARAM(ConsumerID)">
					<WTCONDITION expr="PARAM(C)" oper="equal" value="CONST(0)"/>
				</WTSETATTRIBUTE>
				<WTSETATTRIBUTE name="PARAM(CompanyID)" value="SYSCON(NEXXUS)">
					<WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
				</WTSETATTRIBUTE>
			</WTCODEGROUP>

			<WTACTION id="0" name="New" type="New">
				<WTCUSTOM>
          reqHeader = GetHeader( reqCompanyID, 0, "MobileHeader", "" )
          If reqCompanyID = 21 Then reqHeader = "NexxusRewardsMobile.png"
          reqHeader = "company/" + CStr(reqCompanyID) + "/" + reqHeader
        </WTCUSTOM>
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(ConsumerName)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
          <WTSETCACHE name="MERCHANTSEARCH" value="ATTR(City)"/>
          <WTMETHOD name="XML">
						<WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTCALLSUB name="GetMenuColors reqCompanyID, GroupID, reqMenuBehindColor, MenuTopColor, MenuTopBGColor, MenuColor, MenuBGColor, MenuShadowColor, MenuBDColor, MenuOverColor, MenuOverBGColor, MenuDividerColor, reqMenuBehindImage, MenuTopImage, MenuImage"/>

			</WTACTION>

			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="100" align="left"/>

				<WTFUNCTION name="ShowTab(tab, shw)">
          var mid = document.getElementById('ConsumerID').value;
          var cid = document.getElementById('CompanyID').value;
          var frame, url, frm, src, page, target='', style='', compare=0, load=0, comingsoon=0;

          switch(tab) {
          case 'TabDashboard':
          frame = 'DashboardFrame';
          switch(shw) {
          case 1: url = 'm_15110.asp?consumerid=' + mid; load=1; break;
          } break;
          case 'TabRewards':
          frame = 'RewardsFrame';
          switch(shw) {
          case 1: url = 'm_16501.asp?consumerid=' + mid; break;
          case 2: url = 'm_15201.asp?consumerid=' + mid; break;
          case 3: url = 'm_15225.asp?consumerid=' + mid; target="Transfer"; break;
          } break;
          case 'TabMerchants':
          frame = 'MerchantsFrame';
          switch(shw) {
          case 1: url ='m_15013.asp'; break;
          case 2: url = 'xxxxx.asp?consumerid=' + mid; comingsoon=1; break;
          case 3: url = 'm_15511.asp?c=' + mid; load=1; break;
          } break;
          case 'TabAccount':
          frame = 'AccountFrame';
          switch(shw) {
          case 1: url = 'm_15103.asp?popup=1&amp;consumerid=' + mid; break;
          case 2: url = 'm_15101.asp?referid=' + mid; break;
          case 3: url = 'm_0108.asp?consumerid=' + mid; load=1; break;
          } break;
          case 'TabHelp':
          frame = 'HelpFrame';
          switch(shw) {
          case 1: url = 'p.asp?p=107'; target="Questions"; break;
          case 2: url = 'm_9506.asp?contentpage=3' + '&amp;companyid=' + cid; break;
          } break;
          }
          if(comingsoon == 1) {
          alert('Coming Soon...');
          }
          else {
          if( target.length &gt; 0 ) {
					win = window.open(url,target,style);
					win.focus();
					}
					else {
					frm = document.getElementById(frame);
					src = frm.src;
					if( compare == 0 ) { compare = url.indexOf('.') }
					page = url.substring(0,compare);
					if (load == 1 || src.indexOf(page) &lt; 0 ) {frm.src = url} else {ShowFrame(tab)}
					}
					}
				</WTFUNCTION>

				<WTFUNCTION name="ShowFrame(tab)">
          document.getElementById('TabDashboard').style.display = 'none';
          document.getElementById('TabRewards').style.display = 'none';
          document.getElementById('TabMerchants').style.display = 'none';
          document.getElementById('TabAccount').style.display = 'none';
          document.getElementById('TabHelp').style.display = 'none';
          document.getElementById(tab).style.display = '';
        </WTFUNCTION>

				<WTLOAD>
					ShowTab('TabDashboard',1);
				</WTLOAD>

				<WTMENU name="UserMenu" type="bar" menuwidth="125" top-color="CONST(MenuTopColor)" top-bgcolor="CONST(MenuTopBGColor)"
						color="CONST(MenuColor)" bgcolor="CONST(MenuBGColor)" shadow-color="CONST(MenuShadowColor)" bdcolor="CONST(MenuBDColor)"
						over-color="CONST(MenuOverColor)" over-bgcolor="CONST(MenuOverBGColor)" divider-color="CONST(MenuDividerColor)" top-bgimg="CONST(MenuTopImage)" bgimg="CONST(MenuImage)">
          <WTITEM width="40" menuwidth="150">
            <WTIMAGE name="Menu2.png" width="29" height="30"/>
            <WTITEM label="mDashboard" width="100" height="40" menuwidth="100" menuheight="40">
            <WTIMAGE name="Home.gif" width="18" height="18"/>
              <WTLINK name="JAVA(ShowTab('TabDashboard',1))"/>
            </WTITEM>
            <WTITEM label="mShopping" width="100" height="40" menuwidth="100" menuheight="40">
              <WTIMAGE name="ShoppingCart.gif" width="18" height="18"/>
              <WTITEM label="mPurchases">
                <WTIMAGE name="sales.gif" width="18" height="18"/>
                <WTLINK name="JAVA(ShowTab('TabRewards',1))"/>
              </WTITEM>
              <WTITEM label="mRewards">
                <WTIMAGE name="mNXC.gif" width="18" height="18"/>
                <WTLINK name="JAVA(ShowTab('TabRewards',2))"/>
              </WTITEM>
              <WTITEM label="mTransfer">
                <WTIMAGE name="mTransfer.gif" width="18" height="18"/>
                <WTITEM label="mRewards">
                  <WTIMAGE name="mNXC.gif" width="18" height="18"/>
                  <WTLINK name="JAVA(ShowTab('TabRewards',3))"/>
                </WTITEM>
              </WTITEM>
            </WTITEM>
						<WTITEM label="mMerchants" width="125" height="40" menuwidth="125" menuheight="40">
							<WTIMAGE name="Prospect.gif" width="18" height="18"/>
							<WTITEM label="mSearch">
								<WTIMAGE name="Suspect.gif" width="18" height="18"/>
								<WTLINK name="JAVA(ShowTab('TabMerchants',1))"/>
							</WTITEM>
<!--              
							<WTITEM label="mMap">
								<WTIMAGE name="Prospect.gif" width="18" height="18"/>
								<WTLINK name="JAVA(ShowTab('TabMerchants',2))"/>
							</WTITEM>
-->              
							<WTITEM label="mBlocks">
								<WTIMAGE name="Block.gif" width="18" height="18"/>
								<WTLINK name="JAVA(ShowTab('TabMerchants',3))"/>
							</WTITEM>
						</WTITEM>
  					<WTITEM label="mAccount" width="100" height="40" menuwidth="145" menuheight="40">
							<WTIMAGE name="MyInfo.gif" width="18" height="18"/>
							<WTITEM label="mProfile">
								<WTIMAGE name="MyInfo.gif" width="18" height="18"/>
								<WTLINK name="JAVA(ShowTab('TabAccount',1))"/>
							</WTITEM>
              <WTITEM label="mReferrals">
                <WTIMAGE name="Referrals.gif" width="18" height="18"/>
                <WTLINK name="JAVA(ShowTab('TabAccount',2))"/>
              </WTITEM>
              <WTDIVIDER/>
              <WTITEM label="m2FA">
                <WTIMAGE name="logon.gif" width="18" height="18"/>
                <WTLINK name="JAVA(ShowTab('TabAccount',3))"/>
              </WTITEM>
            </WTITEM>
						<WTITEM label="mHelp" width="100" height="40" menuwidth="175" menuheight="40">
							<WTIMAGE name="Help.gif" width="18" height="18"/>
							<WTITEM label="mFAQ">
								<WTIMAGE name="Question.gif" width="18" height="18"/>
								<WTLINK name="JAVA(ShowTab('TabHelp',1))"/>
							</WTITEM>
							<WTITEM label="mTickets">
								<WTIMAGE name="SupportTicket.gif" width="18" height="18"/>
								<WTLINK name="JAVA(ShowTab('TabHelp',2))"/>
							</WTITEM>
							<WTDIVIDER/>
							<WTITEM label="mSignout">
								<WTIMAGE name="close.gif" width="18" height="18"/>
								<WTLINK name="m_15005" nodata="true"/>
							</WTITEM>
						</WTITEM>
					</WTITEM>
					<WTITEM value="CONST(ConsumerName)" width="220" align="center"/>
					<WTITEM width="40">
						<WTIMAGE name="Refresh2.png" width="29" height="30"/>
						<WTLINK name="JAVA(doSubmit(0,''))"/>
					</WTITEM>
				</WTMENU>

				<WTROW>
					<WTHIDDEN value="PARAM(ConsumerID)"/>
					<WTHIDDEN value="PARAM(CompanyID)"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTIMAGE col="1" align="center" value="PARAM(Header)"/>
				</WTROW>
				<WTROW height="36">
					<WTSTATIC col="1" align="left" valign="top" backcolor="PARAM(MenuBehindColor)" bgimg="PARAM(MenuBehindImage)">
						<WTCODEGROUP><WTSTARTMENU name="UserMenu" type="bar"/></WTCODEGROUP>
					</WTSTATIC>
				</WTROW>

        <!-- ======================================================================= -->
        <WTROW id="TabDashboard">
          <WTFRAME col="1" src="" name="DashboardFrame" frmclass="FrameNoScroll" onload="ShowFrame('TabDashboard')" frmwidth="100" frmheight="700" label="NoFrameSupport" border="0"/>
        </WTROW>
        <!-- ======================================================================= -->
				<WTROW id="TabRewards">
					<WTFRAME col="1" src="" name="RewardsFrame" frmclass="FrameNoScroll" onload="ShowFrame('TabRewards')" frmwidth="100" frmheight="1320" label="NoFrameSupport" border="0"/>
				</WTROW>
				<!-- ======================================================================= -->
				<WTROW id="TabMerchants">
					<WTFRAME col="1" src="" name="MerchantsFrame" frmclass="FrameNoScroll" onload="ShowFrame('TabMerchants')" frmwidth="100" frmheight="700" label="NoFrameSupport" border="0"/>
				</WTROW>
				<!-- ======================================================================= -->
				<WTROW id="TabAccount">
					<WTFRAME col="1" src="" name="AccountFrame" frmclass="FrameNoScroll" onload="ShowFrame('TabAccount')" frmwidth="100" frmheight="700" label="NoFrameSupport" border="0"/>
				</WTROW>
				<!-- ======================================================================= -->
				<WTROW id="TabHelp">
					<WTFRAME col="1" src="" name="HelpFrame" frmclass="FrameNoScroll" onload="ShowFrame('TabHelp')" frmwidth="100" frmheight="700" label="NoFrameSupport" border="0"/>
				</WTROW>
				<!-- ======================================================================= -->

        <WTROW>
          <WTSTATIC col="1" align="right">
            <WTCODEGROUP>
              <WTTRANSLATE/>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>

      </WTCONTENT>
		</WTWEBPAGE>

		<!--============================================================================================-->
		<WTWEBPAGE name="15110" caption="Consumer Dashboard" navbar="false" header="false" footer="false" wrapper="false"
			page-left="0" margin-width="0" navbar-width="0"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" focus="false" langfile="15110">
			<!--============================================================================================-->
			<WTPARAM name="ConsumerID" datatype="number"/>
			<WTPARAM name="CompanyID" datatype="number"/>
      <WTPARAM name="User2FA" datatype="number"/>

      <WTINCLUDE name="2FA.asp"/>
      <WTINCLUDE name="Coins.asp"/>

      <WTCODEGROUP>
        <WTCONDITION expr="NotEmployee"/>
        <WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(Is2FAConsumer(reqConsumerID))"/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="IsEmployee"/>
        <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
        <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(1)"/>
      </WTCODEGROUP>

      <WTACTION id="0" name="New" type="New">
				<WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
					<WTMETHOD name="Load">
						<WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(tmpName)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
					<WTSETATTRIBUTE name="CONST(tmpEmail)" value="ATTR(Email)"/>
          <WTSETATTRIBUTE name="CONST(tmpEnrollDate)" value="ATTR(EnrollDate)"/>
          <WTSETATTRIBUTE name="CONST(tmpEmail2)" value="ATTR(Email2)"/>
					<WTSETATTRIBUTE name="CONST(tmpPhone)" value="ATTR(Phone)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlConsumer" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
					<WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections/Company/&quot; + CStr(reqCompanyID))"/>
					<WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(&quot;Consumer.htm&quot;)"/>
					<WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)"/>
					<WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)"/>
					<WTMETHOD name="Load"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlHTMLFile" direction="return" datatype="text"/>
					</WTMETHOD>
					<WTCUSTOM>
            xmlHTMLFile = Replace( xmlHTMLFile, "{id}", reqConsumerID )
            xmlHTMLFile = Replace( xmlHTMLFile, "{name}", tmpName )
            xmlHTMLFile = Replace( xmlHTMLFile, "{email}", tmpEmail )
            xmlHTMLFile = Replace( xmlHTMLFile, "{enrolldate}", tmpEnrollDate )
            xmlHTMLFile = Replace( xmlHTMLFile, "{email2}", tmpEmail2 )
            xmlHTMLFile = Replace( xmlHTMLFile, "{phone}", tmpPhone )
          </WTCUSTOM>
				</WTOBJECT>

        <!-- Company Customizations -->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="SYSCON(NEXXUS)"/>
          <WTOBJECT name="Nexxus" project="ptsNexxusUser" class="CNexxus">
            <WTMETHOD name="Custom">
              <WTPARAM name="Status" direction="input" value="CONST(38)"/>
              <WTPARAM name="czDate" direction="input" value="CONST(0)"/>
              <WTPARAM name="Quantity" direction="input" value="PARAM(ConsumerID)"/>
              <WTPARAM name="Amount" direction="input" value="CONST(0)"/>
              <WTPARAM name="Result" direction="return" datatype="text"/>
            </WTMETHOD>
          </WTOBJECT>
          <!-- get the current price of the Nexxus coin -->
          <WTSETATTRIBUTE name="CONST(NXCprice)" value="CONST(CoinPrice( 2, &quot;USD&quot; ))"/>
          <WTCUSTOM>
            If reqUser2FA = 0 Then strDisplay = "block" Else strDisplay = "none"
            xmlHTMLFile = Replace( xmlHTMLFile, "{display2FA}", strDisplay )

            tmpToday = FormatDateTime(reqSysDate,1)
            aSection = Split( Result, "|")
            a1 = Split( aSection(0), "^")
            a2 = Split( aSection(1), "^")
            a3 = Split( aSection(2), "^")
            a4 = Split( aSection(3), "^")
            a5 = Split( aSection(4), "^")
            tmpSale1 = FormatCurrency(a1(0))
            tmpSale2 = FormatCurrency(a1(1))
            tmpSale3 = FormatCurrency(a1(2))
            tmpSale4 = FormatCurrency(a1(3))
            If a3(0) = "" Then a3(0) = "No Merchants Shopped Yet!"
            Reward1 = a2(0)
            Reward2 = a2(1)
            Reward3 = a2(2)
            Reward4 = a2(3)
            Reward1Price = FormatCurrency(Reward1 * NXCPrice)
            Reward2Price = FormatCurrency(Reward2 * NXCPrice)
            Reward3Price = FormatCurrency(Reward3 * NXCPrice)
            NXCPriceText = FormatCurrency(NXCPrice,4)

            xmlHTMLFile = Replace( xmlHTMLFile, "{today}", tmpToday )
            xmlHTMLFile = Replace( xmlHTMLFile, "{sale1}", tmpSale1 )
            xmlHTMLFile = Replace( xmlHTMLFile, "{sale2}", tmpSale2 )
            xmlHTMLFile = Replace( xmlHTMLFile, "{sale3}", tmpSale3 )
            xmlHTMLFile = Replace( xmlHTMLFile, "{sale4}", tmpSale4 )
            xmlHTMLFile = Replace( xmlHTMLFile, "{nxcprice}", NXCPriceText )
            xmlHTMLFile = Replace( xmlHTMLFile, "{reward1}", Reward1 )
            xmlHTMLFile = Replace( xmlHTMLFile, "{reward2}", Reward2 )
            xmlHTMLFile = Replace( xmlHTMLFile, "{reward3}", Reward3 )
            xmlHTMLFile = Replace( xmlHTMLFile, "{reward1a}", Reward1Price )
            xmlHTMLFile = Replace( xmlHTMLFile, "{reward2a}", Reward2Price )
            xmlHTMLFile = Replace( xmlHTMLFile, "{reward3a}", Reward3Price )
            xmlHTMLFile = Replace( xmlHTMLFile, "{reward4}", Reward4 )
            xmlHTMLFile = Replace( xmlHTMLFile, "{merchant1}", a3(0) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{merchant2}", a3(1) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{merchant3}", a3(2) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{merchant4}", a3(3) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{refer1}", a4(0) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{refer2}", a4(1) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{refer3}", a4(2) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{refer4}", a4(3) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{barter1}", a5(0) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{barter2}", a5(1) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{barter3}", a5(2) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{barter4}", a5(3) )
          </WTCUSTOM>
        </WTCODEGROUP>

      </WTACTION>

			<!--**********************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="1000" align="center"/>

				<WTROW>
					<WTSTATIC col="1" value="ATTR(HTMLFile.Data)" align="left" embedhtml="true"/>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>

    <!--=============================================================================================-->
    <WTWEBPAGE name="m_15110" caption="Mobile Dashboard" page-left="3" page-top="0" navbar="false" header="false" footer="false" wrapper="false"
			page-width="100%" margin-width="0%" navbar-width="0%" content-width="100%" viewport="width=device-width"
		   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl">
      <!--=============================================================================================-->
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="C" datatype="number"/> <!-- CompanyID -->
      <WTPARAM name="Referrals" datatype="number"/>
      <WTPARAM name="Reward1" datatype="currency"/>
      <WTPARAM name="Reward2" datatype="currency"/>
      <WTPARAM name="Reward3" datatype="currency"/>
      <WTPARAM name="Reward4" datatype="currency"/>
      <WTPARAM name="NXCPrice" datatype="currency"/>
      <WTPARAM name="Reward1Price" datatype="text"/>
      <WTPARAM name="Reward2Price" datatype="text"/>
      <WTPARAM name="Reward3Price" datatype="text"/>
      <WTPARAM name="NXCPriceText" datatype="text"/>
      <WTPARAM name="URL" datatype="text"/>

      <WTINCLUDE name="Company.asp"/>
      <WTINCLUDE name="Coins.asp"/>

      <WTDATATXN name="Reward2"/>

      <WTSETATTRIBUTE name="PARAM(C)" value="SYSCON(NEXXUS)">
        <WTCONDITION expr="PARAM(C)" oper="equal" value="CONST(0)"/>
      </WTSETATTRIBUTE>

      <WTCODEGROUP>
          <WTCUSTOM>
          reqURL = "http://" + reqSysServerName + reqSysServerPath + "NewShopper.asp?s=" + CStr(reqConsumerID)
        </WTCUSTOM>
      </WTCODEGROUP>
      
      <WTACTION id="0" name="New" type="New">
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTMETHOD name="Custom">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="Status" direction="input" value="CONST(1)"/>
            <WTPARAM name="MemberID" direction="input" value="CONST(0)"/>
            <WTPARAM name="EnrollDate" direction="input" value="CONST(0)"/>
            <WTPARAM name="Email" direction="input" value="CONST(&quot;&quot;)"/>
            <WTPARAM name="Result" direction="return" datatype="text"/>
          </WTMETHOD>
          <!-- get the current price of the Nexxus coin -->
          <WTSETATTRIBUTE name="CONST(NXCprice)" value="CONST(CoinPrice( 2, &quot;USD&quot; ))"/>
          <WTCODEGROUP>
            <WTCUSTOM>
              a = Split(Result, "|")
              total = UBOUND(a)
              reqReferrals = a(0)
              reqReward1 = a(1)
              reqReward2 = a(2)
              reqReward3 = a(3)
              reqReward4 = a(4)
              reqReward1Price = FormatCurrency(reqReward1 * NXCPrice)
              reqReward2Price = FormatCurrency(reqReward2 * NXCPrice)
              reqReward3Price = FormatCurrency(reqReward3 * NXCPrice)
              reqNXCPriceText = FormatCurrency(NXCPrice,4)
            </WTCUSTOM>
          </WTCODEGROUP>
        </WTOBJECT>
        <WTOBJECT name="Rewards" project="ptsRewardUser" class="CRewards">
          <WTMETHOD name="ListCash">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
          </WTMETHOD>
          <WTCUSTOM>
            For Each oItem in oRewards
            With oItem
            If .Amount &lt; 0 Then .RewardType = 0
            End With
            Next
          </WTCUSTOM>
          <WTMETHOD name="XML">
            <WTPARAM name="Option" direction="input" value="CONST(13)"/>
            <WTPARAM name="xmlRewards" direction="return" datatype="text"/>
          </WTMETHOD>

          <WTMETHOD name="ListPointsSummary">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTPARAM name="Option" direction="input" value="CONST(13)"/>
            <WTPARAM name="ElementName" direction="input" value="CONST(&quot;Reward2&quot;)"/>
            <WTPARAM name="xmlReward2" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTACTION>

      <WTACTION id="1" name="NewShopper" type="New">
        <WTRETURN>
          <WTLINK name="m_NewShopper" nolocaldata="false">
            <WTPARAM name="S" value="PARAM(ConsumerID)"/>
            <WTPARAM name="Ret" value="CONST(1)"/>
          </WTLINK>
        </WTRETURN>
      </WTACTION>

      <!--*******************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="100" align="center"/>

        <WTFUNCTION name="NewShopper()">
          var cid = document.getElementById('ConsumerID').value;
          var url = "m_NewShopper.asp?s=" + cid;
          var win = window.open(url);
        </WTFUNCTION>

        <WTFUNCTION name="ViewAwards(id)">
          var  url = "m_15312.asp?merchantid=" + id
          var win = window.open(url);
          win.focus();
        </WTFUNCTION>

        <WTROW>
          <WTHIDDEN value="PARAM(ConsumerID)"/>
        </WTROW>

        <WTROW margin-top="6">
          <WTTABLE col="1" valign="top" padding="0" style="border:1px solid; border-radius:15px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #ffffff">
            <WTCOLUMN width="82" align="left"/>
            <WTCOLUMN width="13" align="center"/>
            <WTROW margin-bottom="3">
              <WTIMAGE col="1" merge="2" value="CONST(NXC24.gif)" imgalign="absmiddle" align="center"/>
              <WTSTATIC col="1" merge="2" fontsize="3">
                <WTSTATIC label="RewardPoints" space="1"/>
                <WTSTATIC value="PARAM(NXCPriceText)" fontsize="2"/>
              </WTSTATIC>
            </WTROW>
            <WTROW>
              <WTSTATIC col="1" merge="2" fontsize="3" align="center">
                <WTSTATIC value="PARAM(Reward3)" space="1"/>
                <WTSTATIC label="AvailableRewards" space="1"/>
                <WTSTATIC value="PARAM(Reward3Price)"/>
              </WTSTATIC>
            </WTROW>
<!--            
            <WTROW>
              <WTSTATIC col="1" merge="2" fontcolor="orange" fontsize="3" align="center">
                <WTSTATIC value="PARAM(Reward2)" space="1"/>
                <WTSTATIC label="HoldRewards" space="1"/>
                <WTSTATIC value="PARAM(Reward2Price)"/>
              </WTSTATIC>
            </WTROW>
-->            
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" merge="2" fontcolor="green" fontsize="3" align="center">
                <WTSTATIC value="PARAM(Reward1)" space="1"/>
                <WTSTATIC label="PendingRewards" space="1"/>
                <WTSTATIC value="PARAM(Reward1Price)"/>
              </WTSTATIC>
            </WTROW>
            <WTREPEAT entity="Reward">
              <WTROW>
                <WTSTATIC col="1" value="DATA(RewardDate)" fontsize="1"/>
                <WTSTATIC col="2" value="DATA(HoldDate)" fontcolor="orange" fontsize="1">
                  <WTCONDITION expr="DATA(Status)" oper="equal" value="CONST(4)"/>
                </WTSTATIC>
              </WTROW>
              <WTROW>
                <WTSTATIC col="1" value="DATA(MerchantName)" fontsize="2" bold="true"/>
                <WTSTATIC col="2" bold="true">
                  <WTSTATIC value="DATA(Amount)" fontcolor="green">
                    <WTCONDITION expr="DATA(Status)" oper="less-equal" value="CONST(2)"/>
                  </WTSTATIC>
                  <WTSTATIC value="DATA(Amount)">
                    <WTCONDITION expr="DATA(Status)" oper="equal" value="CONST(3)"/>
                  </WTSTATIC>
                  <WTSTATIC value="DATA(Amount)" fontcolor="orange">
                    <WTCONDITION expr="DATA(Status)" oper="equal" value="CONST(4)"/>
                  </WTSTATIC>
                </WTSTATIC>
              </WTROW>
              <WTROW margin-bottom="6">
                <WTSTATIC col="1" merge="2" value="DATA(Note)" fontcolor="gray" fontsize="1"/>
              </WTROW>
            </WTREPEAT>
          </WTTABLE>
        </WTROW>

        <WTROW margin-top="6">
          <WTTABLE col="1" valign="top" padding="0" style="border:1px solid; border-radius:15px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #ffffff">
            <WTCOLUMN width="82" align="left"/>
            <WTCOLUMN width="13" align="center"/>

            <WTROW margin-bottom="3">
              <WTSTATIC col="1" merge="2" align="center">
                <WTCODEGROUP>
                  <WTIMAGE value="CONST(prize24.gif)" imgalign="absmiddle"/>
                  <WTSTATIC space="1"/>
                  <WTSTATIC label="AwardPoints" fontsize="3"/>
                </WTCODEGROUP>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-bottom="6">
              <WTSTATIC col="1" merge="2" fontsize="3" align="center">
                <WTSTATIC value="PARAM(Reward4)" space="1"/>
                <WTSTATIC label="Total"/>
              </WTSTATIC>
            </WTROW>

            <WTREPEAT entity="Reward2">
              <WTROW height="24">
                <WTSTATIC col="1" fontsize="2" bold="true">
                  <WTSTATIC value="DATA(MerchantName)" space="1"/>
                  <WTCODEGROUP>
                    <WTIMAGE value="CONST(gift24.png)" imgalign="absmiddle">
                      <WTLINK name="ViewAwards(&lt;xsl:value-of select=&quot;@merchantid&quot;/&gt;)" click="true" />
                    </WTIMAGE>
                  </WTCODEGROUP>
                </WTSTATIC>
                <WTSTATIC col="2" value="DATA(Points)" bold="true" fontcolor="green"/>
              </WTROW>
            </WTREPEAT>
          </WTTABLE>
        </WTROW>

        <WTROW margin-top="6">
          <WTTABLE col="1" valign="top" padding="0" style="border:1px solid; border-radius:15px; border-color:#cccccc; padding:10px; BACKGROUND-COLOR: #ffffff">
            <WTCOLUMN width="95" align="center"/>

            <WTROW margin-top="6">
              <WTSTATIC col="1" fontsize="4" fontcolor="blue">
                <WTSTATIC value="PARAM(Referrals)" space="1"/>
                <WTSTATIC label="Referrals"/>
              </WTSTATIC>
            </WTROW>
            <WTROW margin-top="6">
              <WTBUTTON col="1" value="CONST(NewShopper)"  btnclass="bigbutton">
                <WTCLICK>NewShopper()</WTCLICK>
              </WTBUTTON>
            </WTROW>
            <WTROW margin-top="6">
              <WTSTATIC col="1" fontsize="2" fontcolor="blue">
                <WTSTATIC tag="ReferralLink" newline="1"/>
                <WTSTATIC value="PARAM(URL)"/>
              </WTSTATIC>
            </WTROW>

          </WTTABLE>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

  </WTWEBPAGES>
</WTROOT>