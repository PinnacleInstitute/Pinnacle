<WTROOT prefix="pts" system="Pinnacle">
	<WTENTITY id="174" name="BarterCredit" alias="bac" translate="false">

		<!--Identity-->
		<WTATTRIBUTE id="17401" name="BarterCreditID" type="number" identity="true" title="true" min="1" required="true" source="entity"/>

    <!--Foreign Keys-->
    <WTATTRIBUTE id="17402" name="OwnerType" type="number" source="entity"/>
    <WTATTRIBUTE id="17403" name="OwnerID" type="number" source="entity"/>
    <WTATTRIBUTE id="17404" name="BarterAdID" type="number" source="entity"/>

    <!--Foreign Table Fields-->

    <!--Attributes-->
    <WTATTRIBUTE id="17410" name="CreditDate" type="date" source="entity"/>
    <WTATTRIBUTE id="17411" name="Amount" type="currency" min="-999999.99" max="999999.99" source="entity">
    <WTFORMAT value="##,###.00"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="17412" name="Status" type="number" source="entity">
      <WTENUM id="1" name="Active"/>
      <WTENUM id="2" name="Expired"/>
      <WTENUM id="3" name="Cancelled"/>
      <WTENUM id="4" name="Reconcilled"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="17413" name="CreditType" type="number" source="entity">
      <WTENUM id="1" name="Credit"/>
      <WTENUM id="2" name="Debit_Title"/>
      <WTENUM id="3" name="Debit_Image"/>
      <WTENUM id="4" name="Debit_Image2"/>
      <WTENUM id="5" name="Debit_Editor"/>
      <WTENUM id="6" name="Debit_Long"/>
      <WTENUM id="7" name="Debit_Listing"/>
      <WTENUM id="8" name="Debit_Bundle1"/>
      <WTENUM id="9" name="Debit_Bundle2"/>
      <WTENUM id="99" name="Transfer"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="17414" name="StartDate" type="date" source="entity"/>
    <WTATTRIBUTE id="17415" name="EndDate" type="date" source="entity"/>
    <WTATTRIBUTE id="17416" name="Reference" type="text" length="30" min="1" max="30" source="entity" language="false"/>
    <WTATTRIBUTE id="17417" name="Notes" type="text" length="500" min="1" max="500" source="entity" language="false"/>

    <!-- Non Persist Fields -->

    <!--Indexes-->
    <WTINDEX name="Owner">
      <WTATTRIBUTE name="OwnerType"/>
      <WTATTRIBUTE name="OwnerID"/>
      <WTATTRIBUTE name="CreditDate"/>
    </WTINDEX>
    <WTINDEX name="BarterAdID">
      <WTATTRIBUTE name="BarterAdID"/>
      <WTATTRIBUTE name="CreditDate"/>
    </WTINDEX>
    <WTINDEX name="Reference">
      <WTATTRIBUTE name="Reference"/>
    </WTINDEX>

    <WTRELATIONSHIPS>
			<WTRELATIONSHIP name="BarterCredit" entity="BarterCredit" alias="bac"/>
      <WTRELATIONSHIP name="Common" entity="BarterCredit" alias="bac"/>
    </WTRELATIONSHIPS>

    <!-- System Constants -->

    <!--List-->
    <WTENUM id="1" type="find">
      <WTATTRIBUTE name="CreditDate" default="true"/>
      <WTATTRIBUTE name="CreditType"/>
    </WTENUM>

  </WTENTITY>

	<WTPROCEDURES>
		<WTPROCEDURE type="Add" name="Add" style="GenerateDataProc.xsl"/>
		<WTPROCEDURE type="Delete" name="Delete" style="GenerateDataProc.xsl"/>
    <WTPROCEDURE type="Fetch" name="Fetch" style="GenerateDataProc.xsl">
      <WTJOIN name="Common"/>
    </WTPROCEDURE>
		<WTPROCEDURE type="Update" name="Update" style="GenerateDataProc.xsl"/>
    <!--==================================================================================================================-->
    <WTPROCEDURE type="Find" name="Find" style="GenerateDataProc.xsl">
      <WTPARAM name="ATTR(OwnerType)" direction="input" required="false"/>
      <WTPARAM name="ATTR(OwnerID)" direction="input" required="false"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTBOOKMARK name=""/>
      <WTJOIN name="Common"/>
      <WTCONDITION expr="ATTR(BarterAd.OwnerType)" oper="equal" value="PARAM(OwnerType)" connector="and"/>
      <WTCONDITION expr="ATTR(BarterAd.OwnerID)" oper="equal" value="PARAM(OwnerID)" connector="and"/>
    </WTPROCEDURE>
    <!--==================================================================================================-->
    <WTPROCEDURE name="Total" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
      <WTPARAM name="ATTR(OwnerType)" direction="input" required="false"/>
      <WTPARAM name="ATTR(OwnerID)" direction="input" required="false"/>
      <WTPARAM name="Result" direction="output" datatype="text" length="1000"/>
    </WTPROCEDURE>
    <!--==================================================================================================-->
    <WTPROCEDURE name="Custom" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
      <WTPARAM name="ATTR(Status)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(BarterAdID)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(CreditType)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(Reference)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="Result" direction="output" datatype="text" length="1000"/>
    </WTPROCEDURE>
  </WTPROCEDURES>

	<WTWEBPAGES>
    <!--==================================================================================================================-->
    <WTWEBPAGE name="17401" caption="Barter Credits" action="5" header="false" footer="false" navbar="false" wrapper="wrapper800"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl">
      <!--==================================================================================================================-->
      <WTPARAM name="SearchText" datatype="text"/>
      <WTPARAM name="FindTypeID" datatype="number"/>
      <WTPARAM name="Bookmark" datatype="text"/>
      <WTPARAM name="Direction" datatype="number"/>
      <WTPARAM name="OwnerType" datatype="number"/>
      <WTPARAM name="OwnerID" datatype="number"/>
      <WTPARAM name="Title" datatype="text"/>
      <WTPARAM name="User2FA" datatype="number"/>

      <WTPARAM name="Available" datatype="currency"/>
      <WTPARAM name="Total" datatype="currency"/>
      <WTPARAM name="Negative" datatype="number"/>

      <WTINCLUDE name="2FA.asp"/>

      <WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="IsEmployee"/>
          <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
          <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(1)"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="NotEmployee"/>
          <WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OwnerType)" oper="equal" value="ENTITY(Member)"/>
          <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(Is2FA(reqSysUserID))"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(OwnerType)" oper="equal" value="ENTITY(Consumer)"/>
            <WTSETATTRIBUTE name="PARAM(User2FA)" value="CONST(Is2FAConsumer(reqOwnerID))"/>
          </WTCODEGROUP>
        </WTCODEGROUP>
      </WTCODEGROUP>

      <WTSETATTRIBUTE name="PARAM(FindTypeID)" value="FINDID(CreditDate)">
        <WTCONDITION expr="PARAM(FindTypeID)" oper="equal" value="CONST(0)"/>
      </WTSETATTRIBUTE>

      <WTACTION id="0" name="New" type="New">
        <WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
        <WTOBJECT name="BarterCredits" project="ptsBarterCreditUser" class="CBarterCredits">
          <WTSETATTRIBUTE name="CONST(.FindTypeID)" value="CONST(reqFindTypeID)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlBarterCredits" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(14)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark"/>
        <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
          <WTCONDITION expr="PARAM(OwnerType)" oper="equal" value="ENTITY(Member)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MemberID" direction="input" value="PARAM(OwnerID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(Title)" value="CONST(CleanXML(.NameFirst + &quot; &quot; + .NameLast))"/>
        </WTOBJECT>
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTCONDITION expr="PARAM(OwnerType)" oper="equal" value="ENTITY(Consumer)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(OwnerID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(Title)" value="CONST(CleanXML(.NameFirst + &quot; &quot; + .NameLast))"/>
        </WTOBJECT>
      </WTACTION>

      <WTACTION id="5" name="Find" type="New">
        <WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
      </WTACTION>

      <WTACTION id="6" name="Previous" type="New">
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(2)"/>
      </WTACTION>

      <WTACTION id="7" name="Next" type="New">
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
      </WTACTION>

      <WTOBJECT name="BarterCredit" project="ptsBarterCreditUser" class="CBarterCredit">
        <WTMETHOD name="Total">
          <WTPARAM name="OwnerType" direction="input" value="PARAM(OwnerType)"/>
          <WTPARAM name="OwnerID" direction="input" value="PARAM(OwnerID)"/>
          <WTPARAM name="Result" direction="return" datatype="text"/>
        </WTMETHOD>
        <WTCODEGROUP>
          <WTCUSTOM>
            a = Split(Result, ";")
            If a(0) &lt; 0 Then reqNegative = 1
            reqAvailable = FormatNumber(a(0),2)
            reqTotal = FormatNumber(a(1),2)
          </WTCUSTOM>
        </WTCODEGROUP>
      </WTOBJECT>

      <WTOBJECT name="BarterCredits" project="ptsBarterCreditUser" class="CBarterCredits">
        <WTMETHOD name="Find">
          <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
          <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
          <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
          <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
          <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
          <WTPARAM name="OwnerType" direction="input" value="PARAM(OwnerType)"/>
          <WTPARAM name="OwnerID" direction="input" value="PARAM(OwnerID)"/>
          <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
        </WTMETHOD>
        <WTMETHOD name="XML">
          <WTPARAM name="xmlBarterCredits" direction="return" datatype="text"/>
          <WTPARAM name="Option" direction="input" value="CONST(15)"/>
        </WTMETHOD>
      </WTOBJECT>
      <WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark">
        <WTSETATTRIBUTE name="ATTR(LastBookmark)" value="PARAM(Bookmark)"/>
        <WTMETHOD name="XML">
          <WTPARAM name="xmlBookmark" direction="return" datatype="text"/>
        </WTMETHOD>
      </WTOBJECT>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="800" align="left"/>

        <WTFUNCTION name="NewBarterCredit()">
          var t = document.getElementById('OwnerType').value
          var i = document.getElementById('OwnerID').value
          var url = "17403.asp?ownertype=" + t + "&amp;ownerid=" + i + "&amp;returnurl=17401.asp?ownertype=" + t + "%26ownerid=" + i
          window.location = url
        </WTFUNCTION>
        <WTFUNCTION name="TransferCredits()">
          var t = document.getElementById('OwnerType').value
          var i = document.getElementById('OwnerID').value
          var url = "17405.asp?ownertype=" + t + "&amp;ownerid=" + i + "&amp;returnurl=17401.asp?ownertype=" + t + "%26ownerid=" + i
          window.location = url
        </WTFUNCTION>
        <WTFUNCTION name="PurchaseCredits()">
          var t = document.getElementById('OwnerType').value
          var i = document.getElementById('OwnerID').value
          var url = '';
          if( t == 4 ) {
            url = "NexxusAd.asp?memberid=" + i + "&amp;returnurl=17401.asp?ownertype=" + t + "%26ownerid=" + i
          }
          if( t == 151 ) {
            url = "NexxusAd2.asp?consumerid=" + i + "&amp;returnurl=17401.asp?ownertype=" + t + "%26ownerid=" + i
          }
          if( url != '' ) { window.location = url }
        </WTFUNCTION>

        <WTROW>
          <WTHIDDEN name="OwnerType" value="PARAM(OwnerType)"/>
          <WTHIDDEN name="OwnerID" value="PARAM(OwnerID)"/>
          <WTHIDDEN name="Title" value="PARAM(Title)"/>
        </WTROW>

        <WTROW margin-bottom="12">
          <WTSTATIC col="1" class="PageHeading" align="center">
            <WTSTATIC tag="BarterCredits" value="PARAM(Title)" newline="1"/>
            <WTSTATIC tag="Available" value="PARAM(Available)" fontcolor="green" space="3">
              <WTCONDITION expr="PARAM(Negative)" oper="equal" value="CONST(0)"/>
            </WTSTATIC>
            <WTSTATIC tag="Available" value="PARAM(Available)" fontcolor="red" space="3">
              <WTCONDITION expr="PARAM(Negative)" oper="not-equal" value="CONST(0)"/>
            </WTSTATIC>
            <WTSTATIC tag="Total" value="PARAM(Total)"/>
          </WTSTATIC>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" tag="SearchBy" class="ColumnHeader" align="center"/>
          <WTCOMBO col="1" value="ATTR(BarterCredits.FindTypeID)" translate="true" prespace="false"/>
          <WTSTATIC col="1" tag="SearchFor" class="ColumnHeader"/>
          <WTTEXT col="1" value="ATTR(Bookmark.SearchText)" size="20" focus="true" prespace="false"/>
          <WTBUTTON col="1" action="5" value="CONST(Search)" default="true"/>
          <WTBUTTON col="1" value="CONST(Purchase)" align="center">
            <WTCLICK>PurchaseCredits()</WTCLICK>
          </WTBUTTON>
          <WTBUTTON col="1" value="CONST(Transfer)" align="center">
            <WTCONDITION expr="PARAM(User2FA)" oper="equal" value="CONST(1)"/>
            <WTCLICK>TransferCredits()</WTCLICK>
          </WTBUTTON>
          <WTBUTTON col="1" value="CONST(NewBarterCredit)" align="center">
            <WTCONDITION expr="IsEmployee"/>
            <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
            <WTCLICK>NewBarterCredit()</WTCLICK>
          </WTBUTTON>
          <WTBUTTON col="1" value="CONST(Close)">
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>

        <WTROW>
          <WTRECORDSET col="1" graybar="true" prevnext="top" entity="BarterCredit">
            <WTCOLUMN width="15" align="center" label="CreditDate"/>
            <WTCOLUMN width="15" align="center" label="Amount"/>
            <WTCOLUMN width="12" align="center" label="Status"/>
            <WTCOLUMN width="12" align="center" label="CreditType"/>
            <WTCOLUMN width="12" align="center" label="StartDate"/>
            <WTCOLUMN width="12" align="center" label="EndDate"/>
            <WTCOLUMN width="15" align="center" label="Reference"/>
            <WTCOLUMN width="7" align="center" label="BarterAdID"/>
            <WTROW height="30">
              <WTSTATIC col="1">
                <WTSTATIC value="DATA(CreditDate)"/>
                <WTCODEGROUP>
                  <WTCONDITION expr="IsEmployee"/>
                  <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
                  <WTSTATIC space="1"/>
                  <WTIMAGE value="CONST(Edit.gif)" imgalign="absmiddle">
                    <WTLINK name="17403"><WTPARAM name="BarterCreditID" value="DATA(BarterCreditID)"/></WTLINK>
                  </WTIMAGE>
                </WTCODEGROUP>
              </WTSTATIC>
              <WTSTATIC col="2">
                <WTSTATIC value="DATA(Amount)" fontcolor="red">
                  <WTCONDITION expr="DATA(Amount)" oper="less" value="CONST(0)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Amount)">
                  <WTCONDITION expr="DATA(Amount)" oper="greater-equal" value="CONST(0)"/>
                </WTSTATIC>
              </WTSTATIC>
              <WTSTATIC col="3" value="DATA(Status)"/>
              <WTSTATIC col="4" value="DATA(CreditType)"/>
              <WTSTATIC col="5" value="DATA(StartDate)"/>
              <WTSTATIC col="6" value="DATA(EndDate)"/>
              <WTSTATIC col="7" value="DATA(Reference)"/>
              <WTSTATIC col="8">
                <WTSTATIC value="DATA(BarterAdID)">
                  <WTCONDITION expr="DATA(BarterAdID)" oper="not-equal" value="CONST(0)"/>
                </WTSTATIC>
              </WTSTATIC>
            </WTROW>
            <WTROW>
              <WTCONDITION expr="DATA(Notes)" oper="not-equal" value="CONST('')"/>
              <WTSTATIC col="1" merge="2"/>
              <WTSTATIC col="3" merge="6" value="DATA(Notes)" fontcolor="gray" align="left"/>
            </WTROW>
          </WTRECORDSET>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="17403" caption="BarterCredit" header="false" footer="false" navbar="false" wrapper="wrapper600"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl">
		<!--============================================================================================-->
      <WTPARAM name="BarterCreditID" datatype="number"/>
      <WTPARAM name="OwnerType" datatype="number"/>
      <WTPARAM name="OwnerID" datatype="number"/>

      <WTSUB name="UpdateBarterCredit">
        <WTOBJECT name="BarterCredit" project="ptsBarterCreditUser" class="CBarterCredit">
          <WTMETHOD name="Load">
            <WTPARAM name="BarterCreditID" direction="input" value="PARAM(BarterCreditID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTES/>
          <WTMETHOD name="Save">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTCONDITION expr="IsErrors"/>
            <WTPARAM name="xmlBarterCredit" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(2)"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>
      
      <WTSUB name="AddBarterCredit">
        <WTOBJECT name="BarterCredit" project="ptsBarterCreditUser" class="CBarterCredit">
          <WTMETHOD name="Load">
            <WTPARAM name="BarterCreditID" direction="input" value="CONST(0)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTES/>
          <WTMETHOD name="Add">
            <WTPARAM name="reqBarterCreditID" direction="return" datatype="number"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTCONDITION expr="IsErrors"/>
            <WTPARAM name="xmlBarterCredit" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(2)"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTSUB name="LoadBarterCredit">
        <WTOBJECT name="BarterCredit" project="ptsBarterCreditUser" class="CBarterCredit">
          <WTMETHOD name="Load">
            <WTPARAM name="BarterCreditID" direction="input" value="PARAM(BarterCreditID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(BarterCreditID)" oper="equal" value="CONST(0)"/>
            <WTSETATTRIBUTE name="ATTR(OwnerType)" value="PARAM(OwnerType)"/>
            <WTSETATTRIBUTE name="ATTR(OwnerID)" value="PARAM(OwnerID)"/>
            <WTSETATTRIBUTE name="ATTR(CreditDate)" value="SYS(Date)"/>
            <WTSETATTRIBUTE name="ATTR(Status)" value="CONST(1)"/>
          </WTCODEGROUP>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlBarterCredit" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(2)"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="LoadBarterCredit"/>
      </WTACTION>

      <WTACTION id="1" name="Update" type="Update">
        <WTCALLSUB name="UpdateBarterCredit"/>
        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
        </WTRETURN>
      </WTACTION>

      <WTACTION id="2" name="Add" type="Add">
        <WTCALLSUB name="AddBarterCredit"/>
        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
        </WTRETURN>
      </WTACTION>

      <WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="4" name="Delete" type="Delete">
				<WTOBJECT name="BarterCredit" project="ptsBarterCreditUser" class="CBarterCredit">
					<WTMETHOD name="Load">
						<WTPARAM name="BarterCreditID" direction="input" value="PARAM(BarterCreditID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
          <WTMETHOD name="Delete">
            <WTPARAM name="BarterCreditID" direction="input" value="PARAM(BarterCreditID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
				</WTRETURN>
			</WTACTION>

      <!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="160" align="right"/>
				<WTCOLUMN width="440" align="left"/>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" merge="2" class="PageHeading" align="left">
            <WTSTATIC tag="NewBarterCredit">
              <WTCONDITION expr="PARAM(BarterCreditID)" oper="equal" value="CONST(0)"/>
            </WTSTATIC>
            <WTSTATIC tag="BarterCredit" value="ATTR(BarterCredit.BarterCreditID)">
              <WTCONDITION expr="PARAM(BarterCreditID)" oper="not-equal" value="CONST(0)"/>
            </WTSTATIC>
          </WTSTATIC>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" merge="2" tag="OwnerType" align="center"/>
          <WTTEXT col="1" value="ATTR(BarterCredit.OwnerType)" size="3" prespace="false"/>
          <WTSTATIC col="1" tag="OwnerID"/>
          <WTTEXT col="1" value="ATTR(BarterCredit.OwnerID)" size="3" prespace="false"/>
          <WTSTATIC col="1" tag="BarterAdID"/>
          <WTTEXT col="1" value="ATTR(BarterCredit.BarterAdID)" size="3" prespace="false"/>
          <WTSTATIC col="1" tag="Reference"/>
          <WTTEXT col="1" value="ATTR(BarterCredit.Reference)" size="10" prespace="false"/>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" tag="CreditDate"/>
          <WTTEXT col="2" value="ATTR(BarterCredit.CreditDate)"/>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTSTATIC col="1" tag="Amount"/>
          <WTTEXT col="2" value="ATTR(BarterCredit.Amount)"/>
        </WTROW>
        <WTROW margin-bottom="3">
          <WTSTATIC col="1" tag="Status"/>
          <WTCOMBO col="2" value="ATTR(BarterCredit.Status)"/>
          <WTSTATIC col="2" tag="CreditType"/>
          <WTCOMBO col="2" value="ATTR(BarterCredit.CreditType)" prespace="false"/>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTSTATIC col="1" tag="StartDate"/>
          <WTTEXT col="2" value="ATTR(BarterCredit.StartDate)"/>
          <WTSTATIC col="2" tag="EndDate"/>
          <WTTEXT col="2" value="ATTR(BarterCredit.EndDate)" prespace="false"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" tag="Notes"/>
          <WTMEMO col="2" value="ATTR(BarterCredit.Notes)" rows="3" cols="60"/>
        </WTROW>

        <WTROW margin-top="12" margin-bottom="12">
          <WTCONDITION expr="PARAM(BarterCreditID)" oper="equal" value="CONST(0)"/>
          <WTBUTTON col="1" merge="2" action="2" value="CONST(Add)" align="center"/>
          <WTBUTTON col="1" action="3" value="CONST(Cancel)"/>
        </WTROW>

        <WTROW margin-top="12" margin-bottom="12">
          <WTCONDITION expr="PARAM(BarterCreditID)" oper="not-equal" value="CONST(0)"/>
          <WTBUTTON col="1" merge="2" action="1" value="CONST(Update)" align="center"/>
          <WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)"/>
					<WTBUTTON col="1" merge="2" action="4" value="CONST(Delete)" msg="ConfirmDelete"/>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="17411" caption="Barter Credit" page-left="5" page-top="0" navbar="false" header="false" footer="false"
			page-width="100%" margin-width="0%" navbar-width="0%" content-width="100%" viewport="width=device-width"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" focus="false">
      <!--============================================================================================-->
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="BarterAdID" datatype="number"/>
      <WTPARAM name="CreditType" datatype="number"/>

      <WTPARAM name="Available" datatype="currency"/>
      <WTPARAM name="Total" datatype="currency"/>
      <WTPARAM name="Negative" datatype="number"/>

      <WTSUB name="LoadBarterCredits">
        <WTOBJECT name="BarterAd" project="ptsBarterAdUser" class="CBarterAd">
          <WTMETHOD name="Load">
            <WTPARAM name="BarterAdID" direction="input" value="PARAM(BarterAdID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlBarterAd" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(2)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTOBJECT name="BarterCredit" project="ptsBarterCreditUser" class="CBarterCredit">
          <WTMETHOD name="Total">
            <WTPARAM name="OwnerType" direction="input" value="ENTITY(Consumer)"/>
            <WTPARAM name="OwnerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="Result" direction="return" datatype="text"/>
          </WTMETHOD>
          <WTCODEGROUP>
            <WTCUSTOM>
              a = Split(Result, ";")
              If a(0) &lt; 0 Then reqNegative = 1
              reqAvailable = FormatNumber(a(0),2)
              reqTotal = FormatNumber(a(1),2)
            </WTCUSTOM>
          </WTCODEGROUP>
        </WTOBJECT>
      </WTSUB>

      <WTSUB name="UpdateBarterCredits">
        <WTSETATTRIBUTE name="CONST(tmpCreditType)" value="FORM(CreditType)"/>
        <WTOBJECT name="BarterCredit" project="ptsBarterCreditUser" class="CBarterCredit">
          <WTMETHOD name="Custom">
            <WTPARAM name="Status" direction="input" value="CONST(1)"/>
            <WTPARAM name="BarterAdID" direction="input" value="PARAM(BarterAdID)"/>
            <WTPARAM name="CreditType" direction="input" value="CONST(tmpCreditType)"/>
            <WTPARAM name="Reference" direction="input" value="CONST(&quot;&quot;)"/>
            <WTPARAM name="Result" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>
      
      <WTACTION name="New" type="New" id="0">
        <WTCALLSUB name="LoadBarterCredits"/>
      </WTACTION>

      <WTACTION name="Update" type="Update" id="1">
        <WTCALLSUB name="UpdateBarterCredits"/>
        <WTCALLSUB name="LoadBarterCredits"/>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="60" align="left"/>
        <WTCOLUMN width="40" align="left"/>

        <WTFUNCTION name="NewBarterOption(id)">
          document.getElementById('CreditType').value = id
          doSubmit(1,'Are you completely sure you want to add this feature for the specified credits?');
        </WTFUNCTION>
        
        <WTROW>
          <WTHIDDEN value="PARAM(BarterAdID)"/>
          <WTHIDDEN value="PARAM(CreditType)"/>
        </WTROW>

        <WTROW margin-bottom="12">
          <WTSTATIC col="1" merge="2" class="PageHeading" align="center">
            <WTSTATIC value="ATTR(BarterAd.Title)" newline="1"/>
            <WTSTATIC label="BarterCredits" bold="true" space="2"/>
            <WTSTATIC tag="Available" value="PARAM(Available)" fontcolor="green" space="2">
              <WTCONDITION expr="PARAM(Negative)" oper="equal" value="CONST(0)"/>
            </WTSTATIC>
            <WTSTATIC tag="Available" value="PARAM(Available)" fontcolor="red" space="2">
              <WTCONDITION expr="PARAM(Negative)" oper="not-equal" value="CONST(0)"/>
            </WTSTATIC>
            <WTSTATIC tag="Total" value="PARAM(Total)"/>
          </WTSTATIC>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" class="PageHeader" align="center">
            <WTCODEGROUP><WTIMAGE value="CONST(Feature_Title.gif)" alt="Feature_Title" imgalign="absmiddle"/></WTCODEGROUP>
            <WTSTATIC space="1"/>
            <WTSTATIC label="OptionTitle" bold="true" fontsize="3" newline="1"/>
            <WTSTATIC label="OptionTitle2"/>
          </WTSTATIC>
          <WTSTATIC col="2" class="PageHeading" align="center" fontsize="2">
            <WTSTATIC label="Enabled" fontsize="4">
              <WTCONDITION expr="_IsBarterOption_Title"/>
            </WTSTATIC>
            <WTCODEGROUP>
              <WTCONDITION expr="_NotBarterOption_Title"/>
              <WTBUTTON value="CONST(AddFeature)">
                <WTCONDITION expr="PARAM(Available)" oper="greater-equal" value="CONST(1)"/>
                <WTCLICK>NewBarterOption(2)</WTCLICK>
              </WTBUTTON>
              <WTSTATIC label="NotAvailable" fontsize="3" fontcolor="red">
                <WTCONDITION expr="PARAM(Available)" oper="less" value="CONST(1)"/>
              </WTSTATIC>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>
        
        <WTROW margin-bottom="6">
          <WTCONDITION expr="_NotBarterOption_Images+"/>
          <WTSTATIC col="1" class="PageHeader" align="center">
            <WTCODEGROUP><WTIMAGE value="CONST(Feature_Images.gif)" alt="Feature_Title" imgalign="absmiddle"/></WTCODEGROUP>
            <WTSTATIC space="1"/>
            <WTSTATIC label="OptionImages" bold="true" fontsize="3" newline="1"/>
            <WTSTATIC label="OptionImages2"/>
          </WTSTATIC>
          <WTSTATIC col="2" class="PageHeading" align="center" fontsize="2">
            <WTSTATIC>
              <WTSTATIC label="Enabled" fontsize="4">
                <WTCONDITION expr="_IsBarterOption_Images"/>
              </WTSTATIC>
              <WTCODEGROUP>
                <WTCONDITION expr="_NotBarterOption_Images"/>
                <WTBUTTON value="CONST(AddFeature)">
                  <WTCONDITION expr="PARAM(Available)" oper="greater-equal" value="CONST(3)"/>
                  <WTCLICK>NewBarterOption(3)</WTCLICK>
                </WTBUTTON>
                <WTSTATIC label="NotAvailable" fontsize="3" fontcolor="red">
                  <WTCONDITION expr="PARAM(Available)" oper="less" value="CONST(3)"/>
                </WTSTATIC>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTSTATIC>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" class="PageHeader" align="center">
            <WTCODEGROUP><WTIMAGE value="CONST(Feature_Images2.gif)" alt="Feature_Title" imgalign="absmiddle"/></WTCODEGROUP>
            <WTSTATIC space="1"/>
            <WTSTATIC label="OptionImages+" bold="true" fontsize="3" newline="1"/>
            <WTSTATIC label="OptionImages+2"/>
          </WTSTATIC>
          <WTSTATIC col="2" class="PageHeading" align="center" fontsize="2">
            <WTSTATIC>
              <WTSTATIC label="Enabled" fontsize="4">
                <WTCONDITION expr="_IsBarterOption_Images+"/>
              </WTSTATIC>
              <WTCODEGROUP>
                <WTCONDITION expr="_NotBarterOption_Images+"/>
                <WTBUTTON value="CONST(AddFeature)">
                  <WTCONDITION expr="PARAM(Available)" oper="greater-equal" value="CONST(5)"/>
                  <WTCLICK>NewBarterOption(4)</WTCLICK>
                </WTBUTTON>
                <WTSTATIC label="NotAvailable" fontsize="3" fontcolor="red">
                  <WTCONDITION expr="PARAM(Available)" oper="less" value="CONST(5)"/>
                </WTSTATIC>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTSTATIC>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" class="PageHeader" align="center">
            <WTCODEGROUP><WTIMAGE value="CONST(Feature_Editor.gif)" alt="Feature_Title" imgalign="absmiddle"/></WTCODEGROUP>
            <WTSTATIC space="1"/>
            <WTSTATIC label="OptionEditor" bold="true" fontsize="3" newline="1"/>
            <WTSTATIC label="OptionEditor2"/>
          </WTSTATIC>
          <WTSTATIC col="2" class="PageHeading" align="center" fontsize="2">
            <WTSTATIC>
              <WTSTATIC label="Enabled" fontsize="4">
                <WTCONDITION expr="_IsBarterOption_Editor"/>
              </WTSTATIC>
              <WTCODEGROUP>
                <WTCONDITION expr="_NotBarterOption_Editor"/>
                <WTBUTTON value="CONST(AddFeature)">
                  <WTCONDITION expr="PARAM(Available)" oper="greater-equal" value="CONST(3)"/>
                  <WTCLICK>NewBarterOption(5)</WTCLICK>
                </WTBUTTON>
                <WTSTATIC label="NotAvailable" fontsize="3" fontcolor="red">
                  <WTCONDITION expr="PARAM(Available)" oper="less" value="CONST(3)"/>
                </WTSTATIC>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTSTATIC>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" class="PageHeader" align="center">
            <WTCODEGROUP><WTIMAGE value="CONST(Feature_Long.gif)" alt="Feature_Title" imgalign="absmiddle"/></WTCODEGROUP>
            <WTSTATIC space="1"/>
            <WTSTATIC label="OptionLong" bold="true" fontsize="3" newline="1"/>
            <WTSTATIC label="OptionLong2"/>
          </WTSTATIC>
          <WTSTATIC col="2" class="PageHeading" align="center" fontsize="2">
            <WTSTATIC>
              <WTSTATIC label="Enabled" fontsize="4">
                <WTCONDITION expr="_IsBarterOption_Long"/>
              </WTSTATIC>
              <WTCODEGROUP>
                <WTCONDITION expr="_NotBarterOption_Long"/>
                <WTBUTTON value="CONST(AddFeature)">
                  <WTCONDITION expr="PARAM(Available)" oper="greater-equal" value="CONST(5)"/>
                  <WTCLICK>NewBarterOption(6)</WTCLICK>
                </WTBUTTON>
                <WTSTATIC label="NotAvailable" fontsize="3" fontcolor="red">
                  <WTCONDITION expr="PARAM(Available)" oper="less" value="CONST(5)"/>
                </WTSTATIC>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTSTATIC>
        </WTROW>
<!--
        <WTROW margin-bottom="6">
          <WTSTATIC col="1" class="PageHeader" align="center">
            <WTSTATIC label="OptionListing" bold="true" fontsize="3" newline="1"/>
            <WTSTATIC label="OptionListing2"/>
          </WTSTATIC>
          <WTSTATIC col="2" class="PageHeading" align="center" fontsize="2">
            <WTSTATIC>
              <WTSTATIC label="Enabled" fontsize="4">
                <WTCONDITION expr="_IsBarterOption_Listing"/>
              </WTSTATIC>
              <WTCODEGROUP>
                <WTCONDITION expr="_NotBarterOption_Listing"/>
                <WTBUTTON value="CONST(AddFeature)">
                  <WTCONDITION expr="PARAM(Available)" oper="greater-equal" value="CONST(5)"/>
                  <WTCLICK>NewBarterOption(7)</WTCLICK>
                </WTBUTTON>
                <WTSTATIC label="NotAvailable" fontsize="3" fontcolor="red">
                  <WTCONDITION expr="PARAM(Available)" oper="less" value="CONST(5)"/>
                </WTSTATIC>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTSTATIC>
        </WTROW>
-->
        <WTROW margin-bottom="6">
          <WTCONDITION expr="_NotBarterOption_Title"/>
          <WTCONDITION expr="_NotBarterOption_Images" connector="and"/>
          <WTCONDITION expr="_NotBarterOption_Editor" connector="and"/>
          <WTSTATIC col="1" class="PageHeader" align="center">
            <WTSTATIC label="OptionBundle1" bold="true" fontsize="3" newline="1"/>
            <WTSTATIC label="OptionBundle12"/>
          </WTSTATIC>
          <WTSTATIC col="2" class="PageHeading" align="center" fontsize="2">
            <WTCODEGROUP>
              <WTBUTTON value="CONST(AddFeature)">
                <WTCONDITION expr="PARAM(Available)" oper="greater-equal" value="CONST(5)"/>
                <WTCLICK>NewBarterOption(8)</WTCLICK>
              </WTBUTTON>
              <WTSTATIC label="NotAvailable" fontsize="3" fontcolor="red">
                <WTCONDITION expr="PARAM(Available)" oper="less" value="CONST(5)"/>
              </WTSTATIC>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTCONDITION expr="_NotBarterOption_Title"/>
          <WTCONDITION expr="_NotBarterOption_Images+" connector="and"/>
          <WTCONDITION expr="_NotBarterOption_Editor" connector="and"/>
          <WTCONDITION expr="_NotBarterOption_Long" connector="and"/>
          <WTSTATIC col="1" class="PageHeader" align="center">
            <WTSTATIC label="OptionBundle2" bold="true" fontsize="3" newline="1"/>
            <WTSTATIC label="OptionBundle22"/>
          </WTSTATIC>
          <WTSTATIC col="2" class="PageHeading" align="center" fontsize="2">
            <WTCODEGROUP>
              <WTBUTTON value="CONST(AddFeature)">
                <WTCONDITION expr="PARAM(Available)" oper="greater-equal" value="CONST(10)"/>
                <WTCLICK>NewBarterOption(9)</WTCLICK>
              </WTBUTTON>
              <WTSTATIC label="NotAvailable" fontsize="3" fontcolor="red">
                <WTCONDITION expr="PARAM(Available)" oper="less" value="CONST(10)"/>
              </WTSTATIC>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>

        <WTROW margin-top="12" margin-bottom="12">
          <WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
            <WTCLICK>window.opener.UpdateImages();window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================-->
    <WTWEBPAGE name="17405" audit="?/?" caption="Credit Tranfer" header="false" footer="false" navbar="false" wrapper="wrapper600"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl">
      <!--==================================================================-->
      <WTPARAM name="OwnerType" datatype="number"/>
      <WTPARAM name="OwnerID" datatype="number"/>
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="ConsumerName" datatype="text"/>
      <WTPARAM name="Available" datatype="currency"/>
      <WTPARAM name="Txn" datatype="number"/>
      <WTPARAM name="TransferAmount" datatype="currency"/>
      <WTPARAM name="TransferNote" datatype="text"/>

      <WTINCLUDE name="IP.asp"/>

      <WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="IsMemberOnly"/>
          <WTCONDITION expr="PARAM(OwnerID)" oper="not-equal" value="SYS(MemberID)" connector="and"/>
          <WTCUSTOM>AbortUser()</WTCUSTOM>
        </WTCODEGROUP>
      </WTCODEGROUP>

      <WTSUB name="GetAvailable">
        <WTOBJECT name="BarterCredit" project="ptsBarterCreditUser" class="CBarterCredit">
          <WTMETHOD name="Total">
            <WTPARAM name="OwnerType" direction="input" value="PARAM(OwnerType)"/>
            <WTPARAM name="OwnerID" direction="input" value="PARAM(OwnerID)"/>
            <WTPARAM name="Result" direction="return" datatype="text"/>
          </WTMETHOD>
          <WTCODEGROUP>
            <WTCUSTOM>
              a = Split(Result, ";")
              reqAvailable = a(0)
            </WTCUSTOM>
          </WTCODEGROUP>
        </WTOBJECT>
      </WTSUB>

      <WTSUB name="NewTransfer">
        <WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(&quot;&quot;)"/>
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)" />
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(ConsumerName)" value="CONST(TRIM(.NameFirst + &quot; &quot; + .NameLast))"/>
          <WTSETATTRIBUTE name="PARAM(Txn)" value="CONST(3)">
            <WTCONDITION expr="PARAM(ConsumerName)" oper="equal" value="CONST(&quot;&quot;)" />
          </WTSETATTRIBUTE>
        </WTOBJECT>
        <WTCALLSUB name="GetAvailable"/>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="NewTransfer"/>
      </WTACTION>

      <WTACTION id="2" name="Add" type="Add">
        <WTCALLSUB name="GetAvailable"/>
        <WTSETATTRIBUTE name="PARAM(Txn)" value="CONST(0)"/>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(ConsumerID)" oper="equal" value="CONST(0)" />
          <WTSETATTRIBUTE name="PARAM(Txn)" value="CONST(1)"/>
          <WTCALLSUB name="NewTransfer"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(0)" />
          <WTCONDITION expr="CONST(IsNumeric(reqTransferAmount))" oper="equal" value="CONST(0)" connector="and"/>
          <WTSETATTRIBUTE name="PARAM(Txn)" value="CONST(2)"/>
          <WTCALLSUB name="NewTransfer"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(0)" />
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(CCUR(reqTransferAmount))" oper="greater" value="CONST(CCUR(reqAvailable))" />
            <WTCONDITION expr="CONST(CCUR(reqTransferAmount))" oper="less-equal" value="CONST(0)" connector="or"/>
            <WTSETATTRIBUTE name="PARAM(Txn)" value="CONST(2)"/>
            <WTCALLSUB name="NewTransfer"/>
          </WTCODEGROUP>
        </WTCODEGROUP>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(0)" />
          <WTSETATTRIBUTE name="PARAM(TransferNote)" value="CONST(Left(reqTransferNote,500))"/>

          <WTOBJECT name="BarterCredit" project="ptsBarterCreditUser" class="CBarterCredit">
            <WTMETHOD name="Load">
              <WTPARAM name="BarterCreditID" direction="input" value="CONST(0)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="ATTR(OwnerType)" value="PARAM(OwnerType)"/>
            <WTSETATTRIBUTE name="ATTR(OwnerID)" value="PARAM(OwnerID)"/>
            <WTSETATTRIBUTE name="ATTR(BarterAdID)" value="CONST(0)"/>
            <WTSETATTRIBUTE name="ATTR(CreditDate)" value="SYS(date)"/>
            <WTSETATTRIBUTE name="ATTR(Amount)" value="CONST(CCUR(reqTransferAmount) * -1)"/>
            <WTSETATTRIBUTE name="ATTR(Status)" value="CONST(1)"/>
            <WTSETATTRIBUTE name="ATTR(CreditType)" value="CONST(99)"/>
            <WTSETATTRIBUTE name="ATTR(Reference)" value="CONST(CSTR(reqConsumerID) + &quot;-&quot; + CSTR(reqSysUserID))"/>
            <WTCUSTOM>
              IP = Request.ServerVariables("REMOTE_ADDR")
              tmpLocation = GetIPCity( IP )
            </WTCUSTOM>
            <WTSETATTRIBUTE name="ATTR(Notes)" value="CONST(Left(reqTransferNote + &quot; &quot; + IP + &quot; &quot; + tmpLocation, 500) )"/>
            <WTMETHOD name="Add">
              <WTPARAM name="BarterCreditID" direction="return" datatype="number"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="ATTR(OwnerType)" value="ENTITY(Consumer)"/>
            <WTSETATTRIBUTE name="ATTR(OwnerID)" value="PARAM(ConsumerID)"/>
            <WTSETATTRIBUTE name="ATTR(Amount)" value="CONST(CCUR(reqTransferAmount))"/>
            <WTSETATTRIBUTE name="ATTR(Reference)" value="CONST(CSTR(reqOwnerType) + &quot;-&quot; + CSTR(reqOwnerID))"/>
            <WTMETHOD name="Add">
              <WTPARAM name="BarterCreditID" direction="return" datatype="number"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTOBJECT>
        </WTCODEGROUP>

        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
          <WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(0)" connector="and"/>
        </WTRETURN>

      </WTACTION>

      <WTACTION id="3" name="Cancel" type="Cancel">
        <WTRETURN/>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="50" align="right"/>
        <WTCOLUMN width="500" align="left"/>
        <WTCOLUMN width="50" align="left"/>

        <WTROW>
          <WTHIDDEN value="PARAM(Available)"/>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" merge="3" align="center" class="PageHeading">
            <WTSTATIC label="BarterCredits" space="3"/>
            <WTSTATIC tag="Available" value="PARAM(Available)"/>
          </WTSTATIC>
        </WTROW>
        <WTROW margin-bottom="12">
          <WTSTATIC col="1"/>
          <WTSTATIC col="2" merge="2" align="left" class="prompt">
            <WTSTATIC label="TransferText"/>
          </WTSTATIC>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1"/>
          <WTSTATIC col="2" align="center" class="PageHeading">
            <WTSTATIC tag="TransferTo" value="PARAM(ConsumerName)"/>
            <WTCODEGROUP>
              <WTSTATIC value="#"/>
              <WTTEXT value="PARAM(ConsumerID)" size="4"/>
              <WTSTATIC space="1"/>
              <WTBUTTON action="0" value="CONST(ViewConsumer)" btnclass="smbutton"/>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(1)"/>
          <WTSTATIC col="1" merge="3" label="NoConsumerSelected" align="center" class="PageHeading" fontcolor="red"/>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(2)"/>
          <WTSTATIC col="1" merge="3" label="WrongTransferAmount" align="center" class="PageHeading" fontcolor="red"/>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(3)"/>
          <WTSTATIC col="1" merge="3" label="InvalidConsumerSelected" align="center" class="PageHeading" fontcolor="red"/>
        </WTROW>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(ConsumerName)" oper="not-equal" value="CONST('')"/>
          <WTROW margin-top="12" margin-bottom="12">
            <WTSTATIC col="1"/>
            <WTSTATIC col="2" align="center">
              <WTSTATIC tag="TransferAmount" bold="true"/>
              <WTCODEGROUP>
                <WTTEXT value="PARAM(TransferAmount)" size="5"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
          <WTROW>
            <WTSTATIC col="1"/>
            <WTSTATIC col="2" tag="TransferNote" align="center" bold="true"/>
          </WTROW>
          <WTROW>
            <WTSTATIC col="1"/>
            <WTMEMO col="2" align="center" value="PARAM(TransferNote)" cols="50" rows="2"/>
          </WTROW>
        </WTCODEGROUP>

        <WTROW margin-bottom="12" margin-top="12">
          <WTBUTTON col="1" merge="3" action="2" value="CONST(Submit)" align="center" msg="ConfirmTransfer">
            <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
          </WTBUTTON>
          <WTBUTTON col="1" merge="3" action="3" value="CONST(Cancel)"/>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

  </WTWEBPAGES>
</WTROOT>