<WTROOT prefix="pts" dbo="dbo" system="Pinnacle">
	<WTENTITY id="21" name="QuizQuestion" alias="qq" language="false" audit="false">

		<!--Identity-->
		<WTATTRIBUTE id="2101" name="QuizQuestionID" type="number" identity="true" min="1" required="true" title="true" source="entity"/>

		<!--Foreign Keys-->
		<WTATTRIBUTE id="2102" name="LessonID" type="number" source="entity" parent="true"/>
		
		<!-- Enumeration of all the choices, the ID stores the correct choice -->
		<WTATTRIBUTE id="2103" name="QuizChoiceID" type="number" source="entity">
			<WTLOOKUP entity="QuizChoice" class="QuizChoices" method="EnumUserQuizChoice" blankrow="false">
				<WTPARAM name="QuizQuestionID" direction="input" value="ATTR(QuizQuestionID)"/>
				<WTPARAM name="UserID" direction="input" value="SYS(userid)"/>
			</WTLOOKUP>
		</WTATTRIBUTE>

		<!--Foreign Table Fields-->

		<!--Attributes-->
		
		<WTATTRIBUTE id="2110" name="Question" type="text" length="2000" min="1" max="2000" source="entity"/>
		<WTATTRIBUTE id="2111" name="Explain" type="text" length="1000" min="1" max="1000" source="entity"/>
		<WTATTRIBUTE id="2112" name="Points" type="number" source="entity"/>
		<WTATTRIBUTE id="2113" name="IsRandom" type="yesno" source="entity"/>
		<WTATTRIBUTE id="2114" name="Seq" type="number" source="entity" seq="10"/>
		<WTATTRIBUTE id="2115" name="MediaType" type="number" source="entity">
			<WTENUM id="1" name="Image"/>
			<WTENUM id="2" name="Video"/>
			<WTENUM id="3" name="Audio"/>
		</WTATTRIBUTE>
		<WTATTRIBUTE id="2116" name="MediaFile" type="text" length="80" min="1" max="80" source="entity" language="false"/>
		
		<!--Indexes-->
		<WTINDEX name="LessonID">
			<WTATTRIBUTE name="LessonID"/>
		</WTINDEX>

		<!--Relationships-->
		<WTRELATIONSHIPS>
			<WTRELATIONSHIP name="QuizQuestion" entity="QuizQuestion" alias="qq"/>
			<WTRELATIONSHIP name="Common" entity="QuizQuestion" alias="qq">
				<WTENTITY name="QuizChoice" entity="QuizChoice" alias="qc">
					<WTATTRIBUTE alias="qq" name="QuizQuestionID" relalias="qc" relname="QuizQuestionID"/>
				</WTENTITY>
			</WTRELATIONSHIP>
		</WTRELATIONSHIPS>

		<!--Parent-->

		<!--List-->

	</WTENTITY>

	<WTPROCEDURES>
		<!--==================================================================-->
		<WTPROCEDURE type="Add" name="Add" style="GenerateDataProc.xsl"/>
		<!--==================================================================-->
		<WTPROCEDURE type="Delete" name="Delete" style="GenerateDataProc.xsl"/>
		<!--==================================================================-->
		<WTPROCEDURE type="Fetch" name="Fetch" style="GenerateDataProc.xsl">
			<WTJOIN name="Common"/>
		</WTPROCEDURE>
		<!--==================================================================-->
		<WTPROCEDURE type="Update" name="Update" style="GenerateDataProc.xsl"/>
		<!--==================================================================-->
		<WTPROCEDURE type="List" name="ListQuizQuestion" style="GenerateDataProc.xsl" template="new" passthru="true">
			<WTPARAM name="ATTR(LessonID)" direction="input"/>
			<WTPARAM name="SYS(userid)" direction="input"/>
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE value="ATTR(QuizQuestion.QuizQuestionID)"/>
					<WTATTRIBUTE value="ATTR(QuizQuestion.LessonID)"/>
					<WTATTRIBUTE value="ATTR(QuizQuestion.QuizChoiceID)"/>
					<WTATTRIBUTE value="ATTR(QuizQuestion.Question)"/>
					<WTATTRIBUTE value="ATTR(QuizQuestion.Explain)"/>
					<WTATTRIBUTE value="ATTR(QuizQuestion.Points)"/>
					<WTATTRIBUTE value="ATTR(QuizQuestion.IsRandom)"/>
					<WTATTRIBUTE value="ATTR(QuizQuestion.Seq)"/>
					<WTATTRIBUTE value="ATTR(QuizQuestion.MediaType)"/>
					<WTATTRIBUTE value="ATTR(QuizQuestion.MediaFile)"/>
					<WTJOIN name="QuizQuestion"/>
					<WTCONDITION expr="ATTR(QuizQuestion.LessonID)" oper="equal" value="PARAM(LessonID)"/>
					<WTORDER name="ATTR(QuizQuestion.Seq)"/>
				</WTSELECT>
			</WTCODEGROUP>
		</WTPROCEDURE>

	</WTPROCEDURES>

	<WTWEBPAGES>
		<!--===============================================================================-->
		<WTWEBPAGE name="2102" caption="QuizQuestion" aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" secured="31">
		<!--===============================================================================-->
			<WTPARAM name="LessonID" datatype="number"/>
			<WTPARAM name="LessonName" datatype="text"/>
			
			<WTACTION name="New" type="New" id="0">
				<WTOBJECT name="QuizQuestion" project="ptsQuizQuestionUser" class="CQuizQuestion">
					<WTMETHOD name="Load">
						<WTPARAM name="QuizQuestionID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(LessonID)" value="PARAM(LessonID)"/>
					<WTSETATTRIBUTE name="ATTR(Points)" value="CONST(10)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlQuizQuestion" direction="return" datatype="text"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTACTION>
			
			<WTACTION name="Add" type="Add" id="1">
				<WTOBJECT name="QuizQuestion" project="ptsQuizQuestionUser" class="CQuizQuestion">
					<WTMETHOD name="Load">
						<WTPARAM name="QuizQuestionID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTES/>
					<WTSETATTRIBUTE name="ATTR(LessonID)" value="PARAM(LessonID)"/>
					<WTMETHOD name="Add">
						<WTPARAM name="QuizQuestionID" direction="return" datatype="number"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(tmpQuizQuestionID)" value="ATTR(QuizQuestion.QuizQuestionID)"/>
					<WTMETHOD name="XML">
						<WTCONDITION expr="IsErrors"/>
						<WTPARAM name="xmlQuizQuestions" direction="return" datatype="text"/>
					</WTMETHOD>
				</WTOBJECT>

				<WTOBJECT name="QuizChoice" project="ptsQuizChoiceUser" class="CQuizChoice">
					<WTSETATTRIBUTE name="ATTR(QuizQuestionID)" value="CONST(tmpQuizQuestionID)"/>
<WTCUSTOM>
			For x = 1 To 5
				s = trim(Request.Form.Item("Choice" &amp; x))
				If s &lt;&gt; "" Then
					.QuizChoiceText = s
					.Seq = x * 10
					QuizChoiceID = CLng(.Add(CLng(reqSysUserID)))
					If (Err.Number &lt;&gt; 0) Then DoError Err.Number, Err.Source, Err.Description End If
				End If
			Next
</WTCUSTOM>
				</WTOBJECT>
				
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
					<WTLINK name="2111" return="false">
						<WTPARAM name="LessonID" value="PARAM(LessonID)"/>
						<WTPARAM name="LessonName" value="PARAM(LessonName)"/>
					</WTLINK>
				</WTRETURN>
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="160" align="right"/>
				<WTCOLUMN width="440" align="left"/>

				<WTROW>
					<WTSTATIC col="1" merge="2" label="QuizQuestion" class="PageHeading" align="left"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" merge="2" label="NewQuizQuestionText" align="left" class="Prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" merge="2" align="left" tag="Question" valign="top"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTMEMO col="1" merge="2" value="ATTR(QuizQuestion.Question)" rows="4" cols="72" focus="true"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" merge="2" label="ChoiceText" align="left" class="Prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Choice1"/>
					<WTTEXT col="2" name="Choice1" size="60"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Choice2"/>
					<WTTEXT col="2" name="Choice2" size="60"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Choice3"/>
					<WTTEXT col="2" name="Choice3" size="60"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Choice4"/>
					<WTTEXT col="2" name="Choice4" size="60"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Choice5"/>
					<WTTEXT col="2" name="Choice5" size="60"/>
				</WTROW>
				<WTROW margin-top="6" margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" merge="2" align="left" tag="Explain" valign="top"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTMEMO col="1" merge="2" value="ATTR(QuizQuestion.Explain)" rows="4" cols="72"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" merge="2" label="RandomText" align="left" class="Prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1"/>
					<WTCHECK col="2" value="ATTR(QuizQuestion.IsRandom)"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Points"/>
					<WTTEXT col="2" value="ATTR(QuizQuestion.Points)" size="2"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Seq"/>
					<WTTEXT col="2" value="ATTR(QuizQuestion.Seq)" size="2"/>
				</WTROW>
			
				<WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" merge="2" action="1" value="CONST(Add)" align="center"/>
					<WTBUTTON col="1" merge="2" action="3" value="CONST(Return)" align="center"/>
				</WTROW>
				
			</WTCONTENT>
		</WTWEBPAGE>
		<!--===============================================================================-->
		<WTWEBPAGE name="2103" caption="QuizQuestion" aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" secured="31">
		<!--===============================================================================-->
			<WTPARAM name="QuizQuestionID" datatype="number"/>
			<WTPARAM name="UploadMediaFile" datatype="text"/>
			
			<WTCODEGROUP>
				<WTCONDITION expr="PARAM(UploadMediaFile)" oper="not-equal" value="&quot;&quot;"/>
				<WTOBJECT name="QuizQuestion" project="ptsQuizQuestionUser" class="CQuizQuestion">
					<WTMETHOD name="Load">
						<WTPARAM name="QuizQuestionID" direction="input" value="PARAM(QuizQuestionID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
						<WTSETATTRIBUTE name="ATTR(MediaFile)" value="PARAM(UploadMediaFile)"/>
						<WTMETHOD name="Save">
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
				</WTOBJECT>
			</WTCODEGROUP>

			<WTSUB name="UpdateQuizQuestion">
				<WTOBJECT name="QuizQuestion" project="ptsQuizQuestionUser" class="CQuizQuestion">
					<WTMETHOD name="Load">
						<WTPARAM name="QuizQuestionID" direction="input" value="PARAM(QuizQuestionID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTES/>
					<WTMETHOD name="Save">
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="XML">
						<WTCONDITION expr="IsErrors"/>
						<WTPARAM name="xmlQuizQuestion" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTACTION name="New" type="New" id="0">
				<WTOBJECT name="QuizQuestion" project="ptsQuizQuestionUser" class="CQuizQuestion">
					<WTMETHOD name="Load">
						<WTPARAM name="QuizQuestionID" direction="input" value="PARAM(QuizQuestionID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlQuizQuestion" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTACTION>
			
			<WTACTION name="Update" type="Update" id="1">
				<WTCALLSUB name="UpdateQuizQuestion"/>
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
				</WTRETURN>
			</WTACTION>

			<WTACTION id="6" name="UploadMedia" type="Upload">
				<WTCALLSUB name="UpdateQuizQuestion"/>
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
					<WTLINK name="2120" return="false">
						<WTPARAM name="QuizQuestionID" value="PARAM(QuizQuestionID)"/>
					</WTLINK>
				</WTRETURN>
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="4" name="Delete" type="Delete">
				<WTOBJECT name="QuizQuestion" project="ptsQuizQuestionUser" class="CQuizQuestion">
					<WTMETHOD name="Delete">
						<WTPARAM name="QuizQuestionID" direction="input" value="PARAM(QuizQuestionID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="QuizQuestion" project="ptsQuizQuestionUser" class="CQuizQuestion">
					<WTCONDITION expr="IsErrors"/>
					<WTMETHOD name="Load">
						<WTPARAM name="QuizQuestionID" direction="input" value="PARAM(QuizQuestionID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlQuizQuestion" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
				</WTRETURN>
			</WTACTION>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="160" align="right"/>
				<WTCOLUMN width="440" align="left"/>

				<WTROW>
					<WTSTATIC col="1" merge="2" label="QuizQuestion" class="PageHeading" align="left"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" merge="2" label="EditQuizQuestionText" align="left" class="Prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>

				<WTROW>
					<WTSTATIC col="1" merge="2" align="left" tag="Question" valign="top"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTMEMO col="1" merge="2" value="ATTR(QuizQuestion.Question)" rows="4" cols="72"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" merge="2" align="left" tag="Explain" valign="top"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTMEMO col="1" merge="2" value="ATTR(QuizQuestion.Explain)" rows="4" cols="72"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" merge="2" label="RandomText" align="left" class="Prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1"/>
					<WTCHECK col="2" value="ATTR(QuizQuestion.IsRandom)"/>
					<WTIMAGE col="2" value="CONST(QuestionMarksm.gif)" imgalign="absmiddle"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Points"/>
					<WTTEXT col="2" value="ATTR(QuizQuestion.Points)" size="2"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Seq"/>
					<WTTEXT col="2" value="ATTR(QuizQuestion.Seq)" size="2"/>
				</WTROW>
				
				<WTROW margin-top="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-top="6">
					<WTSTATIC col="1" merge="2" label="MediaText" align="left" class="Prompt"/>
				</WTROW>
				<WTROW margin-top="6">
					<WTSTATIC col="1" tag="MediaType"/>
					<WTCOMBO col="2" value="ATTR(QuizQuestion.MediaType)"/>
					<WTBUTTON col="2" action="6" value="CONST(Upload)"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="MediaFile"/>
					<WTTEXT col="2" value="ATTR(QuizQuestion.MediaFile)" size="60"/>
				</WTROW>
				<WTROW margin-top="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>

				<WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" merge="2" action="1" value="CONST(Update)" align="center">
						<WTCONDITION expr="IsActive"/>
					</WTBUTTON>
					<WTBUTTON col="1" merge="2" action="3" value="CONST(Return)" align="center"/>
					<WTBUTTON col="1" merge="2" action="4" value="CONST(Delete)" msg="ConfirmDelete" align="center">
						<WTCONDITION expr="IsActive"/>
					</WTBUTTON>
				</WTROW>
				
			</WTCONTENT>
		</WTWEBPAGE>

		<!--===============================================================================-->
		<WTWEBPAGE name="2111" caption="Quiz" focus="false" aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" secured="52">
		<!--===============================================================================-->
			<WTPARAM name="LessonID" datatype="number"/>
			<WTPARAM name="SessionID" datatype="number"/>
			<WTPARAM name="CourseID" datatype="number"/>
			
			<WTSUB name="LoadQuiz">
				<WTOBJECT name="Lesson" project="ptsLessonUser" class="CLesson">
					<WTMETHOD name="Load">
						<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(CourseID)" value="ATTR(CourseID)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlLesson" direction="return" datatype="text"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="QuizQuestions" project="ptsQuizQuestionUser" class="CQuizQuestions">
					<WTMETHOD name="ListQuizQuestion">
						<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlQuizQuestions" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(1111)"/>
					</WTMETHOD>
 <!-- the data for the quiz choices is pulled as an enum, so the "selection" is actually the correct answer.
		for the purposes of configuring the correct answer, this needs to be pulled back as:
			selected="on"
		instead of
			selected="True" -->
<WTCUSTOM>
					xmlQuizQuestions = Replace(xmlQuizQuestions, "selected=""True", "selected=""on")
</WTCUSTOM> 
				</WTOBJECT>
				<WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
					<WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(CStr(reqLessonID) + &quot;q.htm&quot;)"/>
					<WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\Course\&quot; &amp; CStr(reqCourseID))"/>
					<WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)"/>
					<WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)"/>
					<WTMETHOD name="Load"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlHTMLFile" direction="return" datatype="text"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>
			
			<WTACTION name="New" type="New" id="0">
				<WTCALLSUB name="LoadQuiz"/>
			</WTACTION>
			
<!-- TODO: create a better interface for selecting the correct answer to a question -->			
			<WTACTION name="Save" type="Save" id="2">		
				<WTOBJECT name="QuizQuestions" project="ptsQuizQuestionUser" class="CQuizQuestions">
					<WTMETHOD name="ListQuizQuestion">
						<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>	
	<WTCUSTOM>
					For Each oQuizQuestion in oQuizQuestions
						With oQuizQuestion
							tmpID = Request.Form.Item(.QuizQuestionID)
							tmpSeq = Request.Form.Item( "S" + .QuizQuestionID )
							If tmpID &gt; 0 OR tmpSeq &lt;&gt; .Seq Then
								If .IsRandom = "-1" Then .IsRandom = "1"
								.QuizChoiceID = tmpID
								.Seq = tmpSeq
								.Save CLng(reqSysUserID)
							End If
							If (Err.Number &lt;&gt; 0) Then DoError Err.Number, Err.Source, Err.Description End If
						End With
					Next
	</WTCUSTOM>
				</WTOBJECT>
				<WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
					<WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(CStr(reqLessonID) + &quot;q.htm&quot;)"/>
					<WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\Course\&quot; &amp; CStr(reqCourseID))"/>
					<WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)"/>
					<WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)"/>
					<WTSETATTRIBUTE name="ATTR(Data)" value="FORM(Data)"/>
					<WTMETHOD name="Save"/>
				</WTOBJECT>
				<WTCALLSUB name="LoadQuiz"/>
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="4" name="QuizIntro" type="Update">
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
					<WTLINK name="2113" skipreturn="true">
						<WTPARAM name="LessonID" value="PARAM(LessonID)"/>
						<WTPARAM name="CourseID" value="PARAM(CourseID)"/>
					</WTLINK>
				</WTRETURN>
			</WTACTION>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="50" align="left"/>
				<WTCOLUMN width="550" align="left"/>

				<WTROW>
					<WTHIDDEN value="PARAM(LessonID)"/>
					<WTHIDDEN value="PARAM(CourseID)"/>
				</WTROW>
				<WTROW>
					<WTTABLE col="1" merge="2">
						<WTCOLUMN width="300" align="left"/>
						<WTCOLUMN width="300" align="right"/>
						<WTROW>
							<WTSTATIC col="1" tag="Quiz" value="ATTR(Lesson.LessonName)" class="PageHeading">
								<WTLINK name="2303" return="false" nodata="true">
									<WTPARAM name="LessonID" value="PARAM(LessonID)"/>
								</WTLINK>
							</WTSTATIC>
							<WTLINKGROUP  col="2" align="right" >
								<WTLINK name="2102" label="NewQuizQuestion" class="PageHeadingLink" nodata="true"><WTPARAM name="LessonID" value="PARAM(LessonID)"/></WTLINK>
							</WTLINKGROUP>
						</WTROW>
					</WTTABLE>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTROW margin-bottom="6">				
					<WTBUTTON col="1" merge="2" action="2" value="CONST(Update)" align="center" btnclass="smbutton"/>
					<WTBUTTON col="1" merge="2" action="3" value="CONST(Return)" align="center" btnclass="smbutton"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTCONDITION expr="CONST(count(/DATA/TXN/PTSQUIZQUESTIONS/PTSQUIZQUESTION))" oper="equal" value="CONST(0)"/>
					<WTSTATIC col="1" merge="2" label="NoQuestions" class="Prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTCONDITION expr="CONST(count(/DATA/TXN/PTSQUIZQUESTIONS/PTSQUIZQUESTION))" oper="greater" value="CONST(0)"/>
					<WTSTATIC col="1" merge="2" label="QuizHelpEmployee" class="Prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" merge="2" label="QuizIntro" align="center" class="PageHeading"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTMEMO col="1" merge="2" value="ATTR(HTMLFile.Data)" rows="5" cols="70" htmleditor="editor_simple" embedhtml="true"/>
				</WTROW>
				<WTROW margin-bottom="12">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				
				<WTROW margin-bottom="6">
					<WTREPEAT xpath="/DATA/TXN/PTSQUIZQUESTIONS/PTSQUIZQUESTION[position()]">
						<WTROW>
							<WTCONDITION expr="DATA(MediaType)" oper="equal" value="CONST(1)"/>
							<WTSTATIC col="1"/>
							<WTIMAGE col="2" value="DATA(MediaFile)" imgpath="Sections\Course\&lt;xsl:value-of select=&quot;/DATA/PARAM/@courseid&quot;/&gt;\"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" merge="2">
								<WTCODEGROUP>
									<WTTEXT name="S&lt;xsl:value-of select=&quot;@quizquestionid&quot;/&gt;" value="CONST(&lt;xsl:value-of select=&quot;@seq&quot;/&gt;)" size="1"/>
									<WTSTATIC space="1"/>
								</WTCODEGROUP>

								<WTCODEGROUP>
									<WTCONDITION expr="DATA(IsRandom)" oper="not-equal" value="CONST(0)"/>
									<WTIMAGE value="CONST(QuestionMarksm.gif)" imgalign="absmiddle"/>
								</WTCODEGROUP>

								<WTSTATIC value="DATA(QuizQuestion.Question)" space="2">
									<WTLINK name="2103" nodata="true">
										<WTPARAM name="QuizQuestionID" value="DATA(QuizQuestion.QuizQuestionID)"/>
										<WTPARAM name="LessonID" value="PARAM(LessonID)"/>
									</WTLINK>
								</WTSTATIC>
								
								<WTCODEGROUP>
									<WTCONDITION expr="DATA(MediaType)" oper="greater" value="CONST(1)"/>
									<WTCODEGROUP>
										<WTCONDITION expr="CONST(contains)" value="CONST((@mediafile,':'))"/>
										<WTSTATIC label="PlayClip" space="2" bold="true">
											<WTLINK name="2431" target="Video" >
												<WTPARAM name="Video" value="DATA(QuizQuestion.MediaFile)"/>
											</WTLINK>
										</WTSTATIC>
									</WTCODEGROUP>
									<WTCODEGROUP>
										<WTCONDITION expr="CONST(not)" value="CONST((contains(@mediafile,':')))"/>
										<WTSTATIC label="PlayClip" space="2" bold="true">
											<WTLINK name="2431" target="Video" >
												<WTPARAM name="Video" value="Sections\Course\&lt;xsl:value-of select=&quot;concat(/DATA/PARAM/@courseid,'\',@mediafile)&quot;/&gt;"/>
											</WTLINK>
										</WTSTATIC>
									</WTCODEGROUP>
								</WTCODEGROUP>
								
								<WTSTATIC value="CONST( ()"/>
								<WTSTATIC value="DATA(QuizQuestion.Points)"/>
								<WTSTATIC value="CONST( pts))" space="1"/>

								<WTSTATIC value="CONST( ()"/>
								<WTSTATIC value="CONST(add choice)">
									<WTLINK name="2002" nodata="true">
										<WTPARAM name="QuizQuestionID" value="DATA(QuizQuestion.QuizQuestionID)"/>
										<WTPARAM name="LessonID" value="PARAM(LessonID)"/>
									</WTLINK>
								</WTSTATIC>
								<WTSTATIC value="CONST())"/>
							</WTSTATIC>
						</WTROW>
						<WTROW margin-bottom="12">				
							<WTREPEAT xpath="./PTSQUIZCHOICEIDS/ENUM[position()]">
								<WTROW>
									<WTSTATIC col="1"/>
<!--									<WTSTATIC col="2" id="&lt;xsl:value-of select=&quot;@id&quot;/&gt;text" prespace="false"/>-->
									<WTRADIO col="2" group="&lt;xsl:value-of select=&quot;../../@quizquestionid&quot;/&gt;" name="&lt;xsl:value-of select=&quot;@id&quot;/&gt;" value="DATA(@selected)"/>	
									<WTSTATIC col="2" value="DATA(name)">
										<WTLINK name="2003" nodata="true">
											<WTPARAM name="QuizChoiceID" value="DATA(ID)"/>
											<WTPARAM name="LessonID" value="PARAM(LessonID)"/>
										</WTLINK>
									</WTSTATIC>
								</WTROW>
														
							</WTREPEAT>		
						</WTROW>
						<WTROW margin-bottom="12">
							<WTSTATIC col="1"/>
							<WTSTATIC col="2" value="DATA(QuizQuestion.Explain)" class="prompt" bold="true"/>
						</WTROW>

					</WTREPEAT>
				</WTROW>				
				
				<WTROW margin-top="12" margin-bottom="12">				
					<WTBUTTON col="1" merge="2" action="2" value="CONST(Update)" align="center"/>
					<WTBUTTON col="1" merge="2" action="3" value="CONST(Return)" align="center"/>
				</WTROW>
				
			</WTCONTENT>
		</WTWEBPAGE>

		<!--===============================================================================-->
		<WTWEBPAGE name="2112" caption="Quiz" navbar="false" focus="false" 
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl">
		<!--===============================================================================-->
			<WTPARAM name="LessonID" datatype="number"/>
			<WTPARAM name="SessionID" datatype="number"/>
			<WTPARAM name="CourseID" datatype="number"/>
			<WTPARAM name="NextLessonID" datatype="number"/>
			<WTPARAM name="Grade" datatype="text"/>
			<WTPARAM name="Review" datatype="number"/>
			<WTPARAM name="TotalPoints" datatype="number"/>
			<WTPARAM name="PassingPoints" datatype="number"/>
			<WTPARAM name="YourGrade" datatype="number"/>
			<WTPARAM name="QuizLimit" datatype="number"/>
			<WTPARAM name="AutoQuiz" datatype="number"/>
			<WTPARAM name="ContentPage" datatype="number"/>
			<WTPARAM name="Popup" datatype="number"/>
			<WTPARAM name="Identify" datatype="number"/>
			<WTPARAM name="MemberID" datatype="number"/>
			<WTPARAM name="Lessons" datatype="text"/>

			<WTSUB name="LoadQuiz">
				<WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
					<WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(CStr(reqLessonID) + &quot;q.htm&quot;)"/>
					<WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\Course\&quot; &amp; CStr(reqCourseID))"/>
					<WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)"/>
					<WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)"/>
					<WTMETHOD name="Load"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlHTMLFile" direction="return" datatype="text"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Session" project="ptsSessionUser" class="CSession">
					<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="SessionID" direction="input" value="PARAM(SessionID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(QuizLimit)" value="ATTR(QuizLimit)"/>
					<WTSETATTRIBUTE name="CONST(tmpOrgCourseID)" value="ATTR(OrgCourseID)"/>
					<WTSETATTRIBUTE name="PARAM(MemberID)" value="ATTR(MemberID)"/>
				</WTOBJECT>
				<WTOBJECT name="Lesson" project="ptsLessonUser" class="CLesson">
					<WTMETHOD name="Load">
						<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(tmpPassingGrade)" value="ATTR(PassingGrade)"/>
					<WTSETATTRIBUTE name="CONST(tmpQuizWeight)" value="ATTR(QuizWeight)"/>
					<WTSETATTRIBUTE name="PARAM(QuizLimit)" value="CONST(0)">
						<WTCONDITION expr="ATTR(QuizWeight)" oper="equal" value="CONST(0)"/>
					</WTSETATTRIBUTE>
					<WTSETATTRIBUTE name="CONST(tmpQuizLength)" value="CONST(CLng(.QuizLength))"/>
					<WTSETATTRIBUTE name="CONST(curIsPassQuiz)" value="ATTR(IsPassQuiz)"/>
					<WTSETATTRIBUTE name="CONST(curQuiz)" value="ATTR(Quiz)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlLesson" direction="return" datatype="text"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="OrgCourse" project="ptsOrgCourseUser" class="COrgCourse">
					<WTCONDITION expr="CONST(tmpOrgCourseID)" oper="greater" value="CONST(0)"/>
					<WTCONDITION expr="CONST(tmpQuizWeight)" oper="greater" value="CONST(0)" connector="and"/>
					<WTMETHOD name="Load">
						<WTPARAM name="OrgCourseID" direction="input" value="CONST(tmpOrgCourseID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(QuizLimit)" value="ATTR(QuizLimit)">
						<WTCONDITION expr="ATTR(QuizLimit)" oper="greater" value="CONST(0)"/>
					</WTSETATTRIBUTE>
				</WTOBJECT>
				<WTOBJECT name="SessionLesson" project="ptsSessionLessonUser" class="CSessionLesson">
					<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
					<WTMETHOD name="GetSessionLesson">
						<WTPARAM name="SessionID" direction="input" value="PARAM(SessionID)"/>
						<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						<WTPARAM name="tmpSessionLessonID" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTMETHOD name="Load">
						<WTPARAM name="SessionLessonID" direction="input" value="CONST(tmpSessionLessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(reqYourGrade)" value="ATTR(QuizScore)"/>
					<WTSETATTRIBUTE name="CONST(curStatus)" value="ATTR(Status)"/>
					<WTSETATTRIBUTE name="CONST(tmpQuestions)" value="ATTR(Questions)"/>
				</WTOBJECT>
				<WTOBJECT name="SessionLessons" project="ptsSessionLessonUser" class="CSessionLessons">
					<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
					<WTMETHOD name="ListSession">
						<WTPARAM name="LessonID" direction="input" value="PARAM(CourseID)"/>
						<WTPARAM name="SessionID" direction="input" value="PARAM(SessionID)"/>
						<WTPARAM name="Lessons" direction="input" value="PARAM(Lessons)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
<WTCUSTOM>
					reqNextLessonID = 0
					curLesson = 0
					nextIsPassQuiz = 0
					For Each oSessionLesson in oSessionLessons
						With oSessionLesson
							If curLesson = 1 Then
								reqNextLessonID = .LessonID
								nextIsPassQuiz = .IsPassQuiz
								Exit For
							End If	
							If reqLessonID = Clng(.LessonID) Then curLesson = 1
						End With
					Next

					'NO NEXT LESSON if the next lesson requires a passed quiz AND this lesson has a quiz AND the quiz wasn't passed  
					If nextIsPassQuiz &lt;&gt; "0" AND curQuiz &gt; "1" AND curStatus &lt;&gt; "4" Then
						reqNextLessonID = 0
					End If
</WTCUSTOM>
					<!-- Only display lesson list if passed quiz is not required -->
					<WTMETHOD name="LessonXML">
						<WTCONDITION expr="CONST(curIsPassQuiz)" oper="equal" value="CONST(0)"/>
						<WTPARAM name="xmlSessionLessons" direction="return" datatype="text"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="QuizQuestions" project="ptsQuizQuestionUser" class="CQuizQuestions">
					<WTMETHOD name="ListQuizQuestion">
						<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
<WTCUSTOM>
					tmpSaveQuestions = 0
					'If the quiz has a specific number of questions AND we have none Then get the questions
					If tmpQuizLength &lt;&gt; 0 AND tmpQuestions = "" Then
						tmpSaveQuestions = 1
						tmpQuestions = "~"
						cnt = 0
						total = 0
						'Get all the non-random questions
						For Each oQuizQuestion in oQuizQuestions
							With oQuizQuestion
								If cnt &lt; tmpQuizLength AND .IsRandom = 0 Then
									'Make sure we don't exceed the storage for the question IDs
									If (Len(tmpQuestions) + Len(CStr(.QuizQuestionID)) + 1) &lt; 200 Then
										tmpQuestions = tmpQuestions + CStr(.QuizQuestionID) + "~"
										cnt = cnt + 1
										.Seq = cnt
									Else
										cnt = tmpQuizLength
										Response.write "Length of Quiz Questions exceeds storage capacity - see administrator"
									End If
								End If
							End With	
							total = total + 1
						Next
						'Make sure we have enough questions
						If tmpQuizLength &gt; total Then tmpQuizLength = total
						'If we still need more questions get the needed random questions
						While cnt &lt; tmpQuizLength
							'get a random number
							randomize
							random = Int((total * Rnd) + 1)
							With oQuizQuestions.Item(random)
								tmpQuizQuestionID = .QuizQuestionID
								tmpIsRandom = .IsRandom
								If tmpIsRandom &lt;&gt; 0 Then
									If InStr(tmpQuestions, "~" + CStr(tmpQuizQuestionID) + "~") = 0 Then
										'Make sure we don't exceed the storage for the question IDs
										If (Len(tmpQuestions) + Len(CStr(tmpQuizQuestionID)) + 1) &lt; 200 Then
											tmpQuestions = tmpQuestions + CStr(tmpQuizQuestionID) + "~"
											cnt = cnt + 1
											.Seq = cnt
										Else
											cnt = tmpQuizLength
											Response.write "Length of Quiz Questions exceeds storage capacity - see administrator"
										End If
									End If
								End If
							End With
						Wend
					End If

					reqTotalPoints = 0
					For Each oQuizQuestion in oQuizQuestions
						With oQuizQuestion
							If tmpQuizLength = 0 Then
								reqTotalPoints = reqTotalPoints + .Points
							Else
								'clear the name of the unused questions, otherwise get total points
								If InStr(tmpQuestions, "~" + CStr(.QuizQuestionID) + "~") = 0 Then
									.Question = ""
									.Explain = ""
									.MediaFile = ""
								Else
									reqTotalPoints = reqTotalPoints + .Points
								End If
							End If
						End With
					Next
					reqPassingPoints = Round( (tmpPassingGrade * reqTotalPoints) / 100 )
</WTCUSTOM> 
					<WTMETHOD name="XML">
						<WTPARAM name="xmlQuizQuestions" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(1111)"/>
					</WTMETHOD>
 <!-- the data for the quiz choices is pulled as an enum, so the "selection" is actually the correct answer.
		for the purposes of configuring the correct answer, this needs to be pulled back as:
			selected="on"  instead of  selected="True" -->
<WTCUSTOM>
					xmlQuizQuestions = Replace(xmlQuizQuestions, "selected=""True", "selected=""on")
</WTCUSTOM>
				</WTOBJECT>
				<!-- Save the questions if specified questions -->
				<WTOBJECT name="SessionLesson" project="ptsSessionLessonUser" class="CSessionLesson">
					<WTCONDITION expr="PARAM(SessionID)" oper="not-equal" value="CONST(0)"/>
					<WTCONDITION expr="CONST(tmpSaveQuestions)" oper="equal" value="CONST(1)" connector="and"/>
					<WTMETHOD name="Load">
						<WTPARAM name="SessionLessonID" direction="input" value="CONST(tmpSessionLessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(Questions)" value="CONST(tmpQuestions)"/>
					<WTMETHOD name="Save">
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="QuizAnswers" project="ptsQuizAnswerUser" class="CQuizAnswers">
					<WTCONDITION expr="PARAM(SessionID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="ListQuizAnswer">
						<WTPARAM name="SessionLessonID" direction="input" value="CONST(tmpSessionLessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>					
					<WTMETHOD name="ChoiceXML">
						<WTPARAM name="xmlQuizAnswers" direction="return" datatype="text"/>
					</WTMETHOD>
<WTCUSTOM>
					if Len(xmlQuizAnswers) &gt; 20 Then reqReview = 1
</WTCUSTOM> 
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="GradeQuiz">
				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
					<WTCONDITION expr="PARAM(Grade)" oper="equal" value="CONST(&quot;on&quot;)" connector="and"/>
					<WTOBJECT name="SessionLesson" project="ptsSessionLessonUser" class="CSessionLesson">
						<WTMETHOD name="GetSessionLesson">
							<WTPARAM name="SessionID" direction="input" value="PARAM(SessionID)"/>
							<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
							<WTPARAM name="tmpSessionLessonID" direction="return" datatype="number"/>
						</WTMETHOD>
					</WTOBJECT>
<!-- NOT USED
					<WTOBJECT name="QuizAnswers" project="ptsQuizAnswerUser" class="CQuizAnswers">
						<WTMETHOD name="ListQuizQuestion">
							<WTPARAM name="SessionLessonID" direction="input" value="CONST(tmpSessionLessonID)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
					</WTOBJECT>
-->
					<WTOBJECT name="QuizQuestions" project="ptsQuizQuestionUser" class="CQuizQuestions">
						<WTCONDITION expr="CONST(tmpSessionLessonID)" oper="greater" value="CONST(0)"/>
						<WTMETHOD name="ListQuizQuestion">
							<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
<WTCUSTOM>
					Set oQuizAnswer = server.CreateObject("ptsQuizAnswerUser.CQuizAnswer")
					If oQuizAnswer Is Nothing Then
					   DoError Err.Number, Err.Source, "Unable to Create Object - ptsQuizAnswerUser.CQuizAnswer"
					Else
						With oQuizAnswer
						   .SysCurrentLanguage = reqSysLanguage
						   .SessionLessonID = tmpSessionLessonID
						   .CreateDate = reqSysDate
						End With
					End If
					Set oQuizAnswers = server.CreateObject("ptsQuizAnswerUser.CQuizAnswers")
					If oQuizAnswers Is Nothing Then
					   DoError Err.Number, Err.Source, "Unable to Create Object - ptsQuizAnswerUser.CQuizAnswers"
					Else
					   With oQuizAnswers
					      .SysCurrentLanguage = reqSysLanguage
					      .ListQuizQuestion tmpSessionLessonID, CLng(reqSysUserID)
					      If (Err.Number &lt;&gt; 0) Then DoError Err.Number, Err.Source, Err.Description End If
					   End With
					End If

					For Each oQuizQuestion in oQuizQuestions
						tmpQuestionID = oQuizQuestion.QuizQuestionID
						tmpCorrectID = oQuizQuestion.QuizChoiceID
						tmpID = Request.Form.Item(tmpQuestionID)

						If tmpID &lt;&gt; "" Then
							'Check if the Question has already been Answered
							tmpQuizAnswerID = 0
							For Each oAnswer in oQuizAnswers
								If oAnswer.QuizQuestionID = tmpQuestionID Then
									tmpQuizAnswerID = oAnswer.QuizAnswerID
									Exit For
								End If
							Next

							With oQuizAnswer
								.QuizQuestionID = tmpQuestionID
							.QuizChoiceID = tmpID
							.IsCorrect = 0
							If (tmpID = tmpCorrectID) Then .IsCorrect = 1

								If tmpQuizAnswerID > 0 Then
								.QuizAnswerID = tmpQuizAnswerID
								.Save reqSysUserID
								Else
								QuizAnswerID = CLng(.Add( reqSysUserID ))
								End If
							If (Err.Number &lt;&gt; 0) Then DoError Err.Number, Err.Source, Err.Description End If
							End With
						End If
					Next
					result = oQuizAnswer.Grade( tmpSessionLessonID, reqSysUserID )
					Set oQuizAnswer = Nothing
					Set oQuizAnswers = Nothing
</WTCUSTOM>
					</WTOBJECT>
					<WTOBJECT name="Session" project="ptsSessionUser" class="CSession">
						<WTMETHOD name="SetStatus">
							<WTPARAM name="SessionID" direction="input" value="PARAM(SessionID)"/>
							<WTPARAM name="Lessons" direction="input" value="PARAM(Lessons)"/>
							<WTPARAM name="result" direction="return" datatype="number"/>
						</WTMETHOD>
					</WTOBJECT>
					<WTCALLSUB name="LoadQuiz">
						<WTCONDITION expr="IsErrors"/>
					</WTCALLSUB>
				</WTCODEGROUP>
			</WTSUB>

			<WTACTION name="New" type="New" id="0">
			    <WTGETCACHE name="PARAM(Identify)" value="IDENTIFY">
					<WTCONDITION expr="IsMemberOnly"/>
					<WTCONDITION expr="PARAM(Identify)" oper="equal" value="CONST(0)" connector="and"/>
			    </WTGETCACHE>
				<WTSETATTRIBUTE name="PARAM(Grade)" value="CONST(&quot;on&quot;)">
					<WTCONDITION expr="PARAM(Review)" oper="equal" value="CONST(0)"/>
				</WTSETATTRIBUTE>
				<WTCALLSUB name="LoadQuiz"/>
			</WTACTION>
			
			<WTACTION name="GradeNow" type="Continue" id="1">
				<WTSETATTRIBUTE name="PARAM(Grade)" value="CONST(&quot;on&quot;)"/>
				<WTCALLSUB name="GradeQuiz"/>
				<WTSETATTRIBUTE name="PARAM(Grade)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Review)" value="CONST(1)"/>
				<WTCALLSUB name="LoadQuiz">
					<WTCONDITION expr="NoErrors"/>
				</WTCALLSUB>
			</WTACTION>

			<WTACTION name="NextLesson" type="Continue" id="2">
				<WTSETATTRIBUTE name="PARAM(Grade)" value="FORM(Grade)"/>
				<WTCALLSUB name="GradeQuiz"/>
				<WTCODEGROUP>
					<WTCONDITION expr="NoErrors"/>
					<WTSETATTRIBUTE name="PARAM(NextLessonID)" value="FORM(NextLessonID)"/>
					<WTRETURN>
						<WTCONDITION expr="PARAM(NextLessonID)" oper="greater" value="CONST(0)"/>
						<WTLINK name="2430">
							<WTPARAM name="LessonID" value="PARAM(NextLessonID)"/>
							<WTPARAM name="SessionID" value="PARAM(SessionID)"/>
							<WTPARAM name="CourseID" value="PARAM(CourseID)"/>
							<WTPARAM name="Lessons" value="PARAM(Lessons)"/>
							<WTPARAM name="ContentPage" value="PARAM(ContentPage)"/>
							<WTPARAM name="Popup" value="PARAM(Popup)"/>
						</WTLINK>				
					</WTRETURN>
				</WTCODEGROUP>
			</WTACTION>

			<WTACTION name="GoToLesson" type="Continue" id="4">
				<WTSETATTRIBUTE name="PARAM(Grade)" value="FORM(Grade)"/>
				<WTCALLSUB name="GradeQuiz"/>
				<WTCODEGROUP>
					<WTCONDITION expr="NoErrors"/>
					<WTSETATTRIBUTE name="PARAM(NextLessonID)" value="FORM(LessonID)"/>
					<WTRETURN>
						<WTCONDITION expr="PARAM(NextLessonID)" oper="greater" value="CONST(0)"/>
						<WTLINK name="2430">
							<WTPARAM name="LessonID" value="PARAM(NextLessonID)"/>
							<WTPARAM name="SessionID" value="PARAM(SessionID)"/>
							<WTPARAM name="CourseID" value="PARAM(CourseID)"/>
							<WTPARAM name="Lessons" value="PARAM(Lessons)"/>
							<WTPARAM name="ContentPage" value="PARAM(ContentPage)"/>
							<WTPARAM name="Popup" value="PARAM(Popup)"/>
						</WTLINK>				
					</WTRETURN>
				</WTCODEGROUP>
			</WTACTION>

			<WTACTION name="ReturnLesson" type="Continue" id="5">
				<WTSETATTRIBUTE name="PARAM(Grade)" value="FORM(Grade)"/>
				<WTCALLSUB name="GradeQuiz"/>
				<WTCODEGROUP>
					<WTCONDITION expr="NoErrors"/>
					<WTRETURN>
						<WTLINK name="2430">
							<WTPARAM name="LessonID" value="PARAM(LessonID)"/>
							<WTPARAM name="SessionID" value="PARAM(SessionID)"/>
							<WTPARAM name="CourseID" value="PARAM(CourseID)"/>
							<WTPARAM name="Lessons" value="PARAM(Lessons)"/>
							<WTPARAM name="ContentPage" value="PARAM(ContentPage)"/>
							<WTPARAM name="Popup" value="PARAM(Popup)"/>
						</WTLINK>				
					</WTRETURN>
				</WTCODEGROUP>
			</WTACTION>

			<WTACTION name="ReturnClass" type="Continue" id="3">
				<WTSETATTRIBUTE name="PARAM(Grade)" value="FORM(Grade)"/>
				<WTCALLSUB name="GradeQuiz"/>
				<WTCODEGROUP>
					<WTCONDITION expr="NoErrors"/>
					<WTRETURN>
						<WTLINK name="1330" return="false">
							<WTPARAM name="SessionID" value="PARAM(SessionID)"/>
							<WTPARAM name="CourseID" value="PARAM(CourseID)"/>
							<WTPARAM name="ContentPage" value="PARAM(ContentPage)"/>
							<WTPARAM name="Popup" value="PARAM(Popup)"/>
						</WTLINK>				
					</WTRETURN>
				</WTCODEGROUP>
			</WTACTION>

			<WTACTION name="RetakeQuiz" type="Continue" id="6">
				<WTOBJECT name="SessionLesson" project="ptsSessionLessonUser" class="CSessionLesson">
					<WTMETHOD name="DeleteQuiz">
						<WTPARAM name="SessionID" direction="input" value="PARAM(SessionID)"/>
						<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						<WTPARAM name="tmpSessionLessonID" direction="return" datatype="number"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTRETURN>
					<WTLINK name="2112">
						<WTPARAM name="LessonID" value="PARAM(LessonID)"/>
						<WTPARAM name="SessionID" value="PARAM(SessionID)"/>
						<WTPARAM name="CourseID" value="PARAM(CourseID)"/>
						<WTPARAM name="Lessons" value="PARAM(Lessons)"/>
						<WTPARAM name="ContentPage" value="PARAM(ContentPage)"/>
						<WTPARAM name="Popup" value="PARAM(Popup)"/>
					</WTLINK>				
				</WTRETURN>
			</WTACTION>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="50" align="left"/>
				<WTCOLUMN width="15" align="left"/>
				<WTCOLUMN width="685" align="left"/>

				<WTFUNCTION name="CheckIdentity()">
					<!-- If we need Identification info -->
					var url, win
					url = "0427.asp?memberid=" + document.getElementById('MemberID').value;
		            win = window.open(url,"Identify","top=200,left=200,height=150,width=430,resizable=yes,status=no,toolbar=no,menubar=no,location=no,titlebar=no");
					win.focus();
				</WTFUNCTION>

				<WTROW>
					<WTHIDDEN value="PARAM(Identify)"/>
					<WTHIDDEN value="PARAM(MemberID)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Identify)" oper="greater" value="CONST(0)"/>
					<WTROW margin-top="12" margin-bottom="12">
						<WTSTATIC col="1" merge="3" label="IdentificationInfo" align="center" class="PageHeading"/>
					</WTROW>
					<WTROW margin-bottom="12">
						<WTBUTTON col="1" merge="3" value="CONST(IdentifyMember)" align="center">
							<WTCLICK>CheckIdentity();</WTCLICK>
						</WTBUTTON>
						<WTBUTTON col="1" merge="3" action="5" value="CONST(ReturnLesson)" align="center" btnclass="smbutton"/>
						<WTBUTTON col="1" merge="3" action="3" value="CONST(ReturnClass)" align="center" btnclass="smbutton"/>
					</WTROW>
				</WTCODEGROUP>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Identify)" oper="less-equal" value="CONST(0)"/>
					<WTROW>
						<WTSTATIC col="1" merge="3" tag="Quiz" value="ATTR(Lesson.LessonName)" class="PageHeading"/>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTDIVIDER col="1" merge="3" height="1" color="SYS(headerdivider)"/>
					</WTROW>
					<WTCODEGROUP>
						<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
						<WTROW margin-bottom="6">
							<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
							<WTSTATIC col="1" merge="3" label="QuizHelpMemberReview" class="Prompt"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTCONDITION expr="PARAM(Review)" oper="equal" value="CONST(0)"/>
							<WTSTATIC col="1" merge="3" label="QuizHelpMember" class="Prompt"/>
						</WTROW>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="PARAM(SessionID)" oper="equal" value="CONST(0)"/>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" merge="3" label="QuizHelpTrainer" class="Prompt"/>
						</WTROW>
					</WTCODEGROUP>
					<WTROW margin-bottom="6">
						<WTDIVIDER col="1" merge="3" height="1" color="SYS(divider)"/>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTSTATIC col="1" align="center">
							<WTCODEGROUP>
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTCODEGROUP>
									<WTCONDITION expr="PARAM(YourGrade)" oper="less" value="CONST(/DATA/TXN/PTSLESSON/@passinggrade)"/>
									<WTIMAGE value="CONST(lesson_status3.gif)" imgalign="middle"/>
								</WTCODEGROUP>
								<WTCODEGROUP>
									<WTCONDITION expr="PARAM(YourGrade)" oper="greater-equal" value="CONST(/DATA/TXN/PTSLESSON/@passinggrade)"/>
									<WTIMAGE value="CONST(lesson_status4.gif)" imgalign="middle"/>
								</WTCODEGROUP>
							</WTCODEGROUP>
						</WTSTATIC>
						<WTSTATIC col="2" merge="2" class="PageHeading">
							<WTCODEGROUP>
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTSTATIC tag="YourGrade"/>
								<WTSTATIC value="CONST(&lt;xsl:value-of select=&quot;/DATA/PARAM/@yourgrade&quot;/&gt;%)"/>
								<WTSTATIC space="5"/>
							</WTCODEGROUP>
							<WTSTATIC tag="PassingGrade"/>
							<WTSTATIC value="CONST(&lt;xsl:value-of select=&quot;/DATA/TXN/PTSLESSON/@passinggrade&quot;/&gt;%)"/>
							<WTSTATIC value="CONST( ()"/>
							<WTSTATIC value="PARAM(PassingPoints)"/>
							<WTSTATIC value="CONST( / )"/>
							<WTSTATIC value="PARAM(TotalPoints)" space="1"/>
							<WTSTATIC label="PTS"/>
							<WTSTATIC value="CONST())"/>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTDIVIDER col="1" merge="3" height="1" color="SYS(divider)"/>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTSTATIC col="1" merge="3" value="ATTR(HTMLFile.Data)" embedhtml="true"/>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTREPEAT xpath="/DATA/TXN/PTSQUIZQUESTIONS/PTSQUIZQUESTION[position() and @question != '']">
							<WTSORT name="@seq" datatype="number"/>
							<WTROW>
								<WTCONDITION expr="DATA(MediaType)" oper="equal" value="CONST(1)"/>
								<WTSTATIC col="1"/>
								<WTIMAGE col="2" merge="2" value="DATA(MediaFile)" imgpath="Sections\Course\&lt;xsl:value-of select=&quot;/DATA/PARAM/@courseid&quot;/&gt;\"/>
							</WTROW>
							<WTROW>
								<WTSTATIC col="1" align="center">
									<WTCODEGROUP>
										<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
										<WTCONDITION expr="PARAM(QuizLimit)" oper="not-equal" value="CONST(2)" connector="and"/>
										<WTCODEGROUP>
											<WTCONDITION expr="CONST(/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid)" oper="equal" value="CONST(current()/@quizchoiceid])"/>
											<WTIMAGE value="CONST(GreenCheck.gif)"/>
										</WTCODEGROUP>
										<WTCODEGROUP>
											<WTCONDITION expr="CONST(not(/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid)" oper="equal" value="CONST(current()/@quizchoiceid]))"/>
											<WTIMAGE value="CONST(RedCheck.gif)"/>
										</WTCODEGROUP>
									</WTCODEGROUP>
								</WTSTATIC>
								<WTSTATIC col="2" merge="2">
									<WTSTATIC value="CONST(&lt;xsl:value-of select=&quot;position()&quot;/&gt;.)"/>
									<WTSTATIC value="DATA(QuizQuestion.Question)" space="2"/>

									<WTCODEGROUP>
										<WTCONDITION expr="DATA(MediaType)" oper="greater" value="CONST(1)"/>
										<WTCODEGROUP>
											<WTCONDITION expr="CONST(contains)" value="CONST((@mediafile,':'))"/>
											<WTSTATIC label="PlayClip" space="2" bold="true">
												<WTLINK name="2431" target="Video" >
													<WTPARAM name="Video" value="DATA(QuizQuestion.MediaFile)"/>
												</WTLINK>
											</WTSTATIC>
										</WTCODEGROUP>
										<WTCODEGROUP>
											<WTCONDITION expr="CONST(not)" value="CONST((contains(@mediafile,':')))"/>
											<WTSTATIC label="PlayClip" space="2" bold="true">
												<WTLINK name="2431" target="Video" >
													<WTPARAM name="Video" value="Sections\Course\&lt;xsl:value-of select=&quot;concat(/DATA/PARAM/@courseid,'\',@mediafile)&quot;/&gt;"/>
												</WTLINK>
											</WTSTATIC>
										</WTCODEGROUP>
									</WTCODEGROUP>

									<WTSTATIC value="CONST( ()"/>
									<WTSTATIC value="DATA(QuizQuestion.Points)"/>
									<WTSTATIC value="CONST( pts))"/>
								</WTSTATIC>
							</WTROW>
							<WTROW margin-bottom="12">				
								<WTREPEAT xpath="./PTSQUIZCHOICEIDS/ENUM[position()]">
									<WTCODEGROUP>
										<WTCONDITION expr="PARAM(Review)" oper="equal" value="CONST(0)"/>
										<WTCONDITION expr="PARAM(QuizLimit)" oper="equal" value="CONST(2)" connector="or"/>
										<WTROW>
											<WTSTATIC col="1" merge="2"/>
											<WTRADIO col="3" group="&lt;xsl:value-of select=&quot;../../@quizquestionid&quot;/&gt;" name="&lt;xsl:value-of select=&quot;@id&quot;/&gt;" 
												datapathx="/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid=current()/@id]"/>
											<WTSTATIC col="3" value="DATA(name)"/>
										</WTROW>
									</WTCODEGROUP>
									<WTCODEGROUP>
										<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
										<WTCONDITION expr="PARAM(QuizLimit)" oper="not-equal" value="CONST(2)" connector="and"/>
										<WTROW>
											<WTCONDITION expr="CONST(not(@selected))" value="CONST( )"/>
											<WTSTATIC col="1" merge="2"/>
											<WTRADIO col="3" group="&lt;xsl:value-of select=&quot;../../@quizquestionid&quot;/&gt;" name="&lt;xsl:value-of select=&quot;@id&quot;/&gt;" 
												datapathx="/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid=current()/@id]"/>
											<WTSTATIC col="3" value="DATA(name)"/>
										</WTROW>
										<WTROW>
											<WTCONDITION expr="CONST(@selected)" value="CONST( )"/>
											<WTSTATIC col="1" merge="2"/>
											<WTRADIO col="3" group="&lt;xsl:value-of select=&quot;../../@quizquestionid&quot;/&gt;" name="&lt;xsl:value-of select=&quot;@id&quot;/&gt;" 
												datapathx="/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid=current()/@id]"/>
											<WTSTATIC col="3" value="DATA(name)" bold="true"/>
										</WTROW>
									</WTCODEGROUP>

								</WTREPEAT>
							</WTROW>

							<WTROW margin-bottom="12">
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTCONDITION expr="DATA(explain)" oper="not-equal" value="CONST('')" connector="and"/>
								<WTSTATIC col="1" merge="2"/>
								<WTSTATIC col="3" class="prompt" bold="true">
									<WTSTATIC value="DATA(explain)" fontcolor="green">
										<WTCONDITION expr="CONST(/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid)" oper="equal" value="CONST(current()/@quizchoiceid])"/>
									</WTSTATIC>
									<WTSTATIC value="DATA(explain)" fontcolor="red">
										<WTCONDITION expr="CONST(not(/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid)" oper="equal" value="CONST(current()/@quizchoiceid]))"/>
									</WTSTATIC>
								</WTSTATIC>
							</WTROW>

						</WTREPEAT>
					</WTROW>
					
					<WTROW margin-bottom="12">
						<WTDIVIDER col="2" merge="3" height="1" color="SYS(divider)"/>
					</WTROW>
					<WTCODEGROUP>
						<WTCONDITION expr="PARAM(Popup)" oper="less" value="CONST(2)"/>
						<WTCODEGROUP>
							<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
							<WTROW margin-bottom="12">
								<WTCONDITION expr="PARAM(Review)" oper="equal" value="CONST(0)"/>
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)" connector="or" paren="start"/>
								<WTCONDITION expr="ATTR(Lesson.IsPassQuiz)" oper="equal" value="CONST(0)" connector="and"/>
								<WTCONDITION expr="PARAM(QuizLimit)" oper="equal" value="CONST(0)" connector="and" paren="end"/>
								<WTCHECK col="1" merge="3" align="center" name="Grade" value="CONST(/DATA/PARAM/@grade)"/>
								<WTSTATIC col="1" merge="3" align="center" label="GradeQuizAfter"/>
							</WTROW>
						</WTCODEGROUP>
						<WTROW>
							<WTHIDDEN value="PARAM(NextLessonID)"/>
						</WTROW>
						<WTROW margin-bottom="12">
							<WTBUTTON col="1" merge="3" action="2" value="CONST(NextLesson)" align="center">
								<WTCONDITION expr="PARAM(NextLessonID)" oper="not-equal" value="CONST(0)"/>
							</WTBUTTON>
							<WTSTATIC col="1" merge="3" label="GoToLesson" align="center">
								<WTCONDITION expr="CONST(count(/DATA/TXN/PTSSESSIONLESSONS/PTSSESSIONLESSON))" oper="greater" value="CONST(1)"/>
							</WTSTATIC>
							<WTCOMBO col="1" merge="3" value="PARAM(LessonID)" datapath="/DATA/TXN/PTSSESSIONLESSONS/PTSSESSIONLESSON" setselected="PARAM(LessonID)" align="center" required="false">
								<WTCONDITION expr="CONST(count(/DATA/TXN/PTSSESSIONLESSONS/PTSSESSIONLESSON))" oper="greater" value="CONST(1)"/>
								<WTCHANGE>doSubmit(4,"")</WTCHANGE>
							</WTCOMBO>
						</WTROW>
						<WTROW margin-bottom="12">
							<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
							<WTBUTTON col="1" merge="3" action="1" value="CONST(GradeQuizNow)" align="center">
								<WTCONDITION expr="PARAM(Review)" oper="equal" value="CONST(0)"/>
							</WTBUTTON>
							<WTBUTTON col="1" merge="3" action="5" value="CONST(ReturnLesson)" align="center">
								<WTCONDITION expr="PARAM(AutoQuiz)" oper="equal" value="CONST(0)"/>
							</WTBUTTON>
							<WTBUTTON col="1" merge="3" action="3" value="CONST(ReturnClass)" align="center"/>
							<WTBUTTON col="1" merge="3" action="1" value="CONST(GradeQuizNow)" align="center">
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTCONDITION expr="ATTR(Lesson.IsPassQuiz)" oper="equal" value="CONST(0)" connector="and"/>
							</WTBUTTON>
							<WTBUTTON col="1" merge="3" action="6" value="CONST(RetakeQuiz)" align="center">
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTCONDITION expr="PARAM(QuizLimit)" oper="equal" value="CONST(0)" connector="and"/>
							</WTBUTTON>
						</WTROW>
						<WTROW margin-bottom="12">
							<WTCONDITION expr="PARAM(SessionID)" oper="equal" value="CONST(0)"/>
							<WTBUTTON col="1" merge="3" action="5" value="CONST(Continue)" align="center"/>
						</WTROW>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(2)"/>
						<WTROW margin-bottom="12">
							<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
							<WTBUTTON col="1" merge="3" action="1" value="CONST(GradeQuizNow)" align="center">
								<WTCONDITION expr="PARAM(Review)" oper="equal" value="CONST(0)"/>
							</WTBUTTON>
							<WTBUTTON col="1" merge="3" action="1" value="CONST(GradeQuizNow)" align="center">
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTCONDITION expr="ATTR(Lesson.IsPassQuiz)" oper="equal" value="CONST(0)" connector="and"/>
							</WTBUTTON>
							<WTBUTTON col="1" merge="3" action="6" value="CONST(RetakeQuiz)" align="center">
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTCONDITION expr="PARAM(QuizLimit)" oper="equal" value="CONST(0)" connector="and"/>
							</WTBUTTON>
							<WTBUTTON col="1" merge="3" value="CONST(Close)">
								<WTCLICK>window.close()</WTCLICK>
							</WTBUTTON>
						</WTROW>
					</WTCODEGROUP>
				</WTCODEGROUP>
				
			</WTCONTENT>
		</WTWEBPAGE>

		<!--===============================================================================-->
		<WTWEBPAGE name="m_2112" caption="Quiz Questions" page-left="0" page-top="0" navbar="false" header="false" footer="false" wrapper="false"
			page-width="100%" margin-width="0" navbar-width="0" content-width="100%" focus="false" viewport="width=device-width"
		   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" mobile="MobileHome.asp" secured="98" track="0">
			<!--===============================================================================-->
			<WTPARAM name="LessonID" datatype="number"/>
			<WTPARAM name="SessionID" datatype="number"/>
			<WTPARAM name="CourseID" datatype="number"/>
			<WTPARAM name="NextLessonID" datatype="number"/>
			<WTPARAM name="Grade" datatype="text"/>
			<WTPARAM name="Review" datatype="number"/>
			<WTPARAM name="TotalPoints" datatype="number"/>
			<WTPARAM name="PassingPoints" datatype="number"/>
			<WTPARAM name="YourGrade" datatype="number"/>
			<WTPARAM name="QuizLimit" datatype="number"/>
			<WTPARAM name="AutoQuiz" datatype="number"/>
			<WTPARAM name="ContentPage" datatype="number"/>
			<WTPARAM name="Popup" datatype="number"/>
			<WTPARAM name="Identify" datatype="number"/>
			<WTPARAM name="MemberID" datatype="number"/>
			<WTPARAM name="Lessons" datatype="text"/>

			<WTSUB name="LoadQuiz">
				<WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
					<WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(CStr(reqLessonID) + &quot;q.htm&quot;)"/>
					<WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\Course\&quot; &amp; CStr(reqCourseID))"/>
					<WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)"/>
					<WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)"/>
					<WTMETHOD name="Load"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlHTMLFile" direction="return" datatype="text"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Session" project="ptsSessionUser" class="CSession">
					<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="SessionID" direction="input" value="PARAM(SessionID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(QuizLimit)" value="ATTR(QuizLimit)"/>
					<WTSETATTRIBUTE name="CONST(tmpOrgCourseID)" value="ATTR(OrgCourseID)"/>
					<WTSETATTRIBUTE name="PARAM(MemberID)" value="ATTR(MemberID)"/>
				</WTOBJECT>
				<WTOBJECT name="Lesson" project="ptsLessonUser" class="CLesson">
					<WTMETHOD name="Load">
						<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(tmpPassingGrade)" value="ATTR(PassingGrade)"/>
					<WTSETATTRIBUTE name="CONST(tmpQuizWeight)" value="ATTR(QuizWeight)"/>
					<WTSETATTRIBUTE name="PARAM(QuizLimit)" value="CONST(0)">
						<WTCONDITION expr="ATTR(QuizWeight)" oper="equal" value="CONST(0)"/>
					</WTSETATTRIBUTE>
					<WTSETATTRIBUTE name="CONST(tmpQuizLength)" value="CONST(CLng(.QuizLength))"/>
					<WTSETATTRIBUTE name="CONST(curIsPassQuiz)" value="ATTR(IsPassQuiz)"/>
					<WTSETATTRIBUTE name="CONST(curQuiz)" value="ATTR(Quiz)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlLesson" direction="return" datatype="text"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="OrgCourse" project="ptsOrgCourseUser" class="COrgCourse">
					<WTCONDITION expr="CONST(tmpOrgCourseID)" oper="greater" value="CONST(0)"/>
					<WTCONDITION expr="CONST(tmpQuizWeight)" oper="greater" value="CONST(0)" connector="and"/>
					<WTMETHOD name="Load">
						<WTPARAM name="OrgCourseID" direction="input" value="CONST(tmpOrgCourseID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(QuizLimit)" value="ATTR(QuizLimit)">
						<WTCONDITION expr="ATTR(QuizLimit)" oper="greater" value="CONST(0)"/>
					</WTSETATTRIBUTE>
				</WTOBJECT>
				<WTOBJECT name="SessionLesson" project="ptsSessionLessonUser" class="CSessionLesson">
					<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
					<WTMETHOD name="GetSessionLesson">
						<WTPARAM name="SessionID" direction="input" value="PARAM(SessionID)"/>
						<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						<WTPARAM name="tmpSessionLessonID" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTMETHOD name="Load">
						<WTPARAM name="SessionLessonID" direction="input" value="CONST(tmpSessionLessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(reqYourGrade)" value="ATTR(QuizScore)"/>
					<WTSETATTRIBUTE name="CONST(curStatus)" value="ATTR(Status)"/>
					<WTSETATTRIBUTE name="CONST(tmpQuestions)" value="ATTR(Questions)"/>
				</WTOBJECT>
				<WTOBJECT name="SessionLessons" project="ptsSessionLessonUser" class="CSessionLessons">
					<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
					<WTMETHOD name="ListSession">
						<WTPARAM name="LessonID" direction="input" value="PARAM(CourseID)"/>
						<WTPARAM name="SessionID" direction="input" value="PARAM(SessionID)"/>
						<WTPARAM name="Lessons" direction="input" value="PARAM(Lessons)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTCUSTOM>
						reqNextLessonID = 0
						curLesson = 0
						nextIsPassQuiz = 0
						For Each oSessionLesson in oSessionLessons
						With oSessionLesson
						If curLesson = 1 Then
						reqNextLessonID = .LessonID
						nextIsPassQuiz = .IsPassQuiz
						Exit For
						End If
						If reqLessonID = Clng(.LessonID) Then curLesson = 1
						End With
						Next

						'NO NEXT LESSON if the next lesson requires a passed quiz AND this lesson has a quiz AND the quiz wasn't passed
						If nextIsPassQuiz &lt;&gt; "0" AND curQuiz &gt; "1" AND curStatus &lt;&gt; "4" Then
						reqNextLessonID = 0
						End If
					</WTCUSTOM>
					<!-- Only display lesson list if passed quiz is not required -->
					<WTMETHOD name="LessonXML">
						<WTCONDITION expr="CONST(curIsPassQuiz)" oper="equal" value="CONST(0)"/>
						<WTPARAM name="xmlSessionLessons" direction="return" datatype="text"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="QuizQuestions" project="ptsQuizQuestionUser" class="CQuizQuestions">
					<WTMETHOD name="ListQuizQuestion">
						<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTCUSTOM>
						tmpSaveQuestions = 0
						'If the quiz has a specific number of questions AND we have none Then get the questions
						If tmpQuizLength &lt;&gt; 0 AND tmpQuestions = "" Then
						tmpSaveQuestions = 1
						tmpQuestions = "~"
						cnt = 0
						total = 0
						'Get all the non-random questions
						For Each oQuizQuestion in oQuizQuestions
						With oQuizQuestion
						If cnt &lt; tmpQuizLength AND .IsRandom = 0 Then
						'Make sure we don't exceed the storage for the question IDs
						If (Len(tmpQuestions) + Len(CStr(.QuizQuestionID)) + 1) &lt; 200 Then
						tmpQuestions = tmpQuestions + CStr(.QuizQuestionID) + "~"
						cnt = cnt + 1
						.Seq = cnt
						Else
						cnt = tmpQuizLength
						Response.write "Length of Quiz Questions exceeds storage capacity - see administrator"
						End If
						End If
						End With
						total = total + 1
						Next
						'Make sure we have enough questions
						If tmpQuizLength &gt; total Then tmpQuizLength = total
						'If we still need more questions get the needed random questions
						While cnt &lt; tmpQuizLength
						'get a random number
						randomize
						random = Int((total * Rnd) + 1)
						With oQuizQuestions.Item(random)
						tmpQuizQuestionID = .QuizQuestionID
						tmpIsRandom = .IsRandom
						If tmpIsRandom &lt;&gt; 0 Then
						If InStr(tmpQuestions, "~" + CStr(tmpQuizQuestionID) + "~") = 0 Then
						'Make sure we don't exceed the storage for the question IDs
						If (Len(tmpQuestions) + Len(CStr(tmpQuizQuestionID)) + 1) &lt; 200 Then
						tmpQuestions = tmpQuestions + CStr(tmpQuizQuestionID) + "~"
						cnt = cnt + 1
						.Seq = cnt
						Else
						cnt = tmpQuizLength
						Response.write "Length of Quiz Questions exceeds storage capacity - see administrator"
						End If
						End If
						End If
						End With
						Wend
						End If

						reqTotalPoints = 0
						For Each oQuizQuestion in oQuizQuestions
						With oQuizQuestion
						If tmpQuizLength = 0 Then
						reqTotalPoints = reqTotalPoints + .Points
						Else
						'clear the name of the unused questions, otherwise get total points
						If InStr(tmpQuestions, "~" + CStr(.QuizQuestionID) + "~") = 0 Then
						.Question = ""
						.Explain = ""
						.MediaFile = ""
						Else
						reqTotalPoints = reqTotalPoints + .Points
						End If
						End If
						End With
						Next
						reqPassingPoints = Round( (tmpPassingGrade * reqTotalPoints) / 100 )
					</WTCUSTOM>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlQuizQuestions" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(1111)"/>
					</WTMETHOD>
					<!-- the data for the quiz choices is pulled as an enum, so the "selection" is actually the correct answer.
		for the purposes of configuring the correct answer, this needs to be pulled back as:
			selected="on"  instead of  selected="True" -->
					<WTCUSTOM>
						xmlQuizQuestions = Replace(xmlQuizQuestions, "selected=""True", "selected=""on")
					</WTCUSTOM>
				</WTOBJECT>
				<!-- Save the questions if specified questions -->
				<WTOBJECT name="SessionLesson" project="ptsSessionLessonUser" class="CSessionLesson">
					<WTCONDITION expr="PARAM(SessionID)" oper="not-equal" value="CONST(0)"/>
					<WTCONDITION expr="CONST(tmpSaveQuestions)" oper="equal" value="CONST(1)" connector="and"/>
					<WTMETHOD name="Load">
						<WTPARAM name="SessionLessonID" direction="input" value="CONST(tmpSessionLessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(Questions)" value="CONST(tmpQuestions)"/>
					<WTMETHOD name="Save">
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="QuizAnswers" project="ptsQuizAnswerUser" class="CQuizAnswers">
					<WTCONDITION expr="PARAM(SessionID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="ListQuizAnswer">
						<WTPARAM name="SessionLessonID" direction="input" value="CONST(tmpSessionLessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="ChoiceXML">
						<WTPARAM name="xmlQuizAnswers" direction="return" datatype="text"/>
					</WTMETHOD>
					<WTCUSTOM>
						if Len(xmlQuizAnswers) &gt; 20 Then reqReview = 1
					</WTCUSTOM>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="GradeQuiz">
				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
					<WTCONDITION expr="PARAM(Grade)" oper="equal" value="CONST(&quot;on&quot;)" connector="and"/>
					<WTOBJECT name="SessionLesson" project="ptsSessionLessonUser" class="CSessionLesson">
						<WTMETHOD name="GetSessionLesson">
							<WTPARAM name="SessionID" direction="input" value="PARAM(SessionID)"/>
							<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
							<WTPARAM name="tmpSessionLessonID" direction="return" datatype="number"/>
						</WTMETHOD>
					</WTOBJECT>
					<!-- NOT USED
					<WTOBJECT name="QuizAnswers" project="ptsQuizAnswerUser" class="CQuizAnswers">
						<WTMETHOD name="ListQuizQuestion">
							<WTPARAM name="SessionLessonID" direction="input" value="CONST(tmpSessionLessonID)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
					</WTOBJECT>
-->
					<WTOBJECT name="QuizQuestions" project="ptsQuizQuestionUser" class="CQuizQuestions">
						<WTCONDITION expr="CONST(tmpSessionLessonID)" oper="greater" value="CONST(0)"/>
						<WTMETHOD name="ListQuizQuestion">
							<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
							<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						</WTMETHOD>
						<WTCUSTOM>
							Set oQuizAnswer = server.CreateObject("ptsQuizAnswerUser.CQuizAnswer")
							If oQuizAnswer Is Nothing Then
							DoError Err.Number, Err.Source, "Unable to Create Object - ptsQuizAnswerUser.CQuizAnswer"
							Else
							With oQuizAnswer
							.SysCurrentLanguage = reqSysLanguage
							.SessionLessonID = tmpSessionLessonID
							.CreateDate = reqSysDate
							End With
							End If
							Set oQuizAnswers = server.CreateObject("ptsQuizAnswerUser.CQuizAnswers")
							If oQuizAnswers Is Nothing Then
							DoError Err.Number, Err.Source, "Unable to Create Object - ptsQuizAnswerUser.CQuizAnswers"
							Else
							With oQuizAnswers
							.SysCurrentLanguage = reqSysLanguage
							.ListQuizQuestion tmpSessionLessonID, CLng(reqSysUserID)
							If (Err.Number &lt;&gt; 0) Then DoError Err.Number, Err.Source, Err.Description End If
							End With
							End If

							For Each oQuizQuestion in oQuizQuestions
							tmpQuestionID = oQuizQuestion.QuizQuestionID
							tmpCorrectID = oQuizQuestion.QuizChoiceID
							tmpID = Request.Form.Item(tmpQuestionID)

							If tmpID &lt;&gt; "" Then
							'Check if the Question has already been Answered
							tmpQuizAnswerID = 0
							For Each oAnswer in oQuizAnswers
							If oAnswer.QuizQuestionID = tmpQuestionID Then
							tmpQuizAnswerID = oAnswer.QuizAnswerID
							Exit For
							End If
							Next

							With oQuizAnswer
							.QuizQuestionID = tmpQuestionID
							.QuizChoiceID = tmpID
							.IsCorrect = 0
							If (tmpID = tmpCorrectID) Then .IsCorrect = 1

							If tmpQuizAnswerID > 0 Then
							.QuizAnswerID = tmpQuizAnswerID
							.Save reqSysUserID
							Else
							QuizAnswerID = CLng(.Add( reqSysUserID ))
							End If
							If (Err.Number &lt;&gt; 0) Then DoError Err.Number, Err.Source, Err.Description End If
							End With
							End If
							Next
							result = oQuizAnswer.Grade( tmpSessionLessonID, reqSysUserID )
							Set oQuizAnswer = Nothing
							Set oQuizAnswers = Nothing
						</WTCUSTOM>
					</WTOBJECT>
					<WTOBJECT name="Session" project="ptsSessionUser" class="CSession">
						<WTMETHOD name="SetStatus">
							<WTPARAM name="SessionID" direction="input" value="PARAM(SessionID)"/>
							<WTPARAM name="Lessons" direction="input" value="PARAM(Lessons)"/>
							<WTPARAM name="result" direction="return" datatype="number"/>
						</WTMETHOD>
					</WTOBJECT>
					<WTCALLSUB name="LoadQuiz">
						<WTCONDITION expr="IsErrors"/>
					</WTCALLSUB>
				</WTCODEGROUP>
			</WTSUB>

			<WTACTION name="New" type="New" id="0">
				<WTGETCACHE name="PARAM(Identify)" value="IDENTIFY">
					<WTCONDITION expr="IsMemberOnly"/>
					<WTCONDITION expr="PARAM(Identify)" oper="equal" value="CONST(0)" connector="and"/>
				</WTGETCACHE>
				<WTSETATTRIBUTE name="PARAM(Grade)" value="CONST(&quot;on&quot;)">
					<WTCONDITION expr="PARAM(Review)" oper="equal" value="CONST(0)"/>
				</WTSETATTRIBUTE>
				<WTCALLSUB name="LoadQuiz"/>
			</WTACTION>

			<WTACTION name="GradeNow" type="Continue" id="1">
				<WTSETATTRIBUTE name="PARAM(Grade)" value="CONST(&quot;on&quot;)"/>
				<WTCALLSUB name="GradeQuiz"/>
				<WTSETATTRIBUTE name="PARAM(Grade)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Review)" value="CONST(1)"/>
				<WTCALLSUB name="LoadQuiz">
					<WTCONDITION expr="NoErrors"/>
				</WTCALLSUB>
			</WTACTION>

			<WTACTION name="NextLesson" type="Continue" id="2">
				<WTSETATTRIBUTE name="PARAM(Grade)" value="FORM(Grade)"/>
				<WTCALLSUB name="GradeQuiz"/>
				<WTCODEGROUP>
					<WTCONDITION expr="NoErrors"/>
					<WTSETATTRIBUTE name="PARAM(NextLessonID)" value="FORM(NextLessonID)"/>
					<WTRETURN>
						<WTCONDITION expr="PARAM(NextLessonID)" oper="greater" value="CONST(0)"/>
						<WTLINK name="m_2430">
							<WTPARAM name="LessonID" value="PARAM(NextLessonID)"/>
							<WTPARAM name="SessionID" value="PARAM(SessionID)"/>
							<WTPARAM name="CourseID" value="PARAM(CourseID)"/>
							<WTPARAM name="Lessons" value="PARAM(Lessons)"/>
							<WTPARAM name="ContentPage" value="PARAM(ContentPage)"/>
							<WTPARAM name="Popup" value="PARAM(Popup)"/>
						</WTLINK>
					</WTRETURN>
				</WTCODEGROUP>
			</WTACTION>

			<WTACTION name="GoToLesson" type="Continue" id="4">
				<WTSETATTRIBUTE name="PARAM(Grade)" value="FORM(Grade)"/>
				<WTCALLSUB name="GradeQuiz"/>
				<WTCODEGROUP>
					<WTCONDITION expr="NoErrors"/>
					<WTSETATTRIBUTE name="PARAM(NextLessonID)" value="FORM(LessonID)"/>
					<WTRETURN>
						<WTCONDITION expr="PARAM(NextLessonID)" oper="greater" value="CONST(0)"/>
						<WTLINK name="m_2430">
							<WTPARAM name="LessonID" value="PARAM(NextLessonID)"/>
							<WTPARAM name="SessionID" value="PARAM(SessionID)"/>
							<WTPARAM name="CourseID" value="PARAM(CourseID)"/>
							<WTPARAM name="Lessons" value="PARAM(Lessons)"/>
							<WTPARAM name="ContentPage" value="PARAM(ContentPage)"/>
							<WTPARAM name="Popup" value="PARAM(Popup)"/>
						</WTLINK>
					</WTRETURN>
				</WTCODEGROUP>
			</WTACTION>

			<WTACTION name="ReturnLesson" type="Continue" id="5">
				<WTSETATTRIBUTE name="PARAM(Grade)" value="FORM(Grade)"/>
				<WTCALLSUB name="GradeQuiz"/>
				<WTCODEGROUP>
					<WTCONDITION expr="NoErrors"/>
					<WTRETURN>
						<WTLINK name="m_2430">
							<WTPARAM name="LessonID" value="PARAM(LessonID)"/>
							<WTPARAM name="SessionID" value="PARAM(SessionID)"/>
							<WTPARAM name="CourseID" value="PARAM(CourseID)"/>
							<WTPARAM name="Lessons" value="PARAM(Lessons)"/>
							<WTPARAM name="ContentPage" value="PARAM(ContentPage)"/>
							<WTPARAM name="Popup" value="PARAM(Popup)"/>
						</WTLINK>
					</WTRETURN>
				</WTCODEGROUP>
			</WTACTION>

			<WTACTION name="ReturnClass" type="Continue" id="3">
				<WTSETATTRIBUTE name="PARAM(Grade)" value="FORM(Grade)"/>
				<WTCALLSUB name="GradeQuiz"/>
				<WTCODEGROUP>
					<WTCONDITION expr="NoErrors"/>
					<WTRETURN>
						<WTLINK name="m_1330" return="false">
							<WTPARAM name="SessionID" value="PARAM(SessionID)"/>
							<WTPARAM name="CourseID" value="PARAM(CourseID)"/>
							<WTPARAM name="ContentPage" value="PARAM(ContentPage)"/>
							<WTPARAM name="Popup" value="PARAM(Popup)"/>
						</WTLINK>
					</WTRETURN>
				</WTCODEGROUP>
			</WTACTION>

			<WTACTION name="RetakeQuiz" type="Continue" id="6">
				<WTOBJECT name="SessionLesson" project="ptsSessionLessonUser" class="CSessionLesson">
					<WTMETHOD name="DeleteQuiz">
						<WTPARAM name="SessionID" direction="input" value="PARAM(SessionID)"/>
						<WTPARAM name="LessonID" direction="input" value="PARAM(LessonID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
						<WTPARAM name="tmpSessionLessonID" direction="return" datatype="number"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTRETURN>
					<WTLINK name="m_2112">
						<WTPARAM name="LessonID" value="PARAM(LessonID)"/>
						<WTPARAM name="SessionID" value="PARAM(SessionID)"/>
						<WTPARAM name="CourseID" value="PARAM(CourseID)"/>
						<WTPARAM name="Lessons" value="PARAM(Lessons)"/>
						<WTPARAM name="ContentPage" value="PARAM(ContentPage)"/>
						<WTPARAM name="Popup" value="PARAM(Popup)"/>
					</WTLINK>
				</WTRETURN>
			</WTACTION>

			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="17" align="left"/>
				<WTCOLUMN width="5" align="left"/>
				<WTCOLUMN width="78" align="left"/>

				<WTFUNCTION name="CheckIdentity()">
					<!-- If we need Identification info -->
					var url, win
					url = "m_0427.asp?memberid=" + document.getElementById('MemberID').value;
					win = window.open(url,"Identify","top=200,left=200,height=150,width=430,resizable=yes,status=no,toolbar=no,menubar=no,location=no,titlebar=no");
					win.focus();
				</WTFUNCTION>

				<WTROW>
					<WTHIDDEN value="PARAM(Identify)"/>
					<WTHIDDEN value="PARAM(MemberID)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Identify)" oper="greater" value="CONST(0)"/>
					<WTROW margin-top="12" margin-bottom="12">
						<WTSTATIC col="1" merge="3" label="IdentificationInfo" align="center" class="PageHeading"/>
					</WTROW>
					<WTROW margin-bottom="12">
						<WTBUTTON col="1" merge="3" value="CONST(IdentifyMember)" align="center">
							<WTCLICK>CheckIdentity();</WTCLICK>
						</WTBUTTON>
						<WTBUTTON col="1" merge="3" action="5" value="CONST(ReturnLesson)" align="center" btnclass="smbutton"/>
						<WTBUTTON col="1" merge="3" action="3" value="CONST(ReturnClass)" align="center" btnclass="smbutton"/>
					</WTROW>
				</WTCODEGROUP>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Identify)" oper="less-equal" value="CONST(0)"/>
					<WTROW>
						<WTSTATIC col="1" merge="3" tag="Quiz" value="ATTR(Lesson.LessonName)" class="PageHeading"/>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTDIVIDER col="1" merge="3" height="1" color="SYS(headerdivider)"/>
					</WTROW>
					<WTCODEGROUP>
						<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
						<WTROW margin-bottom="6">
							<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
							<WTSTATIC col="1" merge="3" label="QuizHelpMemberReview" class="Prompt"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTCONDITION expr="PARAM(Review)" oper="equal" value="CONST(0)"/>
							<WTSTATIC col="1" merge="3" label="QuizHelpMember" class="Prompt"/>
						</WTROW>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="PARAM(SessionID)" oper="equal" value="CONST(0)"/>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" merge="3" label="QuizHelpTrainer" class="Prompt"/>
						</WTROW>
					</WTCODEGROUP>
					<WTROW margin-bottom="6">
						<WTDIVIDER col="1" merge="3" height="1" color="SYS(divider)"/>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTSTATIC col="1" align="center">
							<WTCODEGROUP>
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTCODEGROUP>
									<WTCONDITION expr="PARAM(YourGrade)" oper="less" value="CONST(/DATA/TXN/PTSLESSON/@passinggrade)"/>
									<WTIMAGE value="CONST(lesson_status3.gif)" imgalign="middle"/>
								</WTCODEGROUP>
								<WTCODEGROUP>
									<WTCONDITION expr="PARAM(YourGrade)" oper="greater-equal" value="CONST(/DATA/TXN/PTSLESSON/@passinggrade)"/>
									<WTIMAGE value="CONST(lesson_status4.gif)" imgalign="middle"/>
								</WTCODEGROUP>
							</WTCODEGROUP>
						</WTSTATIC>
						<WTSTATIC col="2" merge="2" class="PageHeading">
							<WTCODEGROUP>
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTSTATIC tag="YourGrade"/>
								<WTSTATIC value="CONST(&lt;xsl:value-of select=&quot;/DATA/PARAM/@yourgrade&quot;/&gt;%)"/>
								<WTSTATIC space="5"/>
							</WTCODEGROUP>
							<WTSTATIC tag="PassingGrade"/>
							<WTSTATIC value="CONST(&lt;xsl:value-of select=&quot;/DATA/TXN/PTSLESSON/@passinggrade&quot;/&gt;%)"/>
							<WTSTATIC value="CONST( ()"/>
							<WTSTATIC value="PARAM(PassingPoints)"/>
							<WTSTATIC value="CONST( / )"/>
							<WTSTATIC value="PARAM(TotalPoints)" space="1"/>
							<WTSTATIC label="PTS"/>
							<WTSTATIC value="CONST())"/>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTDIVIDER col="1" merge="3" height="1" color="SYS(divider)"/>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTSTATIC col="1" merge="3" value="ATTR(HTMLFile.Data)" embedhtml="true"/>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTREPEAT xpath="/DATA/TXN/PTSQUIZQUESTIONS/PTSQUIZQUESTION[position() and @question != '']">
							<WTSORT name="@seq" datatype="number"/>
							<WTROW>
								<WTCONDITION expr="DATA(MediaType)" oper="equal" value="CONST(1)"/>
								<WTSTATIC col="1"/>
								<WTIMAGE col="2" merge="2" value="DATA(MediaFile)" imgpath="Sections\Course\&lt;xsl:value-of select=&quot;/DATA/PARAM/@courseid&quot;/&gt;\"/>
							</WTROW>
							<WTROW>
								<WTSTATIC col="1" align="center">
									<WTCODEGROUP>
										<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
										<WTCONDITION expr="PARAM(QuizLimit)" oper="not-equal" value="CONST(2)" connector="and"/>
										<WTCODEGROUP>
											<WTCONDITION expr="CONST(/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid)" oper="equal" value="CONST(current()/@quizchoiceid])"/>
											<WTIMAGE value="CONST(GreenCheck.gif)"/>
										</WTCODEGROUP>
										<WTCODEGROUP>
											<WTCONDITION expr="CONST(not(/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid)" oper="equal" value="CONST(current()/@quizchoiceid]))"/>
											<WTIMAGE value="CONST(RedCheck.gif)"/>
										</WTCODEGROUP>
									</WTCODEGROUP>
								</WTSTATIC>
								<WTSTATIC col="2" merge="2">
									<WTSTATIC value="CONST(&lt;xsl:value-of select=&quot;position()&quot;/&gt;.)"/>
									<WTSTATIC value="DATA(QuizQuestion.Question)" space="2"/>

									<WTCODEGROUP>
										<WTCONDITION expr="DATA(MediaType)" oper="greater" value="CONST(1)"/>
										<WTCODEGROUP>
											<WTCONDITION expr="CONST(contains)" value="CONST((@mediafile,':'))"/>
											<WTSTATIC label="PlayClip" space="2" bold="true">
												<WTLINK name="2431" target="Video" >
													<WTPARAM name="Video" value="DATA(QuizQuestion.MediaFile)"/>
												</WTLINK>
											</WTSTATIC>
										</WTCODEGROUP>
										<WTCODEGROUP>
											<WTCONDITION expr="CONST(not)" value="CONST((contains(@mediafile,':')))"/>
											<WTSTATIC label="PlayClip" space="2" bold="true">
												<WTLINK name="2431" target="Video" >
													<WTPARAM name="Video" value="Sections\Course\&lt;xsl:value-of select=&quot;concat(/DATA/PARAM/@courseid,'\',@mediafile)&quot;/&gt;"/>
												</WTLINK>
											</WTSTATIC>
										</WTCODEGROUP>
									</WTCODEGROUP>

									<WTSTATIC value="CONST( ()"/>
									<WTSTATIC value="DATA(QuizQuestion.Points)"/>
									<WTSTATIC value="CONST( pts))"/>
								</WTSTATIC>
							</WTROW>
							<WTROW margin-bottom="12">
								<WTREPEAT xpath="./PTSQUIZCHOICEIDS/ENUM[position()]">
									<WTCODEGROUP>
										<WTCONDITION expr="PARAM(Review)" oper="equal" value="CONST(0)"/>
										<WTCONDITION expr="PARAM(QuizLimit)" oper="equal" value="CONST(2)" connector="or"/>
										<WTROW>
											<WTSTATIC col="1" merge="2"/>
											<WTRADIO col="3" group="&lt;xsl:value-of select=&quot;../../@quizquestionid&quot;/&gt;" name="&lt;xsl:value-of select=&quot;@id&quot;/&gt;"
												datapathx="/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid=current()/@id]"/>
											<WTSTATIC col="3" value="DATA(name)"/>
										</WTROW>
									</WTCODEGROUP>
									<WTCODEGROUP>
										<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
										<WTCONDITION expr="PARAM(QuizLimit)" oper="not-equal" value="CONST(2)" connector="and"/>
										<WTROW>
											<WTCONDITION expr="CONST(not(@selected))" value="CONST( )"/>
											<WTSTATIC col="1" merge="2"/>
											<WTRADIO col="3" group="&lt;xsl:value-of select=&quot;../../@quizquestionid&quot;/&gt;" name="&lt;xsl:value-of select=&quot;@id&quot;/&gt;"
												datapathx="/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid=current()/@id]"/>
											<WTSTATIC col="3" value="DATA(name)"/>
										</WTROW>
										<WTROW>
											<WTCONDITION expr="CONST(@selected)" value="CONST( )"/>
											<WTSTATIC col="1" merge="2"/>
											<WTRADIO col="3" group="&lt;xsl:value-of select=&quot;../../@quizquestionid&quot;/&gt;" name="&lt;xsl:value-of select=&quot;@id&quot;/&gt;"
												datapathx="/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid=current()/@id]"/>
											<WTSTATIC col="3" value="DATA(name)" bold="true"/>
										</WTROW>
									</WTCODEGROUP>

								</WTREPEAT>
							</WTROW>

							<WTROW margin-bottom="12">
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTCONDITION expr="DATA(explain)" oper="not-equal" value="CONST('')" connector="and"/>
								<WTSTATIC col="1" merge="2"/>
								<WTSTATIC col="3" class="prompt" bold="true">
									<WTSTATIC value="DATA(explain)" fontcolor="green">
										<WTCONDITION expr="CONST(/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid)" oper="equal" value="CONST(current()/@quizchoiceid])"/>
									</WTSTATIC>
									<WTSTATIC value="DATA(explain)" fontcolor="red">
										<WTCONDITION expr="CONST(not(/DATA/TXN/PTSQUIZANSWERS/PTSQUIZANSWER[@quizchoiceid)" oper="equal" value="CONST(current()/@quizchoiceid]))"/>
									</WTSTATIC>
								</WTSTATIC>
							</WTROW>

						</WTREPEAT>
					</WTROW>

					<WTROW margin-bottom="12">
						<WTDIVIDER col="2" merge="3" height="1" color="SYS(divider)"/>
					</WTROW>
					<WTCODEGROUP>
						<WTCONDITION expr="PARAM(Popup)" oper="less" value="CONST(2)"/>
						<WTCODEGROUP>
							<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
							<WTROW margin-bottom="12">
								<WTCONDITION expr="PARAM(Review)" oper="equal" value="CONST(0)"/>
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)" connector="or" paren="start"/>
								<WTCONDITION expr="ATTR(Lesson.IsPassQuiz)" oper="equal" value="CONST(0)" connector="and"/>
								<WTCONDITION expr="PARAM(QuizLimit)" oper="equal" value="CONST(0)" connector="and" paren="end"/>
								<WTCHECK col="1" merge="3" align="center" name="Grade" value="CONST(/DATA/PARAM/@grade)"/>
								<WTSTATIC col="1" merge="3" align="center" label="GradeQuizAfter"/>
							</WTROW>
						</WTCODEGROUP>
						<WTROW>
							<WTHIDDEN value="PARAM(NextLessonID)"/>
						</WTROW>
						<WTROW margin-bottom="12">
							<WTBUTTON col="1" merge="3" action="2" value="CONST(NextLesson)" align="center">
								<WTCONDITION expr="PARAM(NextLessonID)" oper="not-equal" value="CONST(0)"/>
							</WTBUTTON>
							<WTSTATIC col="1" merge="3" label="GoToLesson" align="center">
								<WTCONDITION expr="CONST(count(/DATA/TXN/PTSSESSIONLESSONS/PTSSESSIONLESSON))" oper="greater" value="CONST(1)"/>
							</WTSTATIC>
							<WTCOMBO col="1" merge="3" value="PARAM(LessonID)" datapath="/DATA/TXN/PTSSESSIONLESSONS/PTSSESSIONLESSON" setselected="PARAM(LessonID)" align="center" required="false">
								<WTCONDITION expr="CONST(count(/DATA/TXN/PTSSESSIONLESSONS/PTSSESSIONLESSON))" oper="greater" value="CONST(1)"/>
								<WTCHANGE>doSubmit(4,"")</WTCHANGE>
							</WTCOMBO>
						</WTROW>
						<WTROW margin-bottom="12">
							<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
							<WTBUTTON col="1" merge="3" action="1" value="CONST(GradeQuizNow)" align="center">
								<WTCONDITION expr="PARAM(Review)" oper="equal" value="CONST(0)"/>
							</WTBUTTON>
							<WTBUTTON col="1" merge="3" action="5" value="CONST(ReturnLesson)" align="center">
								<WTCONDITION expr="PARAM(AutoQuiz)" oper="equal" value="CONST(0)"/>
							</WTBUTTON>
							<WTBUTTON col="1" merge="3" action="3" value="CONST(ReturnClass)" align="center"/>
							<WTBUTTON col="1" merge="3" action="1" value="CONST(GradeQuizNow)" align="center">
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTCONDITION expr="ATTR(Lesson.IsPassQuiz)" oper="equal" value="CONST(0)" connector="and"/>
							</WTBUTTON>
							<WTBUTTON col="1" merge="3" action="6" value="CONST(RetakeQuiz)" align="center">
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTCONDITION expr="PARAM(QuizLimit)" oper="equal" value="CONST(0)" connector="and"/>
							</WTBUTTON>
						</WTROW>
						<WTROW margin-bottom="12">
							<WTCONDITION expr="PARAM(SessionID)" oper="equal" value="CONST(0)"/>
							<WTBUTTON col="1" merge="3" action="5" value="CONST(Continue)" align="center"/>
						</WTROW>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(2)"/>
						<WTROW margin-bottom="12">
							<WTCONDITION expr="PARAM(SessionID)" oper="greater" value="CONST(0)"/>
							<WTBUTTON col="1" merge="3" action="1" value="CONST(GradeQuizNow)" align="center">
								<WTCONDITION expr="PARAM(Review)" oper="equal" value="CONST(0)"/>
							</WTBUTTON>
							<WTBUTTON col="1" merge="3" action="1" value="CONST(GradeQuizNow)" align="center">
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTCONDITION expr="ATTR(Lesson.IsPassQuiz)" oper="equal" value="CONST(0)" connector="and"/>
							</WTBUTTON>
							<WTBUTTON col="1" merge="3" action="6" value="CONST(RetakeQuiz)" align="center">
								<WTCONDITION expr="PARAM(Review)" oper="not-equal" value="CONST(0)"/>
								<WTCONDITION expr="PARAM(QuizLimit)" oper="equal" value="CONST(0)" connector="and"/>
							</WTBUTTON>
							<WTBUTTON col="1" merge="3" value="CONST(Close)">
								<WTCLICK>window.close()</WTCLICK>
							</WTBUTTON>
						</WTROW>
					</WTCODEGROUP>
				</WTCODEGROUP>

			</WTCONTENT>
		</WTWEBPAGE>

		<!--**************************************Media Upload Page**************************************-->
		<!--=============================================================================================-->
		<WTWEBPAGE name="2120" caption="Upload File" action="false" submit="2120Upload.asp" type="multi" aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl">
		<!--=============================================================================================-->
			<WTPARAM name="QuizQuestionID" datatype="number"/>
			<WTPARAM name="UploadError" datatype="number"/>
			<WTPARAM name="UploadErrorDesc" datatype="text"/>
			
			<WTCODEGROUP>
				<WTCONDITION expr="PARAM(UploadError)" oper="not-equal" value="CONST(0)"/>
<WTCUSTOM>
					DoError reqUploadError, "Upload", reqUploadErrorDesc
</WTCUSTOM>
			</WTCODEGROUP>
			
			<WTACTION id="0" name="New" type="New">
				<WTSETCACHE name="QUIZQUESTIONID" value="PARAM(QuizQuestionID)"/>
			</WTACTION>

	 		<!--*******************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="600" align="left"/>

				<WTROW>
					<WTSTATIC col="1" label="UploadMediaHeader" class="PageHeading"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTSTATIC col="1" label="UploadMediaText" class="prompt"/>
				</WTROW>
				
				<WTROW margin-bottom="18">
					<WTFILE col="1" align="center" value="upload" size="40"/>
					<WTBUTTON col="1" align="center" default="true" value="CONST(Submit)"/>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>
	</WTWEBPAGES>

</WTROOT>