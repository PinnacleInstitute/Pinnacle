<WTROOT prefix="pts" dbo="dbo" system="Pinnacle" language="false">
	<WTENTITY id="10" name="Payment" alias="pa">

		<!--Identity-->
		<WTATTRIBUTE id="1001" name="PaymentID" type="number" identity="true" min="1" required="true" title="true" source="entity"/>
		<WTATTRIBUTE id="1002" name="CompanyID" type="number" source="entity"/>

		<!--Foreign Keys-->
		<WTATTRIBUTE id="1003" name="OwnerType" type="number" required="true" source="entity"/>
		<WTATTRIBUTE id="1004" name="OwnerID" type="number" required="true" source="entity"/>
		<WTATTRIBUTE id="1005" name="BillingID" type="number" source="entity"/>
		<WTATTRIBUTE id="1006" name="ProductID" type="number" source="entity"/>
		<WTATTRIBUTE id="1007" name="PaidID" type="number" source="entity"/>

		<!--Foreign Table Fields-->

		<!--Attributes-->
		<WTATTRIBUTE id="1008" name="PayDate" type="date" required="true" source="entity"/>
		<WTATTRIBUTE id="1009" name="PaidDate" type="date" source="entity"/>
		<WTATTRIBUTE id="1010" name="PayType" type="number" source="entity">
			<WTENUM id="1" name="Visa"/>
			<WTENUM id="2" name="MasterCard"/>
			<WTENUM id="3" name="Discover"/>
			<WTENUM id="4" name="Amex"/>
			<WTENUM id="5" name="Check"/>
			<WTENUM id="6" name="PayPal"/>
			<WTENUM id="7" name="Cash"/>
			<WTENUM id="8" name="PO"/>
      <WTENUM id="10" name="Wallet"/>
      <WTENUM id="11" name="iPayout"/>
      <WTENUM id="12" name="PayQuicker"/>
			<WTENUM id="13" name="SolidTrust"/>
      <WTENUM id="14" name="BitCoin"/>
      <WTENUM id="15" name="BitCoinCash"/>
      <WTENUM id="20" name="GCR"/>
      <WTENUM id="21" name="NTX"/>
      <WTENUM id="22" name="Coin1"/>
      <WTENUM id="23" name="Coin2"/>
      <WTENUM id="24" name="Coin3"/>
      <WTENUM id="25" name="Coin4"/>
      <WTENUM id="26" name="Coin5"/>
      <WTENUM id="27" name="Coin6"/>
      <WTENUM id="28" name="Coin7"/>
      <WTENUM id="29" name="Coin8"/>
      <WTENUM id="30" name="Coin9"/>
      <WTENUM id="31" name="Coin10"/>
      <WTENUM id="90" name="Commission"/>
			<WTENUM id="91" name="Credit"/>
			<WTENUM id="97" name="MiscPay1"/>
			<WTENUM id="98" name="MiscPay2"/>
			<WTENUM id="99" name="MiscPay3"/>
		</WTATTRIBUTE>
		<WTATTRIBUTE id="1011" name="Amount" type="currency" min="0" max="99999999.99" source="entity" sum="true"/>
		<WTATTRIBUTE id="1012" name="Total" type="currency" min="0" max="99999999.99" source="entity" sum="true"/>
		<WTATTRIBUTE id="1013" name="Credit" type="currency" min="0" max="99999999.99" source="entity" sum="true"/>
		<WTATTRIBUTE id="1014" name="Retail" type="currency" min="0" max="99999999.99" source="entity" sum="true"/>
		<WTATTRIBUTE id="1015" name="Commission" type="currency" min="0" max="99999999.99" source="entity" sum="true"/>
		<WTATTRIBUTE id="1016" name="Description" type="text" length="200" min="1" max="200" source="entity" language="false"/>
		<WTATTRIBUTE id="1017" name="Purpose" type="text" length="100" min="1" max="100" source="entity"/>
		<WTATTRIBUTE id="1018" name="Status" type="number" source="entity">
			<WTENUM id="1" name="Submitted"/>
			<WTENUM id="2" name="Pending"/>
			<WTENUM id="3" name="Approved"/>
			<WTENUM id="4" name="Declined"/>
			<WTENUM id="5" name="Returned"/>
      <WTENUM id="6" name="Cancelled"/>
      <WTENUM id="7" name="Partial"/>
    </WTATTRIBUTE>
		<WTATTRIBUTE id="1019" name="Reference" type="text" length="40" min="1" max="40" source="entity" language="false"/>
		<WTATTRIBUTE id="1020" name="Notes" type="text" length="500" min="1" max="500" source="entity" language="false"/>
		<WTATTRIBUTE id="1021" name="CommStatus" type="number" source="entity">
			<WTENUM id="1" name="No"/>
			<WTENUM id="2" name="Yes"/>
			<WTENUM id="3" name="None"/>
			<WTENUM id="4" name="Reclaimed"/>
		</WTATTRIBUTE>
		<WTATTRIBUTE id="1022" name="CommDate" type="date" source="entity"/>
		<WTATTRIBUTE id="1023" name="TokenType" type="number" source="entity"/>
		<WTATTRIBUTE id="1024" name="TokenOwner" type="number" source="entity"/>
		<WTATTRIBUTE id="1025" name="Token" type="number" source="entity"/>

		<!-- Non Persist Fields -->
		<WTATTRIBUTE id="1090" name="ReportFromDate" type="date" source="entity" persist="false" xml="false"/>
		<WTATTRIBUTE id="1091" name="ReportToDate" type="date" source="entity" persist="false" xml="false"/>
		<WTATTRIBUTE id="1092" name="Count" type="number" source="entity" persist="false" xml="false"/>
		<WTATTRIBUTE id="1093" name="FromDate" type="date" source="entity" persist="false" xml="false"/>
		<WTATTRIBUTE id="1094" name="ToDate" type="date" source="entity" persist="false" xml="false"/>
		<WTATTRIBUTE id="1095" name="MemberID" type="number" source="entity" persist="false" xml="false"/>

		<!--Indexes-->
		<WTINDEX name="Owner">
			<WTATTRIBUTE name="OwnerType"/>
			<WTATTRIBUTE name="OwnerID"/>
		</WTINDEX>

    <WTINDEX name="Reference">
      <WTATTRIBUTE name="Reference"/>
    </WTINDEX>

    <WTINDEX name="CompanyID">
      <WTATTRIBUTE name="CompanyID"/>
    </WTINDEX>

    <WTINDEX name="BillingID">
      <WTATTRIBUTE name="BillingID"/>
    </WTINDEX>

    <!--Relationships-->
		<WTRELATIONSHIPS>
			<WTRELATIONSHIP name="Payment" entity="Payment" alias="pa"/>
			<WTRELATIONSHIP name="Common" entity="Payment" alias="pa"/>
			<WTRELATIONSHIP name="Member" entity="Payment" alias="pa">
				<WTENTITY name="SalesOrder" entity="SalesOrder" alias="so">
					<WTATTRIBUTE alias="pa" name="OwnerType" relname="52"/>
					<WTATTRIBUTE alias="pa" name="OwnerID" relalias="so" relname="SalesOrderID" connector="AND"/>
				</WTENTITY>
			</WTRELATIONSHIP>
		</WTRELATIONSHIPS>

		<!--List-->
		<WTENUM id="1" type="find">
			<WTATTRIBUTE name="PaymentID" default="true"/>
			<WTATTRIBUTE name="Reference"/>
			<WTATTRIBUTE name="PayDate"/>
			<WTATTRIBUTE name="PayType"/>
			<WTATTRIBUTE name="Amount"/>
			<WTATTRIBUTE name="Description" contains="true"/>
		</WTENUM>

		<!-- System Constants --> 
		<WTSYSCONS>
			<WTSYSCON name="PAYTYPE-VISA" value="1"/>
			<WTSYSCON name="PAYTYPE-MASTERCARD" value="2"/>
			<WTSYSCON name="PAYTYPE-DISCOVER" value="3"/>
			<WTSYSCON name="PAYTYPE-AMEX" value="4"/>
			<WTSYSCON name="PAYTYPE-CREDITCARD" value="4"/>
			<WTSYSCON name="PAYTYPE-CHECK" value="5"/>
			<WTSYSCON name="PAYTYPE-PAYPAL" value="6"/>
			<WTSYSCON name="PAYTYPE-CASH" value="7"/>
			<WTSYSCON name="PAYTYPE-PO" value="8"/>
			<WTSYSCON name="PAYTYPE-WALLET" value="10"/>
			<WTSYSCON name="PAYTYPE-MISC1" value="97"/>
			<WTSYSCON name="PAYTYPE-MISC2" value="98"/>
			<WTSYSCON name="PAYTYPE-MISC3" value="99"/>
			<WTSYSCON name="PAYTYPE-COMMISSION" value="90"/>
			<WTSYSCON name="PAYTYPE-CREDIT" value="91"/>
			<WTSYSCON name="PAYSTATUS-SUBMITTED" value="1"/>
			<WTSYSCON name="PAYSTATUS-PENDING" value="2"/>
			<WTSYSCON name="PAYSTATUS-APPROVED" value="3"/>
			<WTSYSCON name="PAYSTATUS-DECLINED" value="4"/>
			<WTSYSCON name="PAYSTATUS-RETURNED" value="5"/>
			<WTSYSCON name="PAYSTATUS-CANCELLED" value="6"/>
			<WTSYSCON name="BILL-PAYTYPE-CREDITCARD" value="1"/>
			<WTSYSCON name="BILL-PAYTYPE-CHECK" value="2"/>
		</WTSYSCONS>
	</WTENTITY>

	<WTPROCEDURES>
		<!--==================================================================================================================-->
		<WTPROCEDURE type="Add" name="Add" style="GenerateDataProc.xsl"/>
		<!--==================================================================================================================-->
		<WTPROCEDURE name="Count" type="Count" style="GenerateDataProc.xsl"/>
		<!--==================================================================================================================-->
		<WTPROCEDURE type="Delete" name="Delete" style="GenerateDataProc.xsl"/>
		<!--==================================================================================================================-->
		<WTPROCEDURE type="Fetch" name="Fetch" style="GenerateDataProc.xsl">
			<WTJOIN name="Common"/>
		</WTPROCEDURE>
    <!--==================================================================================================================-->
    <WTPROCEDURE type="Find" name="Find" style="GenerateDataProc.xsl">
      <WTBOOKMARK name=""/>
      <WTPARAM name="ATTR(CompanyID)" direction="input" required="false"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTJOIN name="Common"/>
      <WTCONDITION expr="ATTR(Payment.CompanyID)" oper="equal" value="PARAM(CompanyID)" connector="and"/>
    </WTPROCEDURE>
    <!--==================================================================================================================-->
    <WTPROCEDURE type="Find" name="FindType" style="GenerateDataProc.xsl">
      <WTBOOKMARK name=""/>
      <WTPARAM name="ATTR(CompanyID)" direction="input" required="false"/>
      <WTPARAM name="ATTR(PayType)" direction="input" required="false"/>
      <WTPARAM name="ATTR(Token)" direction="input" required="false"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTJOIN name="Common"/>
      <WTCONDITION expr="ATTR(Payment.CompanyID)" oper="equal" value="PARAM(CompanyID)" connector="and"/>
      <WTCONDITION expr="ATTR(Payment.PayType)" oper="greater-equal" value="PARAM(PayType)" connector="and"/>
      <WTCONDITION expr="ATTR(Payment.PayType)" oper="less-equal" value="PARAM(Token)" connector="and"/>
    </WTPROCEDURE>
    <!--==================================================================================================================-->
    <WTPROCEDURE type="Find" name="FindStatus" style="GenerateDataProc.xsl">
      <WTBOOKMARK name=""/>
      <WTPARAM name="ATTR(CompanyID)" direction="input" required="false"/>
      <WTPARAM name="ATTR(Status)" direction="input" required="false"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTJOIN name="Common"/>
      <WTCONDITION expr="ATTR(Payment.CompanyID)" oper="equal" value="PARAM(CompanyID)" connector="and"/>
      <WTCONDITION expr="ATTR(Payment.Status)" oper="equal" value="PARAM(Status)" connector="and"/>
    </WTPROCEDURE>
    <!--==================================================================================================================-->
    <WTPROCEDURE type="Find" name="FindStatusType" style="GenerateDataProc.xsl">
      <WTBOOKMARK name=""/>
      <WTPARAM name="ATTR(CompanyID)" direction="input" required="false"/>
      <WTPARAM name="ATTR(Status)" direction="input" required="false"/>
      <WTPARAM name="ATTR(PayType)" direction="input" required="false"/>
      <WTPARAM name="ATTR(Token)" direction="input" required="false"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTJOIN name="Common"/>
      <WTCONDITION expr="ATTR(Payment.CompanyID)" oper="equal" value="PARAM(CompanyID)" connector="and"/>
      <WTCONDITION expr="ATTR(Payment.Status)" oper="equal" value="PARAM(Status)" connector="and"/>
      <WTCONDITION expr="ATTR(Payment.PayType)" oper="greater-equal" value="PARAM(PayType)" connector="and"/>
      <WTCONDITION expr="ATTR(Payment.PayType)" oper="less-equal" value="PARAM(Token)" connector="and"/>
    </WTPROCEDURE>
    <!--==================================================================================================================-->
		<WTPROCEDURE type="Find" name="FindMember" style="GenerateDataProc.xsl">
			<WTBOOKMARK name=""/>
			<WTPARAM name="ATTR(MemberID)" direction="input"/>
			<WTPARAM name="ATTR(FromDate)" direction="input" required="false"/>
			<WTPARAM name="ATTR(ToDate)" direction="input" required="false"/>
			<WTPARAM name="SYS(userid)" direction="input"/>
			<WTJOIN name="Member"/>
			<WTCONDITION expr="CONST(so.MemberID)" oper="equal" value="PARAM(MemberID)" connector="and"/>
			<WTCONDITION expr="ATTR(Payment.PayDate)" oper="greater-equal" value="PARAM(FromDate)" connector="and"/>
			<WTCONDITION expr="ATTR(Payment.PayDate)" oper="less-equal" value="PARAM(ToDate)" connector="and"/>
		</WTPROCEDURE>
    <!--==================================================================================================================-->
    <WTPROCEDURE type="Find" name="FindOwner" style="GenerateDataProc.xsl">
      <WTBOOKMARK name=""/>
      <WTPARAM name="ATTR(OwnerType)" direction="input"/>
      <WTPARAM name="ATTR(OwnerID)" direction="input"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTJOIN name="Payment"/>
      <WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="PARAM(OwnerType)" connector="and"/>
      <WTCONDITION expr="ATTR(OwnerID)" oper="equal" value="PARAM(OwnerID)" connector="and"/>
    </WTPROCEDURE>
    <!--==================================================================================================================-->
    <WTPROCEDURE type="Find" name="FindOwnerType" style="GenerateDataProc.xsl">
      <WTBOOKMARK name=""/>
      <WTPARAM name="ATTR(OwnerType)" direction="input"/>
      <WTPARAM name="ATTR(OwnerID)" direction="input"/>
      <WTPARAM name="ATTR(PayType)" direction="input" required="false"/>
      <WTPARAM name="ATTR(Token)" direction="input" required="false"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTJOIN name="Payment"/>
      <WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="PARAM(OwnerType)" connector="and"/>
      <WTCONDITION expr="ATTR(OwnerID)" oper="equal" value="PARAM(OwnerID)" connector="and"/>
      <WTCONDITION expr="ATTR(Payment.PayType)" oper="greater-equal" value="PARAM(PayType)" connector="and"/>
      <WTCONDITION expr="ATTR(Payment.PayType)" oper="less-equal" value="PARAM(Token)" connector="and"/>
    </WTPROCEDURE>
    <!--==================================================================================================================-->
    <WTPROCEDURE type="Find" name="FindOwnerStatus" style="GenerateDataProc.xsl">
      <WTBOOKMARK name=""/>
      <WTPARAM name="ATTR(OwnerType)" direction="input"/>
      <WTPARAM name="ATTR(OwnerID)" direction="input"/>
      <WTPARAM name="ATTR(Status)" direction="input" required="false"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTJOIN name="Payment"/>
      <WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="PARAM(OwnerType)" connector="and"/>
      <WTCONDITION expr="ATTR(OwnerID)" oper="equal" value="PARAM(OwnerID)" connector="and"/>
      <WTCONDITION expr="ATTR(Payment.Status)" oper="equal" value="PARAM(Status)" connector="and"/>
    </WTPROCEDURE>
    <!--==================================================================================================================-->
    <WTPROCEDURE type="Find" name="FindOwnerStatusType" style="GenerateDataProc.xsl">
      <WTBOOKMARK name=""/>
      <WTPARAM name="ATTR(OwnerType)" direction="input"/>
      <WTPARAM name="ATTR(OwnerID)" direction="input"/>
      <WTPARAM name="ATTR(Status)" direction="input" required="false"/>
      <WTPARAM name="ATTR(PayType)" direction="input" required="false"/>
      <WTPARAM name="ATTR(Token)" direction="input" required="false"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTJOIN name="Payment"/>
      <WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="PARAM(OwnerType)" connector="and"/>
      <WTCONDITION expr="ATTR(OwnerID)" oper="equal" value="PARAM(OwnerID)" connector="and"/>
      <WTCONDITION expr="ATTR(Payment.Status)" oper="equal" value="PARAM(Status)" connector="and"/>
      <WTCONDITION expr="ATTR(Payment.PayType)" oper="greater-equal" value="PARAM(PayType)" connector="and"/>
      <WTCONDITION expr="ATTR(Payment.PayType)" oper="less-equal" value="PARAM(Token)" connector="and"/>
    </WTPROCEDURE>
    <!--==================================================================================================================-->
		<WTPROCEDURE type="Update" name="Update" style="GenerateDataProc.xsl"/>
    <!--==================================================================================================================-->
    <WTPROCEDURE type="List" name="ListOwner" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true">
      <WTPARAM name="ATTR(OwnerType)" direction="input"/>
      <WTPARAM name="ATTR(OwnerID)" direction="input"/>
      <WTCODEGROUP>
        <WTSELECT>
          <WTATTRIBUTE value="ATTR(Payment.PaymentID)"/>
          <WTATTRIBUTE value="ATTR(Payment.PayDate)"/>
          <WTATTRIBUTE value="ATTR(Payment.Amount)"/>
          <WTATTRIBUTE value="ATTR(Payment.Total)"/>
          <WTATTRIBUTE value="ATTR(Payment.Credit)"/>
          <WTATTRIBUTE value="ATTR(Payment.Status)"/>
          <WTATTRIBUTE value="ATTR(Payment.PayType)"/>
          <WTATTRIBUTE value="ATTR(Payment.Reference)"/>
          <WTATTRIBUTE value="ATTR(Payment.Description)"/>
          <WTATTRIBUTE value="ATTR(Payment.Notes)"/>
          <WTJOIN name="Payment"/>
          <WTCONDITION expr="ATTR(Payment.OwnerType)" oper="equal" value="PARAM(OwnerType)"/>
          <WTCONDITION expr="ATTR(Payment.OwnerID)" oper="equal" value="PARAM(OwnerID)" connector="and"/>
          <WTORDER name="ATTR(PayDate)" descend="true"/>
        </WTSELECT>
      </WTCODEGROUP>
    </WTPROCEDURE>
    <!--==================================================================================================================-->
    <WTPROCEDURE type="List" name="ListOwnerStatus" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
      <WTPARAM name="ATTR(OwnerType)" direction="input"/>
      <WTPARAM name="ATTR(OwnerID)" direction="input"/>
      <WTPARAM name="ATTR(Status)" direction="input"/>
      <WTCODEGROUP>
        <WTSELECT>
          <WTATTRIBUTE value="ATTR(Payment.PaymentID)"/>
          <WTATTRIBUTE value="ATTR(Payment.PayDate)"/>
          <WTATTRIBUTE value="ATTR(Payment.Amount)"/>
          <WTATTRIBUTE value="ATTR(Payment.Total)"/>
          <WTATTRIBUTE value="ATTR(Payment.Credit)"/>
          <WTATTRIBUTE value="ATTR(Payment.Status)"/>
          <WTATTRIBUTE value="ATTR(Payment.PayType)"/>
          <WTATTRIBUTE value="ATTR(Payment.Reference)"/>
          <WTATTRIBUTE value="ATTR(Payment.Description)"/>
          <WTATTRIBUTE value="ATTR(Payment.Notes)"/>
          <WTJOIN name="Payment"/>
          <WTCONDITION expr="ATTR(Payment.OwnerType)" oper="equal" value="PARAM(OwnerType)"/>
          <WTCONDITION expr="ATTR(Payment.OwnerID)" oper="equal" value="PARAM(OwnerID)" connector="and"/>
          <WTCONDITION expr="ATTR(Payment.Status)" oper="equal" value="PARAM(Status)" connector="and"/>
          <WTORDER name="ATTR(PayDate)" descend="true"/>
        </WTSELECT>
      </WTCODEGROUP>
    </WTPROCEDURE>
    <!--==================================================================================================-->
		<WTPROCEDURE name="LastBillingID" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
			<WTPARAM name="ATTR(OwnerType)" direction="input"/>
			<WTPARAM name="ATTR(OwnerID)" direction="input"/>
			<WTPARAM name="BillingID" direction="output" datatype="number"/>
		</WTPROCEDURE>

		<!--==================================================================================================================-->
		<WTPROCEDURE type="List" name="ListSubmittedCCCK" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
			<WTPARAM name="ATTR(CompanyID)" direction="input"/>
			<WTPARAM name="ATTR(OwnerType)" direction="input"/>
			<WTPARAM name="ATTR(PayDate)" direction="input"/>
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE value="ATTR(Payment.PaymentID)"/>
					<WTATTRIBUTE value="ATTR(Payment.Amount)"/>
					<WTATTRIBUTE value="ATTR(Payment.PayType)"/>
					<WTATTRIBUTE value="ATTR(Payment.Description)"/>
					<WTATTRIBUTE value="ATTR(Payment.Purpose)"/>
					<WTATTRIBUTE value="ATTR(Payment.TokenType)"/>
					<WTATTRIBUTE value="ATTR(Payment.TokenOwner)"/>
					<WTATTRIBUTE value="ATTR(Payment.Token)"/>
				</WTSELECT>
			</WTCODEGROUP>
		</WTPROCEDURE>
		<!--==================================================================================================-->
		<WTPROCEDURE name="SetPendingCCCK" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
			<WTPARAM name="Count" direction="output" datatype="number"/>
		</WTPROCEDURE>
		<!--==================================================================================================-->
		<WTPROCEDURE name="SetCompanyPendingCCCK" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
			<WTPARAM name="ATTR(CompanyID)" direction="input"/>
			<WTPARAM name="Count" direction="output" datatype="number"/>
		</WTPROCEDURE>
		<!--==================================================================================================-->
		<WTPROCEDURE name="GetCompany" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
			<WTPARAM name="ATTR(OwnerType)" direction="input"/>
			<WTPARAM name="ATTR(OwnerID)" direction="input"/>
			<WTPARAM name="CompanyID" direction="output" datatype="number"/>
		</WTPROCEDURE>

		<!--==================================================================================================-->
		<WTPROCEDURE name="GetOwnerEmail" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
			<WTPARAM name="ATTR(OwnerType)" direction="input"/>
			<WTPARAM name="ATTR(OwnerID)" direction="input"/>
			<WTPARAM name="Email" direction="output" datatype="text" length="100"/>
		</WTPROCEDURE>

		<!--==================================================================================================-->
		<WTPROCEDURE type="List" name="ReportStatusAmount" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
		<!--==================================================================================================-->
			<WTPARAM name="ATTR(ReportFromDate)" direction="input"/>
			<WTPARAM name="ATTR(ReportToDate)" direction="input"/>
			<WTPARAM name="ATTR(OwnerType)" direction="input"/> <!-- Option -->
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE value="ATTR(Payment.PaymentID)"/>
					<WTATTRIBUTE value="ATTR(Payment.Status)"/>
					<WTATTRIBUTE value="ATTR(Payment.Amount)"/>
				</WTSELECT>
			</WTCODEGROUP>
		</WTPROCEDURE>
		<!--==================================================================================================-->
		<WTPROCEDURE type="List" name="ReportStatusCount" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
		<!--==================================================================================================-->
			<WTPARAM name="ATTR(ReportFromDate)" direction="input"/>
			<WTPARAM name="ATTR(ReportToDate)" direction="input"/>
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE value="ATTR(Payment.PaymentID)"/>
					<WTATTRIBUTE value="ATTR(Payment.Status)"/>
					<WTATTRIBUTE value="ATTR(Payment.Count)"/>
				</WTSELECT>
			</WTCODEGROUP>
		</WTPROCEDURE>
		<!--==================================================================================================-->
		<WTPROCEDURE type="List" name="ReportPayTypeAmount" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
		<!--==================================================================================================-->
			<WTPARAM name="ATTR(Status)" direction="input"/>
			<WTPARAM name="ATTR(ReportFromDate)" direction="input"/>
			<WTPARAM name="ATTR(ReportToDate)" direction="input"/>
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE value="ATTR(Payment.PaymentID)"/>
					<WTATTRIBUTE value="ATTR(Payment.PayType)"/>
					<WTATTRIBUTE value="ATTR(Payment.Amount)"/>
				</WTSELECT>
			</WTCODEGROUP>
		</WTPROCEDURE>
		<!--==================================================================================================-->
		<WTPROCEDURE type="List" name="ReportPayTypeCount" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
		<!--==================================================================================================-->
			<WTPARAM name="ATTR(Status)" direction="input"/>
			<WTPARAM name="ATTR(ReportFromDate)" direction="input"/>
			<WTPARAM name="ATTR(ReportToDate)" direction="input"/>
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE value="ATTR(Payment.PaymentID)"/>
					<WTATTRIBUTE value="ATTR(Payment.PayType)"/>
					<WTATTRIBUTE value="ATTR(Payment.Count)"/>
				</WTSELECT>
			</WTCODEGROUP>
		</WTPROCEDURE>

		<!--==================================================================-->
		<WTPROCEDURE type="List" name="ListMemberPayments" style="GenerateDataProc.xsl" template="new" passthru="true" nodata="true">
		<!--==================================================================-->
			<WTPARAM name="ATTR(Payment.OwnerID)" direction="input"/> <!-- MemberID -->
			<WTCODEGROUP>
				<WTSELECT>
					<WTATTRIBUTE value="ATTR(Payment.PaymentID)"/>
					<WTATTRIBUTE value="ATTR(Payment.PayType)"/>
					<WTATTRIBUTE value="ATTR(Payment.Description)"/>
					<WTJOIN name="Payment"/>
					<WTCONDITION expr="ATTR(Payment.Status)" oper="not-equal" value="SYSCON(PAYSTATUS-DECLINED)"/>
					<WTCONDITION expr="ATTR(Payment.PayType)" oper="greater-equal" value="SYSCON(PAYTYPE-VISA)" connector="and"/>
					<WTCONDITION expr="ATTR(Payment.PayType)" oper="less-equal" value="SYSCON(PAYTYPE-CASH)" connector="and"/>
				</WTSELECT>
			</WTCODEGROUP>
		</WTPROCEDURE>
		<!--============================================================================================-->
		<WTPROCEDURE name="CompanyPayments" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" novalidate="true" nodata="true">
			<WTPARAM name="ATTR(CompanyID)" direction="input" required="false" passthru="true"/>
			<WTPARAM name="ATTR(PayDate)" direction="input" required="false" passthru="true"/>
			<WTPARAM name="Count" direction="output" datatype="number"/>
		</WTPROCEDURE>
		<!--============================================================================================-->
		<WTPROCEDURE name="CompanyDebits" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" novalidate="true" nodata="true">
			<WTPARAM name="ATTR(CompanyID)" direction="input" required="false" passthru="true"/>
			<WTPARAM name="ATTR(PayDate)" direction="input" required="false" passthru="true"/>
			<WTPARAM name="Count" direction="output" datatype="number"/>
		</WTPROCEDURE>
		<!--==================================================================================================-->
		<WTPROCEDURE name="Custom" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
			<WTPARAM name="ATTR(PaymentID)" direction="input" required="false" passthru="true"/>
			<WTPARAM name="ATTR(Reference)" direction="input" required="false" passthru="true"/>
			<WTPARAM name="ATTR(Status)" direction="input" required="false" passthru="true"/>
			<WTPARAM name="ATTR(Notes)" direction="input" required="false" passthru="true"/>
			<WTPARAM name="Result" direction="output" datatype="number"/>
		</WTPROCEDURE>
    <!--==================================================================================================================-->
    <WTPROCEDURE type="List" name="ListCustom" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
      <WTPARAM name="ATTR(CompanyID)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(OwnerType)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(OwnerID)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(Status)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(PayType)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(PayDate)" direction="input" required="false" passthru="true"/>
      <WTPARAM name="ATTR(Notes)" direction="input" required="false" passthru="true"/>
      <WTCODEGROUP>
        <WTSELECT>
          <WTATTRIBUTE value="ATTR(Payment.PaymentID)"/>
          <WTATTRIBUTE value="ATTR(Payment.PayDate)"/>
          <WTATTRIBUTE value="ATTR(Payment.Amount)"/>
          <WTATTRIBUTE value="ATTR(Payment.Total)"/>
          <WTATTRIBUTE value="ATTR(Payment.Credit)"/>
          <WTATTRIBUTE value="ATTR(Payment.Retail)"/>
          <WTATTRIBUTE value="ATTR(Payment.Commission)"/>
          <WTATTRIBUTE value="ATTR(Payment.Status)"/>
          <WTATTRIBUTE value="ATTR(Payment.PayType)"/>
          <WTATTRIBUTE value="ATTR(Payment.Purpose)"/>
          <WTATTRIBUTE value="ATTR(Payment.Description)"/>
          <WTATTRIBUTE value="ATTR(Payment.Notes)"/>
        </WTSELECT>
      </WTCODEGROUP>
    </WTPROCEDURE>

  </WTPROCEDURES>

	<WTWEBPAGES>
		<!--==================================================================================================================-->
		<WTWEBPAGE name="1001" caption="Find" audit="21/0" action="5" header="false" footer="false" navbar="false"  wrapper="wrapper750"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" secured="125">
		<!--==================================================================================================================-->
			<WTPARAM name="SearchText" datatype="text"/>
			<WTPARAM name="FindTypeID" datatype="number"/>
			<WTPARAM name="Bookmark" datatype="text"/>
			<WTPARAM name="Direction" datatype="number"/>
			<WTPARAM name="CompanyID" datatype="number"/>
			<WTPARAM name="OwnerType" datatype="number"/>
			<WTPARAM name="OwnerID" datatype="number"/>
			<WTPARAM name="Status" datatype="number"/>

      <WTCODEGROUP>
        <WTCONDITION expr="NotEmployee"/>
        <WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="SYS(CompanyID)" connector="and"/>
        <WTCUSTOM>AbortUser()</WTCUSTOM>
      </WTCODEGROUP>

      <WTSETATTRIBUTE name="PARAM(FindTypeID)" value="FINDID(PaymentID)">
				<WTCONDITION expr="PARAM(FindTypeID)" oper="equal" value="CONST(0)"/>
			</WTSETATTRIBUTE>

			<WTACTION id="0" name="New" type="New">
				<WTSETATTRIBUTE name="PARAM(Status)" value="CONST(0)"/>
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
				<WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
					<WTSETATTRIBUTE name="CONST(.FindTypeID)" value="CONST(reqFindTypeID)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlPayments" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(14)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark"/>
			</WTACTION>

			<WTACTION id="5" name="Find" type="New">
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTACTION id="6" name="Previous" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(2)"/>
			</WTACTION>

			<WTACTION id="7" name="Next" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
				<WTCONDITION expr="CONST(reqActionCode)" oper="not-equal" value="CONST(0)"/>
				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
					<WTMETHOD name="FindOwner">
						<WTCONDITION expr="PARAM(Status)" oper="equal" value="CONST(0)"/>
						<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
						<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
						<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
						<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
						<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
						<WTPARAM name="OwnerType" direction="input" value="PARAM(OwnerType)"/>
						<WTPARAM name="OwnerID" direction="input" value="PARAM(OwnerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="FindOwnerStatus">
						<WTCONDITION expr="PARAM(Status)" oper="not-equal" value="CONST(0)"/>
						<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
						<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
						<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
						<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
						<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
						<WTPARAM name="OwnerType" direction="input" value="PARAM(OwnerType)"/>
						<WTPARAM name="OwnerID" direction="input" value="PARAM(OwnerID)"/>
						<WTPARAM name="Status" direction="input" value="PARAM(Status)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTCODEGROUP>
				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="CONST(0)"/>
					<WTSETATTRIBUTE name="PARAM(CompanyID)" value="CONST(0)">
						<WTCONDITION expr="PARAM(CompanyID)" oper="less" value="CONST(0)"/>
					</WTSETATTRIBUTE>
					<WTMETHOD name="Find">
						<WTCONDITION expr="PARAM(Status)" oper="equal" value="CONST(0)"/>
						<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
						<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
						<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
						<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
						<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="FindStatus">
						<WTCONDITION expr="PARAM(Status)" oper="not-equal" value="CONST(0)"/>
						<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
						<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
						<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
						<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
						<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="Status" direction="input" value="PARAM(Status)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTCODEGROUP>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlPayments" direction="return" datatype="text"/>
					<WTPARAM name="Option" direction="input" value="CONST(15)"/>
				</WTMETHOD>
			</WTOBJECT>
			<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark">
				<WTSETATTRIBUTE name="ATTR(LastBookmark)" value="PARAM(Bookmark)"/>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlBookmark" direction="return" datatype="text"/>
				</WTMETHOD>
			</WTOBJECT>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="750" align="left"/>

				<WTROW>
					<WTSTATIC col="1" label="Payments" class="PageHeading"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTSTATIC col="1" merge="2" label="PaymentFindText" align="left" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="SearchBy" class="ColumnHeader"/>
					<WTCOMBO col="1" value="ATTR(Payments.FindTypeID)" translate="true"/>
					<WTSTATIC col="1" tag="SearchFor" class="ColumnHeader"/>
					<WTTEXT col="1" value="ATTR(Bookmark.SearchText)" size="20" focus="true"/>
					<WTBUTTON col="1" action="5" value="CONST(Go)" default="true"/>
					<WTSTATIC col="1" tag="Status" class="ColumnHeader"/>
					<WTCOMBO col="1" value="PARAM(Status)">
						<WTOPTION id="0" label="All"/>
						<WTOPTION id="1" label="Submitted"/>
						<WTOPTION id="2" label="Pending"/>
						<WTOPTION id="3" label="Approved"/>
						<WTOPTION id="4" label="Declined"/>
						<WTOPTION id="5" label="Returned"/>
            <WTOPTION id="6" label="Cancelled"/>
            <WTOPTION id="7" label="Partial"/>
          </WTCOMBO>
				</WTROW>

				<WTROW>
					<WTCONDITION expr="SYS(searchtype)" oper="not-equal" value="CONST(0)"/>
					<WTRECORDSET col="1" graybar="true" prevnext="top" entity="Payment">
						<WTCOLUMN width="15" align="left" valign="top" label="PayDate" />
						<WTCOLUMN width="12" align="left" valign="top" label="Amount" />
						<WTCOLUMN width="12" align="left" valign="top" label="Total" />
						<WTCOLUMN width="12" align="left" valign="top" label="Credit" />
						<WTCOLUMN width="15" align="left" valign="top" label="Status" />
						<WTCOLUMN width="15" align="left" valign="top" label="PayType" />
						<WTCOLUMN width="13" align="left" valign="top" label="Reference" />
						<WTCOLUMN width="6" align="right" valign="top" label="#" />
						<WTROW>
							<WTSTATIC col="1">
								<WTSTATIC value="DATA(Payment.PayDate)" space="1"/>
								<WTCODEGROUP>
									<WTCONDITION expr="IsEmployee"/>
									<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
									<WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
									<WTIMAGE value="CONST(Edit.gif)" imgalign="absmiddle">
										<WTLINK name="1003">
											<WTPARAM name="PaymentID" value="DATA(Payment.PaymentID)"/>
										</WTLINK>
									</WTIMAGE>
								</WTCODEGROUP>
							</WTSTATIC>
							<WTSTATIC col="2" value="DATA(Payment.Amount)"/>
							<WTSTATIC col="3" value="DATA(Payment.Total)"/>
							<WTSTATIC col="4" value="DATA(Payment.Credit)"/>
							<WTSTATIC col="5">
								<WTSTATIC value="DATA(Payment.Status)" fontcolor="green">
									<WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(2)"/>
								</WTSTATIC>
								<WTSTATIC value="DATA(Payment.Status)" fontcolor="blue">
									<WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(2)"/>
								</WTSTATIC>
								<WTSTATIC value="DATA(Payment.Status)">
									<WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(3)"/>
								</WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="red">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="greater" value="CONST(3)"/>
                  <WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(7)" connector="and"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="orange">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(7)"/>
                </WTSTATIC>
              </WTSTATIC>
							<WTSTATIC col="6" value="DATA(Payment.PayType)"/>
							<WTSTATIC col="7" value="DATA(Payment.Reference)"/>
							<WTSTATIC col="8" value="DATA(Payment.PaymentID)"/>
						</WTROW>
						<WTROW>
							<WTCONDITION expr="IsManager"/>
							<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
							<WTSTATIC col="1" value="CONST(&lt;xsl:value-of select=&quot;@ownertype&quot;/&gt;.&lt;xsl:value-of select=&quot;@ownerid&quot;/&gt;)" fontcolor="gray"/>
							<WTSTATIC col="2" merge="7" value="DATA(Payment.Description)" fontcolor="gray"/>
						</WTROW>
					</WTRECORDSET>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>

		<!--==================================================================================================================-->
		<WTWEBPAGE name="1002" header="false" footer="false" navbar="false" wrapper="wrapper600"
               aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLAdd.xsl" focus="false" secured="125">
		<!--==================================================================================================================-->
			<WTPARAM name="OwnerType" datatype="number"/>
			<WTPARAM name="OwnerID" datatype="number"/>
			<WTPARAM name="ProcessPayment" datatype="number"/>

			<WTPARAM name="PaymentOptions" datatype="text"/>
			<WTPARAM name="MiscPay1" datatype="text"/>
			<WTPARAM name="MiscPay2" datatype="text"/>
			<WTPARAM name="MiscPay3" datatype="text"/>
			<WTPARAM name="CompanyID" datatype="number"/>

			<WTINCLUDE name="Billing.asp"/>

			<WTSUB name="LoadPayTypes">
				<WTOBJECT name="Business" project="ptsBusinessUser" class="CBusiness">
					<WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="BusinessID" direction="input" value="CONST(1)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(PaymentOptions)" value="ATTR(PaymentOptions)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay1)" value="ATTR(MiscPay1)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay2)" value="ATTR(MiscPay2)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay3)" value="ATTR(MiscPay3)"/>
				</WTOBJECT>
				<WTOBJECT name="Coption" project="ptsCoptionUser" class="CCoption">
					<WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="FetchCompany">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
					</WTMETHOD>			
					<WTMETHOD name="Load">
						<WTPARAM name="CoptionID" direction="input" value="ATTR(CoptionID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(PaymentOptions)" value="ATTR(PaymentOptions)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay1)" value="ATTR(MiscPay1)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay2)" value="ATTR(MiscPay2)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay3)" value="ATTR(MiscPay3)"/>
				</WTOBJECT>
			</WTSUB>
			
			<WTSUB name="LoadPayment">
<!--				<WTSETATTRIBUTE name="PARAM(ProcessPayment)" value="CONST(1)"/>-->
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(Payment.PayDate)" value="SYS(now)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.Status)" value="CONST(0)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.Status)" value="SYSCON(PAYSTATUS-APPROVED)">
						<WTCONDITION expr="IsEmployee"/>
					</WTSETATTRIBUTE>
					<WTSETATTRIBUTE name="ATTR(Payment.OwnerType)" value="PARAM(OwnerType)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.OwnerID)" value="PARAM(OwnerID)"/>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(OwnerType)" oper="not-equal" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(CompanyID)" value="ATTR(OwnerID)">
							<WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="ENTITY(Company)"/>
						</WTSETATTRIBUTE>
						<WTMETHOD name="GetCompany">
							<WTCONDITION expr="ATTR(OwnerType)" oper="not-equal" value="ENTITY(Company)"/>
							<WTPARAM name="reqCompanyID" direction="return" datatype="number"/>
							<WTPARAM name="OwnerType" direction="input" value="ATTR(OwnerType)"/>
							<WTPARAM name="OwnerID" direction="input" value="ATTR(OwnerID)"/>
						</WTMETHOD>
					</WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="NotEmployee"/>
            <WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="SYS(CompanyID)" connector="and"/>
            <WTCUSTOM>AbortUser()</WTCUSTOM>
          </WTCODEGROUP>
          <WTMETHOD name="XML">
						<WTPARAM name="xmlPayment" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTCALLSUB name="LoadPayTypes"/>
				<WTOBJECT name="Billing" project="ptsBillingUser" class="CBilling">
					<WTMETHOD name="Load">
						<WTPARAM name="BillingID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlBilling" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="ReloadPayment">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTES/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlPayment" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Billing" project="ptsBillingUser" class="CBilling">
					<WTMETHOD name="Load">
						<WTPARAM name="BillingID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTES/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlBilling" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTACTION id="0" name="New" type="New">
				<WTCALLSUB name="LoadPayment"/>
			</WTACTION>

			<WTACTION id="2" name="Add" type="Add">

				<!-- Validate Card Number or Check Routing Number -->
				<WTSETATTRIBUTE name="CONST(tmpPayType)" value="FORM(PayType)" />
				<WTSETATTRIBUTE name="CONST(tmpCardNumber)" value="FORM(CardNumber)" />
				<WTSETATTRIBUTE name="CONST(tmpCheckRoute)" value="FORM(CheckRoute)" />

				<WTOBJECT name="Payment" project="wtPayment" class="CPayment">
					<WTCONDITION expr="CONST(tmpPayType)" oper="equal" value="SYSCON(PAYTYPE-CHECK)"/>
					<WTMETHOD name="ValidCheckRoute">
						<WTPARAM name="CheckRoute" direction="input" value="CONST(tmpCheckRoute)" />
						<WTPARAM name="result" direction="return" datatype="number" />
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(result)" oper="equal" value="CONST(0)" />
						<WTERROR number="10007" message="Oops, Invalid Check Routing Number." />
					</WTCODEGROUP>
				</WTOBJECT>
				<WTOBJECT name="Payment" project="wtPayment" class="CPayment">
					<WTCONDITION expr="CONST(tmpPayType)" oper="less-equal" value="SYSCON(PAYTYPE-CREDITCARD)"/>
					<WTMETHOD name="ValidCardNumber">
						<WTPARAM name="CardNumber" direction="input" value="CONST(tmpCardNumber)" />
						<WTPARAM name="result" direction="return" datatype="number" />
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(result)" oper="less" value="CONST(0)" />
						<WTERROR number="10008" message="Oops, Invalid Length of Credit Card Number." />
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(result)" oper="equal" value="CONST(0)" />
						<WTERROR number="10009" message="Oops, Invalid Credit Card Number." />
					</WTCODEGROUP>
					<WTCODEGROUP> <!-- card matches selected type -->
						<WTCONDITION expr="CONST(result)" oper="greater-equal" value="CONST(1)" />
						<WTCONDITION expr="CONST(result)" oper="less-equal" value="CONST(4)" connector="and"/>
						<WTCONDITION expr="CONST(CLng(result))" oper="not-equal" value="CONST(CLng(tmpPayType))" connector="and"/>
						<WTERROR number="10010" message="Oops, Selected Card Type does not match Card Number."/>
					</WTCODEGROUP>
					<WTCODEGROUP> <!-- Visa -->
						<WTCONDITION expr="CONST(result)" oper="equal" value="CONST(1)" />
						<WTCONDITION expr="NotPaymentVisa" connector="and"/>
						<WTERROR number="10012" message="Oops, Invalid Credit Card Type." />
					</WTCODEGROUP>
					<WTCODEGROUP> <!-- Mastercard -->
						<WTCONDITION expr="CONST(result)" oper="equal" value="CONST(2)" />
						<WTCONDITION expr="NotPaymentMC" connector="and"/>
						<WTERROR number="10012" message="Oops, Invalid Credit Card Type." />
					</WTCODEGROUP>
					<WTCODEGROUP> <!-- Discover -->
						<WTCONDITION expr="CONST(result)" oper="equal" value="CONST(3)" />
						<WTCONDITION expr="NotPaymentDiscover" connector="and"/>
						<WTERROR number="10012" message="Oops, Invalid Credit Card Type." />
					</WTCODEGROUP>
					<WTCODEGROUP> <!-- Amex -->
						<WTCONDITION expr="CONST(result)" oper="equal" value="CONST(4)" />
						<WTCONDITION expr="NotPaymentAmex" connector="and"/>
						<WTERROR number="10012" message="Oops, Invalid Credit Card Type." />
					</WTCODEGROUP>
					<WTCODEGROUP> <!-- All other credit cards are not allowed -->
						<WTCONDITION expr="CONST(result)" oper="greater" value="CONST(4)" />
						<WTERROR number="10012" message="Oops, Invalid Credit Card Type." />
					</WTCODEGROUP>
				</WTOBJECT>

				<WTOBJECT name="Billing" project="ptsBillingUser" class="CBilling">
					<WTCONDITION expr="NoErrors" />
					<WTCONDITION expr="CONST(tmpPayType)" oper="less-equal" value="SYSCON(PAYTYPE-CHECK)" connector="and"/>
					<WTSETATTRIBUTE name="CONST(tmpPayType)" value="FORM(PayType)"/>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(tmpPayType)" oper="less-equal" value="SYSCON(PAYTYPE-CREDITCARD)" />
						<WTSETATTRIBUTE name="ATTR(PayType)" value="SYSCON(BILL-PAYTYPE-CREDITCARD)"/>
						<WTSETATTRIBUTE name="ATTR(CardType)" value="CONST(tmpPayType)"/>
						<WTSETATTRIBUTE name="ATTR(CardNumber)" value="FORM(CardNumber)" />
						<WTSETATTRIBUTE name="ATTR(CardMo)" value="FORM(CardMo)" />
						<WTSETATTRIBUTE name="ATTR(CardYr)" value="FORM(CardYr)" />
						<WTSETATTRIBUTE name="ATTR(CardName)" value="FORM(CardName)" />
						<WTSETATTRIBUTE name="ATTR(CardCode)" value="FORM(CardCode)" />
						<WTSETATTRIBUTE name="ATTR(Zip)" value="FORM(CardZip)" />
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(tmpPayType)" oper="equal" value="SYSCON(PAYTYPE-CHECK)" />
						<WTSETATTRIBUTE name="ATTR(PayType)" value="SYSCON(BILL-PAYTYPE-CHECK)"/>
						<WTSETATTRIBUTE name="ATTR(CheckBank)" value="FORM(CheckBank)" />
						<WTSETATTRIBUTE name="ATTR(CheckRoute)" value="FORM(CheckRoute)" />
						<WTSETATTRIBUTE name="ATTR(CheckAccount)" value="FORM(CheckAccount)" />
						<WTSETATTRIBUTE name="ATTR(CheckNumber)" value="FORM(CheckNumber)" />
						<WTSETATTRIBUTE name="ATTR(CheckName)" value="FORM(CheckName)" />
					</WTCODEGROUP>
					<WTMETHOD name="Validate">
						<WTPARAM name="New" direction="input" value="CONST(1)" />
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
					</WTMETHOD>
					<WTCALLSUB name="tmpDescription = BillingPayment( oBilling )"/>
				</WTOBJECT>

				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTCONDITION expr="NoErrors"/>
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(Payment.OwnerType)" value="PARAM(OwnerType)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.OwnerID)" value="PARAM(OwnerID)"/>
					<WTSETATTRIBUTES/>
					<WTSETATTRIBUTE name="ATTR(Total)" value="ATTR(Amount)"/>
					<WTSETATTRIBUTE name="ATTR(Description)" value="CONST(tmpDescription)"/>
					<WTMETHOD name="Add">
						<WTPARAM name="reqPaymentID" direction="return" datatype="number"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTOBJECT>
<WTCUSTOM>
		If (xmlError = "") Then
			If Request.Form.Item("ProcessPayment") = 1 Then
				Response.Redirect "1004.asp?PaymentID=" &amp; reqPaymentID &amp; "&amp;IsTxn=1" &amp; "&amp;ReturnURL=" &amp; Replace(GetCache("1002URL"), "%26", "&amp;")
			Else
				Response.Redirect Replace(GetCache("1002URL"), "%26", "&amp;") &amp; "&amp;TxnStatus=1"
			End If
		End If
</WTCUSTOM>
				<WTCALLSUB name="ReloadPayment">
					<WTCONDITION expr="IsErrors"/>
				</WTCALLSUB>

			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
<WTCUSTOM>
				Response.Redirect Replace(GetCache("1002URL"), "%26", "&amp;") &amp; "&amp;TxnStatus=2" 
</WTCUSTOM>
			</WTACTION>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="300" align="right"/>
				<WTCOLUMN width="440" align="left"/>

				<WTROW>
					<WTHIDDEN value="PARAM(PaymentOptions)"/>
				</WTROW>

				<WTFUNCTION name="ShowPayType()">	
					var PayType = document.getElementById('PayType').value;
					if (PayType &gt;= 1 &amp;&amp; PayType &lt;= 4)
						document.getElementById('ShowCreditCard').style.display = '';
					else 
						document.getElementById('ShowCreditCard').style.display = 'none';
							
					if (PayType == 5)
						document.getElementById('ShowCheck').style.display = '';
					else 
						document.getElementById('ShowCheck').style.display = 'none';
			   </WTFUNCTION>
				<WTLOAD>
					ShowPayType();
				</WTLOAD>

				<WTROW>
					<WTSTATIC col="1" merge="2" label="NewPayment" class="PageHeading" align="left"/>
				</WTROW>
				<WTROW>
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
				</WTROW>
				<WTROW>
					<WTIMAGE col="1" merge="2" align="left" value="CONST(padlock.gif)" imgalign="absmiddle"/>
					<WTSTATIC col="1" merge="2" label="SecurePayment" bold="true"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="IsEmployee"/>
					<WTROW>
						<WTSTATIC col="1" tag="PayDate"/>
						<WTTEXT col="2" value="ATTR(Payment.PayDate)"/>
					</WTROW>
				</WTCODEGROUP>
				<WTCODEGROUP>
					<WTCONDITION expr="NotEmployee"/>
					<WTROW>
						<WTSTATIC col="1" tag="PayDate"/>
						<WTSTATIC col="2" value="ATTR(Payment.PayDate)"/>
					</WTROW>
					<WTROW>
						<WTHIDDEN value="ATTR(Payment.PayDate)"/>
					</WTROW>
				</WTCODEGROUP>
				<WTROW>
					<WTSTATIC col="1" tag="Amount"/>
					<WTTEXT col="2" value="ATTR(Payment.Amount)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="IsEmployee"/>
					<WTROW>
						<WTSTATIC col="1" tag="Status"/>
						<WTCOMBO col="2" value="ATTR(Payment.Status)"/>
					</WTROW>
					<WTROW>
				 		<WTSTATIC col="1" tag="Reference"/>
				 		<WTTEXT col="2" value="ATTR(Payment.Reference)"/>
					</WTROW>
					<WTROW>
						<WTSTATIC col="1" tag="Purpose"/>
						<WTTEXT col="2" value="ATTR(Payment.Purpose)"/>
					</WTROW>
				</WTCODEGROUP>

				<WTROW>
					<WTCONDITION expr="NotEmployee"/>
					<WTHIDDEN value="ATTR(Payment.Status)"/>
					<WTHIDDEN value="ATTR(Payment.Reference)"/>
					<WTHIDDEN value="ATTR(Payment.Purpose)"/>
				</WTROW>
				<WTROW>
					<WTCONDITION expr="IsManager"/>
					<WTSTATIC col="1" tag="OwnerType"/>
					<WTTEXT col="2" value="ATTR(Payment.OwnerType)"/>
					<WTSTATIC col="2" tag="OwnerID"/>
					<WTTEXT col="2" value="ATTR(Payment.OwnerID)"/>
				</WTROW>
				<WTROW>
					<WTCONDITION expr="NotManager"/>
					<WTHIDDEN value="ATTR(Payment.OwnerType)"/>
					<WTHIDDEN value="ATTR(Payment.OwnerID)"/>
				</WTROW>

				<WTROW margin-top="12" margin-bottom="12">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="PayType"/>
					<WTCOMBO col="2" value="ATTR(Payment.PayType)">
						<WTCHANGE>ShowPayType();</WTCHANGE>
						<WTOPTION id="0" label="blank"/>
						<WTOPTION id="1" label="Visa">
							<WTCONDITION expr="_IsPaymentVisa"/>
						</WTOPTION>
						<WTOPTION id="2" label="MasterCard">
							<WTCONDITION expr="_IsPaymentMC"/>
						</WTOPTION>
						<WTOPTION id="3" label="Discover">
							<WTCONDITION expr="_IsPaymentDiscover"/>
						</WTOPTION>
						<WTOPTION id="4" label="Amex">
							<WTCONDITION expr="_IsPaymentAmex"/>
						</WTOPTION>
						<WTOPTION id="5" label="Check">
							<WTCONDITION expr="_IsPaymentCheck"/>
						</WTOPTION>
						<WTOPTION id="6" label="eWallet">
							<WTCONDITION expr="_IsPaymenteWallet"/>
						</WTOPTION>
						<WTOPTION id="7" label="Cash">
							<WTCONDITION expr="_IsPaymentCash"/>
						</WTOPTION>
						<WTOPTION id="8" label="PO">
							<WTCONDITION expr="_IsPaymentPO"/>
						</WTOPTION>
            <WTOPTION id="10" label="Wallet">
              <WTCONDITION expr="_IsPaymentWallet"/>
            </WTOPTION>
            <WTOPTION id="11" label="iPayout">
              <WTCONDITION expr="_IsPaymentiPayout"/>
            </WTOPTION>
            <WTOPTION id="12" label="PayQuicker">
							<WTCONDITION expr="_IsPaymentPayQuicker"/>
						</WTOPTION>
						<WTOPTION id="13" label="SolidTrust">
							<WTCONDITION expr="_IsPaymentSolidTrust"/>
						</WTOPTION>
            <WTOPTION id="14" label="BitCoin">
              <WTCONDITION expr="_IsPaymentBitCoin"/>
            </WTOPTION>
            <WTOPTION id="15" label="BitCoinCash">
              <WTCONDITION expr="_IsPaymentBitCoinCash"/>
            </WTOPTION>
            <WTOPTION id="21" label="Nexxus">
              <WTCONDITION expr="_IsPaymentNexxus"/>
            </WTOPTION>
            <WTOPTION id="97" value="PARAM(MiscPay1)">
							<WTCONDITION expr="_IsPaymentMisc1"/>
						</WTOPTION>
						<WTOPTION id="98" value="PARAM(MiscPay2)">
							<WTCONDITION expr="_IsPaymentMisc2"/>
						</WTOPTION>
						<WTOPTION id="99" value="PARAM(MiscPay3)">
							<WTCONDITION expr="_IsPaymentMisc3"/>
						</WTOPTION>
					</WTCOMBO>
				</WTROW>

				<WTROW id="ShowCreditCard">
					<WTCONDITION expr="_IsPaymentVisa"/>
					<WTCONDITION expr="_IsPaymentMC" connector="or"/>
					<WTCONDITION expr="_IsPaymentDiscover" connector="or"/>
					<WTCONDITION expr="_IsPaymentAmex" connector="or"/>
					<WTTABLE col="1" merge="2">
						<WTCOLUMN width="300" align="right"/>
						<WTCOLUMN width="440" align="left"/>
						<WTROW margin-top="6" margin-bottom="6">
							<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
						</WTROW>
						<WTROW margin-bottom="6">
							<WTSTATIC col="1" merge="2" align="left" label="CardText" class="prompt"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardNumber"/>
							<WTTEXT col="2" value="ATTR(Billing.CardNumber)" required="true">
								<WTEXIT>var x = this.value; var filter  = /[^0-9]/; if (filter.test(x)) alert('Please enter digits only for your Credit Card Number')</WTEXIT>
							</WTTEXT>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardDate"/>
							<WTCOMBO col="2" value="ATTR(Billing.CardMo)" />
							<WTCOMBO col="2" value="ATTR(Billing.CardYr)" required="true"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardName"/>
							<WTTEXT col="2" value="ATTR(Billing.CardName)" required="true"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardCode"/>
							<WTTEXT col="2" value="ATTR(Billing.CardCode)" required="true"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardZip"/>
							<WTTEXT col="2" name="CardZip" required="true"/>
						</WTROW>
					</WTTABLE>
				</WTROW>

				<WTROW id="ShowCheck">
					<WTCONDITION expr="_IsPaymentCheck"/>
					<WTTABLE col="1" merge="2">
						<WTCOLUMN width="300" align="right"/>
						<WTCOLUMN width="440" align="left"/>
						<WTROW margin-top="12" margin-bottom="12">
							<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
						</WTROW>
						<WTROW margin-bottom="12">
							<WTSTATIC col="1" merge="2" align="left" label="CheckText" class="prompt"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CheckBank"/>
							<WTTEXT col="2" value="ATTR(Billing.CheckBank)" required="true"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CheckRoute"/>
							<WTTEXT col="2" value="ATTR(Billing.CheckRoute)" required="true"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CheckAccount"/>
							<WTTEXT col="2" value="ATTR(Billing.CheckAccount)" required="true"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CheckNumber"/>
							<WTTEXT col="2" value="ATTR(Billing.CheckNumber)" required="true"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CheckName"/>
							<WTTEXT col="2" value="ATTR(Billing.CheckName)" required="true"/>
						</WTROW>
						<WTROW>
					   		<WTIMAGE col="1" merge="2" align="center" value="CONST(checkref.gif)"/>
						</WTROW>
					</WTTABLE>
				</WTROW>
				
				<WTCODEGROUP>
				 	 <WTCONDITION expr="IsEmployee"/>
					<WTROW margin-top="12" margin-bottom="12">
						<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
					</WTROW>
					<WTROW>
						<WTSTATIC col="1" merge="2" tag="Notes" align="left"/>
					</WTROW>
					<WTROW>
						<WTMEMO col="1" merge="2" align="left" value="ATTR(Payment.Notes)" cols="72" rows="4"/>
					</WTROW>
					 <WTROW margin-top="12" margin-bottom="12">
					 	<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
					 </WTROW>

<!--
					<WTROW margin-top="12">
						<WTCONDITION expr="IsEmployee"/>
						<WTCHECK col="1" merge="2" value="PARAM(ProcessPayment)" align="center"/>
					</WTROW>
					<WTROW>
						<WTCONDITION expr="NotEmployee"/>
						<WTHIDDEN value="PARAM(ProcessPayment)"/>
					</WTROW>
-->
					<WTROW>
						<WTHIDDEN value="PARAM(ProcessPayment)"/>
					</WTROW>
				</WTCODEGROUP>
				
				<WTROW>
					<WTCONDITION expr="NotEmployee"/>
					<WTHIDDEN value="ATTR(Payment.Notes)"/>
					<WTHIDDEN value="PARAM(ProcessPayment)"/>
				</WTROW>

				<WTROW margin-top="6">
					<WTIMAGE col="1" merge="2" align="center" value="CONST(padlock.gif)" imgalign="absmiddle"/>
					<WTSTATIC col="1" merge="2" label="SecurePayment" bold="true"/>
				</WTROW>

				<WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" merge="2" action="2" value="CONST(Add)" align="center">
						<WTCONDITION expr="IsActive"/>
						<WTCLICK>doSubmit(2,&quot;&quot;); this.disabled = true;</WTCLICK>
					</WTBUTTON>
					<WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)"/>
				</WTROW>
			</WTCONTENT>
		</WTWEBPAGE>

		<!--==================================================================================================================-->
		<WTWEBPAGE name="1003" audit="?/2,21/0,51/0" header="false" footer="false" navbar="false" wrapper="wrapper600"
               aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" secured="125">
		<!--==================================================================================================================-->
			<WTPARAM name="PaymentID" datatype="number"/>
			<WTPARAM name="PaymentOptions" datatype="text"/>
			<WTPARAM name="MiscPay1" datatype="text"/>
			<WTPARAM name="MiscPay2" datatype="text"/>
			<WTPARAM name="MiscPay3" datatype="text"/>
			<WTPARAM name="CompanyID" datatype="number"/>
			<WTPARAM name="Preview" datatype="number"/>
			<WTPARAM name="Popup" datatype="number"/>
			<WTPARAM name="Txn" datatype="number"/>
			<WTPARAM name="OwnerType" datatype="number"/>
			<WTPARAM name="MemberID" datatype="number"/>
			<WTPARAM name="SalesOrderID" datatype="number"/>
			<WTPARAM name="HidePayment" datatype="number"/>
			<WTPARAM name="Message" datatype="text"/>
			<WTPARAM name="ProductOrder" datatype="number"/>

			<WTINCLUDE name="Billing.asp"/>
<!--			<WTINCLUDE name="btc.asp"/>-->

      <WTSUB name="ProcessPayment">
				<WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
					<WTMETHOD name="Custom">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="Status" direction="input" value="CONST(99)"/>
						<WTPARAM name="EnrollDate" direction="input" value="CONST(0)"/>
						<WTPARAM name="Quantity" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="Amount" direction="input" value="CONST(0)"/>
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTSUB>

			<WTSUB name="LoadPayTypes">
				<WTOBJECT name="Business" project="ptsBusinessUser" class="CBusiness">
					<WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="BusinessID" direction="input" value="CONST(1)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(PaymentOptions)" value="ATTR(PaymentOptions)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay1)" value="ATTR(MiscPay1)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay2)" value="ATTR(MiscPay2)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay3)" value="ATTR(MiscPay3)"/>
				</WTOBJECT>
				<WTOBJECT name="Coption" project="ptsCoptionUser" class="CCoption">
					<WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="FetchCompany">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
					</WTMETHOD>			
					<WTMETHOD name="Load">
						<WTPARAM name="CoptionID" direction="input" value="ATTR(CoptionID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(PaymentOptions)" value="ATTR(PaymentOptions)"/>
					<WTSETATTRIBUTE name="PARAM(PaymentOptions)" value="CONST(&quot;ABCDEFGHIJK&quot;)">
						<WTCONDITION expr="PARAM(PaymentOptions)" oper="equal" value="CONST(&quot;&quot;)"/>
					</WTSETATTRIBUTE>
					<WTSETATTRIBUTE name="PARAM(MiscPay1)" value="ATTR(MiscPay1)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay2)" value="ATTR(MiscPay2)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay3)" value="ATTR(MiscPay3)"/>
				</WTOBJECT>
			</WTSUB>
			
			<WTSUB name="LoadPayment">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
          <WTCODEGROUP>
            <WTCONDITION expr="NotEmployee"/>
            <WTCONDITION expr="ATTR(CompanyID)" oper="not-equal" value="CONST(CSTR(reqSysCompanyID))" connector="and"/>
            <WTCUSTOM>AbortUser()</WTCUSTOM>
          </WTCODEGROUP>
          <WTSETATTRIBUTE name="PARAM(CompanyID)" value="ATTR(CompanyID)"/>
					<WTSETATTRIBUTE name="PARAM(OwnerType)" value="ATTR(OwnerType)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.CommStatus)" value="CONST(1)">
						<WTCONDITION expr="ATTR(Payment.CommStatus)" oper="equal" value="CONST(0)"/>
					</WTSETATTRIBUTE>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(InStr(.Description, &quot;Charged&quot;))" oper="not-equal" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(Preview)" value="CONST(1)"/>
						<WTSETATTRIBUTE name="PARAM(HidePayment)" value="CONST(1)"/>
					</WTCODEGROUP>
					<WTSETATTRIBUTE name="PARAM(MemberID)" value="ATTR(OwnerID)">
						<WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="ENTITY(Member)"/>
					</WTSETATTRIBUTE>
					<WTSETATTRIBUTE name="PARAM(SalesOrderID)" value="ATTR(OwnerID)">
						<WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="ENTITY(SalesOrder)"/>
					</WTSETATTRIBUTE>
<!--
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(OwnerType)" oper="not-equal" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(CompanyID)" value="ATTR(OwnerID)">
							<WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="ENTITY(Company)"/>
						</WTSETATTRIBUTE>
						<WTMETHOD name="GetCompany">
							<WTCONDITION expr="ATTR(OwnerType)" oper="not-equal" value="ENTITY(Company)"/>
							<WTPARAM name="reqCompanyID" direction="return" datatype="number"/>
							<WTPARAM name="OwnerType" direction="input" value="ATTR(OwnerType)"/>
							<WTPARAM name="OwnerID" direction="input" value="ATTR(OwnerID)"/>
						</WTMETHOD>
					</WTCODEGROUP>
-->					
					<WTMETHOD name="XML">
						<WTPARAM name="xmlPayment" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(CompanyID)" oper="equal" value="SYSCON(GCR)"/>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(Status)" oper="equal" value="SYSCON(PAYSTATUS-APPROVED)"/>
							<WTCUSTOM>
								tmpCode = Replace( .Purpose, "u", "" )
								If TRIM(tmpCode) &lt;&gt; "" Then
								If InStr("103,203,104,204,105,205,106,206,107,207,108,208,111,112,113,114,115,116", tmpCode) &gt; 0 Then
								If InStr(.Notes, "GCRORDER:") = 0 Then reqProductOrder = 1
								End If
								End If
							</WTCUSTOM>
						</WTCODEGROUP>
					</WTCODEGROUP>
				</WTOBJECT>
				<WTCALLSUB name="LoadPayTypes"/>
			</WTSUB>

			<WTSUB name="ReloadPayment">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(InStr(.Description, &quot;Charged&quot;))" oper="not-equal" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(Preview)" value="CONST(1)"/>
						<WTSETATTRIBUTE name="PARAM(HidePayment)" value="CONST(1)"/>
					</WTCODEGROUP>
					<WTSETATTRIBUTES/>
					<WTSETATTRIBUTE name="PARAM(MemberID)" value="ATTR(OwnerID)">
						<WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="ENTITY(Member)"/>
					</WTSETATTRIBUTE>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(OwnerType)" oper="not-equal" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(CompanyID)" value="ATTR(OwnerID)">
							<WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="ENTITY(Company)"/>
						</WTSETATTRIBUTE>
						<WTMETHOD name="GetCompany">
							<WTCONDITION expr="ATTR(OwnerType)" oper="not-equal" value="ENTITY(Company)"/>
							<WTPARAM name="reqCompanyID" direction="return" datatype="number"/>
							<WTPARAM name="OwnerType" direction="input" value="ATTR(OwnerType)"/>
							<WTPARAM name="OwnerID" direction="input" value="ATTR(OwnerID)"/>
						</WTMETHOD>
					</WTCODEGROUP>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlPayment" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTCALLSUB name="LoadPayTypes"/>
			</WTSUB>

			<WTSUB name="SavePayment">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(oldStatus)" value="ATTR(Status)"/>
					<WTSETATTRIBUTES/>
					<WTMETHOD name="Save">
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="NoErrors"/>
						<WTCONDITION expr="CONST(oldStatus)" oper="equal" value="SYSCON(PAYSTATUS-APPROVED)" connector="and"/>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(Status)" oper="equal" value="SYSCON(PAYSTATUS-RETURNED)"/>
							<WTCONDITION expr="ATTR(Status)" oper="equal" value="SYSCON(PAYSTATUS-CANCELLED)" connector="or"/>
							<WTCALLSUB name="ProcessPayment"/>
						</WTCODEGROUP>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="NoErrors"/>
						<WTCONDITION expr="CONST(oldStatus)" oper="not-equal" value="SYSCON(PAYSTATUS-APPROVED)" connector="and"/>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(Status)" oper="equal" value="SYSCON(PAYSTATUS-APPROVED)"/>
							<WTCALLSUB name="ProcessPayment"/>
						</WTCODEGROUP>
					</WTCODEGROUP>
				</WTOBJECT>
				<WTCALLSUB name="ReloadPayment">
					<WTCONDITION expr="IsErrors"/>
				</WTCALLSUB>
				<WTCODEGROUP>
					<WTCONDITION expr="NoErrors"/>
					<WTSETATTRIBUTE name="PARAM(Txn)" value="CONST(1)"/>
					<WTCALLSUB name="LoadPayment">
						<WTCONDITION expr="PARAM(Popup)" oper="not-equal" value="CONST(0)"/>
					</WTCALLSUB>
					<WTRETURN>
						<WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)"/>
					</WTRETURN>
				</WTCODEGROUP>
			</WTSUB>

			<WTACTION id="0" name="New" type="New">
				<WTCALLSUB name="LoadPayment"/>
			</WTACTION>

			<WTACTION id="1" name="Update" type="Update">
				<WTCALLSUB name="SavePayment"/>
				<WTCALLSUB name="LoadPayment"/>
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="4" name="Delete" type="Delete">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Delete">
						<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTSETATTRIBUTE name="PARAM(Txn)" value="CONST(4)">
					<WTCONDITION expr="NoErrors"/>
				</WTSETATTRIBUTE>
				<WTCALLSUB name="ReloadPayment">
					<WTCONDITION expr="IsErrors"/>
					<WTCONDITION expr="PARAM(Popup)" oper="not-equal" value="CONST(0)" connector="or"/>
				</WTCALLSUB>
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
					<WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)" connector="and"/>
				</WTRETURN>
			</WTACTION>

			<WTACTION id="5" name="UpdateMethod" type="Update">
				<WTCALLSUB name="SavePayment"/>
				<WTSETATTRIBUTE name="CONST(tmpBillingID)" value="CONST(0)"/>
				<WTSETATTRIBUTE name="CONST(tmpPayType)" value="CONST(0)"/>
				<WTSETATTRIBUTE name="CONST(tmpPayment)" value="CONST(&quot;&quot;)"/>
				<WTOBJECT name="SalesOrder" project="ptsSalesOrderUser" class="CSalesOrder">
					<WTCONDITION expr="PARAM(OwnerType)" oper="equal" value="CONST(52)"/>
					<WTCONDITION expr="PARAM(MemberID)" oper="equal" value="CONST(0)" connector="and"/>
					<WTCONDITION expr="PARAM(SalesOrderID)" oper="not-equal" value="CONST(0)" connector="and"/>
					<WTMETHOD name="Load">
						<WTPARAM name="SalesOrderID" direction="input" value="PARAM(SalesOrderID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(MemberID)" value="ATTR(MemberID)"/>
				</WTOBJECT>
				<WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
					<WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="MemberID" direction="input" value="PARAM(MemberID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(tmpBillingID)" value="ATTR(BillingID)"/>
				</WTOBJECT>
				<WTOBJECT name="Billing" project="ptsBillingUser" class="CBilling">
					<WTCONDITION expr="CONST(tmpBillingID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="BillingID" direction="input" value="CONST(tmpBillingID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(tmpTokenType)" value="ATTR(TokenType)"/>
					<WTSETATTRIBUTE name="CONST(tmpToken)" value="ATTR(Token)"/>
					<WTCUSTOM>tmpPayment = BillingPayment( oBilling )</WTCUSTOM>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(PayType)" oper="equal" value="CONST(1)"/>
						<WTSETATTRIBUTE name="CONST(tmpPayType)" value="ATTR(CardType)"/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(PayType)" oper="equal" value="CONST(2)"/>
						<WTSETATTRIBUTE name="CONST(tmpPayType)" value="SYSCON(PAYTYPE-CHECK)"/>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(PayType)" oper="equal" value="CONST(3)"/>
						<WTSETATTRIBUTE name="CONST(tmpPayType)" value="SYSCON(PAYTYPE-CASH)"/>
					</WTCODEGROUP>
				</WTOBJECT>
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTCONDITION expr="CONST(tmpPayType)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(TokenType)" value="CONST(tmpTokenType)"/>
					<WTSETATTRIBUTE name="ATTR(Token)" value="CONST(tmpToken)"/>
					<WTSETATTRIBUTE name="ATTR(PayType)" value="CONST(tmpPayType)"/>
					<WTSETATTRIBUTE name="ATTR(Description)" value="CONST(tmpPayment)"/>
					<WTMETHOD name="Save">
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTCALLSUB name="LoadPayment">
					<WTCONDITION expr="PARAM(Popup)" oper="not-equal" value="CONST(0)"/>
				</WTCALLSUB>
				<WTRETURN>
					<WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)"/>
				</WTRETURN>
			</WTACTION>
			
			<WTACTION id="6" name="Reclaim" type="Update">
				<WTCALLSUB name="SavePayment"/>
				<WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
					<WTMETHOD name="Custom">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="Status" direction="input" value="CONST(8)"/>
						<WTPARAM name="EnrollDate" direction="input" value="CONST(0)"/>
						<WTPARAM name="Quantity" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="Amount" direction="input" value="CONST(0)"/>
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTCALLSUB name="LoadPayment"/>
			</WTACTION>

			<WTACTION id="7" name="ClearMethod" type="Update">
				<WTCALLSUB name="SavePayment"/>
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(TokenType)" value="CONST(0)"/>
					<WTSETATTRIBUTE name="ATTR(Token)" value="CONST(0)"/>
					<WTSETATTRIBUTE name="ATTR(Description)" value="CONST(&quot;&quot;)"/>
					<WTMETHOD name="Save">
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTCALLSUB name="LoadPayment"/>
			</WTACTION>

			<WTACTION id="8" name="RequestBitcoin" type="Update">
				<WTCALLSUB name="SavePayment"/>
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="GetOwnerEmail">
						<WTPARAM name="OwnerType" direction="input" value="ATTR(OwnerType)"/>
						<WTPARAM name="OwnerID" direction="input" value="ATTR(OwnerID)"/>
						<WTPARAM name="ToEmail" direction="return" datatype="text"/>
					</WTMETHOD>
					<WTCUSTOM>
				If InStr( ToEmail, "@" ) &gt; 0 Then
					result = SendBitCoinRequest( .CompanyID, ToEmail, .Purpose, .Amount, reqPaymentID )
					If result = 1 Then
						reqMessage = "Bitcoin Request Sent"
						If .Status &lt;&gt; 2 Then
							.Status = 2
							.Save 1
						End If
					Else
						reqMessage = "Bitcoin Request Failed"
					End If
				End If
					</WTCUSTOM>
				</WTOBJECT>
				<WTCALLSUB name="LoadPayment"/>
			</WTACTION>

			<WTACTION id="9" name="ProductOrder" type="Update">
				<WTCALLSUB name="SavePayment"/>
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(CompanyID)" oper="equal" value="SYSCON(GCR)"/>
						<WTCUSTOM>
							tmpMemberID = .OwnerID
							tmpPurpose = .Purpose
							tmpCredit = .Credit
							'Check if this is an update to an existing order rather than a new order 
							If tmpCredit &gt; 0 Then tmpPurpose = "u" + tmpPurpose

							Set oHTTP = server.CreateObject("MSXML2.ServerXMLHTTP")
							If oHTTP Is Nothing Then
								Response.Write "Error #" &amp; Err.number &amp; " - " + Err.description
							Else
								tmpURL = "http://www.GCRMarketing.com/GlobalCoinOrder.asp?MemberID=" + CStr(tmpMemberID) + "&amp;Product=" + tmpPurpose
							With oHTTP
							.open "GET", tmpURL
							.send
							OrderID = .responseText
							End With
							End If
							Set oHTTP = Nothing
              If Len(OrderID) = 0 Then
                tmp = "ERROR GCR-ORDER"
              Else  
							  tmp = .Notes + " GCRORDER:" + CStr(OrderID) + " " + CStr(Now())
              End If
							.Notes = Left(tmp,500)
						</WTCUSTOM>
						<WTSETATTRIBUTE name="PARAM(Txn)" value="CONST(9)"/>
					</WTCODEGROUP>
					<WTMETHOD name="Save">
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTCALLSUB name="LoadPayment"/>
			</WTACTION>

			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="160" align="right"/>
				<WTCOLUMN width="440" align="left"/>

				<WTROW>
					<WTHIDDEN value="PARAM(CompanyID)"/>
					<WTHIDDEN value="PARAM(MemberID)"/>
					<WTHIDDEN value="PARAM(SalesOrderID)"/>
					<WTHIDDEN value="PARAM(PaymentID)"/>
				</WTROW>

				<WTROW>
					<WTSTATIC col="1" merge="2" class="PageHeading" align="left">
						<WTSTATIC tag="PaymentID" value="ATTR(Payment.PaymentID)"/>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="ENTITY(SalesOrder)"/>
							<WTSTATIC space="1"/>
							<WTIMAGE value="CONST(shoppingcart16.png)" alt="finances" imgalign="absmiddle">
								<WTLINK name="5203" return="false" target="_blank">
									<WTPARAM name="SalesOrderID" value="PARAM(SalesOrderID)"/>
								</WTLINK>
							</WTIMAGE>
						</WTCODEGROUP>
						<WTCODEGROUP>
							<WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="ENTITY(Member)"/>
							<WTCODEGROUP>
								<WTSTATIC space="1"/>
								<WTIMAGE value="CONST(financesm.gif)" alt="finances" imgalign="absmiddle">
									<WTLINK name="0475" return="false" target="_blank">
										<WTPARAM name="MemberID" value="PARAM(MemberID)"/>
										<WTPARAM name="Code" value="CONST(2)"/>
										<WTPARAM name="ContentPage" value="CONST(3)"/>
										<WTPARAM name="Popup" value="CONST(1)"/>
									</WTLINK>
								</WTIMAGE>
							</WTCODEGROUP>
							<WTCODEGROUP>
								<WTSTATIC space="1"/>
								<WTIMAGE value="CONST(Member16.gif)" alt="Edit" imgalign="absmiddle">
									<WTLINK name="0403" target="_blank">
										<WTPARAM name="MemberID" value="PARAM(MemberID)"/>
										<WTPARAM name="ContentPage" value="CONST(3)"/>
										<WTPARAM name="Popup" value="CONST(1)"/>
									</WTLINK>
								</WTIMAGE>
							</WTCODEGROUP>
						</WTCODEGROUP>
						<WTCODEGROUP>
							<WTCONDITION expr="PARAM(Message)" oper="equal" value="CONST('')"/>
							<WTSTATIC space="1"/>
							<WTSTATIC label="Updated" fontcolor="red">
								<WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(1)"/>
							</WTSTATIC>
							<WTSTATIC label="Deleted" fontcolor="red">
								<WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(4)"/>
							</WTSTATIC>
							<WTSTATIC label="ProductOrdered" fontcolor="red">
								<WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(9)"/>
							</WTSTATIC>
						</WTCODEGROUP>
						<WTCODEGROUP>
							<WTCONDITION expr="PARAM(Message)" oper="not-equal" value="CONST('')"/>
							<WTSTATIC space="1"/>
							<WTSTATIC value="PARAM(Message)" fontcolor="red"/>
						</WTCODEGROUP>
					</WTSTATIC>
				</WTROW>
				<WTROW margin-bottom="12">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(5)" />
					<WTROW>
						<WTCONDITION expr="IsEmployee"/>
						<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
						<WTSTATIC col="1"/>
						<WTSTATIC col="2" fontcolor="purple">
							<WTSTATIC value="ATTR(Payment.TokenType)" space="1"/>
							<WTSTATIC value="ATTR(Payment.TokenOwner)" space="1"/>
							<WTSTATIC value="ATTR(Payment.Token)"/>
						</WTSTATIC>
					</WTROW>
				</WTCODEGROUP>
				<WTROW>
					<WTSTATIC col="1" tag="PayDate"/>
					<WTTEXT col="2" value="ATTR(Payment.PayDate)"/>
					<WTSTATIC col="2" tag="PaidDate"/>
					<WTTEXT col="2" value="ATTR(Payment.PaidDate)" noprespace="true"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Status"/>
					<WTCOMBO col="2" value="ATTR(Payment.Status)"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Amount"/>
					<WTTEXT col="2" value="ATTR(Payment.Amount)" size="10"/>
					<WTSTATIC col="2" tag="Total"/>
					<WTTEXT col="2" value="ATTR(Payment.Total)" size="10" prespace="false"/>
					<WTSTATIC col="2" tag="Credit"/>
					<WTTEXT col="2" value="ATTR(Payment.Credit)" size="10" prespace="false"/>
				</WTROW>
<!--
				<WTROW>
					<WTCONDITION expr="ATTR(Payment.OwnerType)" oper="not-equal" value="ENTITY(SalesOrder)"/>
					<WTSTATIC col="1" tag="Retail"/>
					<WTTEXT col="2" value="ATTR(Payment.Retail)" size="10"/>
					<WTSTATIC col="2" tag="Commission"/>
					<WTTEXT col="2" value="ATTR(Payment.Commission)" size="10" prespace="false"/>
				</WTROW>
-->				
				<WTROW>
					<WTCONDITION expr="IsEmployee"/>
					<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
					<WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
					<WTSTATIC col="1" tag="Purpose"/>
					<WTTEXT col="2" value="ATTR(Payment.Purpose)"/>
				</WTROW>
				<WTROW>
					<WTCONDITION expr="NotEmployee"/>
					<WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
					<WTCONDITION expr="NotOrgManagerOnly" connector="and"/>
					<WTHIDDEN value="ATTR(Payment.Purpose)"/>
				</WTROW>
				<WTROW>
					<WTCONDITION expr="IsEmployee"/>
					<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
					<WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
					<WTSTATIC col="1" tag="PayType"/>
					<WTCOMBO col="2" value="ATTR(Payment.PayType)"/>
				</WTROW>
				<WTROW>
					<WTCONDITION expr="NotEmployee"/>
					<WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
					<WTCONDITION expr="NotOrgManagerOnly" connector="and"/>
					<WTSTATIC col="1" tag="PayType"/>
					<WTCOMBO col="2" value="ATTR(Payment.PayType)">
						<WTOPTION id="0" label="blank"/>
						<WTOPTION id="1" label="Visa">
							<WTCONDITION expr="_IsPaymentVisa"/>
						</WTOPTION>
						<WTOPTION id="2" label="MasterCard">
							<WTCONDITION expr="_IsPaymentMC"/>
						</WTOPTION>
						<WTOPTION id="3" label="Discover">
							<WTCONDITION expr="_IsPaymentDiscover"/>
						</WTOPTION>
						<WTOPTION id="4" label="Amex">
							<WTCONDITION expr="_IsPaymentAmex"/>
						</WTOPTION>
						<WTOPTION id="5" label="Check">
							<WTCONDITION expr="_IsPaymentCheck"/>
						</WTOPTION>
						<WTOPTION id="6" label="eWallet">
							<WTCONDITION expr="_IsPaymenteWallet"/>
						</WTOPTION>
						<WTOPTION id="7" label="Cash">
							<WTCONDITION expr="_IsPaymentCash"/>
						</WTOPTION>
						<WTOPTION id="8" label="PO">
							<WTCONDITION expr="_IsPaymentPO"/>
						</WTOPTION>
            <WTOPTION id="10" label="Wallet">
              <WTCONDITION expr="_IsPaymentWallet"/>
            </WTOPTION>
            <WTOPTION id="11" label="iPayout">
							<WTCONDITION expr="_IsPaymentiPayout"/>
						</WTOPTION>
						<WTOPTION id="12" label="PayQuicker">
							<WTCONDITION expr="_IsPaymentPayQuicker"/>
						</WTOPTION>
						<WTOPTION id="13" label="SolidTrust">
							<WTCONDITION expr="_IsPaymentSolidTrust"/>
						</WTOPTION>
            <WTOPTION id="14" label="Bitcoin">
              <WTCONDITION expr="_IsPaymentBitCoin"/>
            </WTOPTION>
            <WTOPTION id="15" label="BitCoinCash">
              <WTCONDITION expr="_IsPaymentBitCoinCash"/>
            </WTOPTION>
            <WTOPTION id="21" label="Nexxus">
              <WTCONDITION expr="_IsPaymentNexxus"/>
            </WTOPTION>
            <WTOPTION id="97" value="PARAM(MiscPay1)">
							<WTCONDITION expr="_IsPaymentMisc1"/>
						</WTOPTION>
						<WTOPTION id="98" value="PARAM(MiscPay2)">
							<WTCONDITION expr="_IsPaymentMisc2"/>
						</WTOPTION>
						<WTOPTION id="99" value="PARAM(MiscPay3)">
							<WTCONDITION expr="_IsPaymentMisc3"/>
						</WTOPTION>
						<WTOPTION id="90" value="Commission"/>
						<WTOPTION id="91" value="Credit"/>
					</WTCOMBO>
				</WTROW>
				 <WTROW>
				 	<WTSTATIC col="1" tag="Reference"/>
				 	<WTTEXT col="2" value="ATTR(Payment.Reference)" size="40"/>
				 </WTROW>
				<WTROW>
<!--					<WTCONDITION expr="ATTR(Payment.OwnerType)" oper="not-equal" value="ENTITY(SalesOrder)"/>-->
					<WTSTATIC col="1" tag="CommStatus"/>
					<WTCOMBO col="2" value="ATTR(Payment.CommStatus)"/>
					<WTIMAGE col="2" value="CONST(Preview.gif)" alt="Preview" imgalign="absmiddle">
						<WTCONDITION expr="ATTR(Payment.CommStatus)" oper="equal" value="CONST(2)"/>
						<WTCONDITION expr="ATTR(Payment.CommStatus)" oper="equal" value="CONST(4)" connector="or"/>
						<WTCLICK>
							var url, win
							url = "0913.asp?refid=" + document.getElementById('PaymentID').value;
							win = window.open(url, '', "top=200,left=200,width=650,height=300,status=no");
							win.focus();
						</WTCLICK>
					</WTIMAGE>
					<WTSTATIC col="2" tag="CommDate"/>
					<WTTEXT col="2" value="ATTR(Payment.CommDate)" prespace="false"/>
				</WTROW>
				<WTROW>
					<WTCONDITION expr="IsManager"/>
					<WTSTATIC col="1" tag="OwnerType"/>
					<WTTEXT col="2" value="ATTR(Payment.OwnerType)" size="2"/>
					<WTTEXT col="2" value="ATTR(Payment.OwnerID)" size="8"/>
				</WTROW>
				<WTROW>
					<WTCONDITION expr="IsManager"/>
					<WTSTATIC col="1" tag="ProductID"/>
					<WTTEXT col="2" value="ATTR(Payment.ProductID)" size="5"/>
          <WTSTATIC col="2" tag="PaidID"/>
          <WTTEXT col="2" value="ATTR(Payment.PaidID)" size="5" prespace="false"/>
        </WTROW>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="SYSCON(GCR)" />
          <WTROW>
            <WTSTATIC col="1" tag="Fulfill"/>
            <WTTEXT col="2" value="ATTR(Payment.Token)" size="5"/>
            <WTSTATIC col="2" tag="Coins"/>
            <WTTEXT col="2" value="ATTR(Payment.TokenOwner)" size="10" prespace="false"/>
          </WTROW>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="SYSCON(NEXXUS)" />
          <WTCONDITION expr="ATTR(Payment.Purpose)" oper="equal" value="CONST(100)" connector="and"/>
          <WTROW>
            <WTSTATIC col="1" tag="CertificateQty"/>
            <WTTEXT col="2" value="ATTR(Payment.Retail)" size="5"/>
          </WTROW>
        </WTCODEGROUP>

        <WTROW>
					<WTCONDITION expr="NotManager"/>
					<WTHIDDEN value="ATTR(Payment.OwnerType)"/>
					<WTHIDDEN value="ATTR(Payment.OwnerID)"/>
					<WTHIDDEN value="ATTR(Payment.ProductID)"/>
					<WTHIDDEN value="ATTR(Payment.PaidID)"/>
				</WTROW>
				<WTCODEGROUP>
					<WTCONDITION expr="IsManager"/>
					<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
					<WTCONDITION expr="_IsPayments" connector="or"/>
					<WTROW margin-top="6">
						<WTSTATIC col="1" merge="2" align="left">
							<WTSTATIC tag="Description"/>
							<WTCODEGROUP>
								<WTCONDITION expr="IsSysAdmin"/>
								<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
								<WTCODEGROUP>
									<WTCONDITION expr="PARAM(Preview)" oper="not-equal" value="CONST(0)"/>
									<WTIMAGE value="CONST(Preview.gif)" alt="Edit" imgalign="absmiddle">
										<WTCLICK>
											var url, win, str
											str = document.getElementById('Description').value;
											url = "2904.asp?payment=" + str.replace(/#/g, "");
											win = window.open(url, 'PayInfo', "top=200,left=200,width=400,height=450,status=no");
											win.focus();
										</WTCLICK>
									</WTIMAGE>
								</WTCODEGROUP>
							</WTCODEGROUP>
							<WTCODEGROUP>
								<WTSTATIC space="1"/>
								<WTBUTTON action="5" value="CONST(UpdatePaymentMethod)" msg="ConfirmUpdateMethod" btnclass="smbutton">
									<WTCONDITION expr="ATTR(Payment.Status)" oper="less-equal" value="CONST(1)"/>
								</WTBUTTON>
							</WTCODEGROUP>
						</WTSTATIC>
					</WTROW>
					<WTROW>
						<WTCONDITION expr="PARAM(HidePayment)" oper="equal" value="CONST(0)"/>
						<WTMEMO col="1" merge="2" align="left" value="ATTR(Payment.Description)" cols="70" rows="2"/>
					</WTROW>
					<WTROW>
						<WTCONDITION expr="PARAM(HidePayment)" oper="not-equal" value="CONST(0)"/>
						<WTHIDDEN value="ATTR(Payment.Description)"/>
					</WTROW>
				</WTCODEGROUP>
				<WTROW>
					<WTCONDITION expr="NotSysAdmin"/>
					<WTCONDITION expr="_NotPayments" connector="and"/>
					<WTHIDDEN value="ATTR(Payment.Description)"/>
				</WTROW>
				
				<WTROW>
					<WTSTATIC col="1" merge="2" tag="Notes" align="left"/>
				</WTROW>
				<WTROW>
					<WTMEMO col="1" merge="2" align="left" value="ATTR(Payment.Notes)" cols="72" rows="6"/>
				</WTROW>

				<WTSTATIC label="ConfirmUpdateMethod"/>
				<WTSTATIC label="ConfirmReclaim"/>
				<WTSTATIC label="ConfirmClear"/>
				<WTSTATIC label="ConfirmRequestBitcoin"/>
				<WTSTATIC label="ConfirmGCROrder"/>

				<WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" merge="2" action="1" value="CONST(Update)" align="center">
						<WTCONDITION expr="IsActive"/>
						<WTCONDITION expr="IsEmployee" connector="and"/>
						<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
						<WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
					</WTBUTTON>
					<WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)">
						<WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)" />
					</WTBUTTON>
					<WTBUTTON col="1" merge="2" value="CONST(Close)">
						<WTCONDITION expr="PARAM(Popup)" oper="not-equal" value="CONST(0)" />
						<WTCLICK>window.close()</WTCLICK>
					</WTBUTTON>
					<WTBUTTON col="1" merge="2" action="8" value="CONST(RequestBitcoin)" msg="ConfirmRequestBitcoin">
						<WTCONDITION expr="IsEmployee" paren="start"/>
						<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
						<WTCONDITION expr="IsOrgManagerOnly" connector="or" paren="end"/>
						<WTCONDITION expr="ATTR(Payment.Status)" oper="less" value="CONST(3)" connector="and"/>
						<WTCONDITION expr="ATTR(Payment.PayType)" oper="equal" value="CONST(14)" connector="and"/>
					</WTBUTTON>
<!--          
					<WTBUTTON col="1" merge="2" action="9" value="CONST(GCROrder)" msg="ConfirmGCROrder">
						<WTCONDITION expr="ATTR(Payment.CompanyID)" oper="equal" value="SYSCON(GCR)"/>
						<WTCONDITION expr="PARAM(ProductOrder)" oper="not-equal" value="CONST(0)" connector="and"/>
					</WTBUTTON>
-->          
					<WTBUTTON col="1" merge="2" action="4" value="CONST(Delete)" msg="ConfirmDelete">
						<WTCONDITION expr="IsActive"/>
						<WTCONDITION expr="IsEmployee" connector="and"/>
						<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
						<WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
					</WTBUTTON>
					<WTBUTTON col="1" merge="2" action="6" value="CONST(Reclaim)" msg="ConfirmReclaim">
						<WTCONDITION expr="IsEmployee" paren="start"/>
						<WTCONDITION expr="IsOrgAdminOnly" connector="or" paren="end"/>
						<WTCONDITION expr="ATTR(Payment.CommStatus)" oper="equal" value="CONST(2)" connector="and"/>
					</WTBUTTON>
					<WTBUTTON col="1" merge="2" action="7" value="CONST(ClearMethod)" msg="ConfirmClear">
						<WTCONDITION expr="IsActive"/>
						<WTCONDITION expr="IsManager" connector="and"/>
						<WTCONDITION expr="ATTR(Payment.Status)" oper="less-equal" value="CONST(1)" connector="and"/>
					</WTBUTTON>
				</WTROW>
			</WTCONTENT>
		</WTWEBPAGE>

		<!--==================================================================================================================-->
		<WTWEBPAGE name="1003r" footer="false" navbar="false" wrapper="wrapper600" aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" secured="52">
			<!--==================================================================================================================-->
			<WTPARAM name="PaymentID" datatype="number"/>
			<WTPARAM name="Purpose" datatype="text"/>

			<WTACTION id="0" name="New" type="New">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(CompanyID)" value="ATTR(CompanyID)"/>
					<WTSETATTRIBUTE name="PARAM(Purpose)" value="ATTR(Purpose)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="IsMemberOnly"/>
            <WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="ENTITY(Member)" connector="and"/>
            <WTCONDITION expr="ATTR(OwnerID)" oper="not-equal" value="CONST(CStr(reqSysMemberID))" connector="and"/>
            <WTCUSTOM>AbortUser()</WTCUSTOM>
          </WTCODEGROUP>
          <WTCODEGROUP>
						<WTOBJECT name="Product" project="ptsProductUser" class="CProduct">
              <WTCONDITION expr="CONST(IsNumeric(reqPurpose))" oper="not-equal" value="CONST(0)"/>
              <WTMETHOD name="FetchCode">
								<WTPARAM name="CompanyID" direction="input" value="CONST(CompanyID)"/>
								<WTPARAM name="Code" direction="input" value="PARAM(Purpose)"/>
							</WTMETHOD>
							<WTCODEGROUP>
								<WTCONDITION expr="ATTR(ProductID)" oper="not-equal" value="CONST(0)"/>
								<WTMETHOD name="Load">
									<WTPARAM name="ProductID" direction="input" value="ATTR(ProductID)"/>
									<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
								</WTMETHOD>
								<WTSETATTRIBUTE name="PARAM(Purpose)" value="ATTR(ProductName)">
									<WTCONDITION expr="ATTR(ProductName)" oper="not-equal" value="CONST(&quot;&quot;)"/>
								</WTSETATTRIBUTE>
							</WTCODEGROUP>
						</WTOBJECT>
					</WTCODEGROUP>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlPayment" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTACTION>

			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="160" align="right"/>
				<WTCOLUMN width="440" align="left"/>

				<WTROW>
					<WTSTATIC col="1" merge="2" tag="PaymentInvoice" value="ATTR(Payment.PaymentID)" class="PageHeading" align="left"/>
				</WTROW>
				<WTROW margin-bottom="12">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="DateCreated"/>
					<WTSTATIC col="2" value="ATTR(Payment.PayDate)" bold="true"/>
					<WTSTATIC col="2" tag="DatePaid"/>
					<WTSTATIC col="2" value="ATTR(Payment.PaidDate)" bold="true" noprespace="true"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Status"/>
					<WTSTATIC col="2" value="ATTR(Payment.Status)" bold="true"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="InvoiceAmount"/>
					<WTSTATIC col="2" value="ATTR(Payment.Amount)" bold="true"/>
					<WTSTATIC col="2" tag="Total"/>
					<WTSTATIC col="2" value="ATTR(Payment.Total)" bold="true" prespace="false"/>
					<WTSTATIC col="2" tag="Credit"/>
					<WTSTATIC col="2" value="ATTR(Payment.Credit)" bold="true" prespace="false"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Purpose"/>
					<WTSTATIC col="2" value="PARAM(Purpose)" bold="true"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Payment"/>
					<WTSTATIC col="2" value="ATTR(Payment.PayType)" bold="true"/>
					<WTSTATIC col="2" tag="Reference"/>
					<WTSTATIC col="2" value="ATTR(Payment.Reference)" bold="true" prespace="false"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="Notes"/>
					<WTSTATIC col="2" value="ATTR(Payment.Notes)" bold="true"/>
				</WTROW>

				<WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
						<WTCLICK>window.close()</WTCLICK>
					</WTBUTTON>
				</WTROW>
			</WTCONTENT>
		</WTWEBPAGE>

		<!--==================================================================================================================-->
		<WTWEBPAGE name="1010" caption="Bitcoin Payment" header="false" footer="false" navbar="false" wrapper="false"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" secured="52">
			<!--==================================================================================================================-->
      <WTPARAM name="PaymentID" datatype="number"/>
      <WTPARAM name="URL" datatype="text"/>

      <WTINCLUDE name="blockchain.asp"/>
<!--      
			<WTINCLUDE name="btc.asp"/>
-->
      <WTACTION id="0" name="New" type="New">
        <WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
          <WTMETHOD name="Load">
            <WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="CONST(tmpCompanyID)" value="ATTR(CompanyID)"/>
          <WTSETATTRIBUTE name="CONST(tmpPurpose)" value="ATTR(Purpose)"/>
          <WTSETATTRIBUTE name="CONST(tmpAmount)" value="ATTR(Amount)"/>
          <WTSETATTRIBUTE name="CONST(tmpBTC)" value="CONST(GetUSDBTC(tmpAmount))"/>
          <WTSETATTRIBUTE name="CONST(tmpAddress)" value="CONST(ReceiveBitCoin( &quot;&quot;,  reqPaymentID, tmpAmount ) )"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlPayment" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(2)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
          <WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(&quot;btcpay.htm&quot;)" />
          <WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\Company/&quot; + CStr(tmpCompanyID))"/>
          <WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)" />
          <WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)" />
          <WTMETHOD name="Load" />
          <WTMETHOD name="XML">
            <WTPARAM name="xmlHTMLFile" direction="return" datatype="text" />
          </WTMETHOD>
          <WTCUSTOM>
            If InStr( xmlHTMLFile, "{address}" ) = 0 Then Response.End
            xmlHTMLFile = Replace( xmlHTMLFile, "{address}", tmpAddress)
            xmlHTMLFile = Replace( xmlHTMLFile, "{amount}", tmpAmount)
            xmlHTMLFile = Replace( xmlHTMLFile, "{btc}", tmpBTC)
          </WTCUSTOM>
        </WTOBJECT>
<!--
        <WTOBJECT name="Coption" project="ptsCoptionUser" class="CCoption">
          <WTMETHOD name="FetchCompany">
            <WTPARAM name="CompanyID" direction="input" value="CONST(tmpCompanyID)"/>
          </WTMETHOD>
          <WTMETHOD name="Load">
            <WTPARAM name="CoptionID" direction="input" value="ATTR(CoptionID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTCUSTOM>
            WalletAcct = GetKeyToken( 14, .WalletAcct)
            AuthenticateBitCoin WalletAcct
            ButtonCode = PayBitCoin( tmpCompanyID, tmpPurpose, tmpAmount, reqPaymentID )
            If Left( ButtonCode, 5 ) = "ERROR" Then Response.write ButtonCode
            reqURL = "https://coinbase.com/checkouts/" + ButtonCode
          </WTCUSTOM>
        </WTOBJECT>
-->        
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="600" align="center"/>

        <WTROW>
          <WTSTATIC col="1" value="ATTR(HTMLFile.Data)" align="left" embedhtml="true"/>
        </WTROW>
<!--        
        <WTROW margin-top="24" margin-bottom="12">
					<WTSTATIC col="1" label="BitcoinPayment" class="PageHeading"/>
				</WTROW>
				<WTROW margin-bottom="12">
					<WTSTATIC col="1" value="ATTR(Payment.Amount)" class="PageHeading" />
				</WTROW>
				<WTROW margin-bottom="12">
					<WTIMAGE col="1" value="CONST(PayBitcoin.gif)" alt="PayBitcoin">
						<WTLINK name="PARAM(URL)" type="anchor" target="_blank"/>
					</WTIMAGE>
				</WTROW>

				<WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" action="3" value="CONST(Return)"/>
				</WTROW>
-->

      </WTCONTENT>
		</WTWEBPAGE>

    <!--==================================================================================================================-->
    <WTWEBPAGE name="1010bp" caption="BitPay Bitcoin Payment" header="false" footer="false" navbar="false" wrapper="false"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" secured="52">
      <!--==================================================================================================================-->
      <WTPARAM name="PaymentID" datatype="number"/>

      <WTINCLUDE name="bitpay.asp"/>

      <WTACTION id="0" name="New" type="New">
        <WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
          <WTMETHOD name="Load">
            <WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="CONST(tmpCompanyID)" value="ATTR(CompanyID)"/>
          <WTSETATTRIBUTE name="CONST(tmpPurpose)" value="ATTR(Purpose)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlPayment" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(2)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
          <WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(&quot;bitpay.htm&quot;)" />
          <WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\Company/&quot; + CStr(tmpCompanyID))"/>
          <WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)" />
          <WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)" />
          <WTMETHOD name="Load" />
          <WTMETHOD name="XML">
            <WTPARAM name="xmlHTMLFile" direction="return" datatype="text" />
          </WTMETHOD>
          <WTCUSTOM>
            tmpCode = BP_GetCode( tmpCompanyID, tmpPurpose )
            xmlHTMLFile = Replace( xmlHTMLFile, "{paymentid}", CSTR(reqPaymentID))
            xmlHTMLFile = Replace( xmlHTMLFile, "{code}", tmpCode)
          </WTCUSTOM>
        </WTOBJECT>
      </WTACTION>

      <WTACTION id="3" name="Cancel" type="Cancel">
        <WTRETURN/>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="600" align="center"/>

        <WTROW margin-top="24" margin-bottom="12">
          <WTSTATIC col="1" label="ClickBitcoinButton" class="PageHeading"/>
        </WTROW>
        <WTROW margin-bottom="12">
          <WTSTATIC col="1" value="ATTR(Payment.Amount)" class="PageHeading" />
        </WTROW>

        <WTROW margin-bottom="12">
          <WTSTATIC col="1" value="ATTR(HTMLFile.Data)" align="left" embedhtml="true"/>
        </WTROW>

        <WTROW margin-top="12" margin-bottom="12">
          <WTBUTTON col="1" action="3" value="CONST(Return)"/>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================================-->
		<WTWEBPAGE name="1010s" caption="STP Payment" header="false" footer="false" navbar="false" wrapper="false"
		aspstyle="GenerateWebASPOpen.xsl" xslstyle="GenerateWebXSLOpen.xsl" focus="false" form="false" translate="false" secured="52">
			<!--==================================================================================================================-->
			<WTPARAM name="PaymentID" datatype="number"/>
			<WTPARAM name="URL" datatype="text"/>

			<WTACTION id="0" name="New" type="New">
				<WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
					<WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(&quot;stp.htm&quot;)" />
					<WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections&quot;)"/>
					<WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)" />
					<WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)" />
					<WTMETHOD name="Load" />
					<WTMETHOD name="XML">
						<WTPARAM name="xmlHTMLFile" direction="return" datatype="text" />
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="CONST(1)"/>
					</WTMETHOD>
					<WTCUSTOM>
						tmpAmount = Round( (CCUR(.Amount) * 1.05) + 1.50, 2 )
						xmlHTMLFile = Replace(xmlHTMLFile, "{amount}", tmpAmount)
						xmlHTMLFile = Replace(xmlHTMLFile, "{purpose}", .Purpose)
						xmlHTMLFile = Replace(xmlHTMLFile, "{paymentid}", .PaymentID)
					</WTCUSTOM>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlPayment" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTACTION>

			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCODEGROUP>
					<WTSTATIC value="ATTR(HTMLFile.Data)" embedhtml="true"/>
				</WTCODEGROUP>
			</WTCONTENT>
		</WTWEBPAGE>

		<!--==================================================================================================================-->
		<WTWEBPAGE name="1005" contentpage="true" header="false" footer="false" navbar="false"
               aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" secured="125">
		<!--==================================================================================================================-->
			<WTPARAM name="OwnerType" datatype="number"/>
			<WTPARAM name="OwnerID" datatype="number"/>

			<WTPARAM name="PaymentOptions" datatype="text"/>
			<WTPARAM name="MiscPay1" datatype="text"/>
			<WTPARAM name="MiscPay2" datatype="text"/>
			<WTPARAM name="MiscPay3" datatype="text"/>
			<WTPARAM name="CompanyID" datatype="number"/>
			<WTPARAM name="ContentPage" datatype="number"/>
			<WTPARAM name="Preview" datatype="number"/>

			<WTINCLUDE name="Billing.asp"/>

      <WTSUB name="LoadPayTypes">
				<WTOBJECT name="Business" project="ptsBusinessUser" class="CBusiness">
					<WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="BusinessID" direction="input" value="CONST(1)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(PaymentOptions)" value="ATTR(PaymentOptions)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay1)" value="ATTR(MiscPay1)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay2)" value="ATTR(MiscPay2)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay3)" value="ATTR(MiscPay3)"/>
				</WTOBJECT>
				<WTOBJECT name="Coption" project="ptsCoptionUser" class="CCoption">
					<WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="FetchCompany">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
					</WTMETHOD>			
					<WTMETHOD name="Load">
						<WTPARAM name="CoptionID" direction="input" value="ATTR(CoptionID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(PaymentOptions)" value="ATTR(PaymentOptions)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay1)" value="ATTR(MiscPay1)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay2)" value="ATTR(MiscPay2)"/>
					<WTSETATTRIBUTE name="PARAM(MiscPay3)" value="ATTR(MiscPay3)"/>
				</WTOBJECT>
			</WTSUB>

			<WTACTION id="0" name="New" type="New">
				<WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
					<WTCONDITION expr="PARAM(OwnerType)" oper="equal" value="CONST(4)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="MemberID" direction="input" value="PARAM(OwnerID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(CompanyID)" value="ATTR(CompanyID)"/>
					<WTSETATTRIBUTE name="CONST(tmpBillingID)" value="ATTR(Member.BillingID)"/>
					<WTSETATTRIBUTE name="CONST(tmpAmount)" value="ATTR(Member.Price)"/>
					<WTSETATTRIBUTE name="CONST(tmpRetail)" value="ATTR(Member.Retail)"/>
				</WTOBJECT>
				
				<WTOBJECT name="Coption" project="ptsCoptionUser" class="CCoption">
					<WTCONDITION expr="PARAM(OwnerType)" oper="equal" value="ENTITY(Company)"/>
					<WTMETHOD name="FetchCompany">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(OwnerID)"/>
					</WTMETHOD>			
					<WTMETHOD name="Load">
						<WTPARAM name="CoptionID" direction="input" value="ATTR(CoptionID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(tmpBillingID)" value="ATTR(BillingID)"/>
					<WTSETATTRIBUTE name="CONST(tmpAmount)" value="ATTR(Price)"/>
					<WTSETATTRIBUTE name="CONST(tmpRetail)" value="ATTR(Retail)"/>
				</WTOBJECT>
				
				<WTOBJECT name="Billing" project="ptsBillingUser" class="CBilling">
					<WTCONDITION expr="CONST(tmpBillingID)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Load">
						<WTPARAM name="BillingID" direction="input" value="CONST(tmpBillingID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(tmpTokenType)" value="ATTR(TokenType)"/>
					<WTSETATTRIBUTE name="CONST(tmpToken)" value="ATTR(Token)"/>
					<WTCALLSUB name="tmpBilling = BillingPayment( oBilling )"/>
<WTCUSTOM>
				If .PayType = 1 Then tmpPayType = .CardType 
				If .PayType = 2 Then tmpPayType = 5
</WTCUSTOM>
				</WTOBJECT>
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(TokenType)" value="CONST(tmpTokenType)"/>
					<WTSETATTRIBUTE name="ATTR(Token)" value="CONST(tmpToken)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.PayType)" value="CONST(tmpPayType)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.PayDate)" value="SYS(now)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.Status)" value="CONST(2)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.OwnerType)" value="PARAM(OwnerType)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.OwnerID)" value="PARAM(OwnerID)"/>
<!--
					<WTSETATTRIBUTE name="ATTR(Payment.Amount)" value="CONST(tmpAmount)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.Total)" value="CONST(tmpAmount)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.Retail)" value="CONST(tmpRetail)"/>
					<WTSETATTRIBUTE name="ATTR(Payment.Commission)" value="CONST(tmpAmount-tmpRetail)"/>
-->					
					<WTSETATTRIBUTE name="ATTR(Payment.Description)" value="CONST(tmpBilling)"/>
					<WTSETATTRIBUTE name="PARAM(Preview)" value="CONST(1)">
						<WTCONDITION expr="CONST(InStr(.Description, &quot;Charged&quot;))" oper="not-equal" value="CONST(0)"/>
					</WTSETATTRIBUTE>
					<WTSETATTRIBUTE name="ATTR(Payment.CommStatus)" value="CONST(1)"/>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(OwnerType)" oper="not-equal" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(CompanyID)" value="ATTR(OwnerID)">
							<WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="ENTITY(Company)"/>
						</WTSETATTRIBUTE>
						<WTMETHOD name="GetCompany">
							<WTCONDITION expr="ATTR(OwnerType)" oper="not-equal" value="ENTITY(Company)"/>
							<WTPARAM name="reqCompanyID" direction="return" datatype="number"/>
							<WTPARAM name="OwnerType" direction="input" value="ATTR(OwnerType)"/>
							<WTPARAM name="OwnerID" direction="input" value="ATTR(OwnerID)"/>
						</WTMETHOD>
            <WTCODEGROUP>
              <WTCONDITION expr="NotEmployee"/>
              <WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="SYS(CompanyID)" connector="and"/>
              <WTCUSTOM>AbortUser()</WTCUSTOM>
            </WTCODEGROUP>
          </WTCODEGROUP>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlPayment" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(2)"/>
					</WTMETHOD>
				</WTOBJECT>

				<WTCALLSUB name="LoadPayTypes"/>
			</WTACTION>

			<WTACTION id="2" name="Add" type="Add">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="CONST(0)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="ATTR(CompanyID)" value="PARAM(CompanyID)"/>
					<WTSETATTRIBUTE name="ATTR(TokenType)" value="FORM(TokenType)"/>
					<WTSETATTRIBUTE name="ATTR(Token)" value="FORM(Token)"/>
					<WTSETATTRIBUTES/>
					<WTMETHOD name="Add">
						<WTPARAM name="PaymentID" direction="return" datatype="number"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>

          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(Status)" oper="equal" value="SYSCON(PAYSTATUS-APPROVED)"/>
                <WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
                  <WTMETHOD name="Custom">
                    <WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
                    <WTPARAM name="Status" direction="input" value="CONST(99)"/>
                    <WTPARAM name="EnrollDate" direction="input" value="CONST(0)"/>
                    <WTPARAM name="Quantity" direction="input" value="CONST(PaymentID)"/>
                    <WTPARAM name="Amount" direction="input" value="CONST(0)"/>
                    <WTPARAM name="Count" direction="return" datatype="number"/>
                  </WTMETHOD>
                </WTOBJECT>
            </WTCODEGROUP>
          </WTCODEGROUP>

          <WTCODEGROUP>
						<WTCONDITION expr="IsErrors"/>
						<WTCALLSUB name="LoadPayTypes"/>
						<WTSETATTRIBUTE name="PARAM(Preview)" value="CONST(1)">
							<WTCONDITION expr="CONST(InStr(.Description, &quot;Charged&quot;))" oper="not-equal" value="CONST(0)"/>
						</WTSETATTRIBUTE>
						<WTMETHOD name="XML">
							<WTPARAM name="xmlPayment" direction="return" datatype="text"/>
							<WTPARAM name="Option" direction="input" value="CONST(2)"/>
						</WTMETHOD>
					</WTCODEGROUP>
				</WTOBJECT>
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
				</WTRETURN>
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="160" align="right"/>
				<WTCOLUMN width="440" align="left"/>

				<WTROW>
					<WTHIDDEN value="ATTR(Payment.TokenType)"/>
					<WTHIDDEN value="ATTR(Payment.TokenOwner)"/>
					<WTHIDDEN value="ATTR(Payment.Token)"/>
					<WTHIDDEN value="PARAM(CompanyID)"/>
				</WTROW>

				<WTROW>
					<WTSTATIC col="1" merge="2" label="NewPayment" class="PageHeading" align="left"/>
				</WTROW>
				<WTROW margin-bottom="12">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTROW>
					<WTSTATIC col="1" tag="PayDate"/>
					<WTTEXT col="2" value="ATTR(Payment.PayDate)"/>
					<WTSTATIC col="2" tag="PaidDate"/>
					<WTTEXT col="2" value="ATTR(Payment.PaidDate)" noprespace="true"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Status"/>
					<WTCOMBO col="2" value="ATTR(Payment.Status)"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Amount"/>
					<WTTEXT col="2" value="ATTR(Payment.Amount)" size="10"/>
					<WTSTATIC col="2" tag="Total"/>
					<WTTEXT col="2" value="ATTR(Payment.Total)" size="10" prespace="false"/>
					<WTSTATIC col="2" tag="Credit"/>
					<WTTEXT col="2" value="ATTR(Payment.Credit)" size="10" prespace="false"/>
				</WTROW>
<!--				
				<WTROW>
					<WTCONDITION expr="ATTR(Payment.OwnerType)" oper="not-equal" value="ENTITY(SalesOrder)"/>
					<WTSTATIC col="1" tag="Retail"/>
					<WTTEXT col="2" value="ATTR(Payment.Retail)" size="10"/>
					<WTSTATIC col="2" tag="Commission"/>
					<WTTEXT col="2" value="ATTR(Payment.Commission)" size="10" prespace="false"/>
				</WTROW>
-->				
				<WTROW>
          <WTCONDITION expr="IsEmployee"/>
          <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
          <WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
          <WTSTATIC col="1" tag="Purpose"/>
					<WTTEXT col="2" value="ATTR(Payment.Purpose)"/>
				</WTROW>
				<WTROW>
          <WTCONDITION expr="NotEmployee"/>
          <WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
          <WTCONDITION expr="NotOrgManagerOnly" connector="and"/>
          <WTHIDDEN value="ATTR(Payment.Purpose)"/>
				</WTROW>
				<WTROW>
					<WTCONDITION expr="IsEmployee"/>
					<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
					<WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
					<WTSTATIC col="1" tag="PayType"/>
					<WTCOMBO col="2" value="ATTR(Payment.PayType)"/>
				</WTROW>
				<WTROW>
					<WTCONDITION expr="NotEmployee"/>
					<WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
					<WTCONDITION expr="NotOrgManagerOnly" connector="and"/>
					<WTSTATIC col="1" tag="PayType"/>
					<WTCOMBO col="2" value="ATTR(Payment.PayType)">
						<WTOPTION id="0" label="blank"/>
						<WTOPTION id="1" label="Visa">
							<WTCONDITION expr="_IsPaymentVisa"/>
						</WTOPTION>
						<WTOPTION id="2" label="MasterCard">
							<WTCONDITION expr="_IsPaymentMC"/>
						</WTOPTION>
						<WTOPTION id="3" label="Discover">
							<WTCONDITION expr="_IsPaymentDiscover"/>
						</WTOPTION>
						<WTOPTION id="4" label="Amex">
							<WTCONDITION expr="_IsPaymentAmex"/>
						</WTOPTION>
						<WTOPTION id="5" label="Check">
							<WTCONDITION expr="_IsPaymentCheck"/>
						</WTOPTION>
						<WTOPTION id="6" label="eWallet">
							<WTCONDITION expr="_IsPaymenteWallet"/>
						</WTOPTION>
						<WTOPTION id="7" label="Cash">
							<WTCONDITION expr="_IsPaymentCash"/>
						</WTOPTION>
						<WTOPTION id="8" label="PO">
							<WTCONDITION expr="_IsPaymentPO"/>
						</WTOPTION>
            <WTOPTION id="10" label="Wallet">
              <WTCONDITION expr="_IsPaymentWallet"/>
            </WTOPTION>
            <WTOPTION id="11" label="iPayout">
							<WTCONDITION expr="_IsPaymentiPayout"/>
						</WTOPTION>
						<WTOPTION id="12" label="PayQuicker">
							<WTCONDITION expr="_IsPaymentPayQuicker"/>
						</WTOPTION>
						<WTOPTION id="13" label="SolidTrust">
							<WTCONDITION expr="_IsPaymentSolidTrust"/>
						</WTOPTION>
            <WTOPTION id="14" label="BitCoin">
              <WTCONDITION expr="_IsPaymentBitCoin"/>
            </WTOPTION>
            <WTOPTION id="15" label="BitCoinCash">
              <WTCONDITION expr="_IsPaymentBitCoinCash"/>
            </WTOPTION>
            <WTOPTION id="21" label="Nexxus">
              <WTCONDITION expr="_IsPaymentNexxus"/>
            </WTOPTION>
            <WTOPTION id="97" value="PARAM(MiscPay1)">
							<WTCONDITION expr="_IsPaymentMisc1"/>
						</WTOPTION>
						<WTOPTION id="98" value="PARAM(MiscPay2)">
							<WTCONDITION expr="_IsPaymentMisc2"/>
						</WTOPTION>
						<WTOPTION id="99" value="PARAM(MiscPay3)">
							<WTCONDITION expr="_IsPaymentMisc3"/>
						</WTOPTION>
						<WTOPTION id="90" value="Commission"/>
						<WTOPTION id="91" value="Credit"/>
					</WTCOMBO>
				</WTROW>

				 <WTROW>
				 	<WTSTATIC col="1" tag="Reference"/>
				 	<WTTEXT col="2" value="ATTR(Payment.Reference)"/>
				 </WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="CommStatus"/>
					<WTCOMBO col="2" value="ATTR(Payment.CommStatus)"/>
          <WTSTATIC col="2" tag="CommDate"/>
          <WTTEXT col="2" value="ATTR(Payment.CommDate)" prespace="false"/>
        </WTROW>
				<WTROW>
					<WTCONDITION expr="IsManager"/>
					<WTSTATIC col="1" tag="OwnerType"/>
					<WTTEXT col="2" value="ATTR(Payment.OwnerType)" size="2"/>
					<WTTEXT col="2" value="ATTR(Payment.OwnerID)" size="8"/>
				</WTROW>
				<WTROW>
					<WTCONDITION expr="NotManager"/>
					<WTHIDDEN value="ATTR(Payment.OwnerType)"/>
					<WTHIDDEN value="ATTR(Payment.OwnerID)"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" merge="2" align="left">
						<WTSTATIC tag="Description"/>
						<WTCODEGROUP>
							<WTCONDITION expr="PARAM(Preview)" oper="not-equal" value="CONST(0)"/>
							<WTIMAGE value="CONST(Preview.gif)" alt="Edit" imgalign="absmiddle">
								<WTCLICK>
									var url, win 
									url = "2904.asp?payment=" + document.getElementById('Description').value;
									win = window.open(url, '', "top=200 left=200 width=360, height=300 status=no");
									win.focus();
								</WTCLICK>
							</WTIMAGE>
						</WTCODEGROUP>
					</WTSTATIC>

				</WTROW>
				<WTROW>
					<WTMEMO col="1" merge="2" align="left" value="ATTR(Payment.Description)" cols="70" rows="2"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" merge="2" tag="Notes" align="left"/>
				</WTROW>
				<WTROW>
					<WTMEMO col="1" merge="2" align="left" value="ATTR(Payment.Notes)" cols="72" rows="6"/>
				</WTROW>

				<WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" merge="2" action="2" value="CONST(Add)" align="center">
						<WTCONDITION expr="IsActive"/>
					</WTBUTTON>
					<WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)"/>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>

 		<!--============================================================================================-->
		<WTWEBPAGE name="1011" caption="List" aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl">
 		<!--============================================================================================-->
			<WTPARAM name="OwnerType" datatype="number"/>
			<WTPARAM name="OwnerID" datatype="number"/>

			<WTINCLUDE name="Billing.asp"/>

			<WTCODEGROUP>
				<WTCONDITION expr="IsMemberOnly"/>
				<WTCONDITION expr="NotPayments" connector="and"/>
				<WTRETURN>
					<WTLINK name="0419" return="false">
						<WTPARAM name="Error" value="CONST(1)"/>
					</WTLINK>
				</WTRETURN>
			</WTCODEGROUP>

			<WTACTION name="New" type="New" id="0">
				<WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
					<WTMETHOD name="ListOwner">
						<WTPARAM name="OwnerType" direction="input" value="PARAM(OwnerType)"/>
						<WTPARAM name="OwnerID" direction="input" value="PARAM(OwnerID)"/>
					</WTMETHOD>
<WTCUSTOM>
				Set oBilling = server.CreateObject("ptsBillingUser.CBilling")
				For Each oPayment In oPayments
					PaymentBilling oPayment.Description, oBilling
					With oBilling
						If .PayType = "1" Then   'Credit Card
							Select Case .CardType
							Case 1
								tmpCardType = "Visa"
							Case 2
								tmpCardType = "MasterCard"
							Case 3
								tmpCardType = "Discover"
							Case 4
								tmpCardType = "Amex"
							End Select
							oPayment.Description = tmpCardType + ", ************" + Right(.CardNumber,4) + ", " + .CardMo + "/" + .CardYr + ", " + .CardName
						End If
						If .PayType = "2" Then   'Check
							oPayment.Description = .CheckBank + ", ************" + Right(.CheckAccount,4)+ ", " + .CheckName
						End If
					End With

					With oPayment
						note = .Notes
						pos1 = InStr(note, "Credit:[")
						If pos1 &gt; 0 Then
							pos2 = InStr(pos1, note, "]")
							If pos2 &gt; 0 Then
								.Description = .Description + "; " + mid(note, pos1, pos2-(pos1-1))
							End If
						End If
					End With

				Next
				Set oBilling = Nothing
</WTCUSTOM>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlPayments" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(13)"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="600" align="left"/>

				<WTROW>
					<WTSTATIC col="1" label="Payments" class="PageHeading" align="left"/>
				</WTROW>
				<WTROW>
					<WTCONDITION expr="IsEmployee"/>
					<WTCONDITION expr="IsActive" connector="and"/>
					<WTLINKGROUP col="1" align="right">
						<WTLINK name="1005" label="NewPayment" class="PageHeadingLink">
							<WTPARAM name="OwnerType" value="PARAM(OwnerType)"/>
							<WTPARAM name="OwnerID" value="PARAM(OwnerID)"/>
						</WTLINK>
					</WTLINKGROUP>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" align="left" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTROW>
					<WTRECORDSET col="1" graybar="true" entity="Payment">
						<WTCOLUMN width="12" align="left" valign="top" label="PayDate" />
						<WTCOLUMN width="13" align="left" valign="top" label="Amount" />
						<WTCOLUMN width="13" align="left" valign="top" label="Total" />
						<WTCOLUMN width="10" align="left" valign="top" label="Credit" />
						<WTCOLUMN width="15" align="left" valign="top" label="Status" />
						<WTCOLUMN width="15" align="left" valign="top" label="PayType" />
						<WTCOLUMN width="13" align="left" valign="top" label="Reference" />
						<WTCOLUMN width="6" align="center" valign="top" label="#" />
						<WTROW>
							<WTCONDITION expr="IsEmployee"/>
							<WTSTATIC col="1" value="DATA(Payment.PayDate)">
								<WTLINK name="1003"><WTPARAM name="PaymentID" value="DATA(Payment.PaymentID)"/></WTLINK>
							</WTSTATIC>
							<WTSTATIC col="2" value="DATA(Payment.Amount)">
								<WTLINK name="1003"><WTPARAM name="PaymentID" value="DATA(Payment.PaymentID)"/></WTLINK>
							</WTSTATIC>
							<WTSTATIC col="3" value="DATA(Payment.Total)"/>
							<WTSTATIC col="4" value="DATA(Payment.Credit)"/>
							<WTSTATIC col="5">
								<WTSTATIC value="DATA(Payment.Status)" fontcolor="green">
									<WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(2)"/>
								</WTSTATIC>
								<WTSTATIC value="DATA(Payment.Status)" fontcolor="blue">
									<WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(2)"/>
								</WTSTATIC>
								<WTSTATIC value="DATA(Payment.Status)">
									<WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(3)"/>
								</WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="red">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="greater" value="CONST(3)"/>
                  <WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(7)" connector="and"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="orange">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(7)"/>
                </WTSTATIC>
              </WTSTATIC>
							<WTSTATIC col="6" value="DATA(Payment.PayType)"/>
							<WTSTATIC col="7" value="DATA(Payment.Reference)"/>
							<WTSTATIC col="8" value="DATA(Payment.PaymentID)"/>
						</WTROW>
						<WTROW>
							<WTCONDITION expr="NotEmployee"/>
							<WTSTATIC col="1" value="DATA(Payment.PayDate)"/>
							<WTSTATIC col="2" value="DATA(Payment.Amount)"/>
							<WTSTATIC col="3" value="DATA(Payment.Total)"/>
							<WTSTATIC col="4" value="DATA(Payment.Credit)"/>
							<WTSTATIC col="5">
								<WTSTATIC value="DATA(Payment.Status)" fontcolor="green">
									<WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(2)"/>
								</WTSTATIC>
								<WTSTATIC value="DATA(Payment.Status)" fontcolor="blue">
									<WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(2)"/>
								</WTSTATIC>
								<WTSTATIC value="DATA(Payment.Status)">
									<WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(3)"/>
								</WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="red">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="greater" value="CONST(3)"/>
                  <WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(7)" connector="and"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="orange">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(7)"/>
                </WTSTATIC>
              </WTSTATIC>
							<WTSTATIC col="6" value="DATA(Payment.PayType)"/>
							<WTSTATIC col="7" value="DATA(Payment.Reference)"/>
							<WTSTATIC col="8" value="DATA(Payment.PaymentID)"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" merge="2"/>
							<WTSTATIC col="3" merge="6" fontcolor="gray">
								<WTSTATIC value="DATA(Payment.Purpose)" space="2"/>
								<WTSTATIC value="DATA(Payment.Description)"/>
							</WTSTATIC>
						</WTROW>
					</WTRECORDSET>
				</WTROW>

				<WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" action="3" value="CONST(Return)" align="center"/>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>

		<!-- =============================================================================================== -->
		<WTWEBPAGE name="1021" caption="Sales Order Payments" page-width="580" page-left="0" margin-width="0" navbar="false" header="false" footer="false" 
		aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" track="0">
		<!-- =============================================================================================== -->
			<WTPARAM name="SearchText" datatype="text"/>
			<WTPARAM name="FindTypeID" datatype="number"/>
			<WTPARAM name="Bookmark" datatype="text"/>
			<WTPARAM name="Direction" datatype="number"/>
			<WTPARAM name="MemberID" datatype="number"/>
			<WTPARAM name="FromDate" datatype="date"/>
			<WTPARAM name="ToDate" datatype="date"/>
			<WTPARAM name="Declines" datatype="number"/>

			<WTINCLUDE name="Billing.asp"/>

			<WTSETATTRIBUTE name="PARAM(FindTypeID)" value="FINDID(PayDate)">
				<WTCONDITION expr="PARAM(FindTypeID)" oper="equal" value="CONST(0)"/>
			</WTSETATTRIBUTE>

			<WTACTION id="0" name="New" type="New">
				<WTSETATTRIBUTE name="PARAM(ToDate)" value="SYS(Date)"/>
        <WTSETATTRIBUTE name="PARAM(FromDate)" value="CONST(DateAdd(&quot;m&quot;, -12, reqToDate))"/>
        <WTSETATTRIBUTE name="PARAM(FromDate)" value="CONST(&quot;1/1/2013&quot;)">
          <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="SYSCON(LEGACYMAX)"/>
        </WTSETATTRIBUTE>
        <WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
				<WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
					<WTSETATTRIBUTE name="CONST(.FindTypeID)" value="CONST(reqFindTypeID)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlPayments" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(14)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark"/>
			</WTACTION>

			<WTACTION id="5" name="Find" type="New">
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTACTION id="6" name="Previous" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(2)"/>
			</WTACTION>

			<WTACTION id="7" name="Next" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
				<WTSETATTRIBUTE name="CONST(tmpToDate)" value="CONST(DateAdd(&quot;d&quot;, 1, reqToDate))"/>
				<WTMETHOD name="FindMember">
					<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
					<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
					<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
					<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
					<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
					<WTPARAM name="MemberID" direction="input" value="PARAM(MemberID)"/>
					<WTPARAM name="FromDate" direction="input" value="PARAM(FromDate)"/>
					<WTPARAM name="ToDate" direction="input" value="CONST(tmpToDate)"/>
					<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
				</WTMETHOD>
			<WTCUSTOM>
				Set oBilling = server.CreateObject("ptsBillingUser.CBilling")
				For Each oPayment In oPayments
				If oPayment.Status = 4 Then reqDeclines = reqDeclines + 1
				 
				PaymentBilling oPayment.Description, oBilling
				With oBilling
					Select Case .PayType
					Case "1"  'Credit Card
						Select Case .CardType
						Case 1 tmpCardType = "Visa"
						Case 2 tmpCardType = "MasterCard"
						Case 3 tmpCardType = "Discover"
						Case 4 tmpCardType = "Amex"
						End Select
						oPayment.Description = tmpCardType + ", ************" + Right(.CardNumber,4) + ", " + .CardMo + "/" + .CardYr + ", " + .CardName
					Case "2"  'Check
						oPayment.Description = .CheckBank + ", ************" + Right(.CheckAccount,4)+ ", " + .CheckName
					Case "4"  'eWallet
						Select Case .CardType
						Case 11 tmpCardType = "iPayout"
						Case 12	tmpCardType = "PayQuicker"
						Case 13	tmpCardType = "SolidTrust"
						End Select
						oPayment.Description = tmpCardType + ", " + .CardName
					Case Else
						oPayment.description = ""
					End Select
				End With

				With oPayment
				note = .Notes
				pos1 = InStr(note, "Credit:[")
				If pos1 &gt; 0 Then
							pos2 = InStr(pos1, note, "]")
							If pos2 &gt; 0 Then
								.Description = .Description + "; " + mid(note, pos1, pos2-(pos1-1))
							End If
						End If
					End With

				Next
				Set oBilling = Nothing
			</WTCUSTOM>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlPayments" direction="return" datatype="text"/>
					<WTPARAM name="Option" direction="input" value="CONST(15)"/>
				</WTMETHOD>
			</WTOBJECT>
			<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark">
				<WTSETATTRIBUTE name="ATTR(LastBookmark)" value="PARAM(Bookmark)"/>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlBookmark" direction="return" datatype="text"/>
				</WTMETHOD>
			</WTOBJECT>

			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="600" align="left"/>

				<WTFUNCTION name="ProcessDeclines()">
					var url, win;
					url = "0436d.asp?memberid=" + document.getElementById('MemberID').value
					win = window.open(url,"Declines");
					win.focus();
				</WTFUNCTION>
				<WTROW>
					<WTHIDDEN value="PARAM(MemberID)"/>
				</WTROW>
				
				<WTROW>
					<WTTABLE col="1">
						<WTCOLUMN width="300" align="left"/>
						<WTCOLUMN width="300" align="right"/>
						<WTROW>
							<WTSTATIC col="1" label="OrderPayments" class="PageHeading"/>
							<WTSTATIC col="2">
								<WTCODEGROUP>
									<WTIMAGE value="CONST(financesm.gif)" imgalign="absmiddle"/>
									<WTSTATIC space="1"/>
									<WTSTATIC label="DirectPayments" bold="true">
										<WTLINK name="1022">
											<WTPARAM name="MemberID" value="PARAM(MemberID)"/>
											<WTPARAM name="OrderOption" value="CONST(1)"/>
										</WTLINK>
									</WTSTATIC>
								</WTCODEGROUP>
							</WTSTATIC>
						</WTROW>
					</WTTABLE>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="SearchBy" class="ColumnHeader" align="center"/>
					<WTCOMBO col="1" value="ATTR(Payments.FindTypeID)" translate="true" prespace="false"/>
					<WTSTATIC col="1" tag="SearchFor" class="ColumnHeader"/>
					<WTTEXT col="1" value="ATTR(Bookmark.SearchText)" size="10" focus="true" prespace="false"/>
					<WTSTATIC col="1" tag="From" class="ColumnHeader"/>
					<WTTEXT col="1" value="PARAM(FromDate)" size="7" type="date" prespace="false"/>
					<WTSTATIC col="1" tag="To" class="ColumnHeader"/>
					<WTTEXT col="1" value="PARAM(ToDate)" size="7" type="date" prespace="false"/>
					<WTBUTTON col="1" action="5" value="CONST(Go)" default="true"/>
				</WTROW>

				<WTSTATIC label="HelpAmount"/>
				<WTSTATIC label="HelpCredit"/>

				<WTROW>
					<WTRECORDSET col="1" graybar="true" prevnext="top" entity="Payment">
						<WTCOLUMN width="12" align="left" label="PayDate"/>
						<WTCOLUMN width="16" align="left" label="Amount"/>
						<WTCOLUMN width="17" align="left" label="Status"/>
						<WTCOLUMN width="15" align="left" label="PayType"/>
						<WTCOLUMN width="12" align="left" label="PaidDate"/>
						<WTCOLUMN width="18" align="left" label="Reference"/>
						<WTCOLUMN width="10"  align="center" label="#" />
						<WTROW>
							<WTSTATIC col="1" value="DATA(Payment.PayDate)"/>
							<WTSTATIC col="2">
								<WTSTATIC value="DATA(Payment.Total)" fontcolor="red">
									<WTCONDITION expr="DATA(Payment.Status)" oper="greater" value="CONST(3)"/>
								</WTSTATIC>
								<WTSTATIC value="DATA(Payment.Total)">
									<WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(4)"/>
								</WTSTATIC>
								<WTCODEGROUP>
									<WTCONDITION expr="IsEmployee"/>
									<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
									<WTSTATIC space="1"/>
									<WTIMAGE value="CONST(Edit.gif)" alt="Edit" imgalign="absmiddle">
										<WTLINK name="1003" target="_blank">
											<WTPARAM name="PaymentID" value="DATA(Payment.PaymentID)"/>
											<WTPARAM name="ContentPage" value="CONST(3)"/>
											<WTPARAM name="PopUp" value="CONST(1)"/>
										</WTLINK>
									</WTIMAGE>
								</WTCODEGROUP>
							</WTSTATIC>
							<WTSTATIC col="3" value="DATA(Payment.Status)"/>
							<WTSTATIC col="4" value="DATA(Payment.PayType)" enum="true"/>
							<WTSTATIC col="5" value="DATA(Payment.PaidDate)"/>
							<WTSTATIC col="6" value="DATA(Payment.Reference)"/>
							<WTSTATIC col="7" value="DATA(Payment.PaymentID)"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1">
								<WTCODEGROUP>
									<WTSTATIC value="DATA(CommStatus)" fontcolor="gray"/>
								</WTCODEGROUP>
							</WTSTATIC>
							<WTSTATIC col="2">
								<WTCODEGROUP>
									<WTCONDITION expr="DATA(Payment.Amount)" oper="not-equal" value="DATA(Total)"/>
									<WTSTATIC value="DATA(Payment.Amount)" fontcolor="gray"/>
									<WTIMAGE value="CONST(Helpsm.gif)" alt="HelpAmount" imgalign="absmiddle"/>
								</WTCODEGROUP>
								<WTSTATIC space="1"/>
								<WTCODEGROUP>
									<WTCONDITION expr="DATA(Payment.Credit)" oper="not-equal" value="CONST('$0.00')"/>
									<WTSTATIC value="DATA(Payment.Credit)" fontcolor="gray"/>
									<WTIMAGE value="CONST(Helpsm.gif)" alt="HelpCredit" imgalign="absmiddle"/>
								</WTCODEGROUP>
							</WTSTATIC>
							<WTSTATIC col="3" merge="5" fontcolor="gray">
								<WTSTATIC value="DATA(Payment.Purpose)" space="1"/>
								<WTSTATIC value="DATA(Payment.Description)"/>
							</WTSTATIC>
						</WTROW>
					</WTRECORDSET>
				</WTROW>

				<WTROW margin-top="6" margin-bottom="12">
					<WTCONDITION expr="PARAM(Declines)" oper="not-equal" value="CONST(0)"/>
					<WTBUTTON col="1" value="CONST(ProcessDeclines)" align="center">
						<WTCLICK>ProcessDeclines()</WTCLICK>
					</WTBUTTON>
					<WTBUTTON col="1" action="0" value="CONST(Refresh)" align="center"/>
				</WTROW>
				
			</WTCONTENT>

		</WTWEBPAGE>

		<!-- =============================================================================================== -->
		<WTWEBPAGE name="1022" caption="Member Payments" page-width="580" page-left="0" margin-width="0" navbar="false" header="false" footer="false" 
		aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" secured="52" track="0">
		<!-- =============================================================================================== -->
			<WTPARAM name="SearchText" datatype="text"/>
			<WTPARAM name="FindTypeID" datatype="number"/>
			<WTPARAM name="Bookmark" datatype="text"/>
			<WTPARAM name="Direction" datatype="number"/>
			<WTPARAM name="MemberID" datatype="number"/>
			<WTPARAM name="OrderOption" datatype="number"/>
			<WTPARAM name="Declines" datatype="number"/>
			<WTPARAM name="STP" datatype="number"/>

			<WTINCLUDE name="Billing.asp"/>
			<WTINCLUDE name="Wallet.asp"/>

			<WTCODEGROUP>
				<WTCONDITION expr="IsSysAdmin"/>
				<WTCONDITION expr="SYS(CompanyID)" oper="equal" value="SYSCON(GCR)" connector="or"/>
				<WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
					<WTMETHOD name="Custom">
						<WTPARAM name="CompanyID" direction="input" value="SYSCON(GCR)"/>
						<WTPARAM name="MemberID" direction="input" value="PARAM(MemberID)"/>
						<WTPARAM name="Status" direction="input" value="CONST(1010)"/>
						<WTPARAM name="CountryID" direction="return" datatype="text"/>
					</WTMETHOD>
					<WTCODEGROUP>
						<WTCONDITION expr="CONST(CountryID)" oper="not-equal" value="CONST(0)"/>
						<WTSETATTRIBUTE name="PARAM(STP)" value="CONST(STPCountry( CountryID ))"/>
					</WTCODEGROUP>
				</WTOBJECT>
			</WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="IsMemberOnly"/>
        <WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="SYS(MemberID)" connector="and"/>
        <WTCUSTOM>AbortUser()</WTCUSTOM>
      </WTCODEGROUP>

      <WTSETATTRIBUTE name="PARAM(FindTypeID)" value="FINDID(PayDate)">
				<WTCONDITION expr="PARAM(FindTypeID)" oper="equal" value="CONST(0)"/>
			</WTSETATTRIBUTE>

			<WTACTION id="0" name="New" type="New">
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
				<WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
					<WTSETATTRIBUTE name="CONST(.FindTypeID)" value="CONST(reqFindTypeID)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlPayments" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(14)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark"/>
			</WTACTION>

			<WTACTION id="5" name="Find" type="New">
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTACTION id="6" name="Previous" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(2)"/>
			</WTACTION>

			<WTACTION id="7" name="Next" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
				<WTMETHOD name="FindOwner">
					<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
					<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
					<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
					<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
					<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
					<WTPARAM name="OwnerType" direction="input" value="ENTITY(Member)"/>
					<WTPARAM name="OwnerID" direction="input" value="PARAM(MemberID)"/>
					<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
				</WTMETHOD>
<WTCUSTOM>
          Set oBilling = server.CreateObject("ptsBillingUser.CBilling")
          For Each oPayment In oPayments
'            With oPayment
'              If Left(.Purpose,7) = "GCRCOIN" Then .PayType = "0"
'            End With

          If oPayment.PayType &lt;= 5 Then
						If oPayment.Status = 4 Then reqDeclines = reqDeclines + 1
						PaymentBilling oPayment.Description, oBilling
						With oBilling
							Select Case .PayType
							Case "1"  'Credit Card
								Select Case .CardType
								Case 1 tmpCardType = "Visa"
								Case 2 tmpCardType = "MasterCard"
								Case 3 tmpCardType = "Discover"
								Case 4 tmpCardType = "Amex"
								End Select
								oPayment.Description = tmpCardType + ", ************" + Right(.CardNumber,4) + ", " + .CardMo + "/" + .CardYr + ", " + .CardName
							Case "2"  'Check
								oPayment.Description = .CheckBank + ", ************" + Right(.CheckAccount,4)+ ", " + .CheckName
							Case "4"  'Wallet
								Select Case .CardType
								Case 11 tmpCardType = "iPayout"
								Case 12	tmpCardType = "PayQuicker"
								Case 13	tmpCardType = "SolidTrust"
								End Select
								oPayment.Description = tmpCardType + ", " + .CardName
							Case Else
								oPayment.description = ""
							End Select
						End With

						With oPayment
  						note = .Notes
	  					pos1 = InStr(note, "Credit:[")
		  				If pos1 &gt; 0 Then
								pos2 = InStr(pos1, note, "]")
								If pos2 &gt; 0 Then
									.Description = .Description + "; " + mid(note, pos1, pos2-(pos1-1))
								End If
							End If
						End With
					End If

				Next
				Set oBilling = Nothing
</WTCUSTOM>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlPayments" direction="return" datatype="text"/>
					<WTPARAM name="Option" direction="input" value="CONST(15)"/>
				</WTMETHOD>
			</WTOBJECT>
			<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark">
				<WTSETATTRIBUTE name="ATTR(LastBookmark)" value="PARAM(Bookmark)"/>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlBookmark" direction="return" datatype="text"/>
				</WTMETHOD>
			</WTOBJECT>

			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="600" align="left"/>

        <WTFUNCTION name="ProcessDeclines()">
          var url, win;
          url = "0436d.asp?memberid=" + document.getElementById('MemberID').value
          win = window.open(url,"Declines");
          win.focus();
        </WTFUNCTION>
        <WTFUNCTION name="CryptoPay(id)">
          var url, win;
          url = "CryptoPay.asp?paymentid=" + id + "&amp;result=1"
          win = window.open(url,"CryptoPay");
          win.focus();
        </WTFUNCTION>
        <WTROW>
					<WTHIDDEN value="PARAM(MemberID)"/>
				</WTROW>

        <WTROW margin-bottom="6">
          <WTTABLE col="1">
						<WTCOLUMN width="300" align="left"/>
						<WTCOLUMN width="300" align="right"/>
						<WTROW>
							<WTSTATIC col="1" label="DirectPayments" class="PageHeading"/>
							<WTSTATIC col="2" class="PageHeader">
								<WTCODEGROUP>
									<WTCODEGROUP>
										<WTCONDITION expr="IsEmployee"/>
										<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
										<WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
										<WTIMAGE value="CONST(addnew.gif)" imgalign="absmiddle"/>
										<WTSTATIC space="1"/>
										<WTSTATIC label="NewPayment" bold="true">
											<WTLINK name="1005">
												<WTPARAM name="OwnerType" value="ENTITY(Member)"/>
												<WTPARAM name="OwnerID" value="PARAM(MemberID)"/>
												<WTPARAM name="ContentPage" value="CONST(3)" />
											</WTLINK>
										</WTSTATIC>
									</WTCODEGROUP>
									<WTCODEGROUP>
										<WTCONDITION expr="PARAM(OrderOption)" oper="not-equal" value="CONST(0)"/>
										<WTSTATIC space="2"/>
										<WTIMAGE value="CONST(financesm.gif)" imgalign="absmiddle"/>
										<WTSTATIC space="1"/>
										<WTSTATIC label="OrderPayments" bold="true">
											<WTLINK name="1021"><WTPARAM name="MemberID" value="PARAM(MemberID)"/></WTLINK>
										</WTSTATIC>
									</WTCODEGROUP>
								</WTCODEGROUP>
							</WTSTATIC>
						</WTROW>
					</WTTABLE>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="SearchBy" class="ColumnHeader" align="center"/>
					<WTCOMBO col="1" value="ATTR(Payments.FindTypeID)" translate="true" prespace="false"/>
					<WTSTATIC col="1" tag="SearchFor" class="ColumnHeader"/>
					<WTTEXT col="1" value="ATTR(Bookmark.SearchText)" size="10" focus="true" prespace="false"/>
					<WTBUTTON col="1" action="5" value="CONST(Go)" default="true"/>
				</WTROW>

				<WTSTATIC label="HelpAmount"/>
				<WTSTATIC label="HelpCredit"/>
				<WTSTATIC label="PayBitcoin"/>
				<WTSTATIC label="Invoice"/>

				<WTROW>
					<WTRECORDSET col="1" graybar="true" prevnext="top" entity="Payment">
						<WTCOLUMN width="12" align="left" label="PayDate"/>
						<WTCOLUMN width="16" align="left" label="Amount"/>
						<WTCOLUMN width="17" align="left" label="Status"/>
						<WTCOLUMN width="15" align="left" label="PayType"/>
						<WTCOLUMN width="12" align="center" label="PaidDate"/>
						<WTCOLUMN width="18" align="left" label="Reference"/>
						<WTCOLUMN width="10"  align="center" label="#" />
						<WTROW>
							<WTSTATIC col="1" value="DATA(Payment.PayDate)"/>
							<WTSTATIC col="2">
                <WTSTATIC value="DATA(Payment.Total)">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(4)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Total)" fontcolor="red">
									<WTCONDITION expr="DATA(Payment.Status)" oper="greater" value="CONST(3)"/>
                  <WTCONDITION expr="DATA(Payment.Status)" oper="not-equal" value="CONST(7)" connector="and"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Total)" fontcolor="orange">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(7)"/>
                </WTSTATIC>
								<WTCODEGROUP>
									<WTCONDITION expr="IsEmployee"/>
									<WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
									<WTSTATIC space="1"/>
									<WTIMAGE value="CONST(Edit.gif)" alt="Edit" imgalign="absmiddle">
										<WTLINK name="1003" target="_blank">
											<WTPARAM name="PaymentID" value="DATA(Payment.PaymentID)"/>
											<WTPARAM name="ContentPage" value="CONST(3)"/>
											<WTPARAM name="PopUp" value="CONST(1)"/>
										</WTLINK>
									</WTIMAGE>
								</WTCODEGROUP>
								<WTCODEGROUP>
									<WTSTATIC space="1"/>
									<WTIMAGE value="CONST(Preview.gif)" alt="Invoice" imgalign="absmiddle">
										<WTLINK name="1003r" target="Invoice">
											<WTPARAM name="PaymentID" value="DATA(Payment.PaymentID)"/>
										</WTLINK>
									</WTIMAGE>
								</WTCODEGROUP>
							</WTSTATIC>
							<WTSTATIC col="3">
                <WTSTATIC value="DATA(Payment.Status)">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(4)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="red">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="greater" value="CONST(3)"/>
                  <WTCONDITION expr="DATA(Payment.Status)" oper="not-equal" value="CONST(7)" connector="and"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="orange">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(7)"/>
                </WTSTATIC>
              </WTSTATIC>
              <WTSTATIC col="4" value="DATA(Payment.PayType)" enum="true"/>
							<WTSTATIC col="5">
								<WTSTATIC value="DATA(Payment.PaidDate)"/>
                <!--
                <WTCODEGROUP>
									<WTCONDITION expr="DATA(Status)" oper="less" value="CONST(3)"/>
									<WTCONDITION expr="DATA(Status)" oper="equal" value="CONST(4)" connector="or"/>
                  <WTCODEGROUP>
                    <WTCONDITION expr="DATA(PayType)" oper="equal" value="CONST(14)"/>
                    <WTCONDITION expr="DATA(CompanyID)" oper="equal" value="SYSCON(GCR)" connector="or"/>
                    <WTSTATIC space="1"/>
                    <WTIMAGE value="CONST(Bitcoin32.gif)" alt="PayBitcoin" imgalign="absmiddle">
                      <WTLINK name="1010" target="Bitcoin">
                        <WTPARAM name="PaymentID" value="DATA(PaymentID)"/>
                      </WTLINK>
                    </WTIMAGE>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="DATA(CompanyID)" oper="equal" value="SYSCON(GCR)"/>
                    <WTCONDITION expr="DATA(PayType)" oper="not-equal" value="CONST(0)" connector="and"/>
                    <WTSTATIC newline="1"/>
                    <WTSTATIC label="OR" bold="true"/>
                  </WTCODEGROUP>
                </WTCODEGROUP>
								<WTCODEGROUP>
									<WTCONDITION expr="DATA(Status)" oper="less" value="CONST(3)"/>
									<WTCONDITION expr="DATA(Status)" oper="equal" value="CONST(4)" connector="or"/>
								  <WTCODEGROUP>
									  <WTCONDITION expr="PARAM(STP)" oper="not-equal" value="CONST(0)"/>
                    <WTCODEGROUP>
                      <WTCONDITION expr="DATA(PayType)" oper="not-equal" value="CONST(0)"/>
                      <WTSTATIC newline="1">
                        <WTCONDITION expr="DATA(CompanyID)" oper="equal" value="SYSCON(GCR)"/>
                      </WTSTATIC>
                      <WTIMAGE value="CONST(PayType13.gif)" alt="PaySTP" imgalign="absmiddle">
			  							  <WTLINK name="1010s" target="STP">
				  							  <WTPARAM name="PaymentID" value="DATA(PaymentID)"/>
					  					  </WTLINK>
						  			  </WTIMAGE>
                    </WTCODEGROUP>
                  </WTCODEGROUP>
								</WTCODEGROUP>
-->                
							</WTSTATIC>
              <WTSTATIC col="6">
                <WTCODEGROUP>
                  <WTCONDITION expr="DATA(Status)" oper="less" value="CONST(3)"/>
                  <WTCONDITION expr="DATA(Status)" oper="equal" value="CONST(4)" connector="or"/>
                  <WTCONDITION expr="DATA(Status)" oper="equal" value="CONST(7)" connector="or"/>
                  <WTCODEGROUP>
                    <WTCONDITION expr="DATA(PayType)" oper="equal" value="CONST(14)"/>
                    <WTCONDITION expr="DATA(CompanyID)" oper="equal" value="SYSCON(NEXXUS)" connector="or"/>
                    <WTSTATIC space="1"/>
                    <WTBUTTON value="CONST(PayNow)" align="center">
                      <WTCLICK escape="false">CryptoPay(&lt;xsl:value-of select=&quot;@paymentid&quot;/&gt;)</WTCLICK>
                    </WTBUTTON>
                  </WTCODEGROUP>
                </WTCODEGROUP>
                <WTSTATIC value="DATA(Payment.Reference)"/>
              </WTSTATIC>
              <WTSTATIC col="7" value="DATA(Payment.PaymentID)"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1">
								<WTCODEGROUP>
									<WTSTATIC value="DATA(CommStatus)" fontcolor="gray"/>
								</WTCODEGROUP>
							</WTSTATIC>
							<WTSTATIC col="2">
								<WTCODEGROUP>
									<WTCONDITION expr="DATA(Payment.Amount)" oper="not-equal" value="DATA(Total)"/>
									<WTSTATIC value="DATA(Payment.Amount)" fontcolor="gray"/>
									<WTIMAGE value="CONST(Helpsm.gif)" alt="HelpAmount" imgalign="absmiddle">
										<WTCONDITION expr="DATA(Payment.PayType)" oper="not-equal" value="CONST(91)"/>
									</WTIMAGE>
								</WTCODEGROUP>
							</WTSTATIC>
							<WTSTATIC col="3">
                <WTCODEGROUP>
                  <WTCONDITION expr="DATA(Payment.Credit)" oper="not-equal" value="CONST('$0.00')"/>
                  <WTSTATIC value="DATA(Payment.Credit)" fontcolor="gray"/>
                  <WTIMAGE value="CONST(Helpsm.gif)" alt="HelpCredit" imgalign="absmiddle">
                    <WTCONDITION expr="DATA(Payment.PayType)" oper="not-equal" value="CONST(91)"/>
                  </WTIMAGE>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="DATA(CompanyID)" oper="equal" value="SYSCON(GCR)"/>
                  <WTCONDITION expr="DATA(TokenOwner)" oper="not-equal" value="CONST(0)" connector="and"/>
                  <WTSTATIC value="DATA(Payment.TokenOwner)" fontcolor="gray"/>
                </WTCODEGROUP>
              </WTSTATIC>
							<WTSTATIC col="4" merge="4" fontcolor="gray">
								<WTSTATIC value="DATA(Payment.Purpose)" space="1"/>
								<WTSTATIC value="DATA(Payment.Description)"/>
							</WTSTATIC>
						</WTROW>
					</WTRECORDSET>
				</WTROW>

				<WTROW margin-top="6" margin-bottom="12">
					<WTCONDITION expr="PARAM(Declines)" oper="not-equal" value="CONST(0)"/>
					<WTBUTTON col="1" value="CONST(ProcessDeclines)" align="center">
						<WTCLICK>ProcessDeclines()</WTCLICK>
					</WTBUTTON>
					<WTBUTTON col="1" action="0" value="CONST(Refresh)" align="center"/>
				</WTROW>

			</WTCONTENT>

		</WTWEBPAGE>

		<!-- =============================================================================================== -->
		<WTWEBPAGE name="m_1022" caption="Member Payments" page-left="0" page-top="0" navbar="false" header="false" footer="false" wrapper="false"
			page-width="100%" margin-width="0" navbar-width="0" content-width="100%" action="5" viewport="width=device-width"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" mobile="MobileHome.asp" secured="98" track="0">
			<!-- =============================================================================================== -->
			<WTPARAM name="SearchText" datatype="text"/>
			<WTPARAM name="FindTypeID" datatype="number"/>
			<WTPARAM name="Bookmark" datatype="text"/>
			<WTPARAM name="Direction" datatype="number"/>
			<WTPARAM name="MemberID" datatype="number"/>
			<WTPARAM name="OrderOption" datatype="number"/>

			<WTINCLUDE name="Billing.asp"/>

      <WTCODEGROUP>
        <WTCONDITION expr="IsMemberOnly"/>
        <WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="SYS(MemberID)" connector="and"/>
        <WTCUSTOM>AbortUser()</WTCUSTOM>
      </WTCODEGROUP>

      <WTSETATTRIBUTE name="PARAM(FindTypeID)" value="FINDID(PayDate)">
				<WTCONDITION expr="PARAM(FindTypeID)" oper="equal" value="CONST(0)"/>
			</WTSETATTRIBUTE>

			<WTACTION id="0" name="New" type="New">
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
				<WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
					<WTSETATTRIBUTE name="CONST(.FindTypeID)" value="CONST(reqFindTypeID)"/>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlPayments" direction="return" datatype="text"/>
						<WTPARAM name="Option" direction="input" value="CONST(14)"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark"/>
			</WTACTION>

			<WTACTION id="5" name="Find" type="New">
				<WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTACTION id="6" name="Previous" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(2)"/>
			</WTACTION>

			<WTACTION id="7" name="Next" type="New">
				<WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
			</WTACTION>

			<WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
				<WTMETHOD name="FindOwner">
					<WTPARAM name="reqBookmark" direction="return" datatype="text"/>
					<WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
					<WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
					<WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
					<WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
					<WTPARAM name="OwnerType" direction="input" value="ENTITY(Member)"/>
					<WTPARAM name="OwnerID" direction="input" value="PARAM(MemberID)"/>
					<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
				</WTMETHOD>
				<WTCUSTOM>
					Set oBilling = server.CreateObject("ptsBillingUser.CBilling")
					For Each oPayment In oPayments
					If oPayment.PayType &lt;= 5 Then
					PaymentBilling oPayment.Description, oBilling
					With oBilling
					If .PayType = "1" Then   'Credit Card
					Select Case .CardType
					Case 1
					tmpCardType = "Visa"
					Case 2
					tmpCardType = "MasterCard"
					Case 3
					tmpCardType = "Discover"
					Case 4
					tmpCardType = "Amex"
					End Select
					oPayment.Description = tmpCardType + ", ************" + Right(.CardNumber,4) + ", " + .CardMo + "/" + .CardYr + ", " + .CardName
					End If
					If .PayType = "2" Then   'Check
					oPayment.Description = .CheckBank + ", ************" + Right(.CheckAccount,4)+ ", " + .CheckName + ", " + .CheckAcctType
					End If
					End With

					With oPayment
					note = .Notes
					pos1 = InStr(note, "Credit:[")
					If pos1 &gt; 0 Then
					pos2 = InStr(pos1, note, "]")
					If pos2 &gt; 0 Then
					.Description = .Description + "; " + mid(note, pos1, pos2-(pos1-1))
					End If
					End If
					End With
					End If

					Next
					Set oBilling = Nothing
				</WTCUSTOM>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlPayments" direction="return" datatype="text"/>
					<WTPARAM name="Option" direction="input" value="CONST(15)"/>
				</WTMETHOD>
			</WTOBJECT>
			<WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark">
				<WTSETATTRIBUTE name="ATTR(LastBookmark)" value="PARAM(Bookmark)"/>
				<WTMETHOD name="XML">
					<WTPARAM name="xmlBookmark" direction="return" datatype="text"/>
				</WTMETHOD>
			</WTOBJECT>

			<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="100" align="left"/>

				<WTROW margin-bottom="6">
					<WTSTATIC col="1" label="MyPayments" class="PageHeading" align="center"/>
				</WTROW>
        <WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="SearchBy" class="ColumnHeader" align="center"/>
					<WTCOMBO col="1" value="ATTR(Payments.FindTypeID)" translate="true"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" tag="SearchFor" class="ColumnHeader" align="center"/>
					<WTTEXT col="1" value="ATTR(Bookmark.SearchText)" size="10" focus="true"/>
					<WTBUTTON col="1" action="5" value="CONST(View)" default="true"/>
				</WTROW>

				<WTSTATIC label="HelpAmount"/>
				<WTSTATIC label="HelpCredit"/>

        <WTROW margin-bottom="6">
          <WTRECORDSET col="1" graybar="true" prevnext="true" entity="Payment">
						<WTCOLUMN width="12" align="left" label="PayDate"/>
						<WTCOLUMN width="16" align="left" label="Amount"/>
						<WTCOLUMN width="17" align="left" label="Status"/>
						<WTCOLUMN width="12" align="left" label="PaidDate"/>
						<WTROW>
							<WTSTATIC col="1" value="DATA(Payment.PayDate)"/>
							<WTSTATIC col="2">
								<WTSTATIC value="DATA(Payment.Total)" fontcolor="red">
									<WTCONDITION expr="DATA(Payment.Status)" oper="greater" value="CONST(3)"/>
								</WTSTATIC>
								<WTSTATIC value="DATA(Payment.Total)">
									<WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(4)"/>
								</WTSTATIC>
							</WTSTATIC>
							<WTSTATIC col="3" value="DATA(Payment.Status)"/>
							<WTSTATIC col="4" value="DATA(Payment.PaidDate)"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1"/>
							<WTSTATIC col="2" value="DATA(Payment.PayType)" enum="true"/>
							<WTSTATIC col="3" merge="2" value="DATA(Payment.Reference)"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" merge="4">
								<WTCODEGROUP>
									<WTCONDITION expr="DATA(Payment.Amount)" oper="not-equal" value="DATA(Total)"/>
									<WTSTATIC value="DATA(Payment.Amount)" fontcolor="gray"/>
									<WTIMAGE value="CONST(Helpsm.gif)" alt="HelpAmount" imgalign="absmiddle"/>
								</WTCODEGROUP>
								<WTSTATIC space="1"/>
								<WTCODEGROUP>
									<WTCONDITION expr="DATA(Payment.Credit)" oper="not-equal" value="CONST('$0.00')"/>
									<WTSTATIC value="DATA(Payment.Credit)" fontcolor="gray"/>
									<WTIMAGE value="CONST(Helpsm.gif)" alt="HelpCredit" imgalign="absmiddle"/>
								</WTCODEGROUP>
								<WTSTATIC space="1"/>
								<WTSTATIC value="DATA(Payment.Purpose)" space="1"/>
								<WTSTATIC value="DATA(Payment.Description)"/>
							</WTSTATIC>
						</WTROW>
					</WTRECORDSET>
				</WTROW>

			</WTCONTENT>

		</WTWEBPAGE>

		<!--==================================================================================================================-->
		<WTWEBPAGE name="1004" navbar="false" aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" focus="false" secured="125">
		<!--==================================================================================================================-->
			<WTPARAM name="PaymentID" datatype="number"/>
			<WTPARAM name="TxnStatus" datatype="number"/>
			<WTPARAM name="IsTxn" datatype="text"/>
			<WTPARAM name="Acct" datatype="text"/>
			<WTPARAM name="Result" datatype="text"/>

			<WTPARAM name="PaymentOptions" datatype="text"/>
			<WTPARAM name="MiscPay1" datatype="text"/>
			<WTPARAM name="MiscPay2" datatype="text"/>
			<WTPARAM name="MiscPay3" datatype="text"/>
			<WTPARAM name="CompanyID" datatype="number"/>
			
<WTSUB function="ProcessPayment(ByVal bvID)">
	<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
		<WTMETHOD name="Load">
			<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
			<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
		</WTMETHOD>
		<WTCODEGROUP>
			<WTCONDITION expr="ATTR(OwnerType)" oper="not-equal" value="CONST(0)"/>
			<WTSETATTRIBUTE name="PARAM(CompanyID)" value="ATTR(OwnerID)">
				<WTCONDITION expr="ATTR(OwnerType)" oper="equal" value="ENTITY(Company)"/>
			</WTSETATTRIBUTE>
			<WTMETHOD name="GetCompany">
				<WTCONDITION expr="ATTR(OwnerType)" oper="not-equal" value="ENTITY(Company)"/>
				<WTPARAM name="reqCompanyID" direction="return" datatype="number"/>
				<WTPARAM name="OwnerType" direction="input" value="ATTR(OwnerType)"/>
				<WTPARAM name="OwnerID" direction="input" value="ATTR(OwnerID)"/>
			</WTMETHOD>
		</WTCODEGROUP>
	</WTOBJECT>

	<WTOBJECT name="Business" project="ptsBusinessUser" class="CBusiness">
		<WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
		<WTMETHOD name="Load">
			<WTPARAM name="BusinessID" direction="input" value="CONST(1)"/>
			<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
		</WTMETHOD>
		<WTSETATTRIBUTE name="PARAM(PaymentOptions)" value="ATTR(PaymentOptions)"/>
		<WTSETATTRIBUTE name="PARAM(MiscPay1)" value="ATTR(MiscPay1)"/>
		<WTSETATTRIBUTE name="PARAM(MiscPay2)" value="ATTR(MiscPay2)"/>
		<WTSETATTRIBUTE name="PARAM(MiscPay3)" value="ATTR(MiscPay3)"/>
		<WTSETATTRIBUTE name="CONST(tmpCardProcessor)" value="ATTR(Business.CardProcessor)"/>
		<WTSETATTRIBUTE name="CONST(tmpCardAcct)" value="ATTR(Business.CardAcct)"/>
		<WTSETATTRIBUTE name="CONST(tmpCheckProcessor)" value="ATTR(Business.CheckProcessor)"/>
		<WTSETATTRIBUTE name="CONST(tmpCheckAcct)" value="ATTR(Business.CheckAcct)"/>
		<WTSETATTRIBUTE name="CONST(tmpMerchantName)" value="ATTR(Business.BusinessName)"/>
	</WTOBJECT>
	<WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
		<WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="CONST(0)"/>
		<WTMETHOD name="Load">
			<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
			<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
		</WTMETHOD>
		<WTSETATTRIBUTE name="CONST(tmpMerchantName)" value="ATTR(Company.CompanyName)"/>
	</WTOBJECT>
	<WTOBJECT name="Coption" project="ptsCoptionUser" class="CCoption">
		<WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="CONST(0)"/>
		<WTMETHOD name="FetchCompany">
			<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
		</WTMETHOD>			
		<WTMETHOD name="Load">
			<WTPARAM name="CoptionID" direction="input" value="ATTR(CoptionID)"/>
			<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
		</WTMETHOD>
		<WTSETATTRIBUTE name="PARAM(PaymentOptions)" value="ATTR(PaymentOptions)"/>
		<WTSETATTRIBUTE name="PARAM(MiscPay1)" value="ATTR(MiscPay1)"/>
		<WTSETATTRIBUTE name="PARAM(MiscPay2)" value="ATTR(MiscPay2)"/>
		<WTSETATTRIBUTE name="PARAM(MiscPay3)" value="ATTR(MiscPay3)"/>
		<WTSETATTRIBUTE name="CONST(tmpCardProcessor)" value="ATTR(Company.MerchantCardType)"/>
		<WTSETATTRIBUTE name="CONST(tmpCardAcct)" value="ATTR(Company.MerchantCardAcct)"/>
		<WTSETATTRIBUTE name="CONST(tmpCheckProcessor)" value="ATTR(Company.MerchantCheckType)"/>
		<WTSETATTRIBUTE name="CONST(tmpCheckAcct)" value="ATTR(Company.MerchantCheckAcct)"/>
	</WTOBJECT>
	
	<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
		<WTMETHOD name="Load">
			<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
			<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
		</WTMETHOD>

<WTCUSTOM>
	If bvID = 0 Then
		.Validate 
		If (Err.Number &lt;&gt; 0) Then DoError Err.Number, Err.Source, Err.Description End If
	Else
		Set oBilling = server.CreateObject("ptsBillingUser.CBilling")
		PaymentBilling oPayment.Description, oBilling

		If xmlError = "" Then
			If .Status = 3 and reqSysUserGroup &gt; 23 Then
				reqResult = "good"
			Else
				PaymentProcessed = False
				Select Case .PayType
				Case "1", "2", "3", "4"	'Process Credit Cards
					If tmpCardProcessor > 0 and tmpCardAcct &lt;&gt; ""  Then
						Set wtPay = server.CreateObject("wtPayment.CPayment")
						If wtPay Is Nothing Then
							DoError Err.Number, Err.Source, "Unable to Create Object - wtPayment.CPayment"
						Else
							PaymentProcessed = True
							wtpay.PaymentID = reqPaymentID
							wtpay.account = tmpCardAcct
							wtpay.processor = tmpCardProcessor
							wtpay.Amount = .Amount
							wtpay.description = .Purpose
							With oBilling
								wtpay.Card .CardNumber, .CardMo, .CardYr, .CardName, .Zip, .CardCode
							End With
							Select Case wtpay.process
							Case -1	'Pending
								.Reference = Left(wtPay.Reference,30)
								.Notes = .Notes + "PENDING: " + wtPay.ErrMsg
								.Status = 2
								reqResult = "good"
							Case 0	'Approved
								.Reference = Left(wtPay.Reference,30)
								.Notes = .Notes + "APPROVED"
								.Status = 3
								reqResult = "good"
							Case Else	'Declined
								.Notes = .Notes + wtPay.ErrMsg
								.Status = 4
								reqResult = "bad"
							End Select							
						End If
						Set wtPay = Nothing
					End If
				Case "5"		'Process Electronic Checks
					If tmpCheckProcessor > 0 and tmpCheckAcct &lt;&gt; "" Then
						Set wtPay = server.CreateObject("wtPayment.CPayment")
						If wtPay Is Nothing Then
							DoError Err.Number, Err.Source, "Unable to Create Object - wtPayment.CPayment"
						Else
							PaymentProcessed = True
							wtpay.PaymentID = reqPaymentID
							wtpay.account = tmpCheckAcct
							wtpay.processor = tmpCheckProcessor
							wtpay.Amount = .Amount
							wtpay.description = .Purpose
							With oBilling
								wtpay.Check .CheckBank, .CheckRoute, .CheckAcct, .CheckNumber, .CheckName
							End With
							Select Case wtpay.process
							Case -1	'Pending
								.Reference = Left(wtPay.Reference,30)
								.Notes = .Notes + "PENDING: " + wtPay.ErrMsg
								.Status = 2
								reqResult = "good"
							Case 0	'Approved
								.Reference = Left(wtPay.Reference,30)
								.Notes = .Notes + "APPROVED"
								.Status = 3
								reqResult = "good"
							Case Else	'Declined
								.Notes = .Notes + wtPay.ErrMsg
								.Status = 4
								reqResult = "bad"
							End Select							
						End If
						Set wtPay = Nothing
					End If
				End Select
			
				If PaymentProcessed = False Then
					.Notes = .Notes + "SUBMITTED"
					.Status = 1
					reqResult = "good"
				End If

			End If
		End If
		Set oBilling = Nothing
	End If
</WTCUSTOM>

		<WTMETHOD name="Save">
			<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
		</WTMETHOD>
		<WTMETHOD name="XML">
			<WTPARAM name="xmlPayment" direction="return" datatype="text"/>
			<WTPARAM name="Option" direction="input" value="CONST(2)"/>
		</WTMETHOD>
	</WTOBJECT>		
</WTSUB>

			<WTACTION id="0" name="New" type="New">
				<WTCALLSUB name="ProcessPayment(0)"/>
			</WTACTION>

			<WTACTION id="1" name="Retry" type="Update">
				<WTCALLSUB name="ProcessPayment(1)"/>
			</WTACTION>

			<WTACTION id="2" name="Continue" type="Continue">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="Load">
						<WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
<WTCUSTOM>
				tmpRedir = Replace(GetCache("1004URL"), "%26", "&amp;")
				If InStr(tmpRedir, "?") = 0 Then
					tmpRedir = tmpRedir &amp; "?"
				Else
					tmpRedir = tmpRedir &amp; "&amp;"
				End If
				If .Status = 3 Then
					Response.Redirect tmpRedir &amp; "TxnStatus=1"
				Else
					Response.Redirect tmpRedir &amp; "TxnStatus=3"
				End If
</WTCUSTOM>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="3" name="Cancel" type="Cancel">
<WTCUSTOM>
				Response.Redirect reqReturnURL &amp; "&amp;TxnStatus=2" 
</WTCUSTOM>
			</WTACTION>

			<!--*************************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="300" align="right"/>
				<WTCOLUMN width="440" align="left"/>

				<WTROW>
					<WTSTATIC col="1" merge="2" label="Payment" class="PageHeading" align="left"/>
				</WTROW>
				
				<WTROW margin-bottom="12">
					<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
				</WTROW>
				<WTROW>
					<WTIMAGE col="1" merge="2" align="left" value="CONST(padlock.gif)" imgalign="absmiddle"/>
					<WTSTATIC col="1" merge="2" label="SecurePayment" bold="true"/>
				</WTROW>

				<WTROW>
					<WTSTATIC col="1" tag="Purpose" height="24"/>
					<WTSTATIC col="2" value="ATTR(Payment.Purpose)" class="BoldText"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Amount" height="24"/>
					<WTSTATIC col="2" value="ATTR(Payment.Amount)" class="BoldText"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Reference" height="24"/>
					<WTSTATIC col="2" value="ATTR(Payment.Reference)" class="BoldText"/>
				</WTROW>
				<WTROW>
					<WTSTATIC col="1" tag="Notes" height="24"/>
					<WTSTATIC col="2" value="ATTR(Payment.Notes)" class="BoldText"/>
				</WTROW>
				<WTROW margin-top="12" margin-bottom="12">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Result)" oper="equal" value="CONST('good')"/>
					<WTCONDITION expr="ATTR(Payment.Status)" oper="equal" value="CONST(3)" connector="and"/>
					<WTROW margin-top="24" margin-bottom="24">
						<WTSTATIC col="1" merge="2" label="GoodPayment" class="prompt" align="left" bold="true"/>
					</WTROW>
					<WTROW>
						<WTSTATIC col="1" tag="PayType" height="18"/>
						<WTSTATIC col="2" value="ATTR(Payment.PayType)"/>
					</WTROW>
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(Payment.PayType)" oper="less" value="CONST(5)"/>
						<WTROW>
							<WTSTATIC col="1" tag="CardNumber"/>
							<WTTEXT col="2" value="ATTR(Billing.CardNumber)" size="25" required="true">
								<WTEXIT>var x = this.value; var filter  = /[^0-9]/; if (filter.test(x)) alert('Please enter digits only for your Credit Card Number')</WTEXIT>
							</WTTEXT>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardDate"/>
							<WTCOMBO col="2" value="ATTR(Billing.CardMo)"/>
							<WTCOMBO col="2" value="ATTR(Billing.CardYr)" required="true" prespace="false"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardName"/>
							<WTTEXT col="2" value="ATTR(Billing.CardName)" size="25" required="true"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardCode"/>
							<WTTEXT col="2" value="ATTR(Billing.CardCode)" required="true"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardZip"/>
							<WTTEXT col="2" value="ATTR(Billing.Zip)" required="true"/>
						</WTROW>
					</WTCODEGROUP>
					
					<WTCODEGROUP>
						<WTCONDITION expr="ATTR(Payment.PayType)" oper="equal" value="CONST(5)"/>
							<WTROW>
								<WTSTATIC col="1" tag="CheckBank"/>
								<WTTEXT col="2" value="ATTR(Billing.CheckBank)" size="25" required="true"/>
							</WTROW>
							<WTROW>
								<WTSTATIC col="1" tag="CheckRoute"/>
								<WTTEXT col="2" value="ATTR(Billing.CheckRoute)" required="true"/>
							</WTROW>
							<WTROW>
								<WTSTATIC col="1" tag="CheckAccount"/>
								<WTTEXT col="2" value="ATTR(Billing.CheckAccount)" size="25" required="true"/>
							</WTROW>
							<WTROW>
								<WTSTATIC col="1" tag="CheckNumber"/>
								<WTTEXT col="2" value="ATTR(Billing.CheckNumber)" required="true"/>
							</WTROW>
							<WTROW>
								<WTSTATIC col="1" tag="CheckName"/>
								<WTTEXT col="2" value="ATTR(Billing.CheckName)" size="25" required="true"/>
							</WTROW>
							<WTROW>
								<WTIMAGE col="1" merge="2" align="center" value="CONST(checkref.gif)"/>
							</WTROW>
					</WTCODEGROUP>

					<WTROW margin-top="18">
						<WTBUTTON col="1" merge="2" action="2" value="CONST(Continue)" align="center">
							<WTCLICK>doSubmit(2,&quot;&quot;); this.disabled = true</WTCLICK>
						</WTBUTTON>
					</WTROW>
				</WTCODEGROUP>
				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Result)" oper="equal" value="CONST('good')"/>
					<WTCONDITION expr="ATTR(Payment.Status)" oper="less-equal" value="CONST(2)" connector="and"/>
					<WTROW margin-top="24" margin-bottom="24">
						<WTSTATIC col="1" merge="2" label="PaymentSubmitted" class="prompt" align="center" bold="true"/>
					</WTROW>
					<WTROW margin-top="18">
						<WTSTATIC col="1"/>
						<WTBUTTON col="2" action="2" value="CONST(Continue)">
							<WTCLICK>doSubmit(2,&quot;&quot;); this.disabled = true</WTCLICK>
						</WTBUTTON>
					</WTROW>
				</WTCODEGROUP>
				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Result)" oper="equal" value="CONST('bad')"/>
					<WTROW margin-top="24" margin-bottom="24">
						<WTSTATIC col="1" merge="2" label="BadPayment" class="prompt" align="left" bold="true"/>
					</WTROW>

					<WTROW>
						<WTSTATIC col="1" tag="PayType"/>
						<WTCOMBO col="2" value="ATTR(Payment.PayType)">
						<WTOPTION id="0" label="blank"/>
						<WTOPTION id="1" label="Visa">
							<WTCONDITION expr="_IsPaymentVisa"/>
						</WTOPTION>
						<WTOPTION id="2" label="MasterCard">
							<WTCONDITION expr="_IsPaymentMC"/>
						</WTOPTION>
						<WTOPTION id="3" label="Discover">
							<WTCONDITION expr="_IsPaymentDiscover"/>
						</WTOPTION>
						<WTOPTION id="4" label="Amex">
							<WTCONDITION expr="_IsPaymentAmex"/>
						</WTOPTION>
						<WTOPTION id="5" label="Check">
							<WTCONDITION expr="_IsPaymentCheck"/>
						</WTOPTION>
						<WTOPTION id="6" label="eWallet">
							<WTCONDITION expr="_IsPaymenteWallet"/>
						</WTOPTION>
						<WTOPTION id="7" label="Cash">
							<WTCONDITION expr="_IsPaymentCash"/>
						</WTOPTION>
						<WTOPTION id="8" label="PO">
							<WTCONDITION expr="_IsPaymentPO"/>
						</WTOPTION>
              <WTOPTION id="10" label="Wallet">
                <WTCONDITION expr="_IsPaymentWallet"/>
              </WTOPTION>
              <WTOPTION id="11" label="iPayout">
							<WTCONDITION expr="_IsPaymentiPayout"/>
						</WTOPTION>
						<WTOPTION id="12" label="PayQuicker">
							<WTCONDITION expr="_IsPaymentPayQuicker"/>
						</WTOPTION>
						<WTOPTION id="13" label="SolidTrust">
							<WTCONDITION expr="_IsPaymentSolidTrust"/>
						</WTOPTION>
              <WTOPTION id="14" label="BitCoin">
                <WTCONDITION expr="_IsPaymentBitCoin"/>
              </WTOPTION>
              <WTOPTION id="15" label="BitCoinCash">
                <WTCONDITION expr="_IsPaymentBitCoinCash"/>
              </WTOPTION>
              <WTOPTION id="21" label="Nexxus">
                <WTCONDITION expr="_IsPaymentNexxus"/>
              </WTOPTION>
              <WTOPTION id="97" value="PARAM(MiscPay1)">
							<WTCONDITION expr="_IsPaymentMisc1"/>
						</WTOPTION>
						<WTOPTION id="98" value="PARAM(MiscPay2)">
							<WTCONDITION expr="_IsPaymentMisc2"/>
						</WTOPTION>
						<WTOPTION id="99" value="PARAM(MiscPay3)">
							<WTCONDITION expr="_IsPaymentMisc3"/>
						</WTOPTION>
						</WTCOMBO>
					</WTROW>
					<WTCODEGROUP>
						<WTCONDITION expr="_IsPaymentVisa"/>
						<WTCONDITION expr="_IsPaymentMC" connector="or"/>
						<WTCONDITION expr="_IsPaymentDiscover" connector="or"/>
						<WTCONDITION expr="_IsPaymentAmex" connector="or"/>
						<WTROW margin-top="12" margin-bottom="12">
							<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
						</WTROW>
						<WTROW margin-bottom="12">
							<WTSTATIC col="1" merge="2" align="left" label="CardText" class="prompt"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardNumber"/>
							<WTTEXT col="2" value="ATTR(Billing.CardNumber)"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardDate"/>
							<WTCOMBO col="2" value="ATTR(Billing.CardMo)" />
							<WTCOMBO col="2" value="ATTR(Billing.CardYr)" />
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardName"/>
							<WTTEXT col="2" value="ATTR(Billing.CardName)"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CardCode"/>
							<WTTEXT col="2" value="ATTR(Billing.CardCode)"/>
						</WTROW>
					</WTCODEGROUP>
					<WTCODEGROUP>
						<WTCONDITION expr="IsPaymentCheck"/>
						<WTROW margin-top="12" margin-bottom="12">
							<WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(divider)"/>
						</WTROW>
						<WTROW margin-bottom="12">
							<WTSTATIC col="1" merge="2" align="left" label="CheckText" class="prompt"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CheckBank"/>
							<WTTEXT col="2" value="ATTR(Billing.CheckBank)"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CheckRoute"/>
							<WTTEXT col="2" value="ATTR(Billing.CheckRoute)"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CheckAcct"/>
							<WTTEXT col="2" value="ATTR(Billing.CheckAcct)"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CheckNumber"/>
							<WTTEXT col="2" value="ATTR(Billing.CheckNumber)"/>
						</WTROW>
						<WTROW>
							<WTSTATIC col="1" tag="CheckName"/>
							<WTTEXT col="2" value="ATTR(Billing.CheckName)"/>
						</WTROW>
						<WTROW>
					   	<WTIMAGE col="1" merge="2" align="center" value="CONST(checkref.gif)"/>
						</WTROW>
					</WTCODEGROUP>

					<WTROW margin-top="6">
						<WTIMAGE col="1" merge="2" align="center" value="CONST(padlock.gif)" imgalign="absmiddle"/>
						<WTSTATIC col="1" merge="2" label="SecurePayment" bold="true"/>
					</WTROW>

					<WTROW margin-top="12">
						<WTBUTTON col="1" merge="2" action="1" value="CONST(Retry)" align="center">
							<WTCLICK>doSubmit(1,&quot;&quot;); this.disabled = true</WTCLICK>
						</WTBUTTON>
						<WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)"/>
					</WTROW>
				</WTCODEGROUP>

				<WTROW margin-top="12"/>
			</WTCONTENT>
		</WTWEBPAGE>

 		<!--============================================================================================-->
		<WTWEBPAGE name="1020" caption="Accounting" header="false" footer="false" navbar="false" 
				   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" langfile="1020" secured="125">
 		<!--============================================================================================-->
			<WTPARAM name="Action" datatype="number"/>
			<WTPARAM name="CCTotal" datatype="number"/>
			<WTPARAM name="CKTotal" datatype="number"/>
			<WTPARAM name="CCFile" datatype="text"/>
			<WTPARAM name="CKFile" datatype="text"/>
			<WTPARAM name="Result" datatype="text"/>

			<WTINCLUDE name="Accounting.asp"/>

			<WTSETATTRIBUTE name="PARAM(Action)" value="CONST(reqActionCode)"/>

			<WTACTION id="0" name="New" type="New">
			</WTACTION>
			
			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="2" name="LinkReferrals" type="Update">
				<WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
					<WTMETHOD name="ReferralIDs">
						<WTPARAM name="CompanyID" direction="input" value="CONST(0)"/>
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>			
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; New Referrals Successfully Linked!&quot;)"/>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="4" name="CreatePayments" type="Update">
				<WTSETATTRIBUTE name="CONST(tmpPayDate)" value="FORM(ReportToDate)"/>
				<WTSETATTRIBUTE name="CONST(tmpPayDate)" value="SYS(Date)">
					<WTCONDITION expr="CONST(tmpPayDate)" oper="equal" value="CONST(&quot;&quot;)"/>
				</WTSETATTRIBUTE>
				<WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
					<WTMETHOD name="BillingCycle">
						<WTPARAM name="CompanyID" direction="input" value="CONST(0)"/>
						<WTPARAM name="PayDate" direction="input" value="CONST(tmpPayDate)"/>
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; New Payments Successfully Created!&quot;)"/>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="5" name="CreateCCCKFiles" type="Update">
				<WTCALLSUB name="CreateCCCKFiles 0, reqCCTotal, reqCKTotal, reqCCFile, reqCKFile, tmpError"/>
				<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(tmpError)">
					<WTCONDITION expr="CONST(tmpError)" oper="not-equal" value="CONST(&quot;&quot;)"/>
				</WTSETATTRIBUTE>
			</WTACTION>

			<WTACTION id="6" name="SetCCCKPending" type="Update">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="SetPendingCCCK">
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; Submitted Payments marked Pending!&quot;)"/>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="7" name="UpdateStatus" type="Upload">
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
					<WTLINK name="1050" return="false"/>
				</WTRETURN>
			</WTACTION>

			<WTACTION id="8" name="CalcTrainerScores" type="Upload">
				<WTOBJECT name="Commission" project="ptsCommissionUser" class="CCommission">
					<WTMETHOD name="TrainerScores">
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; Courses and Assessments Processed!&quot;)"/>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="9" name="CreateCommissions" type="Upload">
				<WTSETATTRIBUTE name="CONST(tmpPayDate)" value="FORM(PayDate)"/>
				<WTSETATTRIBUTE name="CONST(tmpPayDate)" value="SYS(Date)">
					<WTCONDITION expr="CONST(tmpPayDate)" oper="equal" value="CONST(&quot;&quot;)"/>
				</WTSETATTRIBUTE>
				<WTOBJECT name="Commission" project="ptsCommissionUser" class="CCommission">
					<WTMETHOD name="CreateCommissions">
						<WTPARAM name="PayDate" direction="input" value="CONST(tmpPayDate)"/>
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; New Commissions Created!&quot;)"/>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="10" name="CreatePayouts" type="Upload">
				<WTOBJECT name="Payout" project="ptsPayoutUser" class="CPayout">
					<WTMETHOD name="CreatePayouts">
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; New Payouts Created!&quot;)"/>
				</WTOBJECT>
			</WTACTION>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="600" align="center"/>

				<WTROW>
					<WTSTATIC col="1" align="left" label="Accounting" class="PageHeading"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" height="1" color="SYS(headerdivider)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Result)" oper="not-equal" value="CONST('')"/>
					<WTROW margin-bottom="6">
						<WTSTATIC col="1" value="PARAM(Result)" class="PageHeading" fontcolor="blue"/>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
					</WTROW>
				</WTCODEGROUP>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Action)" oper="equal" value="CONST(5)"/>
					<WTCONDITION expr="PARAM(Result)" oper="equal" value="CONST('')" connector="and"/>
					<WTROW margin-bottom="6">
						<WTSTATIC col="1" class="PageHeading" fontcolor="blue">
							<WTSTATIC value="PARAM(CCTotal)" space="1" bold="true"/>
							<WTSTATIC label="CCPayments" space="1"/>
							<WTCODEGROUP>
								<WTCONDITION expr="PARAM(CCTotal)" oper="greater" value="CONST(0)"/>
								<WTSTATIC label="InFile" space="1"/>
								<WTSTATIC value="PARAM(CCFile)"/>
							</WTCODEGROUP>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTSTATIC col="1" class="PageHeading" fontcolor="blue">
							<WTSTATIC value="PARAM(CKTotal)" space="1" bold="true"/>
							<WTSTATIC label="CKPayments" space="1"/>
							<WTCODEGROUP>
								<WTCONDITION expr="PARAM(CKTotal)" oper="greater" value="CONST(0)"/>
								<WTSTATIC label="InFile" space="1"/>
								<WTSTATIC value="PARAM(CKFile)"/>
							</WTCODEGROUP>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
					</WTROW>
				</WTCODEGROUP>

				<WTROW margin-top="6" margin-bottom="12">
					<WTSTATIC col="1" label="PaymentsText" align="center" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="2" value="CONST(LinkReferrals)" align="center" msg="ConfirmLink"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="4" value="CONST(CreatePayments)" align="center" msg="ConfirmCreatePayments"/>
					<WTSTATIC col="1" label="Thru"/>
					<WTTEXT col="1" value="ATTR(Payment.ReportToDate)" required="false"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="5" value="CONST(CreateCCCKFiles)" align="center" msg="ConfirmCreateCCCKFiles"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="6" value="CONST(SetCCCKPending)" align="center" msg="ConfirmSetCCCKPending"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="7" value="CONST(UpdateStatus)" align="center"/>
				</WTROW>

				<WTROW margin-top="6">
					<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-top="6" margin-bottom="12">
					<WTSTATIC col="1" label="CommissionsText" align="center" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="8" value="CONST(CalcTrainerScores)" align="center" msg="ConfirmCalcTrainerScores"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="9" value="CONST(CreateCommissions)" align="center" msg="ConfirmCreateCommissions"/>
					<WTSTATIC col="1" label="Thru"/>
					<WTTEXT col="1" value="ATTR(Payment.PayDate)" required="false"/>
				</WTROW>

				<WTROW margin-top="6">
					<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-top="6" margin-bottom="12">
					<WTSTATIC col="1" label="PayoutsText" align="center" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="10" value="CONST(CreatePayouts)" align="center" msg="ConfirmCreatePayouts"/>
				</WTROW>

				<WTROW margin-top="6">
					<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-top="12" margin-bottom="12">
					<WTBUTTON col="1" action="3" value="CONST(Return)" align="center"/>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>

 		<!--============================================================================================-->
		<WTWEBPAGE name="1030" caption="Accounting" aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" langfile="1030" secured="125">
 		<!--============================================================================================-->
			<WTPARAM name="CompanyID" datatype="number"/>
			<WTPARAM name="Action" datatype="number"/>
			<WTPARAM name="CCTotal" datatype="number"/>
			<WTPARAM name="CKTotal" datatype="number"/>
			<WTPARAM name="CCFile" datatype="text"/>
			<WTPARAM name="CKFile" datatype="text"/>
			<WTPARAM name="Result" datatype="text"/>
			<WTPARAM name="PayDate" datatype="date"/>
			<WTPARAM name="PayoutDate" datatype="date"/>
			<WTPARAM name="PaidDate" datatype="date"/>
			<WTPARAM name="PayoutFileDate" datatype="date"/>
			<WTPARAM name="DebitDate" datatype="date"/>
			<WTPARAM name="CommDate" datatype="date"/>
			<WTPARAM name="CommPlan" datatype="number"/>
			<WTPARAM name="PayoutAmount" datatype="currency"/>

			<WTINCLUDE name="Accounting.asp"/>

			<WTSETATTRIBUTE name="PARAM(Action)" value="CONST(reqActionCode)"/>

			<WTCODEGROUP>
				<WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
					<WTMETHOD name="Load">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>			
					<WTMETHOD name="XML">
						<WTPARAM name="xmlCompany" direction="return" datatype="text"/>
					</WTMETHOD>
				</WTOBJECT>
				<WTOBJECT name="CommPlans" project="ptsCommPlanUser" class="CCommPlans">
					<WTMETHOD name="EnumCompany">
						<WTPARAM name="xmlCommPlans" direction="return" datatype="text" />
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)" />
						<WTPARAM name="ItemID" direction="input" value="CONST()" />
						<WTPARAM name="Element" direction="input" value="CONST()" />
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
					</WTMETHOD>
				</WTOBJECT>
			</WTCODEGROUP>

			<WTACTION id="0" name="New" type="New">
				<WTSETATTRIBUTE name="PARAM(CommDate)" value="SYS(Date)"/>
				<WTSETATTRIBUTE name="PARAM(CommPlan)" value="CONST(1)"/>
				<WTSETATTRIBUTE name="PARAM(PayDate)" value="SYS(Date)"/>
				<WTSETATTRIBUTE name="PARAM(PayoutDate)" value="SYS(Date)"/>
				<WTSETATTRIBUTE name="PARAM(PaidDate)" value="SYS(Date)"/>
				<WTSETATTRIBUTE name="PARAM(PayoutFileDate)" value="SYS(Date)"/>
				<WTSETATTRIBUTE name="PARAM(DebitDate)" value="SYS(Date)"/>
				<WTSETATTRIBUTE name="PARAM(PayoutAmount)" value="CONST(50)"/>
			</WTACTION>
			
			<WTACTION id="3" name="Cancel" type="Cancel">
				<WTRETURN/>
			</WTACTION>

			<WTACTION id="4" name="CreateSOPayments" type="Update">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="CompanyPayments">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="PayDate" direction="input" value="PARAM(PayDate)"/>
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; New Payments Successfully Created!&quot;)"/>
				</WTOBJECT>
			</WTACTION>
			<WTACTION id="14" name="CreateMEPayments" type="Update">
				<WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
					<WTMETHOD name="BillingCycle">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="PayDate" direction="input" value="PARAM(PayDate)"/>
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; New Payments Successfully Created!&quot;)"/>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="5" name="CreateCCCKFiles" type="Update">
				<WTCALLSUB name="CreateCCCKFiles reqCompanyID, reqCCTotal, reqCKTotal, reqCCFile, reqCKFile, tmpError"/>
				<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(tmpError)">
					<WTCONDITION expr="CONST(tmpError)" oper="not-equal" value="CONST(&quot;&quot;)"/>
				</WTSETATTRIBUTE>
			</WTACTION>

			<WTACTION id="6" name="SetCCCKPending" type="Update">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="SetCompanyPendingCCCK">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; Submitted Payments marked Pending!&quot;)"/>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="7" name="UpdateStatus" type="Upload">
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
					<WTLINK name="1050" return="false"/>
				</WTRETURN>
			</WTACTION>

			<WTACTION id="9" name="CreateCommissions" type="Upload">
				<WTSETATTRIBUTE name="PARAM(PayoutDate)" value="PARAM(CommDate)"/>
				<WTSETATTRIBUTE name="PARAM(DebitDate)" value="PARAM(CommDate)"/>
				<WTSETATTRIBUTE name="PARAM(PayoutFileDate)" value="PARAM(CommDate)"/>
				<WTOBJECT name="Commission" project="ptsCommissionUser" class="CCommission">
					<WTMETHOD name="CompanyCommissions">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="CommPlan" direction="input" value="PARAM(CommPlan)"/>
						<WTPARAM name="CommDate" direction="input" value="PARAM(CommDate)"/>
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; New Commissions Created!&quot;)"/>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="10" name="CreatePayouts" type="Upload">
				<WTOBJECT name="Payout" project="ptsPayoutUser" class="CPayout">
					<WTMETHOD name="CompanyPayouts">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="PayDate" direction="input" value="PARAM(PayoutDate)"/>
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; New Payouts Created!&quot;)"/>
				</WTOBJECT>
			</WTACTION>
			
			<WTACTION id="11" name="CreateDebits" type="Update">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTMETHOD name="CompanyDebits">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="CommDate" direction="input" value="PARAM(CommDate)"/>
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; New Debits Successfully Created!&quot;)"/>
				</WTOBJECT>
			</WTACTION>

			<WTACTION id="12" name="PayoutFile" type="Update">
<!--
				<WTRETURN>
					<WTCONDITION expr="NoErrors"/>
					<WTLINK name="1050" return="false"/>
				</WTRETURN>
-->
			</WTACTION>

			<WTACTION id="13" name="PayoutStatus" type="Upload">
				<WTOBJECT name="Payout" project="ptsPayoutUser" class="CPayout">
					<WTMETHOD name="CompanyStatus">
						<WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
						<WTPARAM name="PayDate" direction="input" value="PARAM(PayoutFileDate)"/>
						<WTPARAM name="PayoutAmount" direction="input" value="PARAM(PayoutAmount)"/>
						<WTPARAM name="PaidDate" direction="input" value="PARAM(PaidDate)"/>
						<WTPARAM name="Count" direction="return" datatype="number"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="PARAM(Result)" value="CONST(Count &amp; &quot; Payout Statuses Updated!&quot;)"/>
				</WTOBJECT>
			</WTACTION>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="600" align="center"/>

				<WTROW>
					<WTSTATIC col="1" align="left" tag="Accounting" value="ATTR(Company.CompanyName)" class="PageHeading"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" height="2" color="SYS(headerdivider)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Result)" oper="not-equal" value="CONST('')"/>
					<WTROW margin-bottom="6">
						<WTSTATIC col="1" value="PARAM(Result)" class="PageHeading" fontcolor="blue"/>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
					</WTROW>
				</WTCODEGROUP>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Action)" oper="equal" value="CONST(5)"/>
					<WTCONDITION expr="PARAM(Result)" oper="equal" value="CONST('')" connector="and"/>
					<WTROW margin-bottom="6">
						<WTSTATIC col="1" class="PageHeading" fontcolor="blue">
							<WTSTATIC value="PARAM(CCTotal)" space="1" bold="true"/>
							<WTSTATIC label="CCPayments" space="1"/>
							<WTCODEGROUP>
								<WTCONDITION expr="PARAM(CCTotal)" oper="greater" value="CONST(0)"/>
								<WTSTATIC label="InFile" space="1"/>
								<WTSTATIC value="PARAM(CCFile)"/>
							</WTCODEGROUP>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTSTATIC col="1" class="PageHeading" fontcolor="blue">
							<WTSTATIC value="PARAM(CKTotal)" space="1" bold="true"/>
							<WTSTATIC label="CKPayments" space="1"/>
							<WTCODEGROUP>
								<WTCONDITION expr="PARAM(CKTotal)" oper="greater" value="CONST(0)"/>
								<WTSTATIC label="InFile" space="1"/>
								<WTSTATIC value="PARAM(CKFile)"/>
							</WTCODEGROUP>
						</WTSTATIC>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
					</WTROW>
				</WTCODEGROUP>

				<WTROW margin-top="6" margin-bottom="6">
					<WTSTATIC col="1" label="PaymentsText" align="left" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="4" value="CONST(CreateSOPayments)" align="center" msg="ConfirmCreateSOPayments"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="14" value="CONST(CreateMEPayments)" align="center" msg="ConfirmCreateMEPayments"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" label="Thru" align="center"/>
					<WTTEXT col="1" value="PARAM(PayDate)" required="false" size="8"/>
				</WTROW>

				<WTROW margin-top="6">
					<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-top="6" margin-bottom="6">
					<WTSTATIC col="1" label="CCCKText" align="left" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="5" value="CONST(CreateCCCKFiles)" align="center" msg="ConfirmCreateCCCKFiles"/>
					<WTBUTTON col="1" action="6" value="CONST(SetCCCKPending)" align="center" msg="ConfirmSetCCCKPending"/>
				</WTROW>

				<WTROW margin-top="6">
					<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-top="6" margin-bottom="6">
					<WTSTATIC col="1" label="UpdateCCCKText" align="left" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="12">
					<WTBUTTON col="1" action="7" value="CONST(UpdateStatus)" align="center"/>
				</WTROW>

				<WTROW margin-top="6">
					<WTDIVIDER col="1" height="2" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-top="6" margin-bottom="6">
					<WTSTATIC col="1" label="CommissionsText" align="left" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="9" value="CONST(CreateCommissions)" align="center" msg="ConfirmCreateCommissions"/>
					<WTCOMBO col="1" value="PARAM(CommPlan)" datapath="/DATA/TXN/PTSCOMMPLANS/ENUM" setselected="true"/>
					<WTSTATIC col="1" label="Thru"/>
					<WTTEXT col="1" value="PARAM(CommDate)" required="false" size="8"/>
				</WTROW>

				<WTROW margin-top="6">
					<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-top="6" margin-bottom="6">
					<WTSTATIC col="1" label="PayoutsText" align="left" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="10" value="CONST(CreatePayouts)" align="center" msg="ConfirmCreatePayouts"/>
					<WTSTATIC col="1" label="For"/>
					<WTTEXT col="1" value="PARAM(PayoutDate)" required="false" size="8"/>
				</WTROW>

				<WTROW margin-top="6">
					<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-top="6" margin-bottom="6">
					<WTSTATIC col="1" label="DebitsText" align="left" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="11" value="CONST(CreateDebits)" align="center" msg="ConfirmDebits"/>
					<WTSTATIC col="1" label="For"/>
					<WTTEXT col="1" value="PARAM(DebitDate)" required="false" size="8"/>
				</WTROW>

				<WTROW margin-top="6">
					<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-top="6" margin-bottom="6">
					<WTSTATIC col="1" label="PayoutFileText" align="left" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="12" value="CONST(PayoutFile)" align="center" msg="ConfirmPayoutFile"/>
					<WTSTATIC col="1" label="Min"/>
					<WTTEXT col="1" value="PARAM(PayoutAmount)" required="false" size="2"/>
					<WTSTATIC col="1" label="On"/>
					<WTTEXT col="1" value="PARAM(PayoutFileDate)" required="false" size="8"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTBUTTON col="1" action="13" value="CONST(UpdatePayouts)" align="center" msg="ConfirmUpdatePayouts"/>
					<WTSTATIC col="1" label="SetPaidDate"/>
					<WTTEXT col="1" value="PARAM(PaidDate)" required="false" size="8"/>
				</WTROW>

				<WTROW margin-top="6">
					<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
				</WTROW>
				<WTROW margin-top="12" margin-bottom="6">
					<WTBUTTON col="1" action="3" value="CONST(Return)" align="center"/>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>

		<!--=============================================================================================-->
		<WTWEBPAGE name="1050" caption="File Update Status" action="false" submit="1050Upload.asp" type="multi" 
		aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" secured="125">
		<!--=============================================================================================-->
			<WTPARAM name="UploadError" datatype="number"/>
			<WTPARAM name="UploadErrorDesc" datatype="text"/>
			<WTPARAM name="Result" datatype="text"/>
			<WTPARAM name="Error" datatype="number"/>

			<WTCODEGROUP>
				<WTCONDITION expr="PARAM(Result)" oper="not-equal" value="CONST(&quot;&quot;)"/>
<WTCUSTOM>
					reqResult = Replace( reqResult, "~", "&lt;BR&gt;" )
					If Left(reqResult,5) = "ERROR" Then reqError = 1
</WTCUSTOM>
			</WTCODEGROUP>

			<WTCODEGROUP>
				<WTCONDITION expr="PARAM(UploadError)" oper="not-equal" value="CONST(0)"/>
<WTCUSTOM>
					DoError reqUploadError, "Upload", reqUploadErrorDesc
</WTCUSTOM>
			</WTCODEGROUP>

			<WTACTION id="0" name="New" type="New">
				<WTOBJECT name="Business" project="ptsBusinessUser" class="CBusiness">
					<WTMETHOD name="Load">
						<WTPARAM name="BusinessID" direction="input" value="CONST(1)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTSETCACHE name="CARDPROCESSOR" value="CONST(.CardProcessor)"/>
				</WTOBJECT>

			</WTACTION>

	 		<!--*******************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="600" align="left"/>
				
				<WTROW>
					<WTSTATIC col="1" label="UpdateStatus" class="PageHeading"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" height="1" color="SYS(headerdivider)"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" label="UpdateStatusText" class="prompt"/>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" height="1" color="SYS(divider)"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Result)" oper="not-equal" value="CONST('')"/>
					<WTROW margin-top="12" margin-bottom="12">
						<WTCONDITION expr="PARAM(Error)" oper="equal" value="CONST(0)"/>
						<WTSTATIC col="1" value="PARAM(Result)" class="PageHeading" fontcolor="blue" align="center"/>
					</WTROW>
					<WTROW margin-top="12" margin-bottom="12">
						<WTCONDITION expr="PARAM(Error)" oper="equal" value="CONST(1)"/>
						<WTSTATIC col="1" value="PARAM(Result)" class="PageHeading" fontcolor="red" align="center"/>
					</WTROW>
				</WTCODEGROUP>

				<WTROW margin-bottom="12">
					<WTFILE col="1" value="upload" align="center" size="40"/>
					<WTBUTTON col="1" align="center" default="true" action="1" value="CONST(Submit)"/>
				</WTROW>

				<WTROW margin-top="12" margin-bottom="12">
					<WTSTATIC col="1" label="ReturnAccounting" align="center" bold="true" >
						<WTLINK name="1020" skipreturn="true"/>
					</WTSTATIC>
				</WTROW>
			</WTCONTENT>
		</WTWEBPAGE>

		<!--==================================================================-->
		<WTWEBPAGE name="1060" caption="Payment Reports" navbar="false"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" langfile="1060" secured="125">
		<!--==================================================================-->
			<WTPARAM name="Report" datatype="number"/>
			<WTPARAM name="FromDate" datatype="date"/>
			<WTPARAM name="ToDate" datatype="date"/>
			<WTPARAM name="Count" datatype="number"/>
			<WTPARAM name="ChartSource" datatype="text"/>
			<WTPARAM name="Unit" datatype="text"/>
			<WTPARAM name="ImageMap" datatype="text"/>
			<WTPARAM name="Option" datatype="number"/>
			
			<WTINCLUDE name="ChartURL.asp"/>
		   
			<WTACTION id="0" name="New" type="New">
<WTCUSTOM>
				'validate all parameters
				If reqReport &lt; 1 OR reqReport &gt; 4 Then reqReport = 1
				If IsDate(reqFromDate) AND IsDate(reqToDate) Then
					tmpDays = DateDiff("d", reqFromDate, reqToDate )
					If tmpDays &lt;= 31 Then reqUnit = "day"
					If tmpDays &gt; 31 AND tmpDays &lt;= 90 Then reqUnit = "week"
					If tmpDays &gt; 90 AND tmpDays &lt;= 365 Then reqUnit = "month"
					If tmpDays &gt; 365 Then reqUnit = "quarter"
				Else
					reqFromDate = CDate( DateAdd("d", -1, Date()) )
					reqToDate = CDate( Date() )
					reqUnit = "day"	
				End If
</WTCUSTOM>
				<WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
					<WTMETHOD name="ReportStatusAmount">
						<WTCONDITION expr="PARAM(Report)" oper="equal" value="CONST(1)"/>
						<WTPARAM name="ReportFromDate" direction="input" value="PARAM(FromDate)"/>
						<WTPARAM name="ReportToDate" direction="input" value="PARAM(ToDate)"/>
						<WTPARAM name="Option" direction="input" value="PARAM(Option)"/>
					</WTMETHOD>
					<WTMETHOD name="ReportStatusCount">
						<WTCONDITION expr="PARAM(Report)" oper="equal" value="CONST(2)"/>
						<WTPARAM name="ReportFromDate" direction="input" value="PARAM(FromDate)"/>
						<WTPARAM name="ReportToDate" direction="input" value="PARAM(ToDate)"/>
					</WTMETHOD>
					<WTMETHOD name="ReportPayTypeAmount">
						<WTCONDITION expr="PARAM(Report)" oper="equal" value="CONST(3)"/>
						<WTPARAM name="Status" direction="input" value="CONST(0)"/>
						<WTPARAM name="ReportFromDate" direction="input" value="PARAM(FromDate)"/>
						<WTPARAM name="ReportToDate" direction="input" value="PARAM(ToDate)"/>
					</WTMETHOD>
					<WTMETHOD name="ReportPayTypeCount">
						<WTCONDITION expr="PARAM(Report)" oper="equal" value="CONST(4)"/>
						<WTPARAM name="Status" direction="input" value="CONST(0)"/>
						<WTPARAM name="ReportFromDate" direction="input" value="PARAM(FromDate)"/>
						<WTPARAM name="ReportToDate" direction="input" value="PARAM(ToDate)"/>
					</WTMETHOD>
<WTCUSTOM>
	tmpData = ""
	tmpLabels = ""
	Dim extraData
	ReDim extraData(oPayments.Count)
	counter = LBound(extraData)
	For Each oPayment in oPayments
		With oPayment
			Select Case reqReport
			Case 1:
				tmpLabels = tmpLabels + .Status + "|"
				tmpData = tmpData + .Amount + "|"
				reqCount = reqCount + .Amount
				extraData(counter) = .PaymentID
			Case 2:
				tmpLabels = tmpLabels + .Status + "|"
				tmpData = tmpData + .Count + "|"
				reqCount = reqCount + .Count
				extraData(counter) = .PaymentID
			Case 3:
				tmpLabels = tmpLabels + .PayType + "|"
				tmpData = tmpData + .Amount + "|"
				reqCount = reqCount + .Amount
				extraData(counter) = .PaymentID
			Case 4:
				tmpLabels = tmpLabels + .PayType + "|"
				tmpData = tmpData + .Count + "|"
				reqCount = reqCount + .Count
				extraData(counter) = .PaymentID
			End Select
		End With
		counter = counter + 1
	Next

	'Remove last | delimiter
	If tmpData &lt;&gt; "" And Right(tmpData,1) = "|" Then tmpData = Left(tmpData, Len(tmpData)-1 )
	If tmpLabels &lt;&gt; "" And Right(tmpLabels,1) = "|" Then tmpLabels = Left(tmpLabels, Len(tmpLabels)-1 )

	If reqReport = 1 OR reqReport = 3 Then reqCount = FormatCurrency(reqCount)
	If reqReport = 2 OR reqReport = 4  Then reqCount = FormatNumber(reqCount,0)

	'---ChartURL( Type, Width, Height, StartDate, EndDate, Unit, LangFile, Data, Title, XTitle, YTitle )
	Select Case reqReport
	Case 1:
		ChartLabels "1060Chart1", tmpLabels, "", "", "", ""
		reqChartSource = "Chart.asp?type=pie&amp;width=750&amp;height=400&amp;data=" + tmpData + "&amp;labels=" + tmpLabels
	Case 2:
		ChartLabels "1060Chart1", tmpLabels, "", "", "", ""
		reqChartSource = "Chart.asp?type=pie&amp;width=750&amp;height=400&amp;data=" + tmpData + "&amp;labels=" + tmpLabels
	Case 3:
		ChartLabels "1060Chart2", tmpLabels, "", "", "", ""
		reqChartSource = "Chart.asp?type=pie&amp;width=750&amp;height=400&amp;data=" + tmpData + "&amp;labels=" + tmpLabels
	Case 4:
		ChartLabels "1060Chart2", tmpLabels, "", "", "", ""
		reqChartSource = "Chart.asp?type=pie&amp;width=750&amp;height=400&amp;data=" + tmpData + "&amp;labels=" + tmpLabels
	End Select
</WTCUSTOM>
					<WTMETHOD name="XML">
						<WTCONDITION expr="PARAM(Report)" oper="equal" value="CONST(6)"/>
						<WTPARAM name="xmlPayments" direction="return" datatype="text"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTACTION>

	 		<!--************************************************************************************-->
			<WTCONTENT>
				<WTCOLUMN width="150" align="left"/>
				<WTCOLUMN width="600" align="left"/>
				
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
				</WTROW>
				
				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Report)" oper="equal" value="CONST(1)"/>
					<WTROW margin-bottom="6">
						<WTCONDITION expr="PARAM(Option)" oper="equal" value="CONST(1)"/>
						<WTSTATIC col="1" merge="2" label="PaymentStatusAmountReport" class="PageHeading" align="center"/>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTCONDITION expr="PARAM(Option)" oper="equal" value="CONST(2)"/>
						<WTSTATIC col="1" merge="2" label="PaymentStatusCommissionReport" class="PageHeading" align="center"/>
					</WTROW>
					<WTROW margin-bottom="6">
						<WTCONDITION expr="PARAM(Option)" oper="equal" value="CONST(3)"/>
						<WTSTATIC col="1" merge="2" label="PaymentStatusRetailReport" class="PageHeading" align="center"/>
					</WTROW>
				</WTCODEGROUP>
				<WTROW margin-bottom="6">
					<WTCONDITION expr="PARAM(Report)" oper="equal" value="CONST(2)"/>
					<WTSTATIC col="1" merge="2" label="PaymentStatusCountReport" class="PageHeading" align="center"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTCONDITION expr="PARAM(Report)" oper="equal" value="CONST(3)"/>
					<WTSTATIC col="1" merge="2" label="PaymentPayTypeAmountReport" class="PageHeading" align="center"/>
				</WTROW>

				<WTROW margin-bottom="6">
					<WTCONDITION expr="PARAM(Report)" oper="equal" value="CONST(4)"/>
					<WTSTATIC col="1" merge="2" label="PaymentPayTypeCountReport" class="PageHeading" align="center"/>
				</WTROW>
				
				<WTROW margin-bottom="6">
					<WTSTATIC col="1" merge="2" align="center" class="BoldText">
						<WTSTATIC value="PARAM(FromDate)"/>
						<WTSTATIC value="CONST( - )"/>
						<WTSTATIC value="PARAM(ToDate)"/>
					</WTSTATIC>
				</WTROW>
				<WTROW margin-bottom="6">
					<WTDIVIDER col="1" merge="2" height="1" color="SYS(divider)"/>
				</WTROW>
				
				<WTROW margin-top="24" margin-bottom="24">
					<WTCONDITION expr="PARAM(Count)" oper="equal" value="CONST(0)"/>
					<WTCONDITION expr="PARAM(Count)" oper="equal" value="CONST('$0.00')" connector="or"/>
					<WTSTATIC col="1" merge="2" label="NoReportData" class="PageHeading" align="center"/>
				</WTROW>

				<WTCODEGROUP>
					<WTCONDITION expr="PARAM(Count)" oper="not-equal" value="CONST(0)"/>
					<WTCONDITION expr="PARAM(Count)" oper="not-equal" value="CONST('$0.00')" connector="and"/>

					<WTROW margin-bottom="6">
						<WTCONDITION expr="PARAM(ImageMap)" oper="equal" value="CONST('')"/>
						<WTIMAGE col="1" merge="2" align="center" value="PARAM(ChartSource)" path="../.."/>
					</WTROW>
				
					<WTROW margin-bottom="6">
						<WTCONDITION expr="PARAM(ImageMap)" oper="not-equal" value="CONST('')"/>
						<WTIMAGE col="1" merge="2" align="center" value="PARAM(ChartSource)" path="charts" usemap="Map1"/>
						<WTMAP col="1" merge="2" align="center" name="Map1" areahtml="PARAM(ImageMap)"/>
					</WTROW>

					<WTROW margin-bottom="12">
						<WTSTATIC col="1" merge="2" align="center" tag="TotalPayments" value="PARAM(Count)" class="PageHeading"/>
					</WTROW>
				</WTCODEGROUP>

				<WTROW margin-bottom="12">
					<WTBUTTON col="1" merge="2" value="CONST(Close)" align="center">
						<WTCLICK>window.close()</WTCLICK>
					</WTBUTTON>
				</WTROW>

			</WTCONTENT>
		</WTWEBPAGE>
		
		<!-- CALL BACK LINK FOR PENDING PAYMENT PROCESSING - USED BY eWALLETS AND PAYPAL -->
		<!--=============================================================================================-->
		<WTWEBPAGE name="1000" worker="true" aspstyle="GenerateWebASP.xsl">
			<!--=============================================================================================-->
			<WTPARAM name="Ref" datatype="text"/>
			<WTPARAM name="Stat" datatype="text"/>
			<WTPARAM name="Note" datatype="text"/>

			<!-- iPayout Parameters -->
			<WTPARAM name="act" datatype="text"/>
			<WTPARAM name="status_id" datatype="text"/>
			<WTPARAM name="status_desc" datatype="text"/>
			<WTPARAM name="trnx_id" datatype="text"/>
			<WTPARAM name="log_id" datatype="text"/>

			<!-- iPayout Notifications -->
			<WTCODEGROUP>
				<WTCONDITION expr="PARAM(act)" oper="not-equal" value="CONST(&quot;&quot;)"/>
				<WTCODEGROUP>
					<WTCONDITION expr="CONST(lcase(reqact))" oper="equal" value="CONST(&quot;paymenttomerchant&quot;)"/>
					<WTSETATTRIBUTE name="PARAM(Ref)" value="PARAM(trnx_id)"/>
					<WTSETATTRIBUTE name="PARAM(Note)" value="PARAM(status_desc)"/>
					<WTSETATTRIBUTE name="PARAM(Stat)" value="SYSCON(PAYSTATUS-APPROVED)">
						<WTCONDITION expr="CONST(lcase(reqstatus_id))" oper="equal" value="CONST(&quot;settled&quot;)"/>
					</WTSETATTRIBUTE>
					<WTSETATTRIBUTE name="PARAM(Stat)" value="SYSCON(PAYSTATUS-CANCELLED)">
						<WTCONDITION expr="CONST(lcase(reqstatus_id))" oper="equal" value="CONST(&quot;voided&quot;)"/>
					</WTSETATTRIBUTE>
				</WTCODEGROUP>
				<WTCUSTOM>Response.Write "OK"</WTCUSTOM>
			</WTCODEGROUP>
			
			<WTACTION id="0" name="New" type="New">
				<WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
					<WTCONDITION expr="PARAM(Stat)" oper="not-equal" value="CONST(0)"/>
					<WTMETHOD name="Custom">
						<WTPARAM name="PaymentID" direction="input" value="CONST(0)"/>
						<WTPARAM name="Reference" direction="input" value="PARAM(Ref)"/>
						<WTPARAM name="Status" direction="input" value="PARAM(Stat)"/>
						<WTPARAM name="Notes" direction="input" value="PARAM(Note)"/>
						<WTPARAM name="Result" direction="return" datatype="number"/>
					</WTMETHOD>
				</WTOBJECT>
			</WTACTION>
			<!--*******************************************************************************************-->

		</WTWEBPAGE>

    <!--==================================================================================================================-->
    <WTWEBPAGE name="1081" caption="My Orders" action="5" header="false" footer="false" navbar="false" wrapper="wrapper1000"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" langfile="1081">
      <!--==================================================================================================================-->
      <WTPARAM name="SearchText" datatype="text"/>
      <WTPARAM name="FindTypeID" datatype="number"/>
      <WTPARAM name="Bookmark" datatype="text"/>
      <WTPARAM name="Direction" datatype="number"/>
      <WTPARAM name="CompanyID" datatype="number"/>
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="Status" datatype="number"/>
      <WTPARAM name="PayType" datatype="number"/>
      <WTPARAM name="Title" datatype="text"/>

      <!-- *********************************** -->
      <!-- Total ... Total Bill                -->
      <!-- Amount ... Commissionable Amount    -->
      <!-- Credit ... Merchant Money           -->
      <!-- Retail ... Cash Back Reward         -->
      <!-- Commission ... Marketing Fee        -->
      <!-- *********************************** -->

      <WTINCLUDE name="2FA.asp"/>
      <WTCODEGROUP><WTCALLSUB name="Check2FAMerchant reqCompanyID"/></WTCODEGROUP>

      <WTSETATTRIBUTE name="PARAM(FindTypeID)" value="FINDID(PayDate)">
        <WTCONDITION expr="PARAM(FindTypeID)" oper="equal" value="CONST(0)"/>
      </WTSETATTRIBUTE>

      <WTACTION id="0" name="New" type="New">
        <WTSETATTRIBUTE name="PARAM(Status)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
        <WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
          <WTSETATTRIBUTE name="CONST(.FindTypeID)" value="CONST(reqFindTypeID)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlPayments" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(14)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark"/>
        <WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
          <WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MerchantID" direction="input" value="PARAM(CompanyID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(Title)" value="CONST(CleanXML(.MerchantName))"/>
        </WTOBJECT>
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(Title)" value="CONST(CleanXML(.NameFirst + &quot; &quot; + .NameLast))"/>
        </WTOBJECT>
      </WTACTION>

      <WTACTION id="5" name="Find" type="New">
        <WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
      </WTACTION>

      <WTACTION id="6" name="Previous" type="New">
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(2)"/>
      </WTACTION>

      <WTACTION id="7" name="Next" type="New">
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
      </WTACTION>

      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(PayType)" oper="not-equal" value="CONST(0)"/>
        <!-- Get Cash Orders - PayType = 7 -->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(1)"/>
          <WTSETATTRIBUTE name="CONST(PayTypeFrom)" value="CONST(7)"/>
          <WTSETATTRIBUTE name="CONST(PayTypeTo)" value="CONST(7)"/>
        </WTCODEGROUP>
        <!-- Get Crypto Orders - PayType = 22 - 31 -->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(2)"/>
          <WTSETATTRIBUTE name="CONST(PayTypeFrom)" value="CONST(22)"/>
          <WTSETATTRIBUTE name="CONST(PayTypeTo)" value="CONST(31)"/>
        </WTCODEGROUP>
        <!-- Get Redeemed Orders - PayType = 91 -->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(3)"/>
          <WTSETATTRIBUTE name="CONST(PayTypeFrom)" value="CONST(91)"/>
          <WTSETATTRIBUTE name="CONST(PayTypeTo)" value="CONST(91)"/>
        </WTCODEGROUP>
      </WTCODEGROUP>

      <WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(Status)" oper="equal" value="CONST(0)"/>
            <WTMETHOD name="FindOwner">
              <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="OwnerType" direction="input" value="ENTITY(Consumer)"/>
              <WTPARAM name="OwnerID" direction="input" value="PARAM(ConsumerID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTMETHOD name="FindOwnerType">
              <WTCONDITION expr="PARAM(PayType)" oper="not-equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="OwnerType" direction="input" value="ENTITY(Consumer)"/>
              <WTPARAM name="OwnerID" direction="input" value="PARAM(ConsumerID)"/>
              <WTPARAM name="PayType" direction="input" value="CONST(PayTypeFrom)"/>
              <WTPARAM name="Token" direction="input" value="CONST(PayTypeTo)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(Status)" oper="not-equal" value="CONST(0)"/>
            <WTMETHOD name="FindOwnerStatus">
              <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="OwnerType" direction="input" value="ENTITY(Consumer)"/>
              <WTPARAM name="OwnerID" direction="input" value="PARAM(ConsumerID)"/>
              <WTPARAM name="Status" direction="input" value="PARAM(Status)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTMETHOD name="FindOwnerStatusType">
              <WTCONDITION expr="PARAM(PayType)" oper="not-equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="OwnerType" direction="input" value="ENTITY(Consumer)"/>
              <WTPARAM name="OwnerID" direction="input" value="PARAM(ConsumerID)"/>
              <WTPARAM name="Status" direction="input" value="PARAM(Status)"/>
              <WTPARAM name="PayType" direction="input" value="CONST(PayTypeFrom)"/>
              <WTPARAM name="Token" direction="input" value="CONST(PayTypeTo)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="CONST(tmpCompanyID)" value="CONST(reqCompanyID * -1)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(Status)" oper="equal" value="CONST(0)"/>
            <WTMETHOD name="Find">
              <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="CompanyID" direction="input" value="CONST(tmpCompanyID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTMETHOD name="FindType">
              <WTCONDITION expr="PARAM(PayType)" oper="not-equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="CompanyID" direction="input" value="CONST(tmpCompanyID)"/>
              <WTPARAM name="PayType" direction="input" value="CONST(PayTypeFrom)"/>
              <WTPARAM name="Token" direction="input" value="CONST(PayTypeTo)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(Status)" oper="not-equal" value="CONST(0)"/>
            <WTMETHOD name="FindStatus">
              <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="CompanyID" direction="input" value="CONST(tmpCompanyID)"/>
              <WTPARAM name="Status" direction="input" value="PARAM(Status)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTMETHOD name="FindStatusType">
              <WTCONDITION expr="PARAM(PayType)" oper="not-equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="CompanyID" direction="input" value="CONST(tmpCompanyID)"/>
              <WTPARAM name="Status" direction="input" value="PARAM(Status)"/>
              <WTPARAM name="PayType" direction="input" value="CONST(PayTypeFrom)"/>
              <WTPARAM name="Token" direction="input" value="CONST(PayTypeTo)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTMETHOD name="XML">
          <WTPARAM name="xmlPayments" direction="return" datatype="text"/>
          <WTPARAM name="Option" direction="input" value="CONST(15)"/>
        </WTMETHOD>
      </WTOBJECT>
      <WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark">
        <WTSETATTRIBUTE name="ATTR(LastBookmark)" value="PARAM(Bookmark)"/>
        <WTMETHOD name="XML">
          <WTPARAM name="xmlBookmark" direction="return" datatype="text"/>
        </WTMETHOD>
      </WTOBJECT>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="1000" align="left"/>

        <WTFUNCTION name="NewOrder()">
          var mid = document.getElementById('CompanyID').value
          var url = "15212.asp?merchantid=" + mid
          var win = window.location = url + "&amp;returnurl=1081.asp?companyid=" + mid
        </WTFUNCTION>
        <WTFUNCTION name="ApproveOrders()">
          var mid = document.getElementById('CompanyID').value
          url = "1085.asp?merchantid=" + mid
          win = window.open(url)
        </WTFUNCTION>

        <WTROW>
          <WTHIDDEN name="CompanyID" value="PARAM(CompanyID)"/>
          <WTHIDDEN name="Title" value="PARAM(Title)"/>
        </WTROW>
        
        <WTROW margin-bottom="12">
          <WTSTATIC col="1" tag="Orders" value="PARAM(Title)" class="PageHeading"/>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTBUTTON col="1" value="CONST(NewOrder)" align="center">
            <WTCLICK>NewOrder()</WTCLICK>
          </WTBUTTON>
          <WTSTATIC col="1" space="2"/>
          <WTSTATIC col="1" tag="SearchBy" class="ColumnHeader" align="center"/>
          <WTCOMBO col="1" value="ATTR(Payments.FindTypeID)" translate="true" prespace="false"/>
          <WTSTATIC col="1" tag="SearchFor" class="ColumnHeader"/>
          <WTTEXT col="1" value="ATTR(Bookmark.SearchText)" size="20" focus="true" prespace="false"/>
          <WTCOMBO col="1" value="PARAM(Status)">
            <WTOPTION id="0" label="All"/>
            <WTOPTION id="1" label="Submitted"/>
            <WTOPTION id="2" label="Pending"/>
            <WTOPTION id="3" label="Approved"/>
            <WTOPTION id="4" label="Declined"/>
            <WTOPTION id="5" label="Returned"/>
            <WTOPTION id="6" label="Cancelled"/>
          </WTCOMBO>
          <WTCOMBO col="1" value="PARAM(PayType)">
            <WTOPTION id="0" label="All"/>
            <WTOPTION id="1" label="Cash"/>
            <WTOPTION id="2" label="Crypto"/>
            <WTOPTION id="3" label="Redeem"/>
          </WTCOMBO>
          <WTBUTTON col="1" action="5" value="CONST(View)" default="true"/>
          <WTBUTTON col="1" value="CONST(ApproveOrders)">
            <WTCLICK>ApproveOrders()</WTCLICK>
          </WTBUTTON>
          <WTBUTTON col="1" value="CONST(Close)">
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>

        <WTSTATIC label="No"/>
        <WTSTATIC label="Yes"/>
        <WTSTATIC label="None"/>
        <WTSTATIC label="Reclaimed"/>
        <WTSTATIC label="Description"/>

        <WTROW>
          <WTRECORDSET col="1" graybar="true" prevnext="top" entity="Payment">
            <WTCOLUMN width="11" align="left" valign="top" label="PayDate" />
            <WTCOLUMN width="8" align="left" valign="top" label="Total" />
            <WTCOLUMN width="8" align="left" valign="top" label="Amount" />
            <WTCOLUMN width="8" align="left" valign="top" label="Credit" />
            <WTCOLUMN width="8" align="left" valign="top" label="Retail" />
            <WTCOLUMN width="8" align="left" valign="top" label="Commission" />
            <WTCOLUMN width="10" align="left" valign="top" label="Status" />
            <WTCOLUMN width="11" align="left" valign="top" label="PayType" />
            <WTCOLUMN width="28" align="left" valign="top" label="Reference" />
            <WTROW height="24">
              <WTSTATIC col="1">
                <WTSTATIC value="DATA(Payment.PayDate)" space="1"/>
                <WTCODEGROUP>
                  <WTCONDITION expr="IsEmployee"/>
                  <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
                  <WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
                  <WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="CONST(0)" connector="or"/>
                  <WTIMAGE value="CONST(Edit.gif)" imgalign="absmiddle">
                    <WTLINK name="1083">
                      <WTPARAM name="PaymentID" value="DATA(Payment.PaymentID)"/>
                    </WTLINK>
                  </WTIMAGE>
                </WTCODEGROUP>
              </WTSTATIC>
              <WTSTATIC col="2" value="DATA(Payment.Total)"/>
              <WTSTATIC col="3" value="DATA(Payment.Amount)"/>
              <WTSTATIC col="4" value="DATA(Payment.Credit)"/>
              <WTSTATIC col="5" value="DATA(Payment.Retail)"/>
              <WTSTATIC col="6" value="DATA(Payment.Commission)"/>
              <WTSTATIC col="7">
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="green">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(2)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="blue">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(2)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(3)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="red">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="greater" value="CONST(3)"/>
                  <WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(7)" connector="and"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="orange">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(7)"/>
                </WTSTATIC>
              </WTSTATIC>
              <WTSTATIC col="8" value="DATA(Payment.PayType)"/>
              <WTSTATIC col="9" value="DATA(Payment.Reference)"/>
            </WTROW>
            <WTROW>
              <WTSTATIC col="1">
                <WTCODEGROUP>
                  <WTSTATIC value="DATA(PaymentID)" fontcolor="gray" space="1"/>
                  <WTSTATIC value="DATA(CommStatus)" fontcolor="gray"/>
                </WTCODEGROUP>
              </WTSTATIC>
              <WTSTATIC col="2" merge="5" fontcolor="gray">
                <WTSTATIC value="DATA(Payment.Purpose)"/>
              </WTSTATIC>
              <WTSTATIC col="6" merge="3" fontcolor="gray">
                <WTSTATIC value="DATA(Payment.Description)"/>
              </WTSTATIC>
            </WTROW>
          </WTRECORDSET>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================================-->
    <WTWEBPAGE name="m_1081" caption="Find" page-left="5" page-top="0" navbar="false" header="false" footer="false"
      page-image="bg.jpg" page-width="100%" margin-width="0" navbar-width="0" content-width="100%" viewport="width=device-width"
      aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" focus="false" langfile="m_1081" mobile="m_1081.asp" 
      track="0">
    <!--==================================================================================================================-->
      <WTPARAM name="SearchText" datatype="text"/>
      <WTPARAM name="FindTypeID" datatype="number"/>
      <WTPARAM name="Bookmark" datatype="text"/>
      <WTPARAM name="Direction" datatype="number"/>
      <WTPARAM name="CompanyID" datatype="number"/>
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="Status" datatype="number"/>
      <WTPARAM name="PayType" datatype="number"/>

      <!-- *********************************** -->
      <!-- Total ... Total Bill                -->
      <!-- Retail ... Cash Back Reward         -->
      <!-- Commission ... Marketing Fee        -->
      <!-- Amount ... Commissionable Amount    -->
      <!-- Credit ... Merchant Money           -->
      <!-- *********************************** -->

      <WTSETATTRIBUTE name="PARAM(FindTypeID)" value="FINDID(PayDate)">
        <WTCONDITION expr="PARAM(FindTypeID)" oper="equal" value="CONST(0)"/>
      </WTSETATTRIBUTE>

      <WTACTION id="0" name="New" type="New">
        <WTSETATTRIBUTE name="PARAM(Status)" value="CONST(0)"/>
        <WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
        <WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
          <WTSETATTRIBUTE name="CONST(.FindTypeID)" value="CONST(reqFindTypeID)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlPayments" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(14)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark"/>
      </WTACTION>

      <WTACTION id="5" name="Find" type="New">
        <WTSETATTRIBUTE name="PARAM(Bookmark)" value="CONST(&quot;&quot;)"/>
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
      </WTACTION>

      <WTACTION id="6" name="Previous" type="New">
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(2)"/>
      </WTACTION>

      <WTACTION id="7" name="Next" type="New">
        <WTSETATTRIBUTE name="PARAM(Direction)" value="CONST(1)"/>
      </WTACTION>

      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(PayType)" oper="not-equal" value="CONST(0)"/>
        <!-- Get Cash Orders - PayType = 7 -->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(1)"/>
          <WTSETATTRIBUTE name="CONST(PayTypeFrom)" value="CONST(7)"/>
          <WTSETATTRIBUTE name="CONST(PayTypeTo)" value="CONST(7)"/>
        </WTCODEGROUP>
        <!-- Get Crypto Orders - PayType = 22 - 31 -->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(2)"/>
          <WTSETATTRIBUTE name="CONST(PayTypeFrom)" value="CONST(22)"/>
          <WTSETATTRIBUTE name="CONST(PayTypeTo)" value="CONST(31)"/>
        </WTCODEGROUP>
        <!-- Get Redeemed Orders - PayType = 91 -->
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(3)"/>
          <WTSETATTRIBUTE name="CONST(PayTypeFrom)" value="CONST(91)"/>
          <WTSETATTRIBUTE name="CONST(PayTypeTo)" value="CONST(91)"/>
        </WTCODEGROUP>
      </WTCODEGROUP>

      <WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(Status)" oper="equal" value="CONST(0)"/>
            <WTMETHOD name="FindOwner">
              <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="OwnerType" direction="input" value="ENTITY(Consumer)"/>
              <WTPARAM name="OwnerID" direction="input" value="PARAM(ConsumerID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTMETHOD name="FindOwnerType">
              <WTCONDITION expr="PARAM(PayType)" oper="not-equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="OwnerType" direction="input" value="ENTITY(Consumer)"/>
              <WTPARAM name="OwnerID" direction="input" value="PARAM(ConsumerID)"/>
              <WTPARAM name="PayType" direction="input" value="CONST(PayTypeFrom)"/>
              <WTPARAM name="Token" direction="input" value="CONST(PayTypeTo)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(Status)" oper="not-equal" value="CONST(0)"/>
            <WTMETHOD name="FindOwnerStatus">
              <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="OwnerType" direction="input" value="ENTITY(Consumer)"/>
              <WTPARAM name="OwnerID" direction="input" value="PARAM(ConsumerID)"/>
              <WTPARAM name="Status" direction="input" value="PARAM(Status)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTMETHOD name="FindOwnerStatusType">
              <WTCONDITION expr="PARAM(PayType)" oper="not-equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="OwnerType" direction="input" value="ENTITY(Consumer)"/>
              <WTPARAM name="OwnerID" direction="input" value="PARAM(ConsumerID)"/>
              <WTPARAM name="Status" direction="input" value="PARAM(Status)"/>
              <WTPARAM name="PayType" direction="input" value="CONST(PayTypeFrom)"/>
              <WTPARAM name="Token" direction="input" value="CONST(PayTypeTo)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="CONST(tmpCompanyID)" value="CONST(reqCompanyID * -1)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(Status)" oper="equal" value="CONST(0)"/>
            <WTMETHOD name="Find">
              <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="CompanyID" direction="input" value="CONST(tmpCompanyID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTMETHOD name="FindType">
              <WTCONDITION expr="PARAM(PayType)" oper="not-equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="CompanyID" direction="input" value="CONST(tmpCompanyID)"/>
              <WTPARAM name="PayType" direction="input" value="CONST(PayTypeFrom)"/>
              <WTPARAM name="Token" direction="input" value="CONST(PayTypeTo)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(Status)" oper="not-equal" value="CONST(0)"/>
            <WTMETHOD name="FindStatus">
              <WTCONDITION expr="PARAM(PayType)" oper="equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="CompanyID" direction="input" value="CONST(tmpCompanyID)"/>
              <WTPARAM name="Status" direction="input" value="PARAM(Status)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTMETHOD name="FindStatusType">
              <WTCONDITION expr="PARAM(PayType)" oper="not-equal" value="CONST(0)"/>
              <WTPARAM name="reqBookmark" direction="return" datatype="text"/>
              <WTPARAM name="FindTypeID" direction="input" value="PARAM(FindTypeID)"/>
              <WTPARAM name="Bookmark" direction="input" value="PARAM(Bookmark)"/>
              <WTPARAM name="SearchText" direction="input" value="PARAM(SearchText)"/>
              <WTPARAM name="Direction" direction="input" value="PARAM(Direction)"/>
              <WTPARAM name="CompanyID" direction="input" value="CONST(tmpCompanyID)"/>
              <WTPARAM name="Status" direction="input" value="PARAM(Status)"/>
              <WTPARAM name="PayType" direction="input" value="CONST(PayTypeFrom)"/>
              <WTPARAM name="Token" direction="input" value="CONST(PayTypeTo)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTMETHOD name="XML">
          <WTPARAM name="xmlPayments" direction="return" datatype="text"/>
          <WTPARAM name="Option" direction="input" value="CONST(15)"/>
        </WTMETHOD>
      </WTOBJECT>
      <WTOBJECT name="Bookmark" project="wtSystem" class="CBookmark">
        <WTSETATTRIBUTE name="ATTR(LastBookmark)" value="PARAM(Bookmark)"/>
        <WTMETHOD name="XML">
          <WTPARAM name="xmlBookmark" direction="return" datatype="text"/>
        </WTMETHOD>
      </WTOBJECT>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="100" align="center"/>

        <WTFUNCTION name="NewOrder()">
          var url, win, mid;
          med = document.getElementById('CompanyID').value
          url = "15212.asp?merchantid=" + med
          win = window.location = url + "&amp;returnurl=1081.asp?companyid=" + med
        </WTFUNCTION>

        <WTROW>
          <WTHIDDEN name="CompanyID" value="PARAM(CompanyID)"/>
        </WTROW>

        <WTROW margin-bottom="12">
          <WTSTATIC col="1" label="Orders" class="PageHeading"/>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTBUTTON col="1" value="CONST(NewOrder)" align="center">
            <WTCLICK>NewOrder()</WTCLICK>
          </WTBUTTON>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" tag="SearchBy" class="ColumnHeader" align="left"/>
          <WTCOMBO col="1" value="ATTR(Payments.FindTypeID)" translate="true"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" tag="SearchFor" class="ColumnHeader" align="left"/>
          <WTTEXT col="1" value="ATTR(Bookmark.SearchText)" size="15" focus="true"/>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" tag="Status" class="ColumnHeader"/>
          <WTCOMBO col="1" value="PARAM(Status)">
            <WTOPTION id="0" label="All"/>
            <WTOPTION id="1" label="Submitted"/>
            <WTOPTION id="2" label="Pending"/>
            <WTOPTION id="3" label="Approved"/>
            <WTOPTION id="4" label="Declined"/>
            <WTOPTION id="5" label="Returned"/>
            <WTOPTION id="6" label="Cancelled"/>
          </WTCOMBO>
          <WTCOMBO col="1" value="PARAM(PayType)">
            <WTOPTION id="0" label="All"/>
            <WTOPTION id="1" label="Cash"/>
            <WTOPTION id="2" label="Crypto"/>
            <WTOPTION id="3" label="Redeem"/>
          </WTCOMBO>
          <WTBUTTON col="1" action="5" value="CONST(Go)" default="true"/>
        </WTROW>

        <WTSTATIC label="No"/>
        <WTSTATIC label="Yes"/>
        <WTSTATIC label="None"/>
        <WTSTATIC label="Reclaimed"/>
        <WTSTATIC label="Description"/>

        <WTROW>
          <WTRECORDSET col="1" graybar="true" prevnext="top" entity="Payment">
            <WTCOLUMN width="25" align="left" valign="top" label="PayDate" />
            <WTCOLUMN width="25" align="left" valign="top" label="Total" />
            <WTCOLUMN width="25" align="left" valign="top" label="Commission" />
            <WTCOLUMN width="25" align="left" valign="top" label="Status" />
            <WTROW height="24">
              <WTSTATIC col="1" value="DATA(Payment.PayDate)"/>
              <WTSTATIC col="2" value="DATA(Payment.Total)"/>
              <WTSTATIC col="3" value="DATA(Payment.Commission)"/>
              <WTSTATIC col="4">
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="green">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(2)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="blue">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(2)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(3)"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="red">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="greater" value="CONST(3)"/>
                  <WTCONDITION expr="DATA(Payment.Status)" oper="less" value="CONST(7)" connector="and"/>
                </WTSTATIC>
                <WTSTATIC value="DATA(Payment.Status)" fontcolor="orange">
                  <WTCONDITION expr="DATA(Payment.Status)" oper="equal" value="CONST(7)"/>
                </WTSTATIC>
              </WTSTATIC>
            </WTROW>
            
            <WTROW>
              <WTSTATIC col="1" merge="4">
                <WTSTATIC fontcolor="purple">
                  <WTSTATIC value="DATA(Payment.PayType)" space="1"/>
                  <WTSTATIC value="DATA(Payment.Description)" space="1"/>
                  <WTSTATIC value="DATA(Payment.Reference)"/>
                </WTSTATIC>
              </WTSTATIC>
            </WTROW>
            <WTROW>
              <WTSTATIC col="1" merge="4">
                  <WTSTATIC value="DATA(CommStatus)" fontcolor="gray" space="1"/>
                  <WTSTATIC value="DATA(Payment.Purpose)"/>
              </WTSTATIC>
            </WTROW>
          </WTRECORDSET>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================================-->
    <WTWEBPAGE name="1083" header="false" footer="false" navbar="false" wrapper="wrapper600"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" langfile="1083">
      <!--==================================================================================================================-->
      <WTPARAM name="PaymentID" datatype="number"/>
      <WTPARAM name="CompanyID" datatype="number"/>
      <WTPARAM name="Txn" datatype="number"/>

      <!-- *********************************** -->
      <!-- Total ... Total Bill                -->
      <!-- Amount ... Commissionable Amount    -->
      <!-- Credit ... Merchant Money           -->
      <!-- Retail ... Cash Back Reward         -->
      <!-- Commission ... Marketing Fee        -->
      <!-- *********************************** -->
        
        <CODEGROUP>
        <WTSETATTRIBUTE name="PARAM(CompanyID)" value="SYSCON(NEXXUS)">
          <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
      </CODEGROUP>

      <WTSUB name="ProcessPayment">
        <WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
          <WTMETHOD name="Custom">
            <WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
            <WTPARAM name="Status" direction="input" value="CONST(99)"/>
            <WTPARAM name="EnrollDate" direction="input" value="CONST(0)"/>
            <WTPARAM name="Quantity" direction="input" value="PARAM(PaymentID)"/>
            <WTPARAM name="Amount" direction="input" value="CONST(0)"/>
            <WTPARAM name="Count" direction="return" datatype="number"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTSUB name="LoadPayment">
        <WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
          <WTMETHOD name="Load">
            <WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(Payment.CommStatus)" value="CONST(1)">
            <WTCONDITION expr="ATTR(Payment.CommStatus)" oper="equal" value="CONST(0)"/>
          </WTSETATTRIBUTE>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlPayment" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(2)"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTSUB name="ReloadPayment">
        <WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
          <WTMETHOD name="Load">
            <WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTES/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlPayment" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(2)"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTSUB name="SavePayment">
        <WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
          <WTMETHOD name="Load">
            <WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="CONST(oldStatus)" value="ATTR(Status)"/>
          <WTSETATTRIBUTES/>
          <WTMETHOD name="Save">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCONDITION expr="CONST(oldStatus)" oper="equal" value="SYSCON(PAYSTATUS-APPROVED)" connector="and"/>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(Status)" oper="equal" value="SYSCON(PAYSTATUS-RETURNED)"/>
              <WTCONDITION expr="ATTR(Status)" oper="equal" value="SYSCON(PAYSTATUS-CANCELLED)" connector="or"/>
              <WTCALLSUB name="ProcessPayment"/>
            </WTCODEGROUP>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCONDITION expr="CONST(oldStatus)" oper="not-equal" value="SYSCON(PAYSTATUS-APPROVED)" connector="and"/>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(Status)" oper="equal" value="SYSCON(PAYSTATUS-APPROVED)"/>
              <WTCALLSUB name="ProcessPayment"/>
            </WTCODEGROUP>
          </WTCODEGROUP>
        </WTOBJECT>
        <WTCALLSUB name="ReloadPayment">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(Txn)" value="CONST(1)"/>
          <WTRETURN/>
        </WTCODEGROUP>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="LoadPayment"/>
      </WTACTION>

      <WTACTION id="1" name="Update" type="Update">
        <WTCALLSUB name="SavePayment"/>
        <WTCALLSUB name="LoadPayment"/>
      </WTACTION>

      <WTACTION id="3" name="Cancel" type="Cancel">
        <WTRETURN/>
      </WTACTION>

      <WTACTION id="4" name="Delete" type="Delete">
        <WTOBJECT name="Payment" project="ptsPaymentUser" class="CPayment">
          <WTMETHOD name="Delete">
            <WTPARAM name="PaymentID" direction="input" value="PARAM(PaymentID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTSETATTRIBUTE name="PARAM(Txn)" value="CONST(4)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
        <WTCALLSUB name="ReloadPayment">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
        </WTRETURN>
      </WTACTION>

      <WTACTION id="6" name="Reclaim" type="Update">
        <WTCALLSUB name="SavePayment"/>
        <WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
          <WTMETHOD name="Custom">
            <WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
            <WTPARAM name="Status" direction="input" value="CONST(8)"/>
            <WTPARAM name="EnrollDate" direction="input" value="CONST(0)"/>
            <WTPARAM name="Quantity" direction="input" value="PARAM(PaymentID)"/>
            <WTPARAM name="Amount" direction="input" value="CONST(0)"/>
            <WTPARAM name="Count" direction="return" datatype="number"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTCALLSUB name="LoadPayment"/>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="160" align="right"/>
        <WTCOLUMN width="440" align="left"/>

        <WTROW>
          <WTHIDDEN value="PARAM(CompanyID)"/>
          <WTHIDDEN value="PARAM(PaymentID)"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" merge="2" class="PageHeading" align="left">
            <WTSTATIC tag="PaymentID" value="ATTR(Payment.PaymentID)"/>
            <WTCODEGROUP>
              <WTSTATIC space="1"/>
              <WTSTATIC label="Updated" fontcolor="red">
                <WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(1)"/>
              </WTSTATIC>
              <WTSTATIC label="Deleted" fontcolor="red">
                <WTCONDITION expr="PARAM(Txn)" oper="equal" value="CONST(4)"/>
              </WTSTATIC>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>

        <WTROW margin-bottom="3">
          <WTSTATIC col="1" tag="PayDate"/>
          <WTTEXT col="2" value="ATTR(Payment.PayDate)"/>
          <WTSTATIC col="2" tag="PaidDate"/>
          <WTTEXT col="2" value="ATTR(Payment.PaidDate)" noprespace="true"/>
        </WTROW>
        <WTROW margin-bottom="3">
          <WTSTATIC col="1" tag="Status"/>
          <WTCOMBO col="2" value="ATTR(Payment.Status)"/>
        </WTROW>
        <WTROW margin-bottom="3">
          <WTSTATIC col="1" tag="Total"/>
          <WTTEXT col="2" value="ATTR(Payment.Total)" size="10"/>
          <WTSTATIC col="2" tag="Amount"/>
          <WTTEXT col="2" value="ATTR(Payment.Amount)" size="10" prespace="false"/>
        </WTROW>
        <WTROW margin-bottom="3">
          <WTSTATIC col="1" tag="Credit"/>
          <WTTEXT col="2" value="ATTR(Payment.Credit)" size="10"/>
          <WTSTATIC col="2" tag="Retail"/>
          <WTTEXT col="2" value="ATTR(Payment.Retail)" size="10" prespace="false"/>
          <WTSTATIC col="2" tag="Commission"/>
          <WTTEXT col="2" value="ATTR(Payment.Commission)" size="10" prespace="false"/>
        </WTROW>
        <WTROW margin-bottom="3">
          <WTSTATIC col="1" tag="Purpose"/>
          <WTTEXT col="2" value="ATTR(Payment.Purpose)"/>
        </WTROW>
        <WTROW margin-bottom="3">
          <WTCONDITION expr="IsManager"/>
          <WTSTATIC col="1" tag="PayType"/>
          <WTCOMBO col="2" value="ATTR(Payment.PayType)"/>
        </WTROW>
        <WTCODEGROUP>
          <WTCONDITION expr="NotManager"/>
          <WTROW margin-bottom="3">
            <WTSTATIC col="1" tag="PayType"/>
            <WTSTATIC col="2" value="ATTR(Payment.PayType)" bold="true"/>
          </WTROW>
          <WTROW>
            <WTCONDITION expr="NotManager"/>
            <WTHIDDEN value="ATTR(Payment.PayType)"/>
          </WTROW>
        </WTCODEGROUP>
        <WTROW margin-bottom="3">
          <WTSTATIC col="1" tag="Reference"/>
          <WTTEXT col="2" value="ATTR(Payment.Reference)" size="40"/>
        </WTROW>
        <WTROW margin-bottom="3">
          <WTSTATIC col="1" tag="CommStatus"/>
          <WTCOMBO col="2" value="ATTR(Payment.CommStatus)"/>
          <WTIMAGE col="2" value="CONST(Preview.gif)" alt="Preview" imgalign="absmiddle">
            <WTCONDITION expr="ATTR(Payment.CommStatus)" oper="equal" value="CONST(2)"/>
            <WTCONDITION expr="ATTR(Payment.CommStatus)" oper="equal" value="CONST(4)" connector="or"/>
            <WTCLICK>
              var url, win
              url = "0913.asp?refid=" + document.getElementById('PaymentID').value;
              win = window.open(url, '', "top=200,left=200,width=650,height=300,status=no");
              win.focus();
            </WTCLICK>
          </WTIMAGE>
          <WTSTATIC col="2" tag="CommDate"/>
          <WTTEXT col="2" value="ATTR(Payment.CommDate)" prespace="false"/>
        </WTROW>
        <WTROW margin-bottom="3">
          <WTCONDITION expr="IsManager"/>
          <WTSTATIC col="1" tag="OwnerType"/>
          <WTTEXT col="2" value="ATTR(Payment.OwnerType)" size="2"/>
          <WTTEXT col="2" value="ATTR(Payment.OwnerID)" size="8"/>
        </WTROW>
        <WTROW>
          <WTCONDITION expr="NotManager"/>
          <WTHIDDEN value="ATTR(Payment.OwnerType)"/>
          <WTHIDDEN value="ATTR(Payment.OwnerID)"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" tag="Description" align="left"/>
        </WTROW>
        <WTROW margin-bottom="3">
          <WTMEMO col="1" merge="2" align="left" value="ATTR(Payment.Description)" cols="72" rows="2"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" tag="Notes" align="left"/>
        </WTROW>
        <WTROW>
          <WTMEMO col="1" merge="2" align="left" value="ATTR(Payment.Notes)" cols="72" rows="6"/>
        </WTROW>

        <WTSTATIC label="ConfirmReclaim"/>

        <WTROW margin-top="12" margin-bottom="12">
          <WTBUTTON col="1" merge="2" action="1" value="CONST(Update)" align="center">
            <WTCONDITION expr="IsActive"/>
            <WTCONDITION expr="IsEmployee" connector="and"/>
            <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
            <WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
          </WTBUTTON>
          <WTBUTTON col="1" merge="2" action="3" value="CONST(Cancel)"/>
          <WTBUTTON col="1" merge="2" action="4" value="CONST(Delete)" msg="ConfirmDelete">
            <WTCONDITION expr="IsActive"/>
            <WTCONDITION expr="IsEmployee" connector="and"/>
            <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
            <WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
          </WTBUTTON>
          <WTBUTTON col="1" merge="2" action="6" value="CONST(Reclaim)" msg="ConfirmReclaim">
            <WTCONDITION expr="IsEmployee" paren="start"/>
            <WTCONDITION expr="IsOrgAdminOnly" connector="or" paren="end"/>
            <WTCONDITION expr="ATTR(Payment.CommStatus)" oper="equal" value="CONST(2)" connector="and"/>
          </WTBUTTON>
        </WTROW>
      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================================-->
    <WTWEBPAGE name="1085" caption="Approve Orders" action="5" header="false" footer="false" navbar="false" wrapper="wrapper1000"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLList.xsl" langfile="1085">
      <!--==================================================================================================================-->
      <WTPARAM name="MerchantID" datatype="number"/>

      <WTINCLUDE name="2FA.asp"/>
      <WTCODEGROUP>
        <WTCALLSUB name="Check2FAMerchant reqMerchantID"/>
      </WTCODEGROUP>

      <WTSUB name="LoadOrders">
        <WTSETATTRIBUTE name="CONST(tmpMerchantID)" value="CONST(reqMerchantID * -1)"/>
        <WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
          <WTMETHOD name="ListCustom">
            <WTPARAM name="CompanyID" direction="input" value="CONST(tmpMerchantID)"/>
            <WTPARAM name="OwnerType" direction="input" value="CONST(0)"/>
            <WTPARAM name="OwnerID" direction="input" value="CONST(0)"/>
            <WTPARAM name="Status" direction="input" value="CONST(1)"/>
            <WTPARAM name="PayType" direction="input" value="CONST(0)"/>
            <WTPARAM name="PayDate" direction="input" value="CONST(0)"/>
            <WTPARAM name="Notes" direction="input" value="CONST(&quot;&quot;)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlPayments" direction="return" datatype="text"/>
            <WTPARAM name="Option" direction="input" value="CONST(13)"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTSUB name="ProcessOrders">
        <WTSETATTRIBUTE name="CONST(tmpMerchantID)" value="CONST(reqMerchantID * -1)"/>
        <WTOBJECT name="Payments" project="ptsPaymentUser" class="CPayments">
          <WTMETHOD name="ListCustom">
            <WTPARAM name="CompanyID" direction="input" value="CONST(tmpMerchantID)"/>
            <WTPARAM name="OwnerType" direction="input" value="CONST(0)"/>
            <WTPARAM name="OwnerID" direction="input" value="CONST(0)"/>
            <WTPARAM name="Status" direction="input" value="CONST(1)"/>
            <WTPARAM name="PayType" direction="input" value="CONST(0)"/>
            <WTPARAM name="PayDate" direction="input" value="CONST(0)"/>
            <WTPARAM name="Notes" direction="input" value="CONST(&quot;&quot;)"/>
          </WTMETHOD>
          <WTCODEGROUP>
            <WTCUSTOM>
              For Each oItem in oPayments
                With oItem
                  tmpID = Request.Form.Item(.PaymentID)
                  If tmpID = "on" Then
                    .Custom .PaymentID, "", 1, ""
                  End If
                End With
              Next
            </WTCUSTOM>
          </WTCODEGROUP>
        </WTOBJECT>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="LoadOrders"/>
      </WTACTION>

      <WTACTION id="1" name="Update" type="Update">
        <WTCALLSUB name="ProcessOrders"/>
        <WTCALLSUB name="LoadOrders"/>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="1000" align="left"/>

        <WTFUNCTION name="CheckAll()">
          var inputs = document.getElementsByTagName("input");
          for(var i = 0; i &lt; inputs.length; i++) {
          if(inputs[i].type == "checkbox") {
          inputs[i].checked = true;
          }
          }
        </WTFUNCTION>
        <WTFUNCTION name="UncheckAll()">
          var inputs = document.getElementsByTagName("input");
          for(var i = 0; i &lt; inputs.length; i++) {
          if(inputs[i].type == "checkbox") {
          inputs[i].checked = false;
          }
          }
        </WTFUNCTION>

        <WTROW margin-bottom="12">
          <WTSTATIC col="1" label="ApproveOrders" class="PageHeading"/>
        </WTROW>

        <WTROW margin-bottom="12">
          <WTSTATIC col="1" space="5" align="left"/>
          <WTSTATIC col="1" space="5" align="left"/>
          <WTBUTTON col="1" value="CONST(CheckAll)" align="left">
            <WTCLICK>CheckAll();</WTCLICK>
          </WTBUTTON>
          <WTBUTTON col="1" value="CONST(UncheckAll)" align="left">
            <WTCLICK>UncheckAll();</WTCLICK>
          </WTBUTTON>
s          <WTBUTTON col="1" action="1" value="CONST(ApproveChecked)"/>
          <WTBUTTON col="1" value="CONST(Close)">
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>

        <WTROW>
          <WTRECORDSET col="1" graybar="true" entity="Payment">
            <WTCOLUMN width="10" align="left" valign="top" label="PayDate" />
            <WTCOLUMN width="10" align="left" valign="top" label="TicketNumber" />
            <WTCOLUMN width="10" align="left" valign="top" label="Total" />
            <WTCOLUMN width="10" align="left" valign="top" label="Amount" />
            <WTCOLUMN width="10" align="left" valign="top" label="Credit" />
            <WTCOLUMN width="10" align="left" valign="top" label="Retail" />
            <WTCOLUMN width="10" align="left" valign="top" label="Commission" />
            <WTCOLUMN width="10" align="left" valign="top" label="Status" />
            <WTCOLUMN width="10" align="left" valign="top" label="PayType" />
            <WTROW height="24">
              <WTSTATIC col="1" value="DATA(PayDate)"/>
              <WTSTATIC col="2">
                <WTCODEGROUP>
                  <WTCHECK name="&lt;xsl:value-of select=&quot;@paymentid&quot;/&gt;"/>
                </WTCODEGROUP>
                <WTSTATIC space="1"/>
                <WTSTATIC value="DATA(Purpose)"/>
              </WTSTATIC>
              <WTSTATIC col="3" value="DATA(Total)"/>
              <WTSTATIC col="4" value="DATA(Amount)"/>
              <WTSTATIC col="5" value="DATA(Credit)"/>
              <WTSTATIC col="6" value="DATA(Retail)"/>
              <WTSTATIC col="7" value="DATA(Commission)"/>
              <WTSTATIC col="8" value="DATA(Status)"/>
              <WTSTATIC col="9" value="DATA(PayType)"/>
            </WTROW>
            <WTROW>
              <WTSTATIC col="1" value="DATA(PaymentID)" fontcolor="gray"/>
              <WTSTATIC col="2" merge="2" value="DATA(Notes)" fontcolor="gray"/>
              <WTSTATIC col="4" merge="6" value="DATA(Description)" fontcolor="gray"/>
            </WTROW>
          </WTRECORDSET>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

  </WTWEBPAGES>

</WTROOT>