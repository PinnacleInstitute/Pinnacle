<WTROOT prefix="pts" dbo="dbo" system="Pinnacle">
  <WTENTITY id="01" name="AuthUser" alias="au" VB="false" log="true" audit="true">

    <!--Identity-->
    <WTATTRIBUTE id="0101" name="AuthUserID" type="number" identity="true" min="1" required="true" source="entity">
      <WTIDENTITY seed="100" increment="1"/>
    </WTATTRIBUTE>

    <!--Foreign Keys-->
    <WTATTRIBUTE id="0102" name="TrainerID" type="number" min="1" required="true" source="join">
      <WTJOIN entity="Trainer" name="TrainerID"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="0103" name="EmployeeID" type="number" min="1" required="true" source="join">
      <WTJOIN entity="Employee" name="EmployeeID"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="0104" name="MemberID" type="number" min="1" required="true" source="join">
      <WTJOIN entity="Member" name="MemberID"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="0105" name="OrgID" type="number" min="1" required="true" source="join">
      <WTJOIN entity="Org" name="OrgID"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="0106" name="AffiliateID" type="number" min="1" required="true" source="join">
      <WTJOIN entity="Affiliate" name="AffiliateID"/>
    </WTATTRIBUTE>

    <!--Attributes-->
    <WTATTRIBUTE id="0110" name="Logon" type="text" length="80" min="3" max="80" required="true" source="entity"/>
    <WTATTRIBUTE id="0111" name="NewLogon" type="text" length="80" min="3" max="80" required="true" source="entity" persist="false"/>
    <WTATTRIBUTE id="0112" name="ConfirmLogon" type="text" length="80" min="3" max="80" required="true" source="entity" persist="false"/>
    <WTATTRIBUTE id="0113" name="Password" type="password" length="30" min="3" max="30" required="true" source="entity"/>
    <WTATTRIBUTE id="0114" name="NewPassword" type="password" length="30" min="3" max="30" required="true" source="entity" persist="false"/>
    <WTATTRIBUTE id="0115" name="ConfirmPassword" type="password" length="30" min="3" max="30" required="true" source="entity" persist="false"/>
    <WTATTRIBUTE id="0116" name="Email" type="text" length="80" min="1" max="80" required="true" source="entity"/>
    <WTATTRIBUTE id="0117" name="NameLast" type="text" length="30" min="1" max="30" required="true" source="entity"/>
    <WTATTRIBUTE id="0118" name="NameFirst" type="text" length="30" min="1" max="30" required="true" source="entity"/>
    <WTATTRIBUTE id="0119" name="AuthUserName" type="text" length="62" min="1" max="62" title="true" source="entity">
      <WTCOMPUTE name="NameFirst" required="true"/>
      <WTCOMPUTE text=" "/>
      <WTCOMPUTE name="NameLast" required="true"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="0120" name="UserType" type="number" required="true" source="entity">
      <WTENUM id="1" name="SysAdmin"/>
      <WTENUM id="2" name="Employee"/>
      <WTENUM id="3" name="Trainer"/>
      <WTENUM id="4" name="Member"/>
      <WTENUM id="5" name="Org"/>
      <WTENUM id="6" name="Affiliate"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="0121" name="UserGroup" type="number" required="true" source="entity">
      <WTENUM id="1" name="SysAdmin"/>
      <WTENUM id="21" name="Manager"/>
      <WTENUM id="22" name="Administrator"/>
      <WTENUM id="23" name="Employee"/>
      <WTENUM id="31" name="Trainer"/>
      <WTENUM id="41" name="Member"/>
      <WTENUM id="51" name="Org"/>
      <WTENUM id="61" name="Affiliate"/>
    </WTATTRIBUTE>
    <WTATTRIBUTE id="0122" name="UserStatus" type="number" required="true" source="entity">
      <WTENUM id="1" name="Active" />
      <WTENUM id="2" name="InActive" />
      <WTENUM id="3" name="ReadOnly" />
    </WTATTRIBUTE>
    <WTATTRIBUTE id="0123" name="UserKey" type="text" length="40" min="1" max="40" source="entity" language="false"/>
    <WTATTRIBUTE id="0124" name="UserCode" type="text" length="10" min="1" max="10" source="entity" language="false"/>

    <WTINDEX name="Logon" unique="true">
      <WTATTRIBUTE name="Logon"/>
    </WTINDEX>

    <WTINDEX name="Email">
      <WTATTRIBUTE name="Email"/>
    </WTINDEX>

    <WTINDEX name="NameFirst">
      <WTATTRIBUTE name="NameLast"/>
      <WTATTRIBUTE name="NameFirst"/>
    </WTINDEX>

    <!--Relationships-->
    <WTRELATIONSHIPS>
      <WTRELATIONSHIP name="AuthUser" entity="AuthUser" alias="au"/>
      <WTRELATIONSHIP name="Common" entity="AuthUser" alias="au">
        <WTENTITY name="Trainer" entity="Trainer" alias="tr">
          <WTATTRIBUTE alias="au" name="AuthUserID" relalias="tr" relname="AuthUserID"/>
        </WTENTITY>
        <WTENTITY name="Employee" entity="Employee" alias="em">
          <WTATTRIBUTE alias="au" name="AuthUserID" relalias="em" relname="AuthUserID"/>
        </WTENTITY>
        <WTENTITY name="Member" entity="Member" alias="me">
          <WTATTRIBUTE alias="au" name="AuthUserID" relalias="me" relname="AuthUserID"/>
        </WTENTITY>
        <WTENTITY name="Org" entity="Org" alias="org">
          <WTATTRIBUTE alias="au" name="AuthUserID" relalias="org" relname="AuthUserID"/>
        </WTENTITY>
        <WTENTITY name="Affiliate" entity="Affiliate" alias="af">
          <WTATTRIBUTE alias="au" name="AuthUserID" relalias="af" relname="AuthUserID"/>
        </WTENTITY>
      </WTRELATIONSHIP>
      <WTRELATIONSHIP name="Trainer" entity="AuthUser" alias="au">
        <WTENTITY name="Trainer" entity="Trainer" alias="tr">
          <WTATTRIBUTE alias="au" name="AuthUserID" relalias="tr" relname="AuthUserID"/>
        </WTENTITY>
      </WTRELATIONSHIP>
      <WTRELATIONSHIP name="Employee" entity="AuthUser" alias="au">
        <WTENTITY name="Employee" entity="Employee" alias="em">
          <WTATTRIBUTE alias="au" name="AuthUserID" relalias="em" relname="AuthUserID"/>
        </WTENTITY>
      </WTRELATIONSHIP>
      <WTRELATIONSHIP name="Member" entity="AuthUser" alias="au">
        <WTENTITY name="Member" entity="Member" alias="me">
          <WTATTRIBUTE alias="au" name="AuthUserID" relalias="me" relname="AuthUserID"/>
        </WTENTITY>
      </WTRELATIONSHIP>
      <WTRELATIONSHIP name="Org" entity="AuthUser" alias="au">
        <WTENTITY name="Org" entity="Org" alias="org">
          <WTATTRIBUTE alias="au" name="AuthUserID" relalias="org" relname="AuthUserID"/>
        </WTENTITY>
      </WTRELATIONSHIP>
      <WTRELATIONSHIP name="Affiliate" entity="AuthUser" alias="au">
        <WTENTITY name="Affiliate" entity="Affiliate" alias="af">
          <WTATTRIBUTE alias="au" name="AuthUserID" relalias="af" relname="AuthUserID"/>
        </WTENTITY>
      </WTRELATIONSHIP>
    </WTRELATIONSHIPS>

    <!-- System Constants -->
    <WTSYSCONS>
      <WTSYSCON name="ACCESS-GRANTED" value="1"/>
      <WTSYSCON name="ACCESS-DENIED" value="0"/>
      <WTSYSCON name="USERSTATUS-INACTIVE" value="2"/>
    </WTSYSCONS>

  </WTENTITY>

  <WTPROCEDURES>
    <!--==================================================================================================-->
    <WTPROCEDURE name="Add" type="Add" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(Logon)" direction="input"/>
      <WTPARAM name="ATTR(Password)" direction="input"/>
      <WTPARAM name="ATTR(Email)" direction="input"/>
      <WTPARAM name="ATTR(NameLast)" direction="input"/>
      <WTPARAM name="ATTR(NameFirst)" direction="input"/>
      <WTPARAM name="ATTR(UserGroup)" direction="input"/>
      <WTPARAM name="ATTR(UserStatus)" direction="input"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTPARAM name="ATTR(AuthUserID)" direction="output"/>
      <WTDECLARE name="Now" datatype="date"/>
      <WTDECLARE name="NewID" datatype="number"/>
      <WTDECLARE name="Logon" datatype="text" length="80"/>
      <WTDECLARE name="Password" datatype="text" length="30"/>
      <WTSETVALUE name="Now" value="SYS(timestamp)"/>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(UserGroup)" oper="greater" value="CONST(0)"/>
        <WTPROCEDURE name="System_GetLogon">
          <WTPARAM name="Logon" direction="output" value="Logon"/>
          <WTPARAM name="Default" direction="input" value="PARAM(Logon)"/>
        </WTPROCEDURE>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Password)" oper="equal" value="CONST('')"/>
          <WTPROCEDURE name="System_GetPassword">
            <WTPARAM name="Password" direction="output" value="Password"/>
          </WTPROCEDURE>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Password)" oper="not-equal" value="CONST('')"/>
          <WTSETVALUE name="Password" value="PARAM(Password)"/>
        </WTCODEGROUP>
        <WTINSERT>
          <WTATTRIBUTE name="ATTR(AuthUser.Logon)" value="Logon"/>
          <WTATTRIBUTE name="ATTR(AuthUser.Password)" value="Password"/>
          <WTATTRIBUTE name="ATTR(AuthUser.Email)" value="PARAM(Email)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.NameLast)" value="PARAM(NameLast)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.NameFirst)" value="PARAM(NameFirst)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.UserGroup)" value="PARAM(UserGroup)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.UserStatus)" value="PARAM(UserStatus)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.CreateDate)" value="Now"/>
          <WTATTRIBUTE name="ATTR(AuthUser.CreateID)" value="SYS(userid)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeDate)" value="Now"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeID)" value="SYS(userid)"/>
        </WTINSERT>
        <WTSETVALUE name="NewID" value="SYS(identity)"/>
      </WTCODEGROUP>
      <WTSETVALUE name="PARAM(AuthUserID)" value="NewID" null="0"/>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="ChangeLogon" type="Update" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
      <WTPARAM name="ATTR(Logon)" direction="inputoutput"/>
      <WTPARAM name="ATTR(NewLogon)" direction="inputoutput"/>
      <WTPARAM name="ATTR(ConfirmLogon)" direction="inputoutput"/>
      <WTPARAM name="SYS(userid)" direction="input"/>

      <WTDECLARE name="Now" datatype="date"/>
      <WTDECLARE name="Email" datatype="text" length="80"/>
      <WTDECLARE name="IsValid" datatype="yesno"/>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(NewLogon)" oper="not-equal" value="PARAM(ConfirmLogon)"/>
        <WTERROR number="-2147220506" message="Oops, New Logon and Confirm Logon do not match. Please re-enter the Confirm Logon to continue."/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTSETVALUE name="Now" value="SYS(timestamp)"/>
        <WTPROCEDURE name="AuthUser_CheckLogon">
          <WTPARAM name="AuthUserID" direction="input" value="PARAM(AuthUserID)"/>
          <WTPARAM name="Logon" direction="input" value="PARAM(Logon)"/>
          <WTPARAM name="IsValid" direction="output" datatype="yesno"/>
        </WTPROCEDURE>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="IsValid" oper="equal" value="true"/>
        <WTUPDATE>
          <WTATTRIBUTE name="ATTR(AuthUser.Logon)" value="PARAM(NewLogon)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeDate)" value="Now"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeID)" value="PARAM(UserID)"/>
          <WTJOIN name="AuthUser" lock="true"/>
          <WTCONDITION expr="ATTR(AuthUser.AuthUserID)" oper="equal" value="PARAM(AuthUserID)"/>
        </WTUPDATE>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="IsValid" oper="not-equal" value="true"/>
        <WTERROR number="-2147220507" message="Oops, Change logon failed. The old logon is not correct."/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTSETVALUE name="PARAM(Logon)" value="PARAM(NewLogon)"/>
        <WTSETVALUE name="PARAM(NewLogon)" value="CONST('')"/>
        <WTSETVALUE name="PARAM(ConfirmLogon)" value="CONST('')"/>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="ChangePassword" type="Update" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
      <WTPARAM name="ATTR(Password)" direction="inputoutput"/>
      <WTPARAM name="ATTR(NewPassword)" direction="inputoutput"/>
      <WTPARAM name="ATTR(ConfirmPassword)" direction="inputoutput"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTDECLARE name="Now" datatype="date"/>
      <WTDECLARE name="Email" datatype="text" length="80"/>
      <WTDECLARE name="IsValid" datatype="yesno"/>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(ConfirmPassword)" oper="not-equal" value="PARAM(NewPassword)"/>
        <WTERROR number="-2147220508" message="Oops, New Password and Confirm Password do not match. Please re-enter the Confirm Password to continue."/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(Password)" oper="equal" value="PARAM(NewPassword)"/>
        <WTERROR number="-2147220509" message="Oops, New Password and Password match. Please re-enter a New Password to continue."/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTSETVALUE name="Now" value="SYS(timestamp)"/>
        <WTPROCEDURE name="AuthUser_CheckPassword">
          <WTPARAM name="AuthUserID" direction="input" value="PARAM(AuthUserID)"/>
          <WTPARAM name="Password" direction="input" value="PARAM(Password)"/>
          <WTPARAM name="IsValid" direction="output" datatype="yesno"/>
        </WTPROCEDURE>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="IsValid" oper="equal" value="true"/>
        <WTUPDATE>
          <WTATTRIBUTE name="ATTR(AuthUser.Password)" value="PARAM(NewPassword)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeDate)" value="Now"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeID)" value="PARAM(UserID)"/>
          <WTJOIN name="AuthUser" lock="true"/>
          <WTCONDITION expr="ATTR(AuthUserID)" oper="equal" value="PARAM(AuthUserID)"/>
        </WTUPDATE>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="IsValid" oper="not-equal" value="true"/>
        <WTERROR number="-2147220510" message="Oops, Change password failed. The old password is not correct."/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTSETVALUE name="PARAM(Password)" value="CONST('')"/>
        <WTSETVALUE name="PARAM(NewPassword)" value="CONST('')"/>
        <WTSETVALUE name="PARAM(ConfirmPassword)" value="CONST('')"/>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="IsLogon" type="Fetch" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(Logon)" direction="input"/>
      <WTPARAM name="IsAvailable" direction="output" datatype="yesno"/>

      <WTDECLARE name="AuthUserID" datatype="number"/>
      <WTDECLARE name="IsAvailable" datatype="yesno"/>
      <WTCODEGROUP>
        <WTSELECT>
          <WTATTRIBUTE name="AuthUserID" value="ATTR(AuthUser.AuthUserID)" null="0"/>
          <WTJOIN name="AuthUser" lock="false"/>
          <WTCONDITION expr="ATTR(AuthUser.Logon)" oper="equal" value="PARAM(Logon)"/>
        </WTSELECT>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="AuthUserID" value="CONST( IS NULL)"/>
        <WTSETVALUE name="PARAM(IsAvailable)" value="CONST(1)"/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="AuthUserID" oper="not-equal" value="CONST(0)"/>
        <WTSETVALUE name="PARAM(IsAvailable)" value="CONST(0)"/>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="CheckLogon" type="Fetch" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
      <WTPARAM name="ATTR(Logon)" direction="input"/>
      <WTPARAM name="IsValid" direction="output" datatype="yesno"/>

      <WTDECLARE name="AuthUserID" datatype="number"/>
      <WTDECLARE name="IsValid" datatype="yesno"/>
      <WTCODEGROUP>
        <WTSELECT>
          <WTATTRIBUTE name="AuthUserID" value="ATTR(AuthUser.AuthUserID)" null="0"/>
          <WTJOIN name="AuthUser" lock="false"/>
          <WTCONDITION expr="ATTR(AuthUser.Logon)" oper="equal" value="PARAM(Logon)"/>
        </WTSELECT>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="AuthUserID" oper="equal" value="PARAM(AuthUserID)"/>
        <WTSETVALUE name="PARAM(IsValid)" value="CONST(1)"/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="AuthUserID" oper="not-equal" value="PARAM(AuthUserID)"/>
        <WTSETVALUE name="PARAM(IsValid)" value="CONST(0)"/>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="CheckPassword" type="Fetch" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
      <WTPARAM name="ATTR(Password)" direction="input"/>
      <WTPARAM name="IsValid" direction="output" datatype="yesno"/>

      <WTDECLARE name="Password" datatype="text" length="30"/>
      <WTDECLARE name="IsValid" datatype="yesno"/>
      <WTCODEGROUP>
        <WTSELECT>
          <WTATTRIBUTE name="Password" value="ATTR(AuthUser.Password)" null="''"/>
          <WTJOIN name="AuthUser" lock="false"/>
          <WTCONDITION expr="ATTR(AuthUser.AuthUserID)" oper="equal" value="PARAM(AuthUserID)"/>
        </WTSELECT>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="Password" oper="equal" value="PARAM(Password)"/>
        <WTSETVALUE name="PARAM(IsValid)" value="CONST(1)"/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="Password" oper="not-equal" value="PARAM(Password)"/>
        <WTSETVALUE name="PARAM(IsValid)" value="CONST(0)"/>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="Delete" type="Delete" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTCODEGROUP>
        <WTDELETE>
          <WTJOIN name="AuthUser" lock="true"/>
          <WTCONDITION expr="ATTR(AuthUserID)" oper="equal" value="PARAM(AuthUserID)"/>
        </WTDELETE>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE type="Fetch" name="Fetch" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
      <WTPARAM name="ATTR(TrainerID)" direction="output"/>
      <WTPARAM name="ATTR(EmployeeID)" direction="output"/>
      <WTPARAM name="ATTR(MemberID)" direction="output"/>
      <WTPARAM name="ATTR(OrgID)" direction="output"/>
      <WTPARAM name="ATTR(AffiliateID)" direction="output"/>
      <WTPARAM name="ATTR(Logon)" direction="output"/>
      <WTPARAM name="ATTR(Password)" direction="output"/>
      <WTPARAM name="ATTR(Email)" direction="output"/>
      <WTPARAM name="ATTR(NameLast)" direction="output"/>
      <WTPARAM name="ATTR(NameFirst)" direction="output"/>
      <WTPARAM name="ATTR(AuthUserName)" direction="output"/>
      <WTPARAM name="ATTR(UserType)" direction="output"/>
      <WTPARAM name="ATTR(UserGroup)" direction="output"/>
      <WTPARAM name="ATTR(UserStatus)" direction="output"/>
      <WTPARAM name="ATTR(UserKey)" direction="output"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTDECLARE name="TrainerID" datatype="number"/>
      <WTDECLARE name="EmployeeID" datatype="number"/>
      <WTDECLARE name="MemberID" datatype="number"/>
      <WTDECLARE name="OrgID" datatype="number"/>
      <WTDECLARE name="AffiliateID" datatype="number"/>
      <WTCODEGROUP>
        <WTSELECT>
          <WTATTRIBUTE name="TrainerID" value="ATTR(Trainer.TrainerID)"/>
          <WTATTRIBUTE name="EmployeeID" value="ATTR(Employee.EmployeeID)"/>
          <WTATTRIBUTE name="MemberID" value="ATTR(Member.MemberID)"/>
          <WTATTRIBUTE name="OrgID" value="ATTR(Org.OrgID)"/>
          <WTATTRIBUTE name="AffiliateID" value="ATTR(Affiliate.AffiliateID)"/>
          <WTATTRIBUTE name="PARAM(Logon)" value="ATTR(AuthUser.Logon)"/>
          <WTATTRIBUTE name="PARAM(Password)" value="ATTR(AuthUser.Password)"/>
          <WTATTRIBUTE name="PARAM(Email)" value="ATTR(AuthUser.Email)"/>
          <WTATTRIBUTE name="PARAM(NameLast)" value="ATTR(AuthUser.NameLast)"/>
          <WTATTRIBUTE name="PARAM(NameFirst)" value="ATTR(AuthUser.NameFirst)"/>
          <WTATTRIBUTE name="PARAM(AuthUserName)" value="ATTR(AuthUser.AuthUserName)"/>
          <WTATTRIBUTE name="PARAM(UserType)" value="ATTR(AuthUser.UserType)"/>
          <WTATTRIBUTE name="PARAM(UserGroup)" value="ATTR(AuthUser.UserGroup)"/>
          <WTATTRIBUTE name="PARAM(UserStatus)" value="ATTR(AuthUser.UserStatus)"/>
          <WTATTRIBUTE name="PARAM(UserKey)" value="ATTR(AuthUser.UserKey)"/>
          <WTJOIN name="Common" lock="false"/>
          <WTCONDITION expr="ATTR(AuthUserID)" oper="equal" value="PARAM(AuthUserID)"/>
        </WTSELECT>
        <WTSETVALUE name="PARAM(TrainerID)" value="TrainerID" null="0"/>
        <WTSETVALUE name="PARAM(EmployeeID)" value="EmployeeID" null="0"/>
        <WTSETVALUE name="PARAM(MemberID)" value="MemberID" null="0"/>
        <WTSETVALUE name="PARAM(OrgID)" value="OrgID" null="0"/>
        <WTSETVALUE name="PARAM(AffiliateID)" value="AffiliateID" null="0"/>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE type="Fetch" name="EmailFetch" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(Email)" direction="input"/>
      <WTPARAM name="ATTR(AuthUserID)" direction="output"/>
      <WTPARAM name="ATTR(Logon)" direction="output"/>
      <WTPARAM name="ATTR(Password)" direction="output"/>
      <WTCODEGROUP>
        <WTSELECT>
          <WTATTRIBUTE name="PARAM(AuthUserID)" value="ATTR(AuthUser.AuthUserID)"/>
          <WTATTRIBUTE name="PARAM(Logon)" value="ATTR(AuthUser.Logon)"/>
          <WTATTRIBUTE name="PARAM(Password)" value="ATTR(AuthUser.Password)"/>
          <WTJOIN name="Common" lock="false"/>
          <WTCONDITION expr="ATTR(Email)" oper="equal" value="PARAM(Email)"/>
        </WTSELECT>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="ResetLogon" type="Update" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
      <WTPARAM name="ATTR(Email)" direction="input"/>
      <WTPARAM name="ATTR(Logon)" direction="output"/>
      <WTPARAM name="SYS(userid)" direction="input"/>

      <WTDECLARE name="Logon" datatype="text" length="80"/>
      <WTDECLARE name="Now" datatype="date"/>

      <WTCODEGROUP>
        <WTSETVALUE name="Now" value="SYS(timestamp)"/>
        <WTPROCEDURE name="System_GetLogon">
          <WTPARAM name="Logon" direction="output"/>
          <WTPARAM name="Default" direction="input" value="PARAM(Email)"/>
        </WTPROCEDURE>
        <WTUPDATE>
          <WTATTRIBUTE name="ATTR(AuthUser.Logon)" value="Logon"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeDate)" value="Now"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeID)" value="PARAM(UserID)"/>
          <WTJOIN name="AuthUser" lock="true"/>
          <WTCONDITION expr="ATTR(AuthUserID)" oper="equal" value="PARAM(AuthUserID)"/>
        </WTUPDATE>
        <WTSETVALUE name="PARAM(Logon)" value="Logon"/>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="ResetPassword" type="Update" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
      <WTPARAM name="SYS(userid)" direction="input"/>

      <WTDECLARE name="Password" datatype="text" length="30"/>
      <WTDECLARE name="IsValid" datatype="yesno"/>
      <WTDECLARE name="Now" datatype="date"/>

      <WTCODEGROUP>
        <WTSETVALUE name="Now" value="SYS(timestamp)"/>
        <WTPROCEDURE name="System_GetPassword">
          <WTPARAM name="Password" direction="output"/>
        </WTPROCEDURE>
        <WTUPDATE>
          <WTATTRIBUTE name="ATTR(AuthUser.Password)" value="Password"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeDate)" value="Now"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeID)" value="PARAM(UserID)"/>
          <WTJOIN name="AuthUser" lock="true"/>
          <WTCONDITION expr="ATTR(AuthUserID)" oper="equal" value="PARAM(AuthUserID)"/>
        </WTUPDATE>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="IsValid" oper="not-equal" value="true"/>
        <WTERROR number="-2147220511" message="Oops, Reset password failed. Can not locate user."/>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="SignIn" type="Fetch" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(Logon)" direction="input"/>
      <WTPARAM name="ATTR(Password)" direction="inputoutput"/>
      <WTPARAM name="ATTR(AuthUserID)" direction="output"/>
      <WTPARAM name="ATTR(TrainerID)" direction="output"/>
      <WTPARAM name="ATTR(EmployeeID)" direction="output"/>
      <WTPARAM name="ATTR(MemberID)" direction="output"/>
      <WTPARAM name="ATTR(OrgID)" direction="output"/>
      <WTPARAM name="ATTR(AffiliateID)" direction="output"/>
      <WTPARAM name="ATTR(Email)" direction="output"/>
      <WTPARAM name="ATTR(NameLast)" direction="output"/>
      <WTPARAM name="ATTR(NameFirst)" direction="output"/>
      <WTPARAM name="ATTR(AuthUserName)" direction="output"/>
      <WTPARAM name="ATTR(UserType)" direction="output"/>
      <WTPARAM name="ATTR(UserGroup)" direction="output"/>
      <WTPARAM name="ATTR(UserStatus)" direction="output"/>
      <WTPARAM name="ATTR(UserKey)" direction="output"/>
      <WTPARAM name="ATTR(UserCode)" direction="output"/>
      <WTDECLARE name="AuthUserID" datatype="number"/>
      <WTDECLARE name="TrainerID" datatype="number"/>
      <WTDECLARE name="EmployeeID" datatype="number"/>
      <WTDECLARE name="MemberID" datatype="number"/>
      <WTDECLARE name="OrgID" datatype="number"/>
      <WTDECLARE name="AffiliateID" datatype="number"/>
      <WTDECLARE name="UserType" datatype="number"/>
      <WTDECLARE name="UserGroup" datatype="number"/>
      <WTDECLARE name="UserStatus" datatype="number"/>
      <WTDECLARE name="UserCode" datatype="text" length="10"/>
      <WTCODEGROUP>
        <WTSELECT>
          <WTATTRIBUTE name="AuthUserID" value="ATTR(AuthUser.AuthUserID)"/>
          <WTATTRIBUTE name="TrainerID" value="ATTR(Trainer.TrainerID)"/>
          <WTATTRIBUTE name="EmployeeID" value="ATTR(Employee.EmployeeID)"/>
          <WTATTRIBUTE name="MemberID" value="ATTR(Member.MemberID)"/>
          <WTATTRIBUTE name="OrgID" value="ATTR(Org.OrgID)"/>
          <WTATTRIBUTE name="AffiliateID" value="ATTR(Affiliate.AffiliateID)"/>
          <WTATTRIBUTE name="PARAM(Email)" value="ATTR(AuthUser.Email)"/>
          <WTATTRIBUTE name="PARAM(NameLast)" value="ATTR(AuthUser.NameLast)"/>
          <WTATTRIBUTE name="PARAM(NameFirst)" value="ATTR(AuthUser.NameFirst)"/>
          <WTATTRIBUTE name="PARAM(AuthUserName)" value="ATTR(AuthUser.AuthUserName)"/>
          <WTATTRIBUTE name="PARAM(UserKey)" value="ATTR(AuthUser.UserKey)"/>
          <WTATTRIBUTE name="PARAM(UserCode)" value="ATTR(AuthUser.UserCode)"/>
          <WTATTRIBUTE name="UserType" value="ATTR(AuthUser.UserType)"/>
          <WTATTRIBUTE name="UserGroup" value="ATTR(AuthUser.UserGroup)"/>
          <WTATTRIBUTE name="UserStatus" value="ATTR(AuthUser.UserStatus)"/>
          <WTJOIN name="Common" lock="false"/>
          <WTCONDITION expr="ATTR(Logon)" oper="equal" value="PARAM(Logon)"/>
          <WTCONDITION expr="ATTR(Password)" oper="equal" value="PARAM(Password)" connector="and"/>
        </WTSELECT>
        <WTCODEGROUP>
          <WTCONDITION expr="AuthUserID" oper="not-equal" value="CONST(0)"/>
          <WTCONDITION expr="UserStatus" oper="equal" value="CONST(1)" connector="and"/>
          <WTPROCEDURE name="AuthUser_SetUserCode">
            <WTPARAM name="AuthUserID" direction="input" value="AuthUserID"/>
            <WTPARAM name="UserCode" direction="output"/>
          </WTPROCEDURE>
        </WTCODEGROUP>
        <WTSETVALUE name="PARAM(AuthUserID)" value="AuthUserID" null="0"/>
        <WTSETVALUE name="PARAM(TrainerID)" value="TrainerID" null="0"/>
        <WTSETVALUE name="PARAM(EmployeeID)" value="EmployeeID" null="0"/>
        <WTSETVALUE name="PARAM(MemberID)" value="MemberID" null="0"/>
        <WTSETVALUE name="PARAM(OrgID)" value="OrgID" null="0"/>
        <WTSETVALUE name="PARAM(AffiliateID)" value="AffiliateID" null="0"/>
        <WTSETVALUE name="PARAM(UserType)" value="UserType" null="0"/>
        <WTSETVALUE name="PARAM(UserGroup)" value="UserGroup" null="0"/>
        <WTSETVALUE name="PARAM(UserStatus)" value="UserStatus" null="0"/>
        <WTSETVALUE name="PARAM(UserCode)" value="UserCode"/>
        <WTSETVALUE name="PARAM(Password)" value="CONST('')"/>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="Update" type="Update" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
      <WTPARAM name="ATTR(AuthUser.Email)" direction="input"/>
      <WTPARAM name="ATTR(AuthUser.NameLast)" direction="input"/>
      <WTPARAM name="ATTR(AuthUser.NameFirst)" direction="input"/>
      <WTPARAM name="ATTR(AuthUser.UserGroup)" direction="input"/>
      <WTPARAM name="ATTR(AuthUser.UserStatus)" direction="input"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTDECLARE name="Now" datatype="date"/>
      <WTCODEGROUP>
        <WTSETVALUE name="Now" value="SYS(timestamp)"/>
        <WTUPDATE>
          <WTATTRIBUTE name="ATTR(AuthUser.Email)" value="PARAM(Email)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.NameLast)" value="PARAM(NameLast)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.NameFirst)" value="PARAM(NameFirst)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.UserGroup)" value="PARAM(UserGroup)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.UserStatus)" value="PARAM(UserStatus)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeDate)" value="Now"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeID)" value="PARAM(UserID)"/>
          <WTJOIN name="AuthUser" lock="true"/>
          <WTCONDITION expr="ATTR(AuthUser.AuthUserID)" oper="equal" value="PARAM(AuthUserID)"/>
        </WTUPDATE>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="UpdateLogonPassword" type="Update" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
      <WTPARAM name="ATTR(AuthUser.Logon)" direction="input"/>
      <WTPARAM name="ATTR(AuthUser.Password)" direction="input"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTDECLARE name="Now" datatype="date"/>
      <WTCODEGROUP>
        <WTSETVALUE name="Now" value="SYS(timestamp)"/>
        <WTUPDATE>
          <WTATTRIBUTE name="ATTR(AuthUser.Logon)" value="PARAM(Logon)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.Password)" value="PARAM(Password)"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeDate)" value="Now"/>
          <WTATTRIBUTE name="ATTR(AuthUser.ChangeID)" value="PARAM(UserID)"/>
          <WTJOIN name="AuthUser" lock="true"/>
          <WTCONDITION expr="ATTR(AuthUser.AuthUserID)" oper="equal" value="PARAM(AuthUserID)"/>
        </WTUPDATE>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="UpdateUserType" type="Update" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
      <WTPARAM name="ATTR(AuthUser.UserType)" direction="input"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTCODEGROUP>
        <WTUPDATE>
          <WTATTRIBUTE name="ATTR(AuthUser.UserType)" value="PARAM(UserType)"/>
          <WTJOIN name="AuthUser" lock="true"/>
          <WTCONDITION expr="ATTR(AuthUser.AuthUserID)" oper="equal" value="PARAM(AuthUserID)"/>
        </WTUPDATE>
      </WTCODEGROUP>
    </WTPROCEDURE>

    <!--==================================================================================================-->
    <WTPROCEDURE name="UpdateUserKey" type="Update" style="GenerateDataProc.xsl" template="new">
      <!--==================================================================================================-->
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
      <WTPARAM name="ATTR(AuthUser.UserKey)" direction="input"/>
      <WTPARAM name="SYS(userid)" direction="input"/>
      <WTCODEGROUP>
        <WTUPDATE>
          <WTATTRIBUTE name="ATTR(AuthUser.UserKey)" value="PARAM(UserKey)"/>
          <WTJOIN name="AuthUser" lock="true"/>
          <WTCONDITION expr="ATTR(AuthUser.AuthUserID)" oper="equal" value="PARAM(AuthUserID)"/>
        </WTUPDATE>
      </WTCODEGROUP>
    </WTPROCEDURE>

		<!--==================================================================================================-->
		<WTPROCEDURE name="GetUserCode" type="Check" style="GenerateDataProc.xsl" template="new" passthru="true" noedit="true" nodata="true">
      <WTPARAM name="ATTR(AuthUserID)" direction="input"/>
			<WTPARAM name="UserCode" direction="output" datatype="text" length="10"/>
		</WTPROCEDURE>

  </WTPROCEDURES>

  <WTWEBPAGES>
    <!--==================================================================-->
    <WTWEBPAGE name="Authorize" worker="true" aspstyle="GenerateWebASP.xsl" >
      <!--==================================================================-->
      <WTPARAM name="Lgn" datatype="text"/>
      <WTPARAM name="Pwd" datatype="text"/>
      <WTPARAM name="AID" datatype="number"/>

      <WTINCLUDE name="LimitedAccess.asp"/>
      <WTINCLUDE name="MemberOptions.asp"/>
      <WTINCLUDE name="CompanyHeader.asp"/>

      <WTCODEGROUP>
        <WTCUSTOM>
          If reqAID &gt; 0 Then
          Path = Request.ServerVariables("APPL_PHYSICAL_PATH") + "LiveDesktop\Users\"
          File = CStr(reqAID) + ".xml"
          Set oFileSys = CreateObject("Scripting.FileSystemObject")
          If oFileSys Is Nothing Then
          Response.Write "Scripting.FileSystemObject failed to load"
          Response.End
          End If
          oFileSys.DeleteFile Path + File
          Set oFileSys = Nothing
          Response.End
          End If
        </WTCUSTOM>
      </WTCODEGROUP>

      <WTACTION id="0" name="New" type="New">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(Logon)" value="PARAM(Lgn)"/>
          <WTSETATTRIBUTE name="ATTR(Password)" value="PARAM(Pwd)"/>
          <WTMETHOD name="SignIn"/>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTSETATTRIBUTE name="CONST(tmpAuthUserID)" value="ATTR(AuthUser.AuthUserID)"/>
            <WTSETATTRIBUTE name="CONST(tmpMemberID)" value="ATTR(AuthUser.MemberID)"/>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(AuthUserID)" oper="equal" value="CONST(0)"/>
              <WTERROR number="-2147220504" message="Oops, Either your logon ID or password is incorrect."/>
            </WTCODEGROUP>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(UserStatus)" oper="equal" value="SYSCON(USERSTATUS-INACTIVE)"/>
              <WTERROR number="-2147220505" message="Oops, The logon ID you entered has been disabled."/>
            </WTCODEGROUP>
          </WTCODEGROUP>

          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>

            <WTSETATTRIBUTE name="SYS(userid)" value="ATTR(AuthUser.AuthUserID)"/>
            <WTSETATTRIBUTE name="SYS(usergroup)" value="ATTR(AuthUser.UserGroup)"/>
            <WTSETATTRIBUTE name="SYS(userstatus)" value="ATTR(AuthUser.UserStatus)"/>
            <WTSETATTRIBUTE name="SYS(username)" value="ATTR(AuthUser.AuthUserName)"/>
            <WTSETATTRIBUTE name="SYS(trainerid)" value="ATTR(AuthUser.TrainerID)"/>
            <WTSETATTRIBUTE name="SYS(employeeid)" value="ATTR(AuthUser.EmployeeID)"/>
            <WTSETATTRIBUTE name="SYS(memberid)" value="ATTR(AuthUser.MemberID)"/>
            <WTSETATTRIBUTE name="SYS(orgid)" value="ATTR(AuthUser.OrgID)"/>
            <WTSETATTRIBUTE name="SYS(affiliateid)" value="ATTR(AuthUser.AffiliateID)"/>

            <WTCODEGROUP>
              <WTCONDITION expr="NotMemberOnly"/>
              <WTERROR number="-2147220517" message="Oops, Please contact Customer Support to access the system."/>
            </WTCODEGROUP>

            <WTCODEGROUP>
              <WTCONDITION expr="NoErrors"/>
              <!-- Set access defaults -->
              <WTSETATTRIBUTE name="CONST(tmpAccess)" value="SYSCON(ACCESS-GRANTED)"/>
              <WTSETATTRIBUTE name="CONST(tmpCompanyStatus)" value="SYSCON(NO)"/>
              <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
                <WTMETHOD name="Load">
                  <WTPARAM name="MemberID" direction="input" value="SYS(memberid)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTSETATTRIBUTE name="CONST(tmpImage)" value="ATTR(Member.Image)"/>
                <WTSETATTRIBUTE name="CONST(MemberOptions)" value="ATTR(Member.Options)"/>
                <WTSETATTRIBUTE name="CONST(tmpGroupID)" value="ATTR(Member.GroupID)"/>
                <WTSETATTRIBUTE name="CONST(tmpBilling)" value="ATTR(Member.Billing)"/>
                <WTSETATTRIBUTE name="CONST(tmpStatus)" value="ATTR(Member.Status)"/>
                <WTCODEGROUP>
                  <WTCONDITION expr="ATTR(Status)" oper="equal" value="SYSCON(MEMBER-FREE)"/>
                  <WTSETATTRIBUTE name="ATTR(Level)" value="CONST(0)"/>
                </WTCODEGROUP>
                <WTSETATTRIBUTE name="CONST(tmpLevel)" value="ATTR(Member.Level)"/>
                <!-- Save the member's security level, last visit date, and status -->
                <WTSETATTRIBUTE name="CONST(tmpSECURITYLEVEL)" value="ATTR(Member.Secure)"/>
                <WTSETATTRIBUTE name="CONST(tmpVISITDATE)" value="ATTR(Member.VisitDate)"/>
                <WTSETATTRIBUTE name="SYS(UserMode)" value="ATTR(Member.Status)"/>
                <!-- get any access limitations for this member -->
                <WTSETATTRIBUTE name="CONST(tmpAccessLimit)" value="ATTR(Member.AccessLimit)"/>
                <!-- Display message to contact Customer Support if status is inactive, suspended, or not set -->
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-SUSPENDED)"/>
                  <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="CONST(0)" connector="or"/>
                  <WTERROR number="-2147220517" message="Oops, Please contact Customer Support to access the system."/>
                </WTCODEGROUP>
                <!-- If no errors so far, save the companyID -->
                <WTCODEGROUP>
                  <WTCONDITION expr="NoErrors"/>
                  <WTSETATTRIBUTE name="SYS(CompanyID)" value="ATTR(Member.CompanyID)"/>
                </WTCODEGROUP>
              </WTOBJECT>
              <!-- Set Company Header -->
              <WTCALLSUB name="SetCompanyHeader reqSysCompanyID, reqSysLanguage">
                <WTCONDITION expr="CONST(tmpGroupID)" oper="equal" value="CONST(0)"/>
              </WTCALLSUB>
              <WTCALLSUB name="SetCompanyGrpHeader reqSysCompanyID, tmpGroupID, reqSysLanguage">
                <WTCONDITION expr="CONST(tmpGroupID)" oper="not-equal" value="CONST(0)"/>
              </WTCALLSUB>
              <!-- get the company status and company options -->
              <WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
                <WTCONDITION expr="NoErrors"/>
                <WTMETHOD name="Load">
                  <WTPARAM name="CompanyID" direction="input" value="SYS(CompanyID)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTSETATTRIBUTE name="CONST(tmpCompanyStatus)" value="ATTR(Status)"/>
                <!-- If the company status is not active or demo, display message that the system is unavailable -->
                <WTCODEGROUP>
                  <WTCONDITION expr="ATTR(Status)" oper="not-equal" value="SYSCON(COMPANY-ACTIVE)"/>
                  <WTCONDITION expr="ATTR(Status)" oper="not-equal" value="SYSCON(COMPANY-DEMO)" connector="and"/>
                  <WTERROR number="10106" message="Oops, Your System is not available."/>
                </WTCODEGROUP>
              </WTOBJECT>
              <WTOBJECT name="Coption" project="ptsCoptionUser" class="CCoption">
                <WTCONDITION expr="NoErrors"/>
                <WTMETHOD name="FetchCompany">
                  <WTPARAM name="CompanyID" direction="input" value="SYS(CompanyID)"/>
                </WTMETHOD>
                <WTMETHOD name="Load">
                  <WTPARAM name="CoptionID" direction="input" value="ATTR(CoptionID)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTSETATTRIBUTE name="CONST(tmpIDENTIFY)" value="ATTR(Identify)"/>
                <!--								<WTSETATTRIBUTE name="SYS(NAVBARIMAGE)" value="ATTR(MenuBarColor)"/>-->
                <WTSETATTRIBUTE name="CONST(tmpIPLimit)" value="ATTR(IPLimit)"/>
                <WTSETATTRIBUTE name="CONST(tmpIPLimit)" value="CONST(6)">
                  <WTCONDITION expr="CONST(tmpIPLimit)" oper="equal" value="CONST(0)"/>
                </WTSETATTRIBUTE>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(0)"/>
                  <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(FreeOptions)"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(1)"/>
                  <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options)"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(2)"/>
                  <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options2)"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(3)"/>
                  <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options3)"/>
                </WTCODEGROUP>

                <!-- Get the Users Options -->
                <WTCALLSUB name="reqSysUserOptions = GetUserOptions(reqSysUserOptions, MemberOptions)"/>

                <!-- If we are in Easy Mode, Get the Easy Options for this user -->
                <!--
								<WTCODEGROUP>
									<WTCONDITION expr="IsEasy"/>
									<WTCONDITION expr="IsEasyMode" connector="and"/>
									<WTSETATTRIBUTE name="CONST(tmpMenuBarState)" value="ATTR(MenuEasy)"/>
									<WTCALLSUB name="reqSysUserOptions = GetEasyOptions(reqSysUserOptions, .EasyOptions)"/>
								</WTCODEGROUP>
-->
                <!-- If not Bill Member, don't show payments -->
                <WTSETATTRIBUTE name="SYS(UserOptions)" value="CONST(Replace(reqSysUserOptions, &quot;V&quot;, &quot;&quot;))">
                  <WTCONDITION expr="CONST(tmpBilling)" oper="not-equal" value="SYSCON(MEMBER-BILL)"/>
                </WTSETATTRIBUTE>
              </WTOBJECT>

              <WTCODEGROUP>
                <WTCONDITION expr="NoErrors"/>
                <!-- Get User's IP Address and truncate the last part -->
                <WTCUSTOM>
                  IPLevel = 3
                  If Left(tmpAccessLimit, 4) = "IPL:" Then
                  If IsNumeric(Mid(tmpAccessLimit, 5, 1)) Then
                  x = Mid(tmpAccessLimit, 5, 1)
                  If x &gt;= 1 And x &lt;= 4 Then IPLevel = x
                  End If
                  End If
                  UserIP = Request.ServerVariables("REMOTE_ADDR")
                  If IPLevel = 4 Then
                  tmpIP = UserIP
                  Else
                  x = 0
                  For z = 1 To IPLevel
                  x = InStr(x + 1, UserIP, ".")
                  Next
                  If x &gt; 0 Then tmpIP = Left(UserIP, x)
                  End If
                </WTCUSTOM>
                <!-- Check the Member's logon IP locations -->
                <!-- Unless the member's access limitation is NONE or it is a DEMO company  -->
                <WTOBJECT name="AuthLog" project="ptsAuthLogUser" class="CAuthLog">
                  <WTCONDITION expr="CONST(tmpAccessLimit)" oper="not-equal" value="CONST(&quot;NONE&quot;)"/>
                  <WTCONDITION expr="CONST(tmpCompanyStatus)" oper="not-equal" value="SYSCON(COMPANY-DEMO)" connector="and"/>
                  <WTMETHOD name="LogAuthUser">
                    <WTPARAM name="AuthUserID" direction="input" value="SYS(userid)"/>
                    <WTPARAM name="IP" direction="input" value="CONST(tmpIP)"/>
                    <WTPARAM name="Total" direction="input" value="CONST(tmpIPLimit)"/>
                    <WTPARAM name="result" direction="return" datatype="number"/>
                  </WTMETHOD>
                  <!-- Display Access Disallowed message if IP address has been disabled -->
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(result)" oper="equal" value="CONST(-1)"/>
                    <WTERROR number="-2147220515" message="Oops, Your access to the system has been disallowed - IP Address Denied.{&quot; + UserIP + &quot;}"/>
                  </WTCODEGROUP>
                  <!-- Display Access Disallowed message if too many IP addresses -->
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(result)" oper="greater" value="CONST(1)"/>
                    <WTERROR number="-2147220516" message="Oops, Your access to the system has been disallowed - Too Many IP Addresses.{&quot; + UserIP + &quot;}[&quot; + CStr(result) + &quot;]"/>
                  </WTCODEGROUP>
                </WTOBJECT>
                <!-- Check if the Member's access has been limited -->
                <!-- Unless the member's access limitation is NONE or it is a DEMO company  -->
                <WTCODEGROUP>
                  <WTCONDITION expr="NoErrors"/>
                  <WTCONDITION expr="CONST(tmpAccessLimit)" oper="not-equal" value="CONST(&quot;NONE&quot;)" connector="and"/>
                  <WTCONDITION expr="CONST(tmpCompanyStatus)" oper="not-equal" value="SYSCON(COMPANY-DEMO)" connector="and"/>
                  <WTCALLSUB name="tmpAccess = LimitedAccess( tmpAccessLimit )"/>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpAccess)" oper="not-equal" value="SYSCON(ACCESS-GRANTED)"/>
                    <WTERROR number="-2147220514" message="Oops, Your access to the system has been limited - Access Denied."/>
                  </WTCODEGROUP>
                </WTCODEGROUP>
                <!-- If no errors so far AND the member's status is Active, Trail, or Certify -->
                <!-- Save the current timestamp as the member's last visit date -->
                <WTCODEGROUP>
                  <WTCONDITION expr="NoErrors"/>
                  <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
                    <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-PAID)"/>
                    <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-TRIAL)" connector="or"/>
                    <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-FREE)" connector="or"/>
                    <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-INACTIVE)" connector="or"/>
                    <WTMETHOD name="Load">
                      <WTPARAM name="MemberID" direction="input" value="SYS(memberid)"/>
                      <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                    </WTMETHOD>
                    <WTSETATTRIBUTE name="ATTR(VisitDate)" value="SYS(Now)"/>
                    <WTMETHOD name="Save">
                      <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                    </WTMETHOD>
                  </WTOBJECT>
                  <!-- set all the member's options for pages and training buddy image -->
                  <WTCALLSUB name="SetMemberOptions reqSysMemberID, reqSysCompanyID, reqSysLanguage"/>

                </WTCODEGROUP>
              </WTCODEGROUP>
            </WTCODEGROUP>
          </WTCODEGROUP>
        </WTOBJECT>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTCUSTOM>
            xmlSystem = "&lt;SYSTEM"
            xmlSystem = xmlSystem + " headerimage=" + Chr(34) + reqSysHeaderImage + Chr(34)
            xmlSystem = xmlSystem + " footerimage=" + Chr(34) + reqSysFooterImage + Chr(34)
            xmlSystem = xmlSystem + " returnimage=" + Chr(34) + reqSysReturnImage + Chr(34)
            xmlSystem = xmlSystem + " navbarimage=" + Chr(34) + reqSysNavBarImage + Chr(34)
            xmlSystem = xmlSystem + " headerurl=" + Chr(34) + reqSysHeaderURL + Chr(34)
            xmlSystem = xmlSystem + " language=" + Chr(34) + reqSysLanguage + Chr(34)
            xmlSystem = xmlSystem + " langdialect=" + Chr(34) + reqLangDialect + Chr(34)
            xmlSystem = xmlSystem + " langcountry=" + Chr(34) + reqLangCountry + Chr(34)
            xmlSystem = xmlSystem + " langdefault=" + Chr(34) + reqLangDefault + Chr(34)
            xmlSystem = xmlSystem + " userid=" + Chr(34) + CStr(reqSysUserID) + Chr(34)
            xmlSystem = xmlSystem + " usergroup=" + Chr(34) + CStr(reqSysUserGroup) + Chr(34)
            xmlSystem = xmlSystem + " userstatus=" + Chr(34) + CStr(reqSysUserStatus) + Chr(34)
            xmlSystem = xmlSystem + " username=" + Chr(34) + CleanXML(reqSysUserName) + Chr(34)
            xmlSystem = xmlSystem + " companyid=" + Chr(34) + CStr(reqSysCompanyID) + Chr(34)
            xmlSystem = xmlSystem + " memberid=" + Chr(34) + CStr(reqSysMemberID) + Chr(34)
            xmlSystem = xmlSystem + " usermode=" + Chr(34) + CStr(reqSysUserMode) + Chr(34)
            xmlSystem = xmlSystem + " useroptions=" + Chr(34) + reqSysUserOptions + Chr(34)
            xmlSystem = xmlSystem + " gaa=" + Chr(34) + reqSysGAA + Chr(34)
            xmlSystem = xmlSystem + " cgaa=" + Chr(34) + reqSysCGAA + Chr(34)
            xmlSystem = xmlSystem + " menubarstate=" + Chr(34) + tmpMenuBarState + Chr(34)
            xmlSystem = xmlSystem + " securitylevel=" + Chr(34) + tmpSECURITYLEVEL + Chr(34)
            xmlSystem = xmlSystem + " visitdate=" + Chr(34) + tmpVISITDATE + Chr(34)
            xmlSystem = xmlSystem + " identify=" + Chr(34) + tmpIDENTIFY + Chr(34)
            tmpMEMBEROPTIONS = GetCache("MEMBEROPTIONS")
            xmlSystem = xmlSystem + " memberoptions=" + Chr(34) + tmpMEMBEROPTIONS + Chr(34)
            xmlSystem = xmlSystem + " /&gt;"

            Path = Request.ServerVariables("APPL_PHYSICAL_PATH") + "LiveDesktop\Users\"
            File = CStr(reqSysUserID) + ".xml"

            Set oFileSys = CreateObject("Scripting.FileSystemObject")
            If oFileSys Is Nothing Then
            Response.Write "Scripting.FileSystemObject failed to load"
            Response.End
            End If
            Set oFile = oFileSys.CreateTextFile(Path + File, True)
            If oFile Is Nothing Then
            Response.Write "Couldn't open file: " + Path + File
            Response.End
            End If

            oFile.WriteLine xmlSystem

            Set oFile = Nothing
            Set oFileSys = Nothing
          </WTCUSTOM>
        </WTCODEGROUP>
        <WTCUSTOM>
          If xmlError = "" Then
          str = "&lt;USER name=""" + CleanXML(reqSysUserName) + """ memberid=""" + CStr(reqSysMemberID) + """ companyid=""" + CStr(reqSysCompanyID) + """ authuserid=""" + CStr(reqSysUserID) + """ code=""" + reqSysUserOptions + """"
          If tmpGroupID &lt;&gt; 0 Then str = str + " GroupID=""" + CSTR(tmpGroupID) + """"
          If tmpImage &lt;&gt; "" Then str = str + " image=""" + tmpImage + """"
          str = str + "/&gt;"
          Response.Write str
          Else
          str = "&lt;ERROR&gt;" + xmlError +  "&lt;/ERROR&gt;"
          Response.Write str
          End If
          Response.End

        </WTCUSTOM>
      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT/>
    </WTWEBPAGE>

    <!--==================================================================================================-->
    <WTWEBPAGE name="0101" caption="Sign In" navbar="false" header="PageHeaderPublic" footer="PageFooterPublic" wrapper="wrapper750"
			aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" checksecurity="false">
      <!--==================================================================================================-->
      <WTPARAM name="Lgn" datatype="text"/>
      <WTPARAM name="Pwd" datatype="text"/>
      <WTPARAM name="C" datatype="number"/>    <!-- CompanyID -->
      <WTPARAM name="R" datatype="text"/>      <!-- Member Reference -->
      <WTPARAM name="E" datatype="text"/>      <!-- Encripted Member Reference -->
      <WTPARAM name="A" datatype="number"/>    <!-- AuthUserID -->
      <WTPARAM name="G" datatype="number"/>    <!-- GroupID -->
      <WTPARAM name="ContactInfo" datatype="number"/>
      <WTPARAM name="Remember" datatype="number"/>
      <WTPARAM name="Page" datatype="text" url="true"/>
      <WTPARAM name="CompanyID" datatype="number"/>
      <!--			<WTPARAM name="Browser" datatype="text"/>-->
      <WTPARAM name="AuthyID" datatype="number"/>
      <WTPARAM name="UserKey" datatype="text"/>
      <WTPARAM name="SecurityCode" datatype="text"/>
      <WTPARAM name="IsOverride2FA" datatype="number"/>
      <WTPARAM name="AccessStatus" datatype="number"/>

      <WTINCLUDE name="LimitedAccess.asp"/>
      <WTINCLUDE name="MemberOptions.asp"/>
      <WTINCLUDE name="CompanyHeader.asp"/>
      <WTINCLUDE name="Company.asp" />
      <WTINCLUDE name="Encript.asp"/>
      <WTINCLUDE name="Resources.asp"/>
      <WTINCLUDE name="Authy.asp"/>
      <WTINCLUDE name="Google2FA.asp"/>
      <WTINCLUDE name="Comm.asp"/>
      <WTINCLUDE name="IP.asp"/>
      <WTINCLUDE name="MobileBrowser.asp"/>
      <!--			<WTINCLUDE name="BrowserClass.asp"/>-->
      <WTLOG name="Member" value="SYS(memberid)"/>
      <!--
			<WTCODEGROUP>
<WTCUSTOM>
BrowserName    = browser.getName
BrowserVersion = browser.getVersion
BrowserOS      = browser.getOS 
If BrowserName &lt;&gt; "ie" OR CDbl(BrowserVersion) &lt; 5.5 OR BrowserOS &lt;&gt; "win" Then
	reqBrowser = "&lt;B&gt;This system requires Internet Explorer version 5.5 or higher" 	
	reqBrowser = reqBrowser + "&lt;BR&gt;running on the Windows Operating System.&lt;/B&gt;" 	
	reqBrowser = reqBrowser + "&lt;BR&gt;&lt;BR&gt;Your Browser is: &lt;B&gt;" + browser.getFullName + "&lt;/B&gt;" 
	reqBrowser = reqBrowser + "&lt;BR&gt;Your Browser version is: &lt;B&gt;" + BrowserVersion + "&lt;/B&gt;" 
	reqBrowser = reqBrowser + "&lt;BR&gt;Your Computer Operating System is: &lt;B&gt;" + browser.getFullOS + "&lt;/B&gt;" 
	reqBrowser = reqBrowser + "&lt;BR&gt;&lt;BR&gt;You may experience difficulties if you proceed." 
End If
</WTCUSTOM>
			</WTCODEGROUP>
-->
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(G)" oper="equal" value="CONST(0)" />
        <WTGETCACHE name="PARAM(G)" value="G" datatype="number"/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(E)" oper="not-equal" value="CONST(&quot;&quot;)"/>
        <WTCUSTOM>
          reqR = Decript(reqE)
        </WTCUSTOM>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
        <WTCONDITION expr="PARAM(C)" oper="not-equal" value="CONST(0)" connector="and"/>
        <WTSETATTRIBUTE name="PARAM(CompanyID)" value="PARAM(C)"/>
      </WTCODEGROUP>
      <!--
			<WTCODEGROUP>
				<WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(0)"/>
				<WTSETATTRIBUTE name="SYS(CompanyID)" value="PARAM(CompanyID)"/>
				<WTSETCACHE name="SYS(CompanyID)" value="SYS(CompanyID)"/>
			</WTCODEGROUP>
-->
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="CONST(0)" />
        <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(0)" connector="and"/>
        <WTCALLSUB name="GetCompany(reqCompanyID)" />
        <!-- Set Group Header -->
        <WTCALLSUB name="SetCompanyGrpHeader reqCompanyID, reqG, reqSysLanguage">
          <WTCONDITION expr="PARAM(G)" oper="not-equal" value="CONST(0)"/>
        </WTCALLSUB>
      </WTCODEGROUP>

      <WTSUB function="AccessNotice( lgn, email )">
        <WTCODEGROUP>
          <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="SYS(CompanyID)" value="SYSCON(NEXXUS)"/>
        </WTCODEGROUP>
        <WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
          <WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(&quot;access.htm&quot;)"/>
          <WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\Company/&quot; + CStr(reqSysCompanyID))"/>
          <WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)"/>
          <WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)"/>
          <WTMETHOD name="Load"/>
          <WTSETATTRIBUTE name="CONST(tmpBody)" value="ATTR(Data)"/>
        </WTOBJECT>
            <WTCUSTOM>
              If reqAccessStatus = 0 Then tmp2FA = "Disabled"
              If reqAccessStatus = 1 Then tmp2FA = "Enabled"
              If reqAccessStatus = 2 Then tmp2FA = "Override"
              UserName = GetCache("USERNAME")
              IP = Request.ServerVariables("REMOTE_ADDR")
              Browser = Request.ServerVariables("HTTP_USER_AGENT")
              tmpLocation = GetIPCity( IP )
              tmpTime = Now()

              tmpBody = Replace( tmpBody, "{username}", lgn + " - " + UserName )
              tmpBody = Replace( tmpBody, "{time}", tmpTime )
              tmpBody = Replace( tmpBody, "{ip}", IP + " - " + tmpLocation )
              tmpBody = Replace( tmpBody, "{browser}", Browser )
              tmpBody = Replace( tmpBody, "{2fa}", tmp2FA )

              tmpTo = email
              tmpFrom = "app-events@pinnaclep.com"
              If reqSysCompanyID = 17 Then
              tmpFrom = "support@gcrmarketing.com"
              tmpSubject = "GCR - Successful login notification " + CStr(tmpTime)
              End If
              If reqSysCompanyID = 21 Then
              tmpFrom = "support@nexxusuniversity.com"
              tmpSubject = "Nexxus - Successful login notification " + CStr(tmpTime)
              End If
              tmpSender = tmpFrom
              SendEmail company, tmpSender, tmpFrom, tmpTo, "", "", tmpSubject, tmpBody
            </WTCUSTOM>
      </WTSUB>

      <WTSUB name="NotifySystem">
        <WTCUSTOM>
          tmpTo = "app-events@pinnaclep.com"
          tmpSender = tmpTo
          tmpFrom = tmpTo
          tmpBody = ""
          IP = Request.ServerVariables("REMOTE_ADDR")
          tmpLocation = GetIPCity( IP )
          If reqSysUserGroup = 1 Then tmpSubject = "LOGIN SYSADMIN: "
          If reqSysUserGroup &gt;= 21 And reqSysUserGroup &lt;= 23 Then tmpSubject = "LOGIN EMPLOYEE: "
          If reqSysUserGroup &gt;= 51 And reqSysUserGroup &lt;= 52 Then tmpSubject = "LOGIN ADMIN: "
          tmpSubject = tmpSubject + " " + CStr(reqSysUserID) + " - " + reqSysUserName + " - " + CSTR(reqSysCompanyID) + " - " + IP + " - " + tmpLocation
'          SendEmail reqSysCompanyID, tmpSender, tmpFrom, tmpTo, "", "", tmpSubject, tmpBody
          'HACKER TEST
          Target = "85.253.66.46,90.191.167.100,88.196.236.75,121.54.58.242,121.54.58.246,119.81.230.137,119.81.230.132"
          If InStr( Target, IP ) > 0 Then
          tmpTo = "bobwood56@gmail.com"
          tmpSubject = "HACKER ALERT: " + tmpSubject
          SendEmail reqSysCompanyID, tmpSender, tmpFrom, tmpTo, "", "", tmpSubject, tmpBody
          End If
        </WTCUSTOM>
      </WTSUB>

      <WTSUB function="LogLogin(msg,lgn)">
        <WTCUSTOM>
          UserID = Numeric(GetCache("USERID"))
          MemberID = Numeric(GetCache("MEMBERID"))
          CompanyID = Numeric(GetCache("COMPANYID"))
          UserName = GetCache("USERNAME")
          good = ""
          If msg = "GOOD" Then good = " - " + CStr(UserID) + "/" + CStr(MemberID) + " - " + UserName
          str = lgn + " - " + CStr(CompanyID)
          LogFile "Login", msg + ": " + str + good
        </WTCUSTOM>
      </WTSUB>

      <WTSUB name="ClearUser">
        <WTSETCACHE name="SYS(userid)" value="CONST(99)"/>
        <WTSETCACHE name="SYS(usergroup)" value="CONST(99)"/>
        <WTSETCACHE name="SYS(userstatus)" value="CONST(1)"/>
        <WTSETCACHE name="SYS(username)" value="CONST(&quot;&quot;)"/>
        <WTSETCACHE name="SYS(trainerid)" value="CONST(0)"/>
        <WTSETCACHE name="SYS(employeeid)" value="CONST(0)"/>
        <WTSETCACHE name="SYS(orgid)" value="CONST(0)"/>
        <WTSETCACHE name="SYS(affiliateid)" value="CONST(0)"/>
        <WTSETCACHE name="SYS(memberid)" value="CONST(0)"/>
        <WTSETCACHE name="SYS(signinurl)" value="CONST(&quot;&quot;)"/>
        <WTSETCACHE name="SECURITYLEVEL" value="CONST(0)"/>
        <WTSETCACHE name="SYS(Options)" value="CONST(&quot;&quot;)"/>
        <WTSETCACHE name="SYS(MenuBarState)" value="CONST(&quot;&quot;)"/>
      </WTSUB>

      <WTSUB function="SignIn(lgn,pwd)">
        <WTSETATTRIBUTE name="CONST(tmpAuthUserID)" value="CONST(1)"/>
        <WTSETATTRIBUTE name="CONST(tmpAuthUserID)" value="PARAM(A)">
          <WTCONDITION expr="PARAM(A)" oper="not-equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
        <!-- If a Member Reference was passed in get the Member's AuthUserID -->
        <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
          <WTCONDITION expr="PARAM(C)" oper="not-equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(R)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
          <WTMETHOD name="FetchRef">
            <WTPARAM name="CompanyID" direction="input" value="PARAM(C)"/>
            <WTPARAM name="Reference" direction="input" value="PARAM(R)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="CONST(tmpAuthUserID)" value="ATTR(AuthUserID)"/>
        </WTOBJECT>
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETCACHE name="SECURITYLEVEL" value="CONST(0)"/>
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="CONST(tmpAuthUserID)"/>
          <WTSETATTRIBUTE name="ATTR(Logon)" value="CONST(lgn)"/>
          <WTSETATTRIBUTE name="ATTR(Password)" value="CONST(pwd)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
          <!-- If we only have a logon and password, signin the user -->
          <WTMETHOD name="SignIn">
            <WTCONDITION expr="CONST(tmpAuthUserID)" oper="equal" value="CONST(1)"/>
          </WTMETHOD>
          <!-- If a Member's AuthUserID was retrieved, fetch the AuthUser info -->
          <WTMETHOD name="Load">
            <WTCONDITION expr="CONST(tmpAuthUserID)" oper="not-equal" value="CONST(1)"/>
            <WTPARAM name="SecurityToken" direction="input" value="CONST(1)"/>
          </WTMETHOD>
          <WTCODEGROUP>
            <WTCONDITION expr="ATTR(AuthUserID)" oper="equal" value="CONST(0)"/>
            <WTERROR number="-2147220504" message="Oops, Either your logon ID or password is incorrect."/>
            <WTCALLSUB name="LogLogin &quot;BAD&quot;, lgn"/>
            <WTCALLSUB name="ClearUser"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="ATTR(UserStatus)" oper="equal" value="SYSCON(USERSTATUS-INACTIVE)"/>
            <WTERROR number="-2147220505" message="Oops, The logon ID you entered has been disabled."/>
            <WTCALLSUB name="LogLogin &quot;DISABLED&quot;, lgn "/>
            <WTCALLSUB name="ClearUser"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTSETCACHE name="UC" value="ATTR(UserCode)"/>
            <WTSETATTRIBUTE name="CONST(tmpLoginLogged)" value="CONST(0)"/>
            <!-- PROCESS 2FA SECURITY-->
            <WTSETATTRIBUTE name="PARAM(AuthyID)" value="ATTR(AuthUser.UserType)"/>
            <WTSETATTRIBUTE name="PARAM(UserKey)" value="ATTR(AuthUser.UserKey)"/>
            <WTSETATTRIBUTE name="PARAM(AuthyID)" value="CONST(0)">
              <WTCONDITION expr="PARAM(UserKey)" oper="not-equal" value="CONST(&quot;&quot;)"/>
            </WTSETATTRIBUTE>
            <WTSETCACHE name="O2FA" value="CONST(0)"/>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(AuthUser.UserGroup)" oper="equal" value="CONST(41)"/>
              <WTCONDITION expr="PARAM(IsOverride2FA)" oper="not-equal" value="SYSCON(NO)" connector="and"/>
              <WTSETCACHE name="O2FA" value="CONST(1)"/>
              <WTSETATTRIBUTE name="PARAM(AuthyID)" value="CONST(0)"/>
              <WTSETATTRIBUTE name="PARAM(UserKey)" value="CONST(&quot;&quot;)"/>
              <WTSETATTRIBUTE name="PARAM(SecurityCode)" value="CONST(&quot;&quot;)"/>
              <WTSETATTRIBUTE name="PARAM(AccessStatus)" value="CONST(2)"/>
            </WTCODEGROUP>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCONDITION expr="PARAM(SecurityCode)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
            <!--VERIFY AUTHY SECURITY CODE -->
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(AuthyID)" oper="not-equal" value="CONST(0)"/>
              <WTCUSTOM>
                Verify = VerifyAuthyUser( reqAuthyID, reqSecurityCode )
                If Verify = "1" Then
                reqAuthyID = 0
                reqAccessStatus = 1
                tmpLoginLogged = 1
                LogLogin "GOOD2FA-A", lgn
                Else
                reqSecurityCode = ""
                LogLogin "BAD2FA-A", lgn
                DoError 10138, "", "Oops, Invalid Security Code"
                End If
              </WTCUSTOM>
            </WTCODEGROUP>
            <!--VERIFY GOOGLE AUTHENTICATOR SECURITY CODE -->
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(UserKey)" oper="not-equal" value="CONST(&quot;&quot;)"/>
              <WTCUSTOM>
                If Verify2FAUser( reqUserKey, reqSecurityCode ) Then
                reqUserKey = ""
                reqAccessStatus = 1
                tmpLoginLogged = 1
                LogLogin "GOOD2FA-G", lgn
                Else
                reqSecurityCode = ""
                LogLogin "BAD2FA-G", lgn
                DoError 10138, "", "Oops, Invalid Security Code"
                End If
              </WTCUSTOM>
            </WTCODEGROUP>
          </WTCODEGROUP>
          
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCONDITION expr="PARAM(AuthyID)" oper="equal" value="CONST(0)" connector="and"/>
            <WTCONDITION expr="PARAM(UserKey)" oper="equal" value="CONST(&quot;&quot;)" connector="and"/>

            <WTSETATTRIBUTE name="SYS(userid)" value="ATTR(AuthUser.AuthUserID)"/>
            <WTSETCACHE name="SYS(userid)" value="SYS(userid)"/>
<!--            <WTSETCACHE name="usertype" value="ATTR(AuthUser.UserType)"/>-->
            <WTSETATTRIBUTE name="SYS(usergroup)" value="ATTR(AuthUser.UserGroup)"/>
            <WTSETCACHE name="SYS(usergroup)" value="SYS(usergroup)"/>
            <WTSETATTRIBUTE name="SYS(userstatus)" value="ATTR(AuthUser.UserStatus)"/>
            <WTSETCACHE name="SYS(userstatus)" value="SYS(userstatus)"/>
            <WTSETATTRIBUTE name="SYS(username)" value="ATTR(AuthUser.AuthUserName)"/>
            <WTSETCACHE name="SYS(username)" value="SYS(username)"/>
            <WTSETATTRIBUTE name="SYS(trainerid)" value="ATTR(AuthUser.TrainerID)"/>
            <WTSETCACHE name="SYS(trainerid)" value="SYS(trainerid)"/>
            <WTSETATTRIBUTE name="SYS(employeeid)" value="ATTR(AuthUser.EmployeeID)"/>
            <WTSETCACHE name="SYS(employeeid)" value="SYS(employeeid)"/>
            <WTSETATTRIBUTE name="SYS(memberid)" value="ATTR(AuthUser.MemberID)"/>
            <WTSETCACHE name="SYS(memberid)" value="SYS(memberid)"/>
            <WTSETATTRIBUTE name="SYS(orgid)" value="ATTR(AuthUser.OrgID)"/>
            <WTSETCACHE name="SYS(orgid)" value="SYS(orgid)"/>
            <WTSETATTRIBUTE name="SYS(affiliateid)" value="ATTR(AuthUser.AffiliateID)"/>
            <WTSETCACHE name="SYS(affiliateid)" value="SYS(affiliateid)"/>
            <!-- SECURITY CHECK FOR ACCESS ERROR (AE)-->
            <WTSETCACHE name="AE" value="SYS(usergroup)"/>

            <WTSETATTRIBUTE name="CONST(UserEmail)" value="ATTR(AuthUser.Email)"/>

            <WTCALLSUB name="LogLogin &quot;GOOD&quot;, lgn ">
              <WTCONDITION expr="CONST(tmpLoginLogged)" oper="equal" value="CONST(0)"/>
            </WTCALLSUB>

            <WTCODEGROUP>
              <WTCONDITION expr="IsEmployee"/>
              <WTCONDITION expr="IsTranslatorOnly" connector="or"/>
              <WTCALLSUB name="NotifySystem"/>
              <WTSETCACHE name="CONST(EMEMBERID)" value="CONST(Encript(CStr(reqSysMemberID)))"/>
              <WTSETATTRIBUTE name="SYS(CompanyID)" value="CONST(0)"/>
              <WTSETCACHE name="SYS(CompanyID)" value="SYS(CompanyID)"/>
              <WTSETATTRIBUTE name="SYS(NAVBARIMAGE)" value="CONST(&quot;&quot;)"/>
              <WTSETCACHE name="SYS(NAVBARIMAGE)" value="SYS(NAVBARIMAGE)"/>
              <WTOBJECT name="Employee" project="ptsEmployeeUser" class="CEmployee">
                <WTMETHOD name="Load">
                  <WTPARAM name="EmployeeID" direction="input" value="SYS(Employeeid)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTCODEGROUP>
                  <WTSETATTRIBUTE name="SYS(memberid)" value="ATTR(MemberID)"/>
                  <WTSETCACHE name="SYS(memberid)" value="SYS(memberid)"/>
                </WTCODEGROUP>
              </WTOBJECT>
              <WTOBJECT name="Business" project="ptsBusinessUser" class="CBusiness">
                <WTMETHOD name="Load">
                  <WTPARAM name="BusinessID" direction="input" value="CONST(1)" />
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
                </WTMETHOD>
                <WTSETATTRIBUTE name="SYS(UserOptions)" value="CONST(&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890@#%()|\_+=./,[]{}&quot;)">
                  <WTCONDITION expr="IsSysAdmin"/>
                </WTSETATTRIBUTE>
                <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options1)">
                  <WTCONDITION expr="IsManagerOnly"/>
                </WTSETATTRIBUTE>
                <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options2)">
                  <WTCONDITION expr="IsAdminOnly"/>
                </WTSETATTRIBUTE>
                <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options3)">
                  <WTCONDITION expr="IsEmployeeOnly"/>
                </WTSETATTRIBUTE>
                <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options4)">
                  <WTCONDITION expr="IsTranslatorOnly"/>
                </WTSETATTRIBUTE>
                <WTSETCACHE name="SYS(UserOptions)" value="SYS(UserOptions)"/>
              </WTOBJECT>
              
              <WTCODEGROUP>
                <WTCALLSUB name="AccessNotice lgn, UserEmail "/>
              </WTCODEGROUP>
              
              <WTRETURN>
                <WTCONDITION expr="IsTranslatorOnly"/>
                <WTLINK name="0099" return="false"/>
              </WTRETURN>
              <WTRETURN>
                <WTCONDITION expr="IsEmployee"/>
                <WTLINK name="EmployeeHome" secure="false" return="false"/>
              </WTRETURN>
            </WTCODEGROUP>

            <WTCODEGROUP>
              <WTCONDITION expr="IsTrainerOnly"/>
              <!-- Set default menu bar state -->
              <WTSETCACHE name="SYS(MenuBarState)" value="CONST(&quot;0&quot;)"/>
              <WTRETURN>
                <WTLINK name="0305" return="false"/>
              </WTRETURN>
            </WTCODEGROUP>

            <WTCODEGROUP>
              <WTCONDITION expr="IsOrgAdminOnly"/>
              <WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
              <WTCALLSUB name="NotifySystem"/>
              <WTOBJECT name="Org" project="ptsOrgUser" class="COrg">
                <WTMETHOD name="Load">
                  <WTPARAM name="OrgID" direction="input" value="SYS(orgid)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTCODEGROUP>
                  <WTCONDITION expr="ATTR(CompanyID)" oper="not-equal" value="CONST(CSTR(reqSysCompanyID))"/>
                  <WTCUSTOM>AbortUser()</WTCUSTOM>
                </WTCODEGROUP>
                <WTSETATTRIBUTE name="SYS(CompanyID)" value="ATTR(CompanyID)"/>
                <WTSETATTRIBUTE name="CONST(tmpSecure)" value="ATTR(Org.Secure)"/>
                <WTSETATTRIBUTE name="CONST(tmpIP)" value="ATTR(Org.Description)"/>
                <WTSETCACHE name="SYS(CompanyID)" value="SYS(CompanyID)"/>
                <WTSETCACHE name="SECURITYLEVEL" value="ATTR(Org.Secure)"/>
                <WTSETCACHE name="SYS(MEMBERID)" value="ATTR(Org.MemberID)"/>
                <WTCODEGROUP>
                  <WTCONDITION expr="ATTR(Status)" oper="equal" value="CONST(4)"/>
                  <WTERROR number="10106" message="Oops, Your System is not available."/>
                  <WTCALLSUB name="ClearUser"/>
                </WTCODEGROUP>
                <WTSETATTRIBUTE name="CONST(UserIP)" value="CONST(Request.ServerVariables(&quot;REMOTE_ADDR&quot;))"/>
                <WTSETCACHE name="IPC" value="CONST(Mid(UserIP,5,1))"/>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpIP)" oper="not-equal" value="CONST(&quot;&quot;)"/>
                  <WTCUSTOM>
                    pos = InStr(tmpIP, ";")
                    If pos = 0 Then length = Len(tmpIP) Else length = pos - 1
                    subIP = Left(UserIP,length)
                    If InStr( tmpIP, subIP) = 0 Then AbortUser()
                  </WTCUSTOM>
                </WTCODEGROUP>
              </WTOBJECT>
              <WTOBJECT name="Coption" project="ptsCoptionUser" class="CCoption">
                <WTCONDITION expr="NoErrors"/>
                <WTMETHOD name="FetchCompany">
                  <WTPARAM name="CompanyID" direction="input" value="SYS(CompanyID)"/>
                </WTMETHOD>
                <WTMETHOD name="Load">
                  <WTPARAM name="CoptionID" direction="input" value="ATTR(CoptionID)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTCODEGROUP>
                  <WTCONDITION expr="IsOrgAdminOnly"/>
                  <WTSETCACHE name="SYS(UserOptions)" value="ATTR(Options4)"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="IsOrgManagerOnly"/>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpSecure)" oper="equal" value="CONST(0)"/>
                    <WTCONDITION expr="CONST(tmpSecure)" oper="equal" value="CONST(1)" connector="or"/>
                    <WTSETCACHE name="SYS(UserOptions)" value="ATTR(Options5)"/>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpSecure)" oper="equal" value="CONST(2)"/>
                    <WTSETCACHE name="SYS(UserOptions)" value="ATTR(Options6)"/>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpSecure)" oper="equal" value="CONST(3)"/>
                    <WTSETCACHE name="SYS(UserOptions)" value="ATTR(Options7)"/>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpSecure)" oper="equal" value="CONST(4)"/>
                    <WTSETCACHE name="SYS(UserOptions)" value="ATTR(Options8)"/>
                  </WTCODEGROUP>
                </WTCODEGROUP>
              </WTOBJECT>
              
              <WTCODEGROUP>
                <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="SYSCON(GCR)"/>
                <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="SYSCON(NEXXUS)" connector="or"/>
                <WTCALLSUB name="AccessNotice lgn, UserEmail "/>
              </WTCODEGROUP>
              
              <WTRETURN>
                <WTCONDITION expr="NoErrors"/>
                <WTLINK name="AdminHome" secure="false" return="false">
                  <WTPARAM name="CompanyID" value="SYS(CompanyID)"/>
                </WTLINK>
              </WTRETURN>
            </WTCODEGROUP>

            <WTCODEGROUP>
              <WTCONDITION expr="IsAffiliateOnly"/>
              <!-- Set default menu bar state -->
              <WTSETCACHE name="SYS(MenuBarState)" value="CONST(&quot;0&quot;)"/>
              <WTOBJECT name="Affiliate" project="ptsAffiliateUser" class="CAffiliate">
                <WTMETHOD name="Load">
                  <WTPARAM name="AffiliateID" direction="input" value="SYS(affiliateid)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
              </WTOBJECT>
              <WTRETURN>
                <WTCONDITION expr="NoErrors"/>
                <WTLINK name="0604" return="false">
                  <WTPARAM name="AffiliateID" value="SYS(AffiliateID)"/>
                </WTLINK>
              </WTRETURN>
            </WTCODEGROUP>

            <!-- Handle Member Logon -->
            <WTCODEGROUP>
              <WTCONDITION expr="IsMemberOnly"/>
              <!-- Set access defaults -->
              <WTSETATTRIBUTE name="CONST(tmpAccess)" value="SYSCON(ACCESS-GRANTED)"/>
              <WTSETATTRIBUTE name="CONST(tmpCompanyStatus)" value="SYSCON(NO)"/>
              <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
                <WTMETHOD name="Load">
                  <WTPARAM name="MemberID" direction="input" value="SYS(memberid)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTSETATTRIBUTE name="CONST(MemberCompanyID)" value="CONST(CLng(.CompanyID))"/>
                <!-- Check if this member belongs to the accessed company -->
                <WTCODEGROUP>
                  <WTCONDITION expr="SYS(CompanyID)" oper="not-equal" value="CONST(0)"/>
                  <WTCONDITION expr="CONST(MemberCompanyID)" oper="not-equal" value="SYS(CompanyID)" connector="and"/>
                  <WTERROR number="-2147217874" message="Oops, Logon Name is registered to another company."/>
                  <WTSETATTRIBUTE name="PARAM(ContactInfo)" value="SYSCON(YES)"/>
                  <WTCALLSUB name="ClearUser"/>
                </WTCODEGROUP>

                <WTSETATTRIBUTE name="CONST(MemberOptions)" value="ATTR(Member.Options)"/>
                <WTSETCACHE name="OPTIONS2" value="ATTR(Member.Options2)"/>
                <WTSETATTRIBUTE name="CONST(MemberOptions2)" value="ATTR(Member.Options2)"/>
                <WTSETATTRIBUTE name="CONST(tmpGroupID)" value="ATTR(Member.GroupID)"/>
                <WTSETATTRIBUTE name="CONST(tmpBilling)" value="ATTR(Member.Billing)"/>
                <WTSETATTRIBUTE name="CONST(tmpBillingID)" value="ATTR(Member.BillingID)"/>
                <WTSETATTRIBUTE name="CONST(tmpStatus)" value="ATTR(Member.Status)"/>
                <WTCODEGROUP>
                  <WTCONDITION expr="ATTR(Status)" oper="equal" value="SYSCON(MEMBER-FREE)"/>
                  <WTSETATTRIBUTE name="ATTR(Level)" value="CONST(0)"/>
                </WTCODEGROUP>
                <WTSETATTRIBUTE name="CONST(tmpLevel)" value="ATTR(Member.Level)"/>

                <!-- If this member belongs to a group, get the group's shared resources -->
                <WTCALLSUB name="GetResources tmpGroupID">
                  <WTCONDITION expr="CONST(tmpGroupID)" oper="not-equal" value="CONST(0)"/>
                </WTCALLSUB>

                <!-- Save the member's security level, last visit date, and status -->
                <WTSETCACHE name="SECURITYLEVEL" value="ATTR(Member.Secure)"/>
                <WTSETCACHE name="VISITDATE" value="ATTR(Member.VisitDate)"/>
                <WTSETATTRIBUTE name="SYS(UserMode)" value="ATTR(Member.Status)"/>
                <!-- Flag if this is a business account -->
                <WTSETATTRIBUTE name="SYS(UserMode)" value="SYSCON(MEMBER-BUSINESS)">
                  <WTCONDITION expr="ATTR(Member.IsMaster)" oper="not-equal" value="SYSCON(NO)"/>
                </WTSETATTRIBUTE>
                <WTSETCACHE name="SYS(UserMode)" value="SYS(UserMode)"/>
                <!-- If this is a trial account and we have billing info, flag as an Active account -->
                <!--
									  <WTSETATTRIBUTE name="CONST(tmpStatus)" value="SYSCON(MEMBER-PAID)">
										  <WTCONDITION expr="ATTR(Member.Status)" oper="equal" value="SYSCON(MEMBER-TRIAL)"/>
										  <WTCONDITION expr="ATTR(Member.BillingID)" oper="not-equal" value="CONST(0)" connector="and"/>
									  </WTSETATTRIBUTE>
  -->
                <!-- get any access limitations for this member -->
                <WTSETATTRIBUTE name="CONST(tmpAccessLimit)" value="ATTR(Member.AccessLimit)"/>

                <!-- If Member is Suspended, send them to a payment processing page to fix declined payments -->
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-SUSPENDED)"/>
                  <WTSETATTRIBUTE name="CONST(tmpMemberID)" value="SYS(memberid)"/>
                  <WTCALLSUB name="ClearUser"/>
                  <WTRETURN>
                    <WTLINK name="0436d" secure="false" return="false">
                      <WTPARAM name="MemberID" value="CONST(tmpMemberID)"/>
                    </WTLINK>
                  </WTRETURN>
                </WTCODEGROUP>

                <!-- Display message to contact Customer Support if status is inactive, suspended, or not set -->
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpStatus)" oper="less" value="SYSCON(MEMBER-PAID)"/>
                  <WTCONDITION expr="CONST(tmpStatus)" oper="greater" value="SYSCON(MEMBER-FREE)" connector="or"/>
                  <WTERROR number="-2147220517" message="Oops, Please contact Customer Support to access the system."/>
                  <WTSETATTRIBUTE name="PARAM(ContactInfo)" value="SYSCON(YES)"/>
                  <WTCALLSUB name="ClearUser"/>
                </WTCODEGROUP>
                <!-- If no errors so far, save the companyID -->
                <WTCODEGROUP>
                  <WTCONDITION expr="NoErrors"/>
                  <WTSETATTRIBUTE name="SYS(CompanyID)" value="ATTR(Member.CompanyID)"/>
                  <WTSETCACHE name="SYS(CompanyID)" value="SYS(CompanyID)"/>
                </WTCODEGROUP>
              </WTOBJECT>
              <!-- Set Company Header -->
              <WTCALLSUB name="SetCompanyHeader reqSysCompanyID, reqSysLanguage">
                <WTCONDITION expr="CONST(tmpGroupID)" oper="equal" value="CONST(0)"/>
              </WTCALLSUB>
              <WTCALLSUB name="SetCompanyGrpHeader reqSysCompanyID, tmpGroupID, reqSysLanguage">
                <WTCONDITION expr="CONST(tmpGroupID)" oper="not-equal" value="CONST(0)"/>
              </WTCALLSUB>
              <!-- get the company status and company options -->
              <WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
                <WTCONDITION expr="NoErrors"/>
                <WTMETHOD name="Load">
                  <WTPARAM name="CompanyID" direction="input" value="SYS(CompanyID)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTSETATTRIBUTE name="CONST(tmpCompanyStatus)" value="ATTR(Status)"/>
                <!-- If the company status is not active or demo, display message that the system is unavailable -->
                <WTCODEGROUP>
                  <WTCONDITION expr="ATTR(Status)" oper="not-equal" value="SYSCON(COMPANY-ACTIVE)"/>
                  <WTCONDITION expr="ATTR(Status)" oper="not-equal" value="SYSCON(COMPANY-DEMO)" connector="and"/>
                  <WTERROR number="10106" message="Oops, Your System is not available."/>
                  <WTCALLSUB name="ClearUser"/>
                </WTCODEGROUP>
              </WTOBJECT>
              <WTOBJECT name="Coption" project="ptsCoptionUser" class="CCoption">
                <WTCONDITION expr="NoErrors"/>
                <WTMETHOD name="FetchCompany">
                  <WTPARAM name="CompanyID" direction="input" value="SYS(CompanyID)"/>
                </WTMETHOD>
                <WTMETHOD name="Load">
                  <WTPARAM name="CoptionID" direction="input" value="ATTR(CoptionID)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <!-- SETUP GOOGLE ANALYTICS FOR THE COMPANY-->
                <WTCODEGROUP>
                  <WTCUSTOM>
                    aGA = Split(.GAAcct, ",")
                    If UBOUND(aGA) = 1 Then
                    tmpID = aGA(0)
                    tmpDomain = aGA(1)
                    If tmpID &lt;&gt; "" And tmpDomain &lt;&gt; "" Then
                    SetCache "GA_ACCTID", tmpID
                    SetCache "GA_DOMAIN", tmpDomain
                    End If
                    End If
                  </WTCUSTOM>
                </WTCODEGROUP>
                <WTSETCACHE name="IDENTIFY" value="ATTR(Identify)"/>
                <!--									<WTSETATTRIBUTE name="SYS(NAVBARIMAGE)" value="ATTR(MenuBarColor)"/>-->
                <WTSETCACHE name="SYS(NAVBARIMAGE)" value="SYS(NAVBARIMAGE)"/>
                <WTSETATTRIBUTE name="CONST(tmpIPLimit)" value="ATTR(IPLimit)"/>
                <WTSETATTRIBUTE name="CONST(tmpIPLimit)" value="CONST(6)">
                  <WTCONDITION expr="CONST(tmpIPLimit)" oper="equal" value="CONST(0)"/>
                </WTSETATTRIBUTE>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(0)"/>
                  <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(FreeOptions)"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(1)"/>
                  <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options)"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(2)"/>
                  <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options2)"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(3)"/>
                  <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options3)"/>
                </WTCODEGROUP>

                <!-- Get the Users Options -->
                <WTCALLSUB name="reqSysUserOptions = GetUserOptions(reqSysUserOptions, MemberOptions)"/>

                <!-- If we are in Easy Mode, Get the Easy Options for this user -->
                <!--
									  <WTCODEGROUP>
										  <WTCONDITION expr="IsEasy"/>
										  <WTCONDITION expr="IsEasyMode" connector="and"/>
										  <WTSETCACHE name="SYS(MenuBarState)" value="ATTR(MenuEasy)"/>
										  <WTCALLSUB name="reqSysUserOptions = GetEasyOptions(reqSysUserOptions, .EasyOptions)"/>
									  </WTCODEGROUP>
  -->
                <WTSETCACHE name="SYS(UserOptions)" value="SYS(UserOptions)"/>
              </WTOBJECT>
              <!-- Get Team Membership Level Options -->
              <WTOBJECT name="Moption" project="ptsMoptionUser" class="CMoption">
                <WTCONDITION expr="NoErrors"/>
                <WTCONDITION expr="CONST(tmpGroupID)" oper="not-equal" value="CONST(0)" connector="and"/>
                <WTMETHOD name="FetchMember">
                  <WTPARAM name="MemberID" direction="input" value="CONST(tmpGroupID)"/>
                </WTMETHOD>
                <WTCODEGROUP>
                  <WTCONDITION expr="ATTR(MoptionID)" oper="not-equal" value="CONST(0)"/>
                  <WTMETHOD name="Load">
                    <WTPARAM name="MoptionID" direction="input" value="ATTR(MoptionID)"/>
                    <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                  </WTMETHOD>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(0)"/>
                    <WTCONDITION expr="ATTR(Options0)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
                    <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options0)"/>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(1)"/>
                    <WTCONDITION expr="ATTR(Options1)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
                    <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options1)"/>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(2)"/>
                    <WTCONDITION expr="ATTR(Options2)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
                    <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options2)"/>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(3)"/>
                    <WTCONDITION expr="ATTR(Options3)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
                    <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options3)"/>
                  </WTCODEGROUP>
                  <!-- Get the Users Options -->
                  <WTCALLSUB name="reqSysUserOptions = GetUserOptions(reqSysUserOptions, MemberOptions)"/>
                  <WTSETCACHE name="SYS(UserOptions)" value="SYS(UserOptions)"/>
                </WTCODEGROUP>
              </WTOBJECT>

              <WTCODEGROUP>
                <WTCONDITION expr="NoErrors"/>
                <!-- Get User's IP Address and truncate the last part -->
                <WTCUSTOM>
                  IPLevel = 3
                  If Left(tmpAccessLimit, 4) = "IPL:" Then
                  If IsNumeric(Mid(tmpAccessLimit, 5, 1)) Then
                  x = Mid(tmpAccessLimit, 5, 1)
                  If x &gt;= 1 And x &lt;= 4 Then IPLevel = x
                  End If
                  End If
                  UserIP = Request.ServerVariables("REMOTE_ADDR")
                  If IPLevel = 4 Then
                  tmpIP = UserIP
                  Else
                  x = 0
                  For z = 1 To IPLevel
                  x = InStr(x + 1, UserIP, ".")
                  Next
                  If x &gt; 0 Then tmpIP = Left(UserIP, x)
                  End If
                </WTCUSTOM>
                <!-- Check the Member's logon IP locations -->
                <!-- Unless the member's access limitation is NONE or it is a DEMO company  -->
                <WTOBJECT name="AuthLog" project="ptsAuthLogUser" class="CAuthLog">
                  <WTCONDITION expr="CONST(tmpAccessLimit)" oper="not-equal" value="CONST(&quot;NONE&quot;)"/>
                  <WTCONDITION expr="CONST(tmpCompanyStatus)" oper="not-equal" value="SYSCON(COMPANY-DEMO)" connector="and"/>
                  <WTMETHOD name="LogAuthUser">
                    <WTPARAM name="AuthUserID" direction="input" value="SYS(userid)"/>
                    <WTPARAM name="IP" direction="input" value="CONST(tmpIP)"/>
                    <WTPARAM name="Total" direction="input" value="CONST(tmpIPLimit)"/>
                    <WTPARAM name="result" direction="return" datatype="number"/>
                  </WTMETHOD>
                  <!-- Display Access Disallowed message if IP address has been disabled -->
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(result)" oper="equal" value="CONST(-1)"/>
                    <WTERROR number="-2147220515" message="Oops, Your access to the system has been disallowed - IP Address Denied.{&quot; + UserIP + &quot;}"/>
                    <WTCALLSUB name="ClearUser"/>
                  </WTCODEGROUP>
                  <!-- Display Access Disallowed message if too many IP addresses -->
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(result)" oper="greater" value="CONST(1)"/>
                    <WTERROR number="-2147220516" message="Oops, Your access to the system has been disallowed - Too Many IP Addresses.{&quot; + UserIP + &quot;}[&quot; + CStr(result) + &quot;]"/>
                    <WTCALLSUB name="ClearUser"/>
                  </WTCODEGROUP>
                </WTOBJECT>
                <!-- Check if the Member's access has been limited -->
                <!-- Unless the member's access limitation is NONE or it is a DEMO company  -->
                <WTCODEGROUP>
                  <WTCONDITION expr="NoErrors"/>
                  <WTCONDITION expr="CONST(tmpAccessLimit)" oper="not-equal" value="CONST(&quot;NONE&quot;)" connector="and"/>
                  <WTCONDITION expr="CONST(tmpCompanyStatus)" oper="not-equal" value="SYSCON(COMPANY-DEMO)" connector="and"/>
                  <WTCALLSUB name="tmpAccess = LimitedAccess( tmpAccessLimit )"/>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpAccess)" oper="not-equal" value="SYSCON(ACCESS-GRANTED)"/>
                    <WTERROR number="-2147220514" message="Oops, Your access to the system has been limited - Access Denied."/>
                    <WTCALLSUB name="ClearUser"/>
                  </WTCODEGROUP>
                </WTCODEGROUP>
                <!-- If no errors so far AND the member's status is Active, Trail, or Certify -->
                <!-- Save the current timestamp as the member's last visit date -->
                <WTCODEGROUP>
                  <WTCONDITION expr="NoErrors"/>
                  <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
                    <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-PAID)"/>
                    <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-TRIAL)" connector="or"/>
                    <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-FREE)" connector="or"/>
                    <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-INACTIVE)" connector="or"/>
                    <WTMETHOD name="Load">
                      <WTPARAM name="MemberID" direction="input" value="SYS(memberid)"/>
                      <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                    </WTMETHOD>
                    <WTSETATTRIBUTE name="ATTR(VisitDate)" value="SYS(Now)"/>
                    <WTMETHOD name="Save">
                      <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                    </WTMETHOD>
                  </WTOBJECT>
                  <!-- set all the member's options for pages and training buddy image -->
                  <WTCALLSUB name="SetMemberOptions reqSysMemberID, reqSysCompanyID, reqSysLanguage"/>
                  <!-- if this member can be upgraded -->
                  <!--
										  <WTCODEGROUP>
									  		  <WTCONDITION expr="CONST(tmpUpgrade)" oper="not-equal" value="CONST(&quot;&quot;)"/>
											  <WTRETURN>
										  		  <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-TRIAL)"/>
										  		  <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-FREE)" connector="or"/>
										  		  <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-INACTIVE)" connector="or"/>
												  <WTLINK name="0419" return="false"><WTPARAM name="CompanyID" value="SYS(CompanyID)"/></WTLINK>
											  </WTRETURN>
										  </WTCODEGROUP>
  -->
                  <!-- Otherwise, if access is granted, go to the member home Page -->
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpAccess)" oper="equal" value="SYSCON(ACCESS-GRANTED)"/>
                    <!--											<WTGETCOOKIE name="CONST(tmpNoIntro)" value="CONST(NoIntro)"/>-->

                    <WTCUSTOM>
                      tmpIP = Request.ServerVariables("REMOTE_ADDR")
                    </WTCUSTOM>
                    <WTHTTP>
                      <WTLINK name="0418">
                        <WTPARAM name="MemberID" value="SYS(MemberID)"/>
                        <WTPARAM name="Notify" value="SYSCON(NOTIFYMENTOR-SIGNIN)"/>
                        <WTPARAM name="IP" value="CONST(tmpIP)"/>
                      </WTLINK>
                    </WTHTTP>

                    <WTCODEGROUP>
                      <!--										  		<WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(582)"/> -->
                      <!--										  		<WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(1)"/>-->
                      <!--
										  		  <WTCONDITION expr="CONST(tmpBilling)" oper="equal" value="CONST(3)"/>
										  		  <WTCONDITION expr="CONST(tmpBillingID)" oper="equal" value="CONST(0)" connector="and"/>
												  <WTRETURN>
													  <WTLINK name="2902a" return="false"/>
												  </WTRETURN>
  -->
                    </WTCODEGROUP>

                    <WTCODEGROUP>
                      <WTCONDITION expr="PARAM(Page)" oper="not-equal" value="CONST(&quot;&quot;)"/>
                      <WTCUSTOM>
                        reqPage = Replace( reqPage, "{id}", CStr(reqSysMemberID))
                        reqPage = Replace( reqPage, "%26", "&amp;")
                        Response.Redirect reqPage
                      </WTCUSTOM>
                    </WTCODEGROUP>
                    
                    <WTCODEGROUP>
                      <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="SYSCON(GCR)"/>
                      <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="SYSCON(NEXXUS)" connector="or"/>
                      <WTCALLSUB name="AccessNotice lgn, UserEmail "/>
                    </WTCODEGROUP>

                    <!--
											  <WTRETURN>
												  <WTCONDITION expr="IsJumpStart"/>
												  <WTCONDITION expr="NotSkipJumpStart" connector="and"/>
												  <WTLINK name="0420" return="false"/>
											  </WTRETURN>
											  <WTSETCOOKIE name="CONST(NoIntro)" value="CONST(&quot;1&quot;)"/>
  -->
                    <WTRETURN>
                      <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(12)"/>
                      <WTLINK name="13210" secure="false" return="false"/>
                    </WTRETURN>
                    <WTCODEGROUP>
                      <WTCONDITION expr="SYS(CompanyID)" oper="greater-equal" value="CONST(7)"/>
                      <WTSETATTRIBUTE name="CONST(tmpMobile)" value="CONST(IsMobileBrowser())"/>
                      <WTRETURN>
                        <WTCONDITION expr="CONST(tmpMobile)" oper="equal" value="CONST(0)"/>
                        <WTLINK name="MemberHome" secure="false" return="false"/>
                      </WTRETURN>
                      <WTRETURN>
                        <WTCONDITION expr="CONST(tmpMobile)" oper="not-equal" value="CONST(0)"/>
                        <WTLINK name="m_MemberHome" secure="false" return="false"/>
                      </WTRETURN>
                    </WTCODEGROUP>
                    <WTRETURN>
                      <WTLINK name="0404" secure="false" return="false"/>
                    </WTRETURN>
                  </WTCODEGROUP>
                </WTCODEGROUP>
              </WTCODEGROUP>
            </WTCODEGROUP>
          </WTCODEGROUP>
        </WTOBJECT>
        <WTOBJECT name="Business" project="ptsBusinessUser" class="CBusiness">
          <WTCONDITION expr="PARAM(ContactInfo)" oper="equal" value="SYSCON(YES)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="BusinessID" direction="input" value="CONST(1)"/>
            <WTPARAM name="SecurityToken" direction="input" value="CONST(1)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlBusiness" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTACTION id="0" name="New" type="New" >
        <WTCALLSUB name="SignIn reqLgn, reqPwd">
          <WTCONDITION expr="PARAM(Lgn)" oper="not-equal" value="CONST(&quot;&quot;)"/>
          <WTCONDITION expr="PARAM(R)" oper="not-equal" value="CONST(&quot;&quot;)" connector="or"/>
        </WTCALLSUB>
        <WTGETCOOKIE name="PARAM(Lgn)" value="CONST(LGN)"/>
        <WTGETCOOKIE name="PARAM(Pwd)" value="CONST(PWD)"/>
        <WTSETATTRIBUTE name="PARAM(Remember)" value="CONST(1)">
          <WTCONDITION expr="PARAM(Lgn)" oper="not-equal" value="CONST(&quot;&quot;)"/>
        </WTSETATTRIBUTE>
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="CONST(1)"/>
          <WTSETATTRIBUTE name="ATTR(Logon)" value="PARAM(Lgn)"/>
          <WTSETATTRIBUTE name="ATTR(Password)" value="PARAM(Pwd)"/>
          <WTSETATTRIBUTE name="SYS(userid)" value="CONST(99)"/>
          <WTSETATTRIBUTE name="SYS(usergroup)" value="CONST(99)"/>
          <WTSETATTRIBUTE name="SYS(userstatus)" value="CONST(1)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTACTION>

      <WTACTION id="1" name="SignIn" type="SignIn">
        <WTSETATTRIBUTE name="CONST(tmpLgn)" value="FORM(Logon)"/>
        <WTSETATTRIBUTE name="CONST(tmpPwd)" value="FORM(Password)"/>
        <WTSETATTRIBUTE name="CONST(tmpRemember)" value="FORM(Remember)"/>
        <WTCODEGROUP>
          <WTCONDITION expr="CONST(tmpRemember)" oper="equal" value="CONST(&quot;1&quot;)"/>
          <WTSETCOOKIE name="CONST(LGN)" value="CONST(tmpLgn)"/>
          <WTSETCOOKIE name="CONST(PWD)" value="CONST(tmpPwd)"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="CONST(tmpRemember)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTSETCOOKIE name="CONST(LGN)" value="CONST(&quot;&quot;)"/>
          <WTSETCOOKIE name="CONST(PWD)" value="CONST(&quot;&quot;)"/>
        </WTCODEGROUP>
        <WTCALLSUB name="SignIn tmpLgn, tmpPwd"/>
      </WTACTION>

      <WTACTION id="9" name="SignOut" type="SignOut">
        <WTCALLSUB name="ClearUser"/>
        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
          <WTLINK name="0000"/>
        </WTRETURN>
      </WTACTION>

      <!--*************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="310" align="right"/>
        <WTCOLUMN width="440" align="left"/>

        <WTSTATIC label="IsOverride2FA"/>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="SignIn" class="PageHeading"/>
<!--
          <WTLINKGROUP col="2" align="right">
            <WTCONDITION expr="PARAM(AuthyID)" oper="equal" value="CONST(0)"/>
            <WTCONDITION expr="PARAM(UserKey)" oper="equal" value="CONST('')" connector="and"/>
            <WTLINK name="0102" label="SignInHelp"/>
          </WTLINKGROUP>
-->          
        </WTROW>
        
        <WTROW>
          <WTSTATIC col="1" merge="2" align="right">
            <WTCODEGROUP>
              <WTTRANSLATE/>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>
        <WTROW margin-bottom="12" margin-top="2">
          <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(AuthyID)" oper="equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(UserKey)" oper="equal" value="CONST('')" connector="and"/>
          <WTROW>
            <WTSTATIC col="1" tag="Logon"/>
            <WTTEXT col="2"  value="ATTR(AuthUser.Logon)" size="20"/>
          </WTROW>
          <WTROW>
            <WTSTATIC col="1" tag="Password"/>
            <WTTEXT col="2" value="ATTR(AuthUser.Password)" size="20"/>
          </WTROW>
          <WTROW>
            <WTSTATIC col="1"/>
            <WTCHECK col="2" value="PARAM(Remember)" label="Remember"/>
          </WTROW>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(AuthyID)" oper="not-equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(UserKey)" oper="not-equal" value="CONST('')" connector="or"/>
          <WTROW>
            <WTHIDDEN  value="ATTR(AuthUser.Logon)"/>
            <WTHIDDEN  value="ATTR(AuthUser.Password)"/>
            <WTHIDDEN  value="PARAM(Remember)"/>
          </WTROW>
          <WTROW>
            <WTSTATIC col="1" tag="Token"/>
            <WTTEXT col="2" value="PARAM(SecurityCode)" size="10"/>
          </WTROW>
<!--
          <WTROW margin-top="12">
            <WTSTATIC col="1" merge="2" align="center">
              <WTCODEGROUP>
                <WTCHECK value="PARAM(IsOverride2FA)"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
-->          
        </WTCODEGROUP>

        <WTROW margin-top="12" margin-bottom="12">
          <WTBUTTON col="1" merge="2" action="1" value="CONST(SignIn)" align="center" default="true"/>
        </WTROW>
<!--
        <WTROW margin-bottom="12">
          <WTCONDITION expr="PARAM(AuthyID)" oper="equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(UserKey)" oper="equal" value="CONST('')" connector="and"/>
          <WTLINKGROUP col="1" merge="2" align="center">
            <WTLINK name="0102" label="TroubleSigningInClickhereforhelp"/>
          </WTLINKGROUP>
        </WTROW>
-->        
      </WTCONTENT>
    </WTWEBPAGE>


    <!--==================================================================================================-->
    <WTWEBPAGE name="m_0101" caption="Sign In" page-left="0" page-top="0" navbar="false" header="false" footer="false" wrapper="false"
			page-width="100%" margin-width="0" navbar-width="0" content-width="100%" focus="false" viewport="width=device-width"
		    aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" checksecurity="false">
      <!--==================================================================================================-->
      <WTPARAM name="Lgn" datatype="text"/>
      <WTPARAM name="Pwd" datatype="text"/>
      <WTPARAM name="C" datatype="number"/>
      <!-- CompanyID -->
      <WTPARAM name="R" datatype="text"/>
      <!-- Member Reference -->
      <WTPARAM name="E" datatype="text"/>
      <!-- Encripted Member Reference -->
      <WTPARAM name="A" datatype="number"/>
      <!-- AuthUserID -->
      <WTPARAM name="G" datatype="number"/>
      <!-- GroupID -->
      <WTPARAM name="ContactInfo" datatype="number"/>
      <WTPARAM name="Remember" datatype="number"/>
      <WTPARAM name="Page" datatype="text" url="true"/>
      <WTPARAM name="CompanyID" datatype="number"/>
      <!--			<WTPARAM name="Browser" datatype="text"/>-->
      <WTPARAM name="AuthyID" datatype="number"/>
      <WTPARAM name="UserKey" datatype="text"/>
      <WTPARAM name="SecurityCode" datatype="text"/>
      <WTPARAM name="IsOverride2FA" datatype="number"/>
      <WTPARAM name="AccessStatus" datatype="number"/>

      <WTINCLUDE name="LimitedAccess.asp"/>
      <WTINCLUDE name="MemberOptions.asp"/>
      <WTINCLUDE name="CompanyHeader.asp"/>
      <WTINCLUDE name="Company.asp" />
      <WTINCLUDE name="Encript.asp"/>
      <WTINCLUDE name="Resources.asp"/>
      <WTINCLUDE name="Authy.asp"/>
      <WTINCLUDE name="Google2FA.asp"/>
      <WTINCLUDE name="Comm.asp"/>
      <WTINCLUDE name="IP.asp"/>
      <WTINCLUDE name="MobileBrowser.asp"/>
      <!--			<WTINCLUDE name="BrowserClass.asp"/>-->
      <WTLOG name="Member" value="SYS(memberid)"/>
      <!--
			<WTCODEGROUP>
<WTCUSTOM>
BrowserName    = browser.getName
BrowserVersion = browser.getVersion
BrowserOS      = browser.getOS 
If BrowserName &lt;&gt; "ie" OR CDbl(BrowserVersion) &lt; 5.5 OR BrowserOS &lt;&gt; "win" Then
	reqBrowser = "&lt;B&gt;This system requires Internet Explorer version 5.5 or higher" 	
	reqBrowser = reqBrowser + "&lt;BR&gt;running on the Windows Operating System.&lt;/B&gt;" 	
	reqBrowser = reqBrowser + "&lt;BR&gt;&lt;BR&gt;Your Browser is: &lt;B&gt;" + browser.getFullName + "&lt;/B&gt;" 
	reqBrowser = reqBrowser + "&lt;BR&gt;Your Browser version is: &lt;B&gt;" + BrowserVersion + "&lt;/B&gt;" 
	reqBrowser = reqBrowser + "&lt;BR&gt;Your Computer Operating System is: &lt;B&gt;" + browser.getFullOS + "&lt;/B&gt;" 
	reqBrowser = reqBrowser + "&lt;BR&gt;&lt;BR&gt;You may experience difficulties if you proceed." 
End If
</WTCUSTOM>
			</WTCODEGROUP>
-->
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(G)" oper="equal" value="CONST(0)" />
        <WTGETCACHE name="PARAM(G)" value="G" datatype="number"/>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(E)" oper="not-equal" value="CONST(&quot;&quot;)"/>
        <WTCUSTOM>
          reqR = Decript(reqE)
        </WTCUSTOM>
      </WTCODEGROUP>
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
        <WTCONDITION expr="PARAM(C)" oper="not-equal" value="CONST(0)" connector="and"/>
        <WTSETATTRIBUTE name="PARAM(CompanyID)" value="PARAM(C)"/>
      </WTCODEGROUP>
      <!--
			<WTCODEGROUP>
				<WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(0)"/>
				<WTSETATTRIBUTE name="SYS(CompanyID)" value="PARAM(CompanyID)"/>
				<WTSETCACHE name="SYS(CompanyID)" value="SYS(CompanyID)"/>
			</WTCODEGROUP>
-->
      <WTCODEGROUP>
        <WTCONDITION expr="PARAM(CompanyID)" oper="not-equal" value="CONST(0)" />
        <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(0)" connector="and"/>
        <WTCALLSUB name="GetCompany(reqCompanyID)" />
        <!-- Set Group Header -->
        <WTCALLSUB name="SetCompanyGrpHeader reqCompanyID, reqG, reqSysLanguage">
          <WTCONDITION expr="PARAM(G)" oper="not-equal" value="CONST(0)"/>
        </WTCALLSUB>
      </WTCODEGROUP>

      <WTSUB function="AccessNotice( lgn, email )">
        <WTCODEGROUP>
          <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="SYS(CompanyID)" value="SYSCON(NEXXUS)"/>
        </WTCODEGROUP>
        <WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
          <WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(&quot;access.htm&quot;)"/>
          <WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\Company/&quot; + CStr(reqSysCompanyID))"/>
          <WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)"/>
          <WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)"/>
          <WTMETHOD name="Load"/>
          <WTSETATTRIBUTE name="CONST(tmpBody)" value="ATTR(Data)"/>
        </WTOBJECT>
        <WTCUSTOM>
          If reqAccessStatus = 0 Then tmp2FA = "Disabled"
          If reqAccessStatus = 1 Then tmp2FA = "Enabled"
          If reqAccessStatus = 2 Then tmp2FA = "Override"
          UserName = GetCache("USERNAME")
          IP = Request.ServerVariables("REMOTE_ADDR")
          Browser = Request.ServerVariables("HTTP_USER_AGENT")
          tmpLocation = GetIPCity( IP )
          tmpTime = Now()

          tmpBody = Replace( tmpBody, "{username}", lgn + " - " + UserName )
          tmpBody = Replace( tmpBody, "{time}", tmpTime )
          tmpBody = Replace( tmpBody, "{ip}", IP + " - " + tmpLocation )
          tmpBody = Replace( tmpBody, "{browser}", Browser )
          tmpBody = Replace( tmpBody, "{2fa}", tmp2FA )

          tmpTo = email
          tmpFrom = "app-events@pinnaclep.com"
          If reqSysCompanyID = 17 Then
          tmpFrom = "support@gcrmarketing.com"
          tmpSubject = "GCR - Successful login notification " + CStr(tmpTime)
          End If
          If reqSysCompanyID = 21 Then
          tmpFrom = "support@nexxusuniversity.com"
          tmpSubject = "Nexxus - Successful login notification " + CStr(tmpTime)
          End If
          tmpSender = tmpFrom
          SendEmail company, tmpSender, tmpFrom, tmpTo, "", "", tmpSubject, tmpBody
        </WTCUSTOM>
      </WTSUB>

      <WTSUB name="NotifySystem">
        <WTCUSTOM>
          tmpTo = "app-events@pinnaclep.com"
          tmpSender = tmpTo
          tmpFrom = tmpTo
          tmpBody = ""
          IP = Request.ServerVariables("REMOTE_ADDR")
          tmpLocation = GetIPCity( IP )
          If reqSysUserGroup = 1 Then tmpSubject = "LOGIN SYSADMIN: "
          If reqSysUserGroup &gt;= 21 And reqSysUserGroup &lt;= 23 Then tmpSubject = "LOGIN EMPLOYEE: "
          If reqSysUserGroup &gt;= 51 And reqSysUserGroup &lt;= 52 Then tmpSubject = "LOGIN ADMIN: "
          tmpSubject = tmpSubject + " " + CStr(reqSysUserID) + " - " + reqSysUserName + " - " + CSTR(reqSysCompanyID) + " - " + IP + " - " + tmpLocation
          '          SendEmail reqSysCompanyID, tmpSender, tmpFrom, tmpTo, "", "", tmpSubject, tmpBody
          'HACKER TEST
          Target = "85.253.66.46,90.191.167.100,88.196.236.75,121.54.58.242,121.54.58.246,119.81.230.137,119.81.230.132"
          If InStr( Target, IP ) > 0 Then
          tmpTo = "bobwood56@gmail.com"
          tmpSubject = "HACKER ALERT: " + tmpSubject
          SendEmail reqSysCompanyID, tmpSender, tmpFrom, tmpTo, "", "", tmpSubject, tmpBody
          End If
        </WTCUSTOM>
      </WTSUB>

      <WTSUB function="LogLogin(msg,lgn)">
        <WTCUSTOM>
          UserID = Numeric(GetCache("USERID"))
          MemberID = Numeric(GetCache("MEMBERID"))
          CompanyID = Numeric(GetCache("COMPANYID"))
          UserName = GetCache("USERNAME")
          good = ""
          If msg = "GOOD" Then good = " - " + CStr(UserID) + "/" + CStr(MemberID) + " - " + UserName
          str = lgn + " - " + CStr(CompanyID)
          LogFile "Login", msg + ": " + str + good
        </WTCUSTOM>
      </WTSUB>

      <WTSUB name="ClearUser">
        <WTSETCACHE name="SYS(userid)" value="CONST(99)"/>
        <WTSETCACHE name="SYS(usergroup)" value="CONST(99)"/>
        <WTSETCACHE name="SYS(userstatus)" value="CONST(1)"/>
        <WTSETCACHE name="SYS(username)" value="CONST(&quot;&quot;)"/>
        <WTSETCACHE name="SYS(trainerid)" value="CONST(0)"/>
        <WTSETCACHE name="SYS(employeeid)" value="CONST(0)"/>
        <WTSETCACHE name="SYS(orgid)" value="CONST(0)"/>
        <WTSETCACHE name="SYS(affiliateid)" value="CONST(0)"/>
        <WTSETCACHE name="SYS(memberid)" value="CONST(0)"/>
        <WTSETCACHE name="SYS(signinurl)" value="CONST(&quot;&quot;)"/>
        <WTSETCACHE name="SECURITYLEVEL" value="CONST(0)"/>
        <WTSETCACHE name="SYS(Options)" value="CONST(&quot;&quot;)"/>
        <WTSETCACHE name="SYS(MenuBarState)" value="CONST(&quot;&quot;)"/>
      </WTSUB>

      <WTSUB function="SignIn(lgn,pwd)">
        <WTSETATTRIBUTE name="CONST(tmpAuthUserID)" value="CONST(1)"/>
        <WTSETATTRIBUTE name="CONST(tmpAuthUserID)" value="PARAM(A)">
          <WTCONDITION expr="PARAM(A)" oper="not-equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
        <!-- If a Member Reference was passed in get the Member's AuthUserID -->
        <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
          <WTCONDITION expr="PARAM(C)" oper="not-equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(R)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
          <WTMETHOD name="FetchRef">
            <WTPARAM name="CompanyID" direction="input" value="PARAM(C)"/>
            <WTPARAM name="Reference" direction="input" value="PARAM(R)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="CONST(tmpAuthUserID)" value="ATTR(AuthUserID)"/>
        </WTOBJECT>
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETCACHE name="SECURITYLEVEL" value="CONST(0)"/>
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="CONST(tmpAuthUserID)"/>
          <WTSETATTRIBUTE name="ATTR(Logon)" value="CONST(lgn)"/>
          <WTSETATTRIBUTE name="ATTR(Password)" value="CONST(pwd)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
          <!-- If we only have a logon and password, signin the user -->
          <WTMETHOD name="SignIn">
            <WTCONDITION expr="CONST(tmpAuthUserID)" oper="equal" value="CONST(1)"/>
          </WTMETHOD>
          <!-- If a Member's AuthUserID was retrieved, fetch the AuthUser info -->
          <WTMETHOD name="Load">
            <WTCONDITION expr="CONST(tmpAuthUserID)" oper="not-equal" value="CONST(1)"/>
            <WTPARAM name="SecurityToken" direction="input" value="CONST(1)"/>
          </WTMETHOD>
          <WTCODEGROUP>
            <WTCONDITION expr="ATTR(AuthUserID)" oper="equal" value="CONST(0)"/>
            <WTERROR number="-2147220504" message="Oops, Either your logon ID or password is incorrect."/>
            <WTCALLSUB name="LogLogin &quot;BAD&quot;, lgn"/>
            <WTCALLSUB name="ClearUser"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="ATTR(UserStatus)" oper="equal" value="SYSCON(USERSTATUS-INACTIVE)"/>
            <WTERROR number="-2147220505" message="Oops, The logon ID you entered has been disabled."/>
            <WTCALLSUB name="LogLogin &quot;DISABLED&quot;, lgn "/>
            <WTCALLSUB name="ClearUser"/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTSETCACHE name="UC" value="ATTR(UserCode)"/>
            <WTSETATTRIBUTE name="CONST(tmpLoginLogged)" value="CONST(0)"/>
            <!-- PROCESS 2FA SECURITY-->
            <WTSETATTRIBUTE name="PARAM(AuthyID)" value="ATTR(AuthUser.UserType)"/>
            <WTSETATTRIBUTE name="PARAM(UserKey)" value="ATTR(AuthUser.UserKey)"/>
            <WTSETATTRIBUTE name="PARAM(AuthyID)" value="CONST(0)">
              <WTCONDITION expr="PARAM(UserKey)" oper="not-equal" value="CONST(&quot;&quot;)"/>
            </WTSETATTRIBUTE>
            <WTSETCACHE name="O2FA" value="CONST(0)"/>
            <WTCODEGROUP>
              <WTCONDITION expr="ATTR(AuthUser.UserGroup)" oper="equal" value="CONST(41)"/>
              <WTCONDITION expr="PARAM(IsOverride2FA)" oper="not-equal" value="SYSCON(NO)" connector="and"/>
              <WTSETCACHE name="O2FA" value="CONST(1)"/>
              <WTSETATTRIBUTE name="PARAM(AuthyID)" value="CONST(0)"/>
              <WTSETATTRIBUTE name="PARAM(UserKey)" value="CONST(&quot;&quot;)"/>
              <WTSETATTRIBUTE name="PARAM(SecurityCode)" value="CONST(&quot;&quot;)"/>
              <WTSETATTRIBUTE name="PARAM(AccessStatus)" value="CONST(2)"/>
            </WTCODEGROUP>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCONDITION expr="PARAM(SecurityCode)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
            <!--VERIFY AUTHY SECURITY CODE -->
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(AuthyID)" oper="not-equal" value="CONST(0)"/>
              <WTCUSTOM>
                Verify = VerifyAuthyUser( reqAuthyID, reqSecurityCode )
                If Verify = "1" Then
                reqAuthyID = 0
                reqAccessStatus = 1
                tmpLoginLogged = 1
                LogLogin "GOOD2FA-A", lgn
                Else
                reqSecurityCode = ""
                LogLogin "BAD2FA-A", lgn
                DoError 10138, "", "Oops, Invalid Security Code"
                End If
              </WTCUSTOM>
            </WTCODEGROUP>
            <!--VERIFY GOOGLE AUTHENTICATOR SECURITY CODE -->
            <WTCODEGROUP>
              <WTCONDITION expr="PARAM(UserKey)" oper="not-equal" value="CONST(&quot;&quot;)"/>
              <WTCUSTOM>
                If Verify2FAUser( reqUserKey, reqSecurityCode ) Then
                reqUserKey = ""
                reqAccessStatus = 1
                tmpLoginLogged = 1
                LogLogin "GOOD2FA-G", lgn
                Else
                reqSecurityCode = ""
                LogLogin "BAD2FA-G", lgn
                DoError 10138, "", "Oops, Invalid Security Code"
                End If
              </WTCUSTOM>
            </WTCODEGROUP>
          </WTCODEGROUP>

          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCONDITION expr="PARAM(AuthyID)" oper="equal" value="CONST(0)" connector="and"/>
            <WTCONDITION expr="PARAM(UserKey)" oper="equal" value="CONST(&quot;&quot;)" connector="and"/>

            <WTSETATTRIBUTE name="SYS(userid)" value="ATTR(AuthUser.AuthUserID)"/>
            <WTSETCACHE name="SYS(userid)" value="SYS(userid)"/>
            <!--            <WTSETCACHE name="usertype" value="ATTR(AuthUser.UserType)"/>-->
            <WTSETATTRIBUTE name="SYS(usergroup)" value="ATTR(AuthUser.UserGroup)"/>
            <WTSETCACHE name="SYS(usergroup)" value="SYS(usergroup)"/>
            <WTSETATTRIBUTE name="SYS(userstatus)" value="ATTR(AuthUser.UserStatus)"/>
            <WTSETCACHE name="SYS(userstatus)" value="SYS(userstatus)"/>
            <WTSETATTRIBUTE name="SYS(username)" value="ATTR(AuthUser.AuthUserName)"/>
            <WTSETCACHE name="SYS(username)" value="SYS(username)"/>
            <WTSETATTRIBUTE name="SYS(trainerid)" value="ATTR(AuthUser.TrainerID)"/>
            <WTSETCACHE name="SYS(trainerid)" value="SYS(trainerid)"/>
            <WTSETATTRIBUTE name="SYS(employeeid)" value="ATTR(AuthUser.EmployeeID)"/>
            <WTSETCACHE name="SYS(employeeid)" value="SYS(employeeid)"/>
            <WTSETATTRIBUTE name="SYS(memberid)" value="ATTR(AuthUser.MemberID)"/>
            <WTSETCACHE name="SYS(memberid)" value="SYS(memberid)"/>
            <WTSETATTRIBUTE name="SYS(orgid)" value="ATTR(AuthUser.OrgID)"/>
            <WTSETCACHE name="SYS(orgid)" value="SYS(orgid)"/>
            <WTSETATTRIBUTE name="SYS(affiliateid)" value="ATTR(AuthUser.AffiliateID)"/>
            <WTSETCACHE name="SYS(affiliateid)" value="SYS(affiliateid)"/>
            <!-- SECURITY CHECK FOR ACCESS ERROR (AE)-->
            <WTSETCACHE name="AE" value="SYS(usergroup)"/>

            <WTSETATTRIBUTE name="CONST(UserEmail)" value="ATTR(AuthUser.Email)"/>

            <WTCALLSUB name="LogLogin &quot;GOOD&quot;, lgn ">
              <WTCONDITION expr="CONST(tmpLoginLogged)" oper="equal" value="CONST(0)"/>
            </WTCALLSUB>

            <WTCODEGROUP>
              <WTCONDITION expr="IsEmployee"/>
              <WTCONDITION expr="IsTranslatorOnly" connector="or"/>
              <WTCALLSUB name="NotifySystem"/>
              <WTSETCACHE name="CONST(EMEMBERID)" value="CONST(Encript(CStr(reqSysMemberID)))"/>
              <WTSETATTRIBUTE name="SYS(CompanyID)" value="CONST(0)"/>
              <WTSETCACHE name="SYS(CompanyID)" value="SYS(CompanyID)"/>
              <WTSETATTRIBUTE name="SYS(NAVBARIMAGE)" value="CONST(&quot;&quot;)"/>
              <WTSETCACHE name="SYS(NAVBARIMAGE)" value="SYS(NAVBARIMAGE)"/>
              <WTOBJECT name="Employee" project="ptsEmployeeUser" class="CEmployee">
                <WTMETHOD name="Load">
                  <WTPARAM name="EmployeeID" direction="input" value="SYS(Employeeid)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTCODEGROUP>
                  <WTSETATTRIBUTE name="SYS(memberid)" value="ATTR(MemberID)"/>
                  <WTSETCACHE name="SYS(memberid)" value="SYS(memberid)"/>
                </WTCODEGROUP>
              </WTOBJECT>
              <WTOBJECT name="Business" project="ptsBusinessUser" class="CBusiness">
                <WTMETHOD name="Load">
                  <WTPARAM name="BusinessID" direction="input" value="CONST(1)" />
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
                </WTMETHOD>
                <WTSETATTRIBUTE name="SYS(UserOptions)" value="CONST(&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890@#%()|\_+=./,[]{}&quot;)">
                  <WTCONDITION expr="IsSysAdmin"/>
                </WTSETATTRIBUTE>
                <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options1)">
                  <WTCONDITION expr="IsManagerOnly"/>
                </WTSETATTRIBUTE>
                <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options2)">
                  <WTCONDITION expr="IsAdminOnly"/>
                </WTSETATTRIBUTE>
                <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options3)">
                  <WTCONDITION expr="IsEmployeeOnly"/>
                </WTSETATTRIBUTE>
                <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options4)">
                  <WTCONDITION expr="IsTranslatorOnly"/>
                </WTSETATTRIBUTE>
                <WTSETCACHE name="SYS(UserOptions)" value="SYS(UserOptions)"/>
              </WTOBJECT>

              <WTCODEGROUP>
                <WTCALLSUB name="AccessNotice lgn, UserEmail "/>
              </WTCODEGROUP>

              <WTRETURN>
                <WTCONDITION expr="IsTranslatorOnly"/>
                <WTLINK name="0099" return="false"/>
              </WTRETURN>
              <WTRETURN>
                <WTCONDITION expr="IsEmployee"/>
                <WTLINK name="EmployeeHome" secure="false" return="false"/>
              </WTRETURN>
            </WTCODEGROUP>

            <WTCODEGROUP>
              <WTCONDITION expr="IsTrainerOnly"/>
              <!-- Set default menu bar state -->
              <WTSETCACHE name="SYS(MenuBarState)" value="CONST(&quot;0&quot;)"/>
              <WTRETURN>
                <WTLINK name="0305" return="false"/>
              </WTRETURN>
            </WTCODEGROUP>

            <WTCODEGROUP>
              <WTCONDITION expr="IsOrgAdminOnly"/>
              <WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
              <WTCALLSUB name="NotifySystem"/>
              <WTOBJECT name="Org" project="ptsOrgUser" class="COrg">
                <WTMETHOD name="Load">
                  <WTPARAM name="OrgID" direction="input" value="SYS(orgid)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTCODEGROUP>
                  <WTCONDITION expr="ATTR(CompanyID)" oper="not-equal" value="CONST(CSTR(reqSysCompanyID))"/>
                  <WTCUSTOM>AbortUser()</WTCUSTOM>
                </WTCODEGROUP>
                <WTSETATTRIBUTE name="SYS(CompanyID)" value="ATTR(CompanyID)"/>
                <WTSETATTRIBUTE name="CONST(tmpSecure)" value="ATTR(Org.Secure)"/>
                <WTSETATTRIBUTE name="CONST(tmpIP)" value="ATTR(Org.Description)"/>
                <WTSETCACHE name="SYS(CompanyID)" value="SYS(CompanyID)"/>
                <WTSETCACHE name="SECURITYLEVEL" value="ATTR(Org.Secure)"/>
                <WTSETCACHE name="SYS(MEMBERID)" value="ATTR(Org.MemberID)"/>
                <WTCODEGROUP>
                  <WTCONDITION expr="ATTR(Status)" oper="equal" value="CONST(4)"/>
                  <WTERROR number="10106" message="Oops, Your System is not available."/>
                  <WTCALLSUB name="ClearUser"/>
                </WTCODEGROUP>
                <WTSETATTRIBUTE name="CONST(UserIP)" value="CONST(Request.ServerVariables(&quot;REMOTE_ADDR&quot;))"/>
                <WTSETCACHE name="IPC" value="CONST(Mid(UserIP,5,1))"/>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpIP)" oper="not-equal" value="CONST(&quot;&quot;)"/>
                  <WTCUSTOM>
                    pos = InStr(tmpIP, ";")
                    If pos = 0 Then length = Len(tmpIP) Else length = pos - 1
                    subIP = Left(UserIP,length)
                    If InStr( tmpIP, subIP) = 0 Then AbortUser()
                  </WTCUSTOM>
                </WTCODEGROUP>
              </WTOBJECT>
              <WTOBJECT name="Coption" project="ptsCoptionUser" class="CCoption">
                <WTCONDITION expr="NoErrors"/>
                <WTMETHOD name="FetchCompany">
                  <WTPARAM name="CompanyID" direction="input" value="SYS(CompanyID)"/>
                </WTMETHOD>
                <WTMETHOD name="Load">
                  <WTPARAM name="CoptionID" direction="input" value="ATTR(CoptionID)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTCODEGROUP>
                  <WTCONDITION expr="IsOrgAdminOnly"/>
                  <WTSETCACHE name="SYS(UserOptions)" value="ATTR(Options4)"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="IsOrgManagerOnly"/>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpSecure)" oper="equal" value="CONST(0)"/>
                    <WTCONDITION expr="CONST(tmpSecure)" oper="equal" value="CONST(1)" connector="or"/>
                    <WTSETCACHE name="SYS(UserOptions)" value="ATTR(Options5)"/>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpSecure)" oper="equal" value="CONST(2)"/>
                    <WTSETCACHE name="SYS(UserOptions)" value="ATTR(Options6)"/>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpSecure)" oper="equal" value="CONST(3)"/>
                    <WTSETCACHE name="SYS(UserOptions)" value="ATTR(Options7)"/>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpSecure)" oper="equal" value="CONST(4)"/>
                    <WTSETCACHE name="SYS(UserOptions)" value="ATTR(Options8)"/>
                  </WTCODEGROUP>
                </WTCODEGROUP>
              </WTOBJECT>

              <WTCODEGROUP>
                <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="SYSCON(GCR)"/>
                <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="SYSCON(NEXXUS)" connector="or"/>
                <WTCALLSUB name="AccessNotice lgn, UserEmail "/>
              </WTCODEGROUP>

              <WTRETURN>
                <WTCONDITION expr="NoErrors"/>
                <WTLINK name="AdminHome" secure="false" return="false">
                  <WTPARAM name="CompanyID" value="SYS(CompanyID)"/>
                </WTLINK>
              </WTRETURN>
            </WTCODEGROUP>

            <WTCODEGROUP>
              <WTCONDITION expr="IsAffiliateOnly"/>
              <!-- Set default menu bar state -->
              <WTSETCACHE name="SYS(MenuBarState)" value="CONST(&quot;0&quot;)"/>
              <WTOBJECT name="Affiliate" project="ptsAffiliateUser" class="CAffiliate">
                <WTMETHOD name="Load">
                  <WTPARAM name="AffiliateID" direction="input" value="SYS(affiliateid)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
              </WTOBJECT>
              <WTRETURN>
                <WTCONDITION expr="NoErrors"/>
                <WTLINK name="0604" return="false">
                  <WTPARAM name="AffiliateID" value="SYS(AffiliateID)"/>
                </WTLINK>
              </WTRETURN>
            </WTCODEGROUP>

            <!-- Handle Member Logon -->
            <WTCODEGROUP>
              <WTCONDITION expr="IsMemberOnly"/>
              <!-- Set access defaults -->
              <WTSETATTRIBUTE name="CONST(tmpAccess)" value="SYSCON(ACCESS-GRANTED)"/>
              <WTSETATTRIBUTE name="CONST(tmpCompanyStatus)" value="SYSCON(NO)"/>
              <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
                <WTMETHOD name="Load">
                  <WTPARAM name="MemberID" direction="input" value="SYS(memberid)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTSETATTRIBUTE name="CONST(MemberCompanyID)" value="CONST(CLng(.CompanyID))"/>
                <!-- Check if this member belongs to the accessed company -->
                <WTCODEGROUP>
                  <WTCONDITION expr="SYS(CompanyID)" oper="not-equal" value="CONST(0)"/>
                  <WTCONDITION expr="CONST(MemberCompanyID)" oper="not-equal" value="SYS(CompanyID)" connector="and"/>
                  <WTERROR number="-2147217874" message="Oops, Logon Name is registered to another company."/>
                  <WTSETATTRIBUTE name="PARAM(ContactInfo)" value="SYSCON(YES)"/>
                  <WTCALLSUB name="ClearUser"/>
                </WTCODEGROUP>

                <WTSETATTRIBUTE name="CONST(MemberOptions)" value="ATTR(Member.Options)"/>
                <WTSETCACHE name="OPTIONS2" value="ATTR(Member.Options2)"/>
                <WTSETATTRIBUTE name="CONST(MemberOptions2)" value="ATTR(Member.Options2)"/>
                <WTSETATTRIBUTE name="CONST(tmpGroupID)" value="ATTR(Member.GroupID)"/>
                <WTSETATTRIBUTE name="CONST(tmpBilling)" value="ATTR(Member.Billing)"/>
                <WTSETATTRIBUTE name="CONST(tmpBillingID)" value="ATTR(Member.BillingID)"/>
                <WTSETATTRIBUTE name="CONST(tmpStatus)" value="ATTR(Member.Status)"/>
                <WTCODEGROUP>
                  <WTCONDITION expr="ATTR(Status)" oper="equal" value="SYSCON(MEMBER-FREE)"/>
                  <WTSETATTRIBUTE name="ATTR(Level)" value="CONST(0)"/>
                </WTCODEGROUP>
                <WTSETATTRIBUTE name="CONST(tmpLevel)" value="ATTR(Member.Level)"/>

                <!-- If this member belongs to a group, get the group's shared resources -->
                <WTCALLSUB name="GetResources tmpGroupID">
                  <WTCONDITION expr="CONST(tmpGroupID)" oper="not-equal" value="CONST(0)"/>
                </WTCALLSUB>

                <!-- Save the member's security level, last visit date, and status -->
                <WTSETCACHE name="SECURITYLEVEL" value="ATTR(Member.Secure)"/>
                <WTSETCACHE name="VISITDATE" value="ATTR(Member.VisitDate)"/>
                <WTSETATTRIBUTE name="SYS(UserMode)" value="ATTR(Member.Status)"/>
                <!-- Flag if this is a business account -->
                <WTSETATTRIBUTE name="SYS(UserMode)" value="SYSCON(MEMBER-BUSINESS)">
                  <WTCONDITION expr="ATTR(Member.IsMaster)" oper="not-equal" value="SYSCON(NO)"/>
                </WTSETATTRIBUTE>
                <WTSETCACHE name="SYS(UserMode)" value="SYS(UserMode)"/>
                <!-- If this is a trial account and we have billing info, flag as an Active account -->
                <!--
									  <WTSETATTRIBUTE name="CONST(tmpStatus)" value="SYSCON(MEMBER-PAID)">
										  <WTCONDITION expr="ATTR(Member.Status)" oper="equal" value="SYSCON(MEMBER-TRIAL)"/>
										  <WTCONDITION expr="ATTR(Member.BillingID)" oper="not-equal" value="CONST(0)" connector="and"/>
									  </WTSETATTRIBUTE>
  -->
                <!-- get any access limitations for this member -->
                <WTSETATTRIBUTE name="CONST(tmpAccessLimit)" value="ATTR(Member.AccessLimit)"/>

                <!-- If Member is Suspended, send them to a payment processing page to fix declined payments -->
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-SUSPENDED)"/>
                  <WTSETATTRIBUTE name="CONST(tmpMemberID)" value="SYS(memberid)"/>
                  <WTCALLSUB name="ClearUser"/>
                  <WTRETURN>
                    <WTLINK name="0436d" secure="false" return="false">
                      <WTPARAM name="MemberID" value="CONST(tmpMemberID)"/>
                    </WTLINK>
                  </WTRETURN>
                </WTCODEGROUP>

                <!-- Display message to contact Customer Support if status is inactive, suspended, or not set -->
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpStatus)" oper="less" value="SYSCON(MEMBER-PAID)"/>
                  <WTCONDITION expr="CONST(tmpStatus)" oper="greater" value="SYSCON(MEMBER-FREE)" connector="or"/>
                  <WTERROR number="-2147220517" message="Oops, Please contact Customer Support to access the system."/>
                  <WTSETATTRIBUTE name="PARAM(ContactInfo)" value="SYSCON(YES)"/>
                  <WTCALLSUB name="ClearUser"/>
                </WTCODEGROUP>
                <!-- If no errors so far, save the companyID -->
                <WTCODEGROUP>
                  <WTCONDITION expr="NoErrors"/>
                  <WTSETATTRIBUTE name="SYS(CompanyID)" value="ATTR(Member.CompanyID)"/>
                  <WTSETCACHE name="SYS(CompanyID)" value="SYS(CompanyID)"/>
                </WTCODEGROUP>
              </WTOBJECT>
              <!-- Set Company Header -->
              <WTCALLSUB name="SetCompanyHeader reqSysCompanyID, reqSysLanguage">
                <WTCONDITION expr="CONST(tmpGroupID)" oper="equal" value="CONST(0)"/>
              </WTCALLSUB>
              <WTCALLSUB name="SetCompanyGrpHeader reqSysCompanyID, tmpGroupID, reqSysLanguage">
                <WTCONDITION expr="CONST(tmpGroupID)" oper="not-equal" value="CONST(0)"/>
              </WTCALLSUB>
              <!-- get the company status and company options -->
              <WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
                <WTCONDITION expr="NoErrors"/>
                <WTMETHOD name="Load">
                  <WTPARAM name="CompanyID" direction="input" value="SYS(CompanyID)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <WTSETATTRIBUTE name="CONST(tmpCompanyStatus)" value="ATTR(Status)"/>
                <!-- If the company status is not active or demo, display message that the system is unavailable -->
                <WTCODEGROUP>
                  <WTCONDITION expr="ATTR(Status)" oper="not-equal" value="SYSCON(COMPANY-ACTIVE)"/>
                  <WTCONDITION expr="ATTR(Status)" oper="not-equal" value="SYSCON(COMPANY-DEMO)" connector="and"/>
                  <WTERROR number="10106" message="Oops, Your System is not available."/>
                  <WTCALLSUB name="ClearUser"/>
                </WTCODEGROUP>
              </WTOBJECT>
              <WTOBJECT name="Coption" project="ptsCoptionUser" class="CCoption">
                <WTCONDITION expr="NoErrors"/>
                <WTMETHOD name="FetchCompany">
                  <WTPARAM name="CompanyID" direction="input" value="SYS(CompanyID)"/>
                </WTMETHOD>
                <WTMETHOD name="Load">
                  <WTPARAM name="CoptionID" direction="input" value="ATTR(CoptionID)"/>
                  <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                </WTMETHOD>
                <!-- SETUP GOOGLE ANALYTICS FOR THE COMPANY-->
                <WTCODEGROUP>
                  <WTCUSTOM>
                    aGA = Split(.GAAcct, ",")
                    If UBOUND(aGA) = 1 Then
                    tmpID = aGA(0)
                    tmpDomain = aGA(1)
                    If tmpID &lt;&gt; "" And tmpDomain &lt;&gt; "" Then
                    SetCache "GA_ACCTID", tmpID
                    SetCache "GA_DOMAIN", tmpDomain
                    End If
                    End If
                  </WTCUSTOM>
                </WTCODEGROUP>
                <WTSETCACHE name="IDENTIFY" value="ATTR(Identify)"/>
                <!--									<WTSETATTRIBUTE name="SYS(NAVBARIMAGE)" value="ATTR(MenuBarColor)"/>-->
                <WTSETCACHE name="SYS(NAVBARIMAGE)" value="SYS(NAVBARIMAGE)"/>
                <WTSETATTRIBUTE name="CONST(tmpIPLimit)" value="ATTR(IPLimit)"/>
                <WTSETATTRIBUTE name="CONST(tmpIPLimit)" value="CONST(6)">
                  <WTCONDITION expr="CONST(tmpIPLimit)" oper="equal" value="CONST(0)"/>
                </WTSETATTRIBUTE>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(0)"/>
                  <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(FreeOptions)"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(1)"/>
                  <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options)"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(2)"/>
                  <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options2)"/>
                </WTCODEGROUP>
                <WTCODEGROUP>
                  <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(3)"/>
                  <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options3)"/>
                </WTCODEGROUP>

                <!-- Get the Users Options -->
                <WTCALLSUB name="reqSysUserOptions = GetUserOptions(reqSysUserOptions, MemberOptions)"/>

                <!-- If we are in Easy Mode, Get the Easy Options for this user -->
                <!--
									  <WTCODEGROUP>
										  <WTCONDITION expr="IsEasy"/>
										  <WTCONDITION expr="IsEasyMode" connector="and"/>
										  <WTSETCACHE name="SYS(MenuBarState)" value="ATTR(MenuEasy)"/>
										  <WTCALLSUB name="reqSysUserOptions = GetEasyOptions(reqSysUserOptions, .EasyOptions)"/>
									  </WTCODEGROUP>
  -->
                <WTSETCACHE name="SYS(UserOptions)" value="SYS(UserOptions)"/>
              </WTOBJECT>
              <!-- Get Team Membership Level Options -->
              <WTOBJECT name="Moption" project="ptsMoptionUser" class="CMoption">
                <WTCONDITION expr="NoErrors"/>
                <WTCONDITION expr="CONST(tmpGroupID)" oper="not-equal" value="CONST(0)" connector="and"/>
                <WTMETHOD name="FetchMember">
                  <WTPARAM name="MemberID" direction="input" value="CONST(tmpGroupID)"/>
                </WTMETHOD>
                <WTCODEGROUP>
                  <WTCONDITION expr="ATTR(MoptionID)" oper="not-equal" value="CONST(0)"/>
                  <WTMETHOD name="Load">
                    <WTPARAM name="MoptionID" direction="input" value="ATTR(MoptionID)"/>
                    <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                  </WTMETHOD>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(0)"/>
                    <WTCONDITION expr="ATTR(Options0)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
                    <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options0)"/>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(1)"/>
                    <WTCONDITION expr="ATTR(Options1)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
                    <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options1)"/>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(2)"/>
                    <WTCONDITION expr="ATTR(Options2)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
                    <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options2)"/>
                  </WTCODEGROUP>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(3)"/>
                    <WTCONDITION expr="ATTR(Options3)" oper="not-equal" value="CONST(&quot;&quot;)" connector="and"/>
                    <WTSETATTRIBUTE name="SYS(UserOptions)" value="ATTR(Options3)"/>
                  </WTCODEGROUP>
                  <!-- Get the Users Options -->
                  <WTCALLSUB name="reqSysUserOptions = GetUserOptions(reqSysUserOptions, MemberOptions)"/>
                  <WTSETCACHE name="SYS(UserOptions)" value="SYS(UserOptions)"/>
                </WTCODEGROUP>
              </WTOBJECT>

              <WTCODEGROUP>
                <WTCONDITION expr="NoErrors"/>
                <!-- Get User's IP Address and truncate the last part -->
                <WTCUSTOM>
                  IPLevel = 3
                  If Left(tmpAccessLimit, 4) = "IPL:" Then
                  If IsNumeric(Mid(tmpAccessLimit, 5, 1)) Then
                  x = Mid(tmpAccessLimit, 5, 1)
                  If x &gt;= 1 And x &lt;= 4 Then IPLevel = x
                  End If
                  End If
                  UserIP = Request.ServerVariables("REMOTE_ADDR")
                  If IPLevel = 4 Then
                  tmpIP = UserIP
                  Else
                  x = 0
                  For z = 1 To IPLevel
                  x = InStr(x + 1, UserIP, ".")
                  Next
                  If x &gt; 0 Then tmpIP = Left(UserIP, x)
                  End If
                </WTCUSTOM>
                <!-- Check the Member's logon IP locations -->
                <!-- Unless the member's access limitation is NONE or it is a DEMO company  -->
                <WTOBJECT name="AuthLog" project="ptsAuthLogUser" class="CAuthLog">
                  <WTCONDITION expr="CONST(tmpAccessLimit)" oper="not-equal" value="CONST(&quot;NONE&quot;)"/>
                  <WTCONDITION expr="CONST(tmpCompanyStatus)" oper="not-equal" value="SYSCON(COMPANY-DEMO)" connector="and"/>
                  <WTMETHOD name="LogAuthUser">
                    <WTPARAM name="AuthUserID" direction="input" value="SYS(userid)"/>
                    <WTPARAM name="IP" direction="input" value="CONST(tmpIP)"/>
                    <WTPARAM name="Total" direction="input" value="CONST(tmpIPLimit)"/>
                    <WTPARAM name="result" direction="return" datatype="number"/>
                  </WTMETHOD>
                  <!-- Display Access Disallowed message if IP address has been disabled -->
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(result)" oper="equal" value="CONST(-1)"/>
                    <WTERROR number="-2147220515" message="Oops, Your access to the system has been disallowed - IP Address Denied.{&quot; + UserIP + &quot;}"/>
                    <WTCALLSUB name="ClearUser"/>
                  </WTCODEGROUP>
                  <!-- Display Access Disallowed message if too many IP addresses -->
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(result)" oper="greater" value="CONST(1)"/>
                    <WTERROR number="-2147220516" message="Oops, Your access to the system has been disallowed - Too Many IP Addresses.{&quot; + UserIP + &quot;}[&quot; + CStr(result) + &quot;]"/>
                    <WTCALLSUB name="ClearUser"/>
                  </WTCODEGROUP>
                </WTOBJECT>
                <!-- Check if the Member's access has been limited -->
                <!-- Unless the member's access limitation is NONE or it is a DEMO company  -->
                <WTCODEGROUP>
                  <WTCONDITION expr="NoErrors"/>
                  <WTCONDITION expr="CONST(tmpAccessLimit)" oper="not-equal" value="CONST(&quot;NONE&quot;)" connector="and"/>
                  <WTCONDITION expr="CONST(tmpCompanyStatus)" oper="not-equal" value="SYSCON(COMPANY-DEMO)" connector="and"/>
                  <WTCALLSUB name="tmpAccess = LimitedAccess( tmpAccessLimit )"/>
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpAccess)" oper="not-equal" value="SYSCON(ACCESS-GRANTED)"/>
                    <WTERROR number="-2147220514" message="Oops, Your access to the system has been limited - Access Denied."/>
                    <WTCALLSUB name="ClearUser"/>
                  </WTCODEGROUP>
                </WTCODEGROUP>
                <!-- If no errors so far AND the member's status is Active, Trail, or Certify -->
                <!-- Save the current timestamp as the member's last visit date -->
                <WTCODEGROUP>
                  <WTCONDITION expr="NoErrors"/>
                  <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
                    <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-PAID)"/>
                    <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-TRIAL)" connector="or"/>
                    <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-FREE)" connector="or"/>
                    <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-INACTIVE)" connector="or"/>
                    <WTMETHOD name="Load">
                      <WTPARAM name="MemberID" direction="input" value="SYS(memberid)"/>
                      <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                    </WTMETHOD>
                    <WTSETATTRIBUTE name="ATTR(VisitDate)" value="SYS(Now)"/>
                    <WTMETHOD name="Save">
                      <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
                    </WTMETHOD>
                  </WTOBJECT>
                  <!-- set all the member's options for pages and training buddy image -->
                  <WTCALLSUB name="SetMemberOptions reqSysMemberID, reqSysCompanyID, reqSysLanguage"/>
                  <!-- if this member can be upgraded -->
                  <!--
										  <WTCODEGROUP>
									  		  <WTCONDITION expr="CONST(tmpUpgrade)" oper="not-equal" value="CONST(&quot;&quot;)"/>
											  <WTRETURN>
										  		  <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-TRIAL)"/>
										  		  <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-FREE)" connector="or"/>
										  		  <WTCONDITION expr="CONST(tmpStatus)" oper="equal" value="SYSCON(MEMBER-INACTIVE)" connector="or"/>
												  <WTLINK name="0419" return="false"><WTPARAM name="CompanyID" value="SYS(CompanyID)"/></WTLINK>
											  </WTRETURN>
										  </WTCODEGROUP>
  -->
                  <!-- Otherwise, if access is granted, go to the member home Page -->
                  <WTCODEGROUP>
                    <WTCONDITION expr="CONST(tmpAccess)" oper="equal" value="SYSCON(ACCESS-GRANTED)"/>
                    <!--											<WTGETCOOKIE name="CONST(tmpNoIntro)" value="CONST(NoIntro)"/>-->

                    <WTCUSTOM>
                      tmpIP = Request.ServerVariables("REMOTE_ADDR")
                    </WTCUSTOM>
                    <WTHTTP>
                      <WTLINK name="0418">
                        <WTPARAM name="MemberID" value="SYS(MemberID)"/>
                        <WTPARAM name="Notify" value="SYSCON(NOTIFYMENTOR-SIGNIN)"/>
                        <WTPARAM name="IP" value="CONST(tmpIP)"/>
                      </WTLINK>
                    </WTHTTP>

                    <WTCODEGROUP>
                      <!--										  		<WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(582)"/> -->
                      <!--										  		<WTCONDITION expr="CONST(tmpLevel)" oper="equal" value="CONST(1)"/>-->
                      <!--
										  		  <WTCONDITION expr="CONST(tmpBilling)" oper="equal" value="CONST(3)"/>
										  		  <WTCONDITION expr="CONST(tmpBillingID)" oper="equal" value="CONST(0)" connector="and"/>
												  <WTRETURN>
													  <WTLINK name="2902a" return="false"/>
												  </WTRETURN>
  -->
                    </WTCODEGROUP>

                    <WTCODEGROUP>
                      <WTCONDITION expr="PARAM(Page)" oper="not-equal" value="CONST(&quot;&quot;)"/>
                      <WTCUSTOM>
                        reqPage = Replace( reqPage, "{id}", CStr(reqSysMemberID))
                        reqPage = Replace( reqPage, "%26", "&amp;")
                        Response.Redirect reqPage
                      </WTCUSTOM>
                    </WTCODEGROUP>

                    <WTCODEGROUP>
                      <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="SYSCON(GCR)"/>
                      <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="SYSCON(NEXXUS)" connector="or"/>
                      <WTCALLSUB name="AccessNotice lgn, UserEmail "/>
                    </WTCODEGROUP>

                    <!--
											  <WTRETURN>
												  <WTCONDITION expr="IsJumpStart"/>
												  <WTCONDITION expr="NotSkipJumpStart" connector="and"/>
												  <WTLINK name="0420" return="false"/>
											  </WTRETURN>
											  <WTSETCOOKIE name="CONST(NoIntro)" value="CONST(&quot;1&quot;)"/>
  -->
                    <WTRETURN>
                      <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(12)"/>
                      <WTLINK name="13210" secure="false" return="false"/>
                    </WTRETURN>
                    <WTCODEGROUP>
                      <WTCONDITION expr="SYS(CompanyID)" oper="greater-equal" value="CONST(7)"/>
                      <WTSETATTRIBUTE name="CONST(tmpMobile)" value="CONST(IsMobileBrowser())"/>
                      <WTRETURN>
                        <WTCONDITION expr="CONST(tmpMobile)" oper="equal" value="CONST(0)"/>
                        <WTLINK name="MemberHome" secure="false" return="false"/>
                      </WTRETURN>
                      <WTRETURN>
                        <WTCONDITION expr="CONST(tmpMobile)" oper="not-equal" value="CONST(0)"/>
                        <WTLINK name="m_MemberHome" secure="false" return="false"/>
                      </WTRETURN>
                    </WTCODEGROUP>
                    <WTRETURN>
                      <WTLINK name="0404" secure="false" return="false"/>
                    </WTRETURN>
                  </WTCODEGROUP>
                </WTCODEGROUP>
              </WTCODEGROUP>
            </WTCODEGROUP>
          </WTCODEGROUP>
        </WTOBJECT>
        <WTOBJECT name="Business" project="ptsBusinessUser" class="CBusiness">
          <WTCONDITION expr="PARAM(ContactInfo)" oper="equal" value="SYSCON(YES)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="BusinessID" direction="input" value="CONST(1)"/>
            <WTPARAM name="SecurityToken" direction="input" value="CONST(1)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlBusiness" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTACTION id="0" name="New" type="New" >
        <WTCALLSUB name="SignIn reqLgn, reqPwd">
          <WTCONDITION expr="PARAM(Lgn)" oper="not-equal" value="CONST(&quot;&quot;)"/>
          <WTCONDITION expr="PARAM(R)" oper="not-equal" value="CONST(&quot;&quot;)" connector="or"/>
        </WTCALLSUB>
        <WTGETCOOKIE name="PARAM(Lgn)" value="CONST(LGN)"/>
        <WTGETCOOKIE name="PARAM(Pwd)" value="CONST(PWD)"/>
        <WTSETATTRIBUTE name="PARAM(Remember)" value="CONST(1)">
          <WTCONDITION expr="PARAM(Lgn)" oper="not-equal" value="CONST(&quot;&quot;)"/>
        </WTSETATTRIBUTE>
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="CONST(1)"/>
          <WTSETATTRIBUTE name="ATTR(Logon)" value="PARAM(Lgn)"/>
          <WTSETATTRIBUTE name="ATTR(Password)" value="PARAM(Pwd)"/>
          <WTSETATTRIBUTE name="SYS(userid)" value="CONST(99)"/>
          <WTSETATTRIBUTE name="SYS(usergroup)" value="CONST(99)"/>
          <WTSETATTRIBUTE name="SYS(userstatus)" value="CONST(1)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTACTION>

      <WTACTION id="1" name="SignIn" type="SignIn">
        <WTSETATTRIBUTE name="CONST(tmpLgn)" value="FORM(Logon)"/>
        <WTSETATTRIBUTE name="CONST(tmpPwd)" value="FORM(Password)"/>
        <WTSETATTRIBUTE name="CONST(tmpRemember)" value="FORM(Remember)"/>
        <WTCODEGROUP>
          <WTCONDITION expr="CONST(tmpRemember)" oper="equal" value="CONST(&quot;1&quot;)"/>
          <WTSETCOOKIE name="CONST(LGN)" value="CONST(tmpLgn)"/>
          <WTSETCOOKIE name="CONST(PWD)" value="CONST(tmpPwd)"/>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="CONST(tmpRemember)" oper="equal" value="CONST(&quot;&quot;)"/>
          <WTSETCOOKIE name="CONST(LGN)" value="CONST(&quot;&quot;)"/>
          <WTSETCOOKIE name="CONST(PWD)" value="CONST(&quot;&quot;)"/>
        </WTCODEGROUP>
        <WTCALLSUB name="SignIn tmpLgn, tmpPwd"/>
      </WTACTION>

      <WTACTION id="9" name="SignOut" type="SignOut">
        <WTCALLSUB name="ClearUser"/>
        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
          <WTLINK name="0000"/>
        </WTRETURN>
      </WTACTION>

      <!--*************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="40" align="right"/>
        <WTCOLUMN width="60" align="left"/>

        <WTSTATIC label="IsOverride2FA"/>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="SignIn" class="PageHeading"/>
          <!--
          <WTLINKGROUP col="2" align="right">
            <WTCONDITION expr="PARAM(AuthyID)" oper="equal" value="CONST(0)"/>
            <WTCONDITION expr="PARAM(UserKey)" oper="equal" value="CONST('')" connector="and"/>
            <WTLINK name="0102" label="SignInHelp"/>
          </WTLINKGROUP>
-->
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="right">
            <WTCODEGROUP>
              <WTTRANSLATE/>
            </WTCODEGROUP>
          </WTSTATIC>
        </WTROW>
        <WTROW margin-bottom="12" margin-top="2">
          <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(AuthyID)" oper="equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(UserKey)" oper="equal" value="CONST('')" connector="and"/>
          <WTROW>
            <WTSTATIC col="1" tag="Logon"/>
            <WTTEXT col="2"  value="ATTR(AuthUser.Logon)" size="20"/>
          </WTROW>
          <WTROW>
            <WTSTATIC col="1" tag="Password"/>
            <WTTEXT col="2" value="ATTR(AuthUser.Password)" size="20"/>
          </WTROW>
          <WTROW>
            <WTSTATIC col="1"/>
            <WTCHECK col="2" value="PARAM(Remember)" label="Remember"/>
          </WTROW>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(AuthyID)" oper="not-equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(UserKey)" oper="not-equal" value="CONST('')" connector="or"/>
          <WTROW>
            <WTHIDDEN  value="ATTR(AuthUser.Logon)"/>
            <WTHIDDEN  value="ATTR(AuthUser.Password)"/>
            <WTHIDDEN  value="PARAM(Remember)"/>
          </WTROW>
          <WTROW>
            <WTSTATIC col="1" tag="Token"/>
            <WTTEXT col="2" value="PARAM(SecurityCode)" size="10"/>
          </WTROW>
          <!--
          <WTROW margin-top="12">
            <WTSTATIC col="1" merge="2" align="center">
              <WTCODEGROUP>
                <WTCHECK value="PARAM(IsOverride2FA)"/>
              </WTCODEGROUP>
            </WTSTATIC>
          </WTROW>
-->
        </WTCODEGROUP>

        <WTROW margin-top="12" margin-bottom="12">
          <WTBUTTON col="1" merge="2" action="1" value="CONST(SignIn)" align="center" default="true"/>
        </WTROW>
        <!--
        <WTROW margin-bottom="12">
          <WTCONDITION expr="PARAM(AuthyID)" oper="equal" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(UserKey)" oper="equal" value="CONST('')" connector="and"/>
          <WTLINKGROUP col="1" merge="2" align="center">
            <WTLINK name="0102" label="TroubleSigningInClickhereforhelp"/>
          </WTLINKGROUP>
        </WTROW>
-->
      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================-->
    <WTWEBPAGE name="0102" caption="SignInHelp"  header="false" footer="false" navbar="false" wrapper="wrapper600"
				   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" checksecurity="false">
      <!--==================================================================================================-->

      <WTSETATTRIBUTE name="SYS(userid)" value="CONST(99)"/>

      <WTSUB name="LoadBusiness">
        <WTOBJECT name="Business" project="ptsBusinessUser" class="CBusiness">
          <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="BusinessID" direction="input" value="CONST(1)"/>
            <WTPARAM name="SecurityToken" direction="input" value="CONST(1)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlBusiness" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
          <WTCONDITION expr="SYS(CompanyID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="CompanyID" direction="input" value="SYS(CompanyID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="CONST(1)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlCompany" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="LoadBusiness"/>
      </WTACTION>

      <WTACTION id="1" name="Update" type="Update">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTES/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
          <WTMETHOD name="EmailLoad">
            <WTPARAM name="SecurityToken" direction="input" value="CONST(1)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="CONST(tmpAuthUserID)" value="ATTR(AuthUser.AuthUserID)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="ATTR(AuthUser.AuthUserID)" oper="equal" value="CONST(0)"/>
            <WTERROR number="-2147220512" message="Oops, Could not find the Email address. Please re-enter."/>
          </WTCODEGROUP>
        </WTOBJECT>
        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
          <WTLINK name="0105" return="false">
            <WTPARAM name="AuthUserID" value="CONST(tmpAuthUserID)"/>
            <WTPARAM name="MailReturnURL" value="CONST(GetCache(&quot;0102URL&quot;))"/>
          </WTLINK>
        </WTRETURN>
        <WTCALLSUB name="LoadBusiness">
          <WTCONDITION expr="IsErrors"/>
        </WTCALLSUB>
      </WTACTION>

      <!--*****************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="160" align="right"/>
        <WTCOLUMN width="440" align="left"/>

        <WTROW>
          <WTSTATIC col="1" align="left" label="SignInHelp" class="PageHeading"/>
          <WTLINKGROUP col="2" align="right">
            <WTLINK name="0101" label="ReturnToSignIn"/>
          </WTLINKGROUP>
        </WTROW>
        <WTROW margin-bottom="12" margin-top="2">
          <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="TroubleSigningIn" class="ColumnHeader"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="TroubleSigningInHelp"/>
        </WTROW>
        <WTROW margin-top="12">
          <WTSTATIC col="1" merge="2" align="left" label="ForgotYourPassword" class="ColumnHeader"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ForgotYourPasswordHelp"/>
        </WTROW>
        <WTROW margin-top="12">
          <WTSTATIC col="1" tag="Email"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.Email)" size="40"/>
        </WTROW>

        <WTROW margin-top="12" margin-bottom="12">
          <WTSTATIC col="1"/>
          <WTBUTTON col="2" action="1" value="CONST(EmailLogonPassword)"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="NeedFurtherAssistance" class="ColumnHeader"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="NeedFurtherAssistanceHelp"/>
        </WTROW>
        <WTCODEGROUP>
          <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(0)"/>
          <WTROW margin-top="12" margin-bottom="6">
            <WTCONDITION expr="ATTR(Business.CustomerEmail)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" align="right" tag="Email"/>
            <WTSTATIC col="2" align="left" value="ATTR(Business.CustomerEmail)"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTCONDITION expr="ATTR(Business.Phone)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" align="right" tag="Phone"/>
            <WTSTATIC col="2" align="left" value="ATTR(Business.Phone)"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTCONDITION expr="ATTR(Business.Fax)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" align="right" tag="Fax"/>
            <WTSTATIC col="2" align="left" value="ATTR(Business.Fax)"/>
          </WTROW>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="SYS(CompanyID)" oper="not-equal" value="CONST(0)"/>
          <WTROW margin-top="12" margin-bottom="6">
            <WTCONDITION expr="ATTR(Company.Email)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" align="right" tag="Email"/>
            <WTSTATIC col="2" align="left" value="ATTR(Company.Email)"/>
          </WTROW>
          <WTROW margin-bottom="6">
            <WTCONDITION expr="ATTR(Company.Phone1)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" align="right" tag="Phone"/>
            <WTSTATIC col="2" align="left" value="ATTR(Company.Phone1)"/>
          </WTROW>
          <WTROW margin-bottom="12">
            <WTCONDITION expr="ATTR(Company.Fax)" oper="not-equal" value="CONST('')"/>
            <WTSTATIC col="1" align="right" tag="Fax"/>
            <WTSTATIC col="2" align="left" value="ATTR(Company.Fax)"/>
          </WTROW>
        </WTCODEGROUP>
      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================-->
    <WTWEBPAGE name="m_0103" caption="Change Login" page-left="0" page-top="0" navbar="false" header="false" footer="false" wrapper="false"
			page-width="100%" margin-width="0" navbar-width="0" content-width="100%" focus="false" viewport="width=device-width"
		    aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" mobile="m_MemberHome.asp" secured="52" track="0">
      <!--==================================================================================================-->
      <WTPARAM name="Action" datatype="number"/>

      <WTACTION id="0" name="New" type="New">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="SYS(userid)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(AuthUser.Password)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTACTION>

      <WTACTION id="1" name="Update" type="Update">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="SYS(userid)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(AuthUser.Logon)" value="FORM(Logon)"/>
          <WTSETATTRIBUTE name="ATTR(AuthUser.NewLogon)" value="FORM(NewLogon)"/>
          <WTSETATTRIBUTE name="ATTR(AuthUser.ConfirmLogon)" value="FORM(ConfirmLogon)"/>
          <WTCUSTOM>
            .ChangeLogon CLng(reqSysUserID)
            If (Err.Number = -2147217873) Then DoError -2147220513, "", "Oops, The Logon is not available.  Please select another or contact Member Support for assistance."
            If (Err.Number &lt;&gt; 0) Then DoError Err.Number, Err.Source, Err.Description End If
          </WTCUSTOM>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTSETATTRIBUTE name="PARAM(Action)" value="CONST(1)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
      </WTACTION>

      <WTACTION id="3" name="Cancel" type="Cancel">
        <WTSETCACHE name="SYS(returnurl)" value="CONST(&quot;&quot;)"/>
        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
        </WTRETURN>
      </WTACTION>

      <!--*******************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="40" align="right"/>
        <WTCOLUMN width="60" align="left"/>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ChangeLogon" class="PageHeading"/>
        </WTROW>
        <WTROW margin-bottom="12" margin-top="2">
          <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="VerifyEmailAddress" class="ColumnHeader"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="VerifyEmailChangeLogonHelp"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" tag="Email" height="36" class="BoldText"/>
          <WTSTATIC col="2" value="ATTR(AuthUser.Email)" class="BoldText"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ChangeLogonID" class="ColumnHeader"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ChangeLogonIDHelp"/>
        </WTROW>
        <WTROW margin-top="12">
          <WTSTATIC col="1" align="right" tag="Logon"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.Logon)" size="20"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" align="right" tag="NewLogon"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.NewLogon)" size="20"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" align="right" tag="ConfirmLogon"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.ConfirmLogon)" size="20"/>
        </WTROW>
        <WTROW margin-top="12" margin-bottom="12">
          <WTBUTTON col="1" merge="2" action="1" value="CONST(NewLogon)" align="center"/>
          <WTSTATIC col="1" label="Updated" fontcolor="red" bold="true">
            <WTCONDITION expr="PARAM(Action)" oper="equal" value="CONST(1)" />
          </WTSTATIC>
        </WTROW>
      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================-->
    <WTWEBPAGE name="m_0106" caption="Change Password" page-left="0" page-top="0" navbar="false" header="false" footer="false" wrapper="false"
			page-width="100%" margin-width="0" navbar-width="0" content-width="100%" focus="false" viewport="width=device-width"
		    aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" mobile="m_MemberHome.asp" secured="52" track="0">
      <!--==================================================================================================-->
      <WTPARAM name="Action" datatype="number"/>

      <WTACTION id="0" name="New" type="New">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="SYS(userid)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(AuthUser.Password)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTACTION>

      <WTACTION id="1" name="Update" type="Update">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="SYS(userid)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(AuthUser.Password)" value="FORM(Password)"/>
          <WTSETATTRIBUTE name="ATTR(AuthUser.NewPassword)" value="FORM(NewPassword)"/>
          <WTSETATTRIBUTE name="ATTR(AuthUser.ConfirmPassword)" value="FORM(ConfirmPassword)"/>
          <WTMETHOD name="ChangePassword">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTSETATTRIBUTE name="PARAM(Action)" value="CONST(1)">
          <WTCONDITION expr="NoErrors"/>
        </WTSETATTRIBUTE>
      </WTACTION>

      <!--**********************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="40" align="right"/>
        <WTCOLUMN width="60" align="left"/>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ChangePassword" class="PageHeading"/>
        </WTROW>
        <WTROW margin-bottom="12" margin-top="2">
          <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="VerifyEmailAddress" class="ColumnHeader"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="VerifyEmailChangePasswordHelp"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" tag="Email" height="36" class="BoldText"/>
          <WTSTATIC col="2" value="ATTR(AuthUser.Email)" class="BoldText"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ChangePassword" class="ColumnHeader"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ChangePasswordHelp"/>
        </WTROW>
        <WTROW margin-top="12">
          <WTSTATIC col="1" align="right" tag="Password"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.Password)" size="20"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" align="right" tag="NewPassword"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.NewPassword)" size="20"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" align="right" tag="ConfirmPassword"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.ConfirmPassword)" size="20"/>
        </WTROW>
        <WTROW margin-top="12" margin-bottom="12">
          <WTBUTTON col="1" merge="2" action="1" value="CONST(NewPassword)" align="center"/>
          <WTSTATIC col="1" label="Updated" fontcolor="red" bold="true">
            <WTCONDITION expr="PARAM(Action)" oper="equal" value="CONST(1)" />
          </WTSTATIC>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================-->
    <WTWEBPAGE name="0103" caption="Change Login" header="false" footer="false" navbar="false" wrapper="wrapper600"
				   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" track="0">
      <!--==================================================================================================-->
      <WTPARAM name="Popup" datatype="number"/>
      <WTPARAM name="Action" datatype="number"/>

      <WTACTION id="0" name="New" type="New">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="SYS(userid)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(AuthUser.Password)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTACTION>

      <WTACTION id="1" name="Update" type="Update">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="SYS(userid)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(AuthUser.Logon)" value="FORM(Logon)"/>
          <WTSETATTRIBUTE name="ATTR(AuthUser.NewLogon)" value="FORM(NewLogon)"/>
          <WTSETATTRIBUTE name="ATTR(AuthUser.ConfirmLogon)" value="FORM(ConfirmLogon)"/>
          <WTSETATTRIBUTE name="CONST(newLogon)" value="ATTR(NewLogon)"/>
          <WTSETATTRIBUTE name="CONST(newPassword)" value="ATTR(Password)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Len(.Logon))" oper="less" value="CONST(6)"/>
            <WTERROR number="10101" message="Oops, Your Logon Name must be at least six characters/numbers long."/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="NoErrors"/>
            <WTCUSTOM>
              .ChangeLogon CLng(reqSysUserID)
              If (Err.Number = -2147217873) Then DoError -2147220513, "", "Oops, The Logon is not available.  Please select another or contact Member Support for assistance."
              If (Err.Number &lt;&gt; 0) Then DoError Err.Number, Err.Source, Err.Description End If
            </WTCUSTOM>
          </WTCODEGROUP>
          <WTMETHOD name="XML">
            <WTCONDITION expr="IsErrors"/>
            <WTCONDITION expr="PARAM(Popup)" oper="not-equal" value="CONST(0)" connector="or"/>
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(Action)" value="CONST(1)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="SYSCON(GCR)"/>
            <WTCONDITION expr="SYS(MemberID)" oper="greater" value="CONST(0)" connector="and"/>
            <!-- NEED TO KEEP THE USERNAME IN SYNCH WITH THE COIN MINING SYSTEM -->
            <!--            
						<WTCUSTOM>
							Set oHTTP = server.CreateObject("MSXML2.ServerXMLHTTP")
							If oHTTP Is Nothing Then
							Response.Write "Error #" &amp; Err.number &amp; " - " + Err.description
							Else
							'Update a GCR Username / Password
							newLogon = Replace( newLogon, "&amp;", "-") 'can't pass amphersand in URL
							newLogon = Replace( newLogon, "%", "-") 'can't pass percent in URL
							tmpURL = "GlobalCoinUpdate.asp?MemberID=" + CStr(reqSysMemberID) + "&amp;User=" + newLogon + "&amp;Pswd=" + newPassword
							oHTTP.open "GET", "http://" + reqSysServerName + reqSysServerPath + tmpURL
							oHTTP.send
							End If
							Set oHTTP = Nothing
						</WTCUSTOM>
-->
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
          <WTLINK name="0105" return="false">
            <WTPARAM name="AuthUserID" value="SYS(userid)"/>
            <WTPARAM name="MailReturnURL" value="CONST(GetCache(&quot;0103URL&quot;))"/>
          </WTLINK>
        </WTRETURN>
      </WTACTION>

      <WTACTION id="3" name="Cancel" type="Cancel">
        <WTSETCACHE name="SYS(returnurl)" value="CONST(&quot;&quot;)"/>
        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
        </WTRETURN>
      </WTACTION>

      <!--*******************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="160" align="right"/>
        <WTCOLUMN width="440" align="left"/>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ChangeLogon" class="PageHeading"/>
        </WTROW>
        <WTROW margin-bottom="12" margin-top="2">
          <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="VerifyEmailAddress" class="ColumnHeader"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="VerifyEmailChangeLogonHelp"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" tag="Email" height="36" class="BoldText"/>
          <WTSTATIC col="2" value="ATTR(AuthUser.Email)" class="BoldText"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ChangeLogonID" class="ColumnHeader"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ChangeLogonIDHelp"/>
        </WTROW>
        <WTROW margin-top="12">
          <WTSTATIC col="1" align="right" tag="Logon"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.Logon)" size="20"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" align="right" tag="NewLogon"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.NewLogon)" size="20"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" align="right" tag="ConfirmLogon"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.ConfirmLogon)" size="20"/>
        </WTROW>
        <WTROW margin-top="12" margin-bottom="12">
          <WTSTATIC col="1"/>
          <WTBUTTON col="2" action="1" value="CONST(NewLogon)"/>
          <WTBUTTON col="2" action="3" value="CONST(Cancel)">
            <WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)"/>
          </WTBUTTON>
          <WTBUTTON col="2" value="CONST(Close)">
            <WTCONDITION expr="PARAM(Popup)" oper="greater" value="CONST(0)"/>
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
          <WTSTATIC col="2" label="Updated" fontcolor="red" bold="true">
            <WTCONDITION expr="PARAM(Action)" oper="equal" value="CONST(1)" />
          </WTSTATIC>
        </WTROW>
      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================-->
    <WTWEBPAGE name="0106" caption="Change Password" header="false" footer="false" navbar="false" wrapper="wrapper600"
				   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" secured="61" track="0">
      <!--==================================================================================================-->
      <WTPARAM name="Popup" datatype="number"/>
      <WTPARAM name="Action" datatype="number"/>

      <WTACTION id="0" name="New" type="New">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="SYS(userid)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(AuthUser.Password)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTACTION>

      <WTACTION id="1" name="Update" type="Update">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="SYS(userid)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(AuthUser.Password)" value="FORM(Password)"/>
          <WTSETATTRIBUTE name="ATTR(AuthUser.NewPassword)" value="FORM(NewPassword)"/>
          <WTSETATTRIBUTE name="ATTR(AuthUser.ConfirmPassword)" value="FORM(ConfirmPassword)"/>
          <WTSETATTRIBUTE name="CONST(newLogon)" value="ATTR(Logon)"/>
          <WTSETATTRIBUTE name="CONST(newPassword)" value="ATTR(NewPassword)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Len(.Password))" oper="less" value="CONST(6)"/>
            <WTERROR number="10102" message="Oops, Your Password must be at least six characters/numbers long."/>
          </WTCODEGROUP>
          <WTMETHOD name="ChangePassword">
            <WTCONDITION expr="NoErrors"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTCONDITION expr="IsErrors"/>
            <WTCONDITION expr="PARAM(Popup)" oper="not-equal" value="CONST(0)" connector="or"/>
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTSETATTRIBUTE name="PARAM(Action)" value="CONST(1)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="SYSCON(GCR)"/>
            <WTCONDITION expr="SYS(MemberID)" oper="greater" value="CONST(0)" connector="and"/>
            <!-- NEED TO KEEP THE PASSWORD IN SYNCH WITH THE COIN MINING SYSTEM -->
            <!--            
						<WTCUSTOM>
							Set oHTTP = server.CreateObject("MSXML2.ServerXMLHTTP")
							If oHTTP Is Nothing Then
							Response.Write "Error #" &amp; Err.number &amp; " - " + Err.description
							Else
							'Update a GCR Username / Password
							newLogon = Replace( newLogon, "&amp;", "-") 'can't pass amphersand in URL
							newLogon = Replace( newLogon, "%", "-") 'can't pass percent in URL
							tmpURL = "GlobalCoinUpdate.asp?MemberID=" + CStr(reqSysMemberID) + "&amp;User=" + newLogon + "&amp;Pswd=" + newPassword
							oHTTP.open "GET", "http://" + reqSysServerName + reqSysServerPath + tmpURL
							oHTTP.send
							End If
							Set oHTTP = Nothing
						</WTCUSTOM>
-->
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
          <WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)" connector="and"/>
          <WTLINK name="0105" return="false">
            <WTPARAM name="AuthUserID" value="SYS(userid)"/>
            <WTPARAM name="MailReturnURL" value="CONST(GetCache(&quot;0106URL&quot;))"/>
          </WTLINK>
        </WTRETURN>
      </WTACTION>

      <WTACTION id="3" name="Cancel" type="Cancel">
        <WTSETCACHE name="SYS(returnurl)" value="CONST(&quot;&quot;)"/>
        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
        </WTRETURN>
      </WTACTION>

      <!--**********************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="160" align="right"/>
        <WTCOLUMN width="440" align="left"/>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ChangePassword" class="PageHeading"/>
        </WTROW>
        <WTROW margin-bottom="12" margin-top="2">
          <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="VerifyEmailAddress" class="ColumnHeader"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="VerifyEmailChangePasswordHelp"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" tag="Email" height="36" class="BoldText"/>
          <WTSTATIC col="2" value="ATTR(AuthUser.Email)" class="BoldText"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ChangePassword" class="ColumnHeader"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="ChangePasswordHelp"/>
        </WTROW>
        <WTROW margin-top="12">
          <WTSTATIC col="1" align="right" tag="Password"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.Password)" size="20"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" align="right" tag="NewPassword"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.NewPassword)" size="20"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" align="right" tag="ConfirmPassword"/>
          <WTTEXT col="2"  value="ATTR(AuthUser.ConfirmPassword)" size="20"/>
        </WTROW>
        <WTROW margin-top="12" margin-bottom="12">
          <WTSTATIC col="1"/>
          <WTBUTTON col="2" action="1" value="CONST(NewPassword)"/>
          <WTBUTTON col="2" action="3" value="CONST(Cancel)">
            <WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)"/>
          </WTBUTTON>
          <WTBUTTON col="2" value="CONST(Close)">
            <WTCONDITION expr="PARAM(Popup)" oper="greater" value="CONST(0)"/>
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
          <WTSTATIC col="2" label="Updated" fontcolor="red" bold="true">
            <WTCONDITION expr="PARAM(Action)" oper="equal" value="CONST(1)" />
          </WTSTATIC>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================-->
    <WTWEBPAGE name="0107" caption="2 Step Verification" header="false" footer="false" navbar="false" wrapper="wrapper800"
				   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" secured="61" track="0">
      <!--==================================================================================================-->
      <WTPARAM name="AuthUserID" datatype="number"/>
      <WTPARAM name="User" datatype="text"/>
      <WTPARAM name="UserKey" datatype="text"/>
      <WTPARAM name="Mode" datatype="number"/>
      <WTPARAM name="Popup" datatype="number"/>
      <WTPARAM name="O2FA" datatype="number"/>
      <WTPARAM name="SecurityCode" datatype="text"/>

      <WTDATATXN name="HTMLFile"/>
      <WTINCLUDE name="Google2FA.asp"/>

      <!-- Mode 0 = Enable 2FA -->
      <!-- Mode 1 = Disable 2FA -->
      <!-- Mode 2 = 2FA Enabled -->
      <!-- Mode 3 = 2FA Disabled -->

      <WTCODEGROUP>
        <WTCUSTOM>
          reqO2FA = Numeric(GetCache("O2FA"))
        </WTCUSTOM>
      </WTCODEGROUP>

      <WTCODEGROUP>
        <WTSETATTRIBUTE name="PARAM(AuthUserID)" value="SYS(userid)">
          <WTCONDITION expr="PARAM(AuthUserID)" oper="equal" value="CONST(0)"/>
        </WTSETATTRIBUTE>
      </WTCODEGROUP>

      <WTSUB name="Load2FA">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="PARAM(AuthUserID)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(User)" value="CONST(.NameFirst + &quot; &quot; + .NameLast + &quot; (&quot; + .Logon + &quot;)&quot;)"/>
          <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(1)">
            <WTCONDITION expr="ATTR(AuthUser.UserKey)" oper="not-equal" value="CONST(&quot;&quot;)"/>
          </WTSETATTRIBUTE>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="CONST(tmpApp)" value="CONST(&quot;Pinnacle&quot;)"/>
          <WTOBJECT name="Business" project="ptsBusinessUser" class="CBusiness">
            <WTCONDITION expr="IsTranslator"/>
            <WTMETHOD name="Load">
              <WTPARAM name="BusinessID" direction="input" value="CONST(1)" />
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)" />
            </WTMETHOD>
            <WTSETATTRIBUTE name="CONST(tmpApp)" value="ATTR(BusinessName)"/>
          </WTOBJECT>
          <WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
            <WTCONDITION expr="IsMemberOnly"/>
            <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
            <WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
            <WTMETHOD name="Load">
              <WTPARAM name="CompanyID" direction="input" value="SYS(CompanyID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="CONST(tmpApp)" value="ATTR(CompanyName)"/>
          </WTOBJECT>
          <WTCUSTOM>
            reqUserKey = Left(UUID(),10)
            tmpQRCodeUrl = ""
            tmpSetupCode = ""
            Create2FAUser tmpApp, reqUser, reqUserKey, tmpQRCodeUrl, tmpSetupCode
          </WTCUSTOM>
          <WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
            <WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(&quot;2FA.htm&quot;)" />
            <WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\&quot;)"/>
            <WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)" />
            <WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)" />
            <WTMETHOD name="Load" />
            <WTMETHOD name="XML">
              <WTPARAM name="xmlHTMLFile" direction="return" datatype="text" />
            </WTMETHOD>
            <WTCUSTOM>
              xmlHTMLFile = Replace( xmlHTMLFile, "{qrcode}", tmpQRCodeUrl )
              xmlHTMLFile = Replace( xmlHTMLFile, "{manualcode}", tmpSetupCode )
            </WTCUSTOM>
          </WTOBJECT>
        </WTCODEGROUP>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="Load2FA"/>
      </WTACTION>

      <WTACTION id="1" name="Enable" type="Update">
        <!--VERIFY GOOGLE AUTHENTICATOR SECURITY CODE -->
        <WTCODEGROUP>
          <WTCUSTOM>
            If Not Verify2FAUser( reqUserKey, reqSecurityCode ) Then
            reqSecurityCode = ""
            DoError 10138, "", "Oops, Invalid Security Code"
            Load2FA()
            End If
          </WTCUSTOM>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
            <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="PARAM(AuthUserID)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="ATTR(UserKey)" value="PARAM(UserKey)"/>
            <WTMETHOD name="UpdateUserKey">
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTOBJECT>
          <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(2)"/>
        </WTCODEGROUP>
      </WTACTION>

      <WTACTION id="2" name="Disable" type="Update">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="PARAM(AuthUserID)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(UserKey)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="UpdateUserKey">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(3)"/>
      </WTACTION>
      <!--**********************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="20" align="center"/>
        <WTCOLUMN width="760" align="center"/>
        <WTCOLUMN width="20" align="center"/>

        <WTROW>
          <WTHIDDEN value="PARAM(User)"/>
          <WTHIDDEN value="PARAM(UserKey)"/>
        </WTROW>
        
        <WTROW>
          <WTSTATIC col="1" merge="3" tag="2StepVerification" value="PARAM(User)" align="left" class="PageHeading"/>
        </WTROW>
        <WTROW margin-bottom="6" margin-top="2">
          <WTDIVIDER col="1" merge="3" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(0)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1"/>
            <WTSTATIC col="2" value="ATTR(HTMLFile.Data)" embedhtml="true"/>
            <WTSTATIC col="3"/>
          </WTROW>
          <WTROW margin-top="12">
            <WTSTATIC col="1" merge="2" tag="SecurityCode" align="center" bold="true" fontsize="4"/>
            <WTTEXT col="1" value="PARAM(SecurityCode)" size="10"/>
          </WTROW>
          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" merge="3" action="1" value="CONST(Enable2FA)" btnclass="bigbutton"/>
          </WTROW>
        </WTCODEGROUP>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(1)"/>
          <WTROW margin-top="24" margin-bottom="12">
            <WTSTATIC col="1" merge="3" align="center" label="2FAEnabled" class="PageHeading"/>
          </WTROW>
          <WTROW margin-top="12" margin-bottom="12">
            <WTCONDITION expr="IsEmployee"/>
            <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
            <WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
            <WTBUTTON col="1" merge="3" action="2" value="CONST(Disable2FA)" msg="ConfirmDisable2FA" btnclass="bigbutton"/>
          </WTROW>
        </WTCODEGROUP>

        <WTROW margin-top="24" margin-bottom="12">
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(2)"/>
          <WTSTATIC col="1" merge="3" align="center" label="2FAEnabled" class="PageHeading"/>
        </WTROW>

        <WTROW margin-top="24" margin-bottom="12">
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(3)"/>
          <WTSTATIC col="1" merge="3" align="center" label="2FADisabled" class="PageHeading"/>
        </WTROW>

        <WTROW margin-top="12" margin-bottom="12">
          <WTCONDITION expr="PARAM(Popup)" oper="greater" value="CONST(0)"/>
          <WTBUTTON col="1" merge="3" value="CONST(Close)" align="center">
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================-->
    <WTWEBPAGE name="0108" caption="2 Step Verification" header="false" footer="false" navbar="false" wrapper="wrapper800"
				   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" track="0">
      <!--==================================================================================================-->
      <WTPARAM name="MerchantID" datatype="number"/>
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="User" datatype="text"/>
      <WTPARAM name="UserKey" datatype="text"/>
      <WTPARAM name="Mode" datatype="number"/>
      <WTPARAM name="Popup" datatype="number"/>
      <WTPARAM name="O2FA" datatype="number"/>
      <WTPARAM name="SecurityCode" datatype="text"/>

      <WTDATATXN name="HTMLFile"/>
      <WTINCLUDE name="Google2FA.asp"/>

      <!-- Mode 0 = Enable 2FA -->
      <!-- Mode 1 = Disable 2FA -->
      <!-- Mode 2 = 2FA Enabled -->
      <!-- Mode 3 = 2FA Disabled -->
      
      <WTCODEGROUP>
        <WTCONDITION expr="NotEmployee"/>
        <WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
          <WTGETCACHE name="CONST(tmpMerchantID)" value="MERCHANT" datatype="number"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(tmpMerchantID)"/>
            <WTCUSTOM>AbortUser()</WTCUSTOM>
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
          <WTGETCACHE name="CONST(tmpConsumerID)" value="CONSUMER" datatype="number"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(tmpConsumerID)"/>
            <WTCUSTOM>AbortUser()</WTCUSTOM>
          </WTCODEGROUP>
        </WTCODEGROUP>
      </WTCODEGROUP>

      <WTSUB name="Load2FA">
        <WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(User)" value="ATTR(MerchantName)"/>
          <WTGETCACHE name="CONST(tmpMerchantAcct)" value="MERCHACCT" datatype="number"/>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(tmpMerchantAcct)" oper="equal" value="CONST(0)"/>
            <WTCONDITION expr="CONST(tmpMerchantAcct)" oper="equal" value="CONST(1)" connector="or"/>
            <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(1)">
              <WTCONDITION expr="ATTR(UserKey)" oper="not-equal" value="CONST(&quot;&quot;)"/>
            </WTSETATTRIBUTE>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(tmpMerchantAcct)" oper="equal" value="CONST(3)"/>
            <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(1)">
              <WTCONDITION expr="ATTR(UserKey3)" oper="not-equal" value="CONST(&quot;&quot;)"/>
            </WTSETATTRIBUTE>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(tmpMerchantAcct)" oper="equal" value="CONST(4)"/>
            <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(1)">
              <WTCONDITION expr="ATTR(UserKey4)" oper="not-equal" value="CONST(&quot;&quot;)"/>
            </WTSETATTRIBUTE>
          </WTCODEGROUP>
        </WTOBJECT>
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(User)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
          <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(1)">
            <WTCONDITION expr="ATTR(UserKey)" oper="not-equal" value="CONST(&quot;&quot;)"/>
          </WTSETATTRIBUTE>
        </WTOBJECT>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="CONST(tmpApp)" value="CONST(&quot;NexxusRewards&quot;)"/>
          <WTCUSTOM>
            If reqUserKey = "" Then reqUserKey = Left(UUID(),10)
            tmpQRCodeUrl = ""
            tmpSetupCode = ""
            Create2FAUser tmpApp, reqUser, reqUserKey, tmpQRCodeUrl, tmpSetupCode
          </WTCUSTOM>
          <WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
            <WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(&quot;2FA.htm&quot;)" />
            <WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\&quot;)"/>
            <WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)" />
            <WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)" />
            <WTMETHOD name="Load" />
            <WTMETHOD name="XML">
              <WTPARAM name="xmlHTMLFile" direction="return" datatype="text" />
            </WTMETHOD>
            <WTCUSTOM>
              xmlHTMLFile = Replace( xmlHTMLFile, "{qrcode}", tmpQRCodeUrl )
              xmlHTMLFile = Replace( xmlHTMLFile, "{manualcode}", tmpSetupCode )
            </WTCUSTOM>
          </WTOBJECT>
        </WTCODEGROUP>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="Load2FA"/>
      </WTACTION>

      <WTACTION id="1" name="Enable" type="Update">
        <!--VERIFY GOOGLE AUTHENTICATOR SECURITY CODE -->
        <WTCODEGROUP>
          <WTCUSTOM>
            If Not Verify2FAUser( reqUserKey, reqSecurityCode ) Then
              reqSecurityCode = ""
              DoError 10138, "", "Oops, Invalid Security Code"
              Load2FA()
            End If
          </WTCUSTOM>
        </WTCODEGROUP>
        
        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
            <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTGETCACHE name="CONST(tmpMerchantAcct)" value="MERCHACCT" datatype="number"/>
            <WTSETATTRIBUTE name="ATTR(UserKey)" value="PARAM(UserKey)">
              <WTCONDITION expr="CONST(tmpMerchantAcct)" oper="equal" value="CONST(0)"/>
              <WTCONDITION expr="CONST(tmpMerchantAcct)" oper="equal" value="CONST(1)" connector="or"/>
            </WTSETATTRIBUTE>
            <WTSETATTRIBUTE name="ATTR(UserKey3)" value="PARAM(UserKey)">
              <WTCONDITION expr="CONST(tmpMerchantAcct)" oper="equal" value="CONST(3)"/>
            </WTSETATTRIBUTE>
            <WTSETATTRIBUTE name="ATTR(UserKey4)" value="PARAM(UserKey)">
              <WTCONDITION expr="CONST(tmpMerchantAcct)" oper="equal" value="CONST(4)"/>
            </WTSETATTRIBUTE>
            <WTMETHOD name="Save">
              <WTCONDITION expr="NoErrors"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTOBJECT>
          <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
            <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="ATTR(UserKey)" value="PARAM(UserKey)"/>
            <WTMETHOD name="Save">
              <WTCONDITION expr="NoErrors"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTOBJECT>
          <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(2)"/>
        </WTCODEGROUP>
      </WTACTION>

      <WTACTION id="2" name="Disable" type="Update">
        <WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTGETCACHE name="CONST(tmpMerchantAcct)" value="MERCHACCT" datatype="number"/>
          <WTSETATTRIBUTE name="ATTR(UserKey)" value="CONST(&quot;&quot;)">
            <WTCONDITION expr="CONST(tmpMerchantAcct)" oper="equal" value="CONST(0)"/>
            <WTCONDITION expr="CONST(tmpMerchantAcct)" oper="equal" value="CONST(1)" connector="or"/>
          </WTSETATTRIBUTE>
          <WTSETATTRIBUTE name="ATTR(UserKey3)" value="CONST(&quot;&quot;)">
            <WTCONDITION expr="CONST(tmpMerchantAcct)" oper="equal" value="CONST(3)"/>
          </WTSETATTRIBUTE>
          <WTSETATTRIBUTE name="ATTR(UserKey4)" value="CONST(&quot;&quot;)">
            <WTCONDITION expr="CONST(tmpMerchantAcct)" oper="equal" value="CONST(4)"/>
          </WTSETATTRIBUTE>
          <WTMETHOD name="Save">
            <WTCONDITION expr="NoErrors"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>
        
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(UserKey)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="Save">
            <WTCONDITION expr="NoErrors"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>
        
        <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(3)"/>
      </WTACTION>
      <!--**********************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="20" align="center"/>
        <WTCOLUMN width="760" align="center"/>
        <WTCOLUMN width="20" align="center"/>

        <WTROW>
          <WTHIDDEN value="PARAM(User)"/>
          <WTHIDDEN value="PARAM(UserKey)"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" merge="3" tag="2StepVerification" value="PARAM(User)" align="left" class="PageHeading"/>
        </WTROW>
        <WTROW margin-bottom="6" margin-top="2">
          <WTDIVIDER col="1" merge="3" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(0)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1"/>
            <WTSTATIC col="2" value="ATTR(HTMLFile.Data)" embedhtml="true"/>
            <WTSTATIC col="3"/>
          </WTROW>
          <WTROW margin-top="12">
            <WTSTATIC col="1" merge="2" tag="SecurityCode" align="center" bold="true" fontsize="4"/>
            <WTTEXT col="1" value="PARAM(SecurityCode)" size="10"/>
          </WTROW>
          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" merge="3" action="1" value="CONST(Enable2FA)" btnclass="bigbutton"/>
          </WTROW>
        </WTCODEGROUP>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(1)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1" merge="3" align="center" label="2FAEnabled" class="PageHeading"/>
          </WTROW>
          <WTROW margin-top="24" margin-bottom="12">
            <WTCONDITION expr="IsEmployee"/>
            <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
            <WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
            <WTBUTTON col="1" merge="3" action="2" value="CONST(Disable2FA)" msg="ConfirmDisable2FA" btnclass="bigbutton"/>
          </WTROW>
        </WTCODEGROUP>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(2)"/>
          <WTROW margin-top="24" margin-bottom="12">
            <WTSTATIC col="1" merge="3" align="center" label="2FAEnabled" class="PageHeading"/>
          </WTROW>
          <WTROW margin-top="24" margin-bottom="12">
            <WTBUTTON col="1" merge="3" value="CONST(Continue2FA)" btnclass="bigbutton">
              <WTCLICK>window.parent.location.reload(1);</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(3)"/>
          <WTROW margin-top="24" margin-bottom="12">
            <WTSTATIC col="1" merge="3" align="center" label="2FADisabled" class="PageHeading"/>
          </WTROW>
          <WTROW margin-top="24" margin-bottom="12">
            <WTBUTTON col="1" merge="3" value="CONST(Continue2FA)" btnclass="bigbutton">
              <WTCLICK>window.parent.location.reload(1);</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

        <WTROW margin-bottom="12">
          <WTCONDITION expr="PARAM(Popup)" oper="not-equal" value="CONST(0)"/>
          <WTBUTTON col="1" merge="3" value="CONST(Close)" align="center">
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================-->
      <WTWEBPAGE name="m_0108" caption="2 Step Verification" page-left="0" page-top="0" navbar="false" header="false" footer="false"
      page-width="100%" margin-width="0%" navbar-width="0%" content-width="100%" viewport="width=device-width"
      aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" track="0">
      <!--==================================================================================================-->
      <WTPARAM name="MerchantID" datatype="number"/>
      <WTPARAM name="ConsumerID" datatype="number"/>
      <WTPARAM name="User" datatype="text"/>
      <WTPARAM name="UserKey" datatype="text"/>
      <WTPARAM name="Mode" datatype="number"/>
      <WTPARAM name="Popup" datatype="number"/>
      <WTPARAM name="O2FA" datatype="number"/>
      <WTPARAM name="SecurityCode" datatype="text"/>

      <WTDATATXN name="HTMLFile"/>
      <WTINCLUDE name="Google2FA.asp"/>

      <!-- Mode 0 = Enable 2FA -->
      <!-- Mode 1 = Disable 2FA -->
      <!-- Mode 2 = 2FA Enabled -->
      <!-- Mode 3 = 2FA Disabled -->

      <WTCODEGROUP>
        <WTCONDITION expr="NotEmployee"/>
        <WTCONDITION expr="NotOrgAdminOnly" connector="and"/>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
          <WTGETCACHE name="CONST(tmpMerchantID)" value="MERCHANT" datatype="number"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(tmpMerchantID)"/>
            <WTCUSTOM>AbortUser()</WTCUSTOM>
          </WTCODEGROUP>
        </WTCODEGROUP>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
          <WTGETCACHE name="CONST(tmpConsumerID)" value="CONSUMER" datatype="number"/>
          <WTCODEGROUP>
            <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(tmpConsumerID)"/>
            <WTCUSTOM>AbortUser()</WTCUSTOM>
          </WTCODEGROUP>
        </WTCODEGROUP>
      </WTCODEGROUP>

      <WTSUB name="Load2FA">
        <WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(User)" value="ATTR(MerchantName)"/>
          <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(1)">
            <WTCONDITION expr="ATTR(UserKey)" oper="not-equal" value="CONST(&quot;&quot;)"/>
          </WTSETATTRIBUTE>
        </WTOBJECT>
        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(User)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
          <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(1)">
            <WTCONDITION expr="ATTR(UserKey)" oper="not-equal" value="CONST(&quot;&quot;)"/>
          </WTSETATTRIBUTE>
        </WTOBJECT>
        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(0)"/>
          <WTSETATTRIBUTE name="CONST(tmpApp)" value="CONST(&quot;NexxusRewards&quot;)"/>
          <WTCUSTOM>
            If reqUserKey = "" Then reqUserKey = Left(UUID(),10)
            tmpQRCodeUrl = ""
            tmpSetupCode = ""
            Create2FAUser tmpApp, reqUser, reqUserKey, tmpQRCodeUrl, tmpSetupCode
          </WTCUSTOM>
          <WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
            <WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(&quot;2FA.htm&quot;)" />
            <WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\&quot;)"/>
            <WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)" />
            <WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)" />
            <WTMETHOD name="Load" />
            <WTMETHOD name="XML">
              <WTPARAM name="xmlHTMLFile" direction="return" datatype="text" />
            </WTMETHOD>
            <WTCUSTOM>
              xmlHTMLFile = Replace( xmlHTMLFile, "{qrcode}", tmpQRCodeUrl )
              xmlHTMLFile = Replace( xmlHTMLFile, "{manualcode}", tmpSetupCode )
            </WTCUSTOM>
          </WTOBJECT>
        </WTCODEGROUP>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="Load2FA"/>
      </WTACTION>

      <WTACTION id="1" name="Enable" type="Update">
        <!--VERIFY GOOGLE AUTHENTICATOR SECURITY CODE -->
        <WTCODEGROUP>
          <WTCUSTOM>
            If Not Verify2FAUser( reqUserKey, reqSecurityCode ) Then
            reqSecurityCode = ""
            DoError 10138, "", "Oops, Invalid Security Code"
            Load2FA()
            End If
          </WTCUSTOM>
        </WTCODEGROUP>

        <WTCODEGROUP>
          <WTCONDITION expr="NoErrors"/>
          <WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
            <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="ATTR(UserKey)" value="PARAM(UserKey)"/>
            <WTMETHOD name="Save">
              <WTCONDITION expr="NoErrors"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTOBJECT>
          <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
            <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
            <WTMETHOD name="Load">
              <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
            <WTSETATTRIBUTE name="ATTR(UserKey)" value="PARAM(UserKey)"/>
            <WTMETHOD name="Save">
              <WTCONDITION expr="NoErrors"/>
              <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
            </WTMETHOD>
          </WTOBJECT>
          <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(2)"/>
        </WTCODEGROUP>
      </WTACTION>

      <WTACTION id="2" name="Disable" type="Update">
        <WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(UserKey)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="Save">
            <WTCONDITION expr="NoErrors"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>

        <WTOBJECT name="Consumer" project="ptsConsumerUser" class="CConsumer">
          <WTCONDITION expr="PARAM(ConsumerID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="ConsumerID" direction="input" value="PARAM(ConsumerID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="ATTR(UserKey)" value="CONST(&quot;&quot;)"/>
          <WTMETHOD name="Save">
            <WTCONDITION expr="NoErrors"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>

        <WTSETATTRIBUTE name="PARAM(Mode)" value="CONST(3)"/>
      </WTACTION>
      <!--**********************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="2" align="center"/>
        <WTCOLUMN width="96" align="center"/>
        <WTCOLUMN width="2" align="center"/>

        <WTROW>
          <WTHIDDEN value="PARAM(User)"/>
          <WTHIDDEN value="PARAM(UserKey)"/>
        </WTROW>

        <WTROW>
          <WTSTATIC col="1" merge="3" tag="2StepVerification" value="PARAM(User)" align="left" class="PageHeading"/>
        </WTROW>
        <WTROW margin-bottom="6" margin-top="2">
          <WTDIVIDER col="1" merge="3" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(0)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1"/>
            <WTSTATIC col="2" value="ATTR(HTMLFile.Data)" embedhtml="true"/>
            <WTSTATIC col="3"/>
          </WTROW>
          <WTROW margin-top="12">
            <WTSTATIC col="1" merge="2" tag="SecurityCode" align="center" bold="true" fontsize="4"/>
            <WTTEXT col="1" value="PARAM(SecurityCode)" size="10"/>
          </WTROW>
          <WTROW margin-top="12" margin-bottom="12">
            <WTBUTTON col="1" merge="3" action="1" value="CONST(Enable2FA)" btnclass="bigbutton"/>
          </WTROW>
        </WTCODEGROUP>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(1)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1" merge="3" align="center" label="2FAEnabled" class="PageHeading"/>
          </WTROW>
          <WTROW margin-top="24" margin-bottom="12">
            <WTCONDITION expr="IsEmployee"/>
            <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
            <WTCONDITION expr="IsOrgManagerOnly" connector="or"/>
            <WTBUTTON col="1" merge="3" action="2" value="CONST(Disable2FA)" msg="ConfirmDisable2FA" btnclass="bigbutton"/>
          </WTROW>
        </WTCODEGROUP>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(2)"/>
          <WTROW margin-top="24" margin-bottom="12">
            <WTSTATIC col="1" merge="3" align="center" label="2FAEnabled" class="PageHeading"/>
          </WTROW>
          <WTROW margin-top="24" margin-bottom="12">
            <WTBUTTON col="1" merge="3" value="CONST(Continue2FA)" btnclass="bigbutton">
              <WTCLICK>window.parent.location.reload(1);</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(Mode)" oper="equal" value="CONST(3)"/>
          <WTROW margin-top="24" margin-bottom="12">
            <WTSTATIC col="1" merge="3" align="center" label="2FADisabled" class="PageHeading"/>
          </WTROW>
          <WTROW margin-top="24" margin-bottom="12">
            <WTBUTTON col="1" merge="3" value="CONST(Continue2FA)" btnclass="bigbutton">
              <WTCLICK>window.parent.location.reload(1);</WTCLICK>
            </WTBUTTON>
          </WTROW>
        </WTCODEGROUP>

        <WTROW margin-bottom="12">
          <WTCONDITION expr="PARAM(Popup)" oper="not-equal" value="CONST(0)"/>
          <WTBUTTON col="1" merge="3" value="CONST(Close)" align="center">
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--============================================================================================-->
    <WTWEBPAGE name="0109" caption="Access Limits" header="false" footer="false" navbar="false" wrapper="wrapper600"
			   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" langfile="0109">
    <!--============================================================================================-->
      <WTPARAM name="MemberID" datatype="number"/>
      <WTPARAM name="MerchantID" datatype="number"/>
      <WTPARAM name="StaffID" datatype="number"/>
      <WTPARAM name="Name" datatype="text"/>
      <WTPARAM name="txn" datatype="number"/>

      <WTPARAM name="IP" datatype="text"/>
      <WTPARAM name="DAY1" datatype="number"/>
      <WTPARAM name="DAY2" datatype="number"/>
      <WTPARAM name="DAY3" datatype="number"/>
      <WTPARAM name="DAY4" datatype="number"/>
      <WTPARAM name="DAY5" datatype="number"/>
      <WTPARAM name="DAY6" datatype="number"/>
      <WTPARAM name="DAY7" datatype="number"/>
      <WTPARAM name="TIME1" datatype="number"/>
      <WTPARAM name="TIME2" datatype="number"/>
      <WTPARAM name="TZ" datatype="number"/>

      ' ********************
      ' IP:1.2.3.4
      ' DAY:17
      ' TIME:900-1700
      ' TZ:5
      ' ********************

      <WTPARAM name="Access" datatype="text"/>
      <WTACTION id="0" name="New" type="New">
        <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
          <WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MemberID" direction="input" value="PARAM(MemberID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(Name)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
          <WTSETATTRIBUTE name="PARAM(Access)" value="ATTR(AccessLimit)"/>
        </WTOBJECT>
        <WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(Name)" value="ATTR(MerchantName)"/>
          <WTSETATTRIBUTE name="PARAM(Access)" value="ATTR(Access)"/>
        </WTOBJECT>
        <WTOBJECT name="Staff" project="ptsStaffUser" class="CStaff">
          <WTCONDITION expr="PARAM(StaffID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="StaffID" direction="input" value="PARAM(StaffID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(Name)" value="ATTR(StaffName)"/>
          <WTSETATTRIBUTE name="PARAM(Access)" value="ATTR(Access)"/>
        </WTOBJECT>
        <WTCODEGROUP>
          <WTCUSTOM>
            aAccess = Split( reqAccess, " " )
            total = UBOUND(aAccess)
            tmpDay = ""
            tmpTime = ""
            reqTime1 = -99
            reqTime2 = -99
            reqTZ = -99
            For x = 0 to total
            a = Split( aAccess(x), ":" )
            Select Case a(0)
            Case "IP": reqIP = a(1)
            Case "DAY": tmpDay = a(1)
            Case "TIME": tmpTime = a(1)
            Case "TZ": reqTZ = a(1)
            End Select
            Next
            If tmpDay &lt;&gt; "" Then
              If InStr( tmpDay, "1") > 0 Then reqDay1 = 1
              If InStr( tmpDay, "2") > 0 Then reqDay2 = 1
              If InStr( tmpDay, "3") > 0 Then reqDay3 = 1
              If InStr( tmpDay, "4") > 0 Then reqDay4 = 1
              If InStr( tmpDay, "5") > 0 Then reqDay5 = 1
              If InStr( tmpDay, "6") > 0 Then reqDay6 = 1
              If InStr( tmpDay, "7") > 0 Then reqDay7 = 1
            End If
            If tmpTime &lt;&gt; "" Then
              a = Split( tmpTime, "-" )
              If UBOUND(a) = 1 Then
                reqTime1 = a(0)
                reqTime2 = a(1)
              End If
            End If
          </WTCUSTOM>
        </WTCODEGROUP>
      </WTACTION>

      <WTACTION id="1" name="Update" type="Update">
        <WTSETATTRIBUTE name="PARAM(txn)" value="CONST(1)"/>
        <WTCODEGROUP>
          <WTCUSTOM>
            reqAccess = ""
            reqIP = Replace( reqIP, " ", "")
            If reqIP &lt;&gt; "" Then reqAccess = reqAccess + "IP:" + reqIP + " "
            tmp = ""
            If reqDay1 &gt; 0 Then tmp = tmp + "1"
            If reqDay2 &gt; 0 Then tmp = tmp + "2"
            If reqDay3 &gt; 0 Then tmp = tmp + "3"
            If reqDay4 &gt; 0 Then tmp = tmp + "4"
            If reqDay5 &gt; 0 Then tmp = tmp + "5"
            If reqDay6 &gt; 0 Then tmp = tmp + "6"
            If reqDay7 &gt; 0 Then tmp = tmp + "7"
            If tmp &lt;&gt; "" Then reqAccess = reqAccess + "DAY:" + tmp + " "
            If reqTime1 &gt; 0 And reqTime2 &gt; 0 Then
              reqAccess = reqAccess + "TIME:" + CSTR(reqTime1) + "-" + CSTR(reqTime2) + " "
              If reqTZ &lt;&gt; -99 Then reqAccess = reqAccess + "TZ:" + CSTR(reqTZ)
            End If
            If Len(reqAccess) &gt; 80 Then reqAccess = Left(reqAccess, 80)
          </WTCUSTOM>
        </WTCODEGROUP>
        <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
          <WTCONDITION expr="PARAM(MemberID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MemberID" direction="input" value="PARAM(MemberID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(Name)" value="CONST(.NameFirst + &quot; &quot; + .NameLast)"/>
          <WTSETATTRIBUTE name="ATTR(AccessLimit)" value="PARAM(Access)"/>
          <WTMETHOD name="Save">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTOBJECT name="Merchant" project="ptsMerchantUser" class="CMerchant">
          <WTCONDITION expr="PARAM(MerchantID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MerchantID" direction="input" value="PARAM(MerchantID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(Name)" value="ATTR(MerchantName)"/>
          <WTSETATTRIBUTE name="ATTR(Access)" value="PARAM(Access)"/>
          <WTMETHOD name="Save">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>
        <WTOBJECT name="Staff" project="ptsStaffUser" class="CStaff">
          <WTCONDITION expr="PARAM(StaffID)" oper="not-equal" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="StaffID" direction="input" value="PARAM(StaffID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(Name)" value="ATTR(StaffName)"/>
          <WTSETATTRIBUTE name="ATTR(Access)" value="PARAM(Access)"/>
          <WTMETHOD name="Save">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTACTION>

      <!--**********************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="250" align="right"/>
        <WTCOLUMN width="350" align="left"/>

        <WTROW>
          <WTSTATIC col="1" merge="2" class="PageHeading" align="left">
            <WTSTATIC tag="AccessLimits" value="PARAM(Name)" space="1"/>
            <WTSTATIC label="Updated" fontsize="4" fontcolor="red">
              <WTCONDITION expr="PARAM(txn)" oper="equal" value="CONST(1)"/>
            </WTSTATIC>
          </WTSTATIC>
        </WTROW>
        <WTROW>
          <WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
        </WTROW>

        <!-- IP Address ******************************************************-->
        <WTROW margin-top="12" margin-bottom="6">
          <WTSTATIC col="1" merge="2" label="IPText" class="prompt" align="left"/>
        </WTROW>
        <WTROW margin-bottom="3">
          <WTSTATIC col="1" merge="2" tag="IP" align="center"/>
          <WTTEXT col="1" value="PARAM(IP)" size="60"/>
        </WTROW>

        <!-- Days ******************************************************-->
        <WTROW margin-top="12">
          <WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
        </WTROW>
        <WTROW margin-top="12" margin-bottom="6">
          <WTSTATIC col="1" merge="2" label="DayText" class="prompt" align="left"/>
        </WTROW>
        <WTROW margin-bottom="3">
          <WTCHECK col="1" merge="2" value="PARAM(DAY1)" label="DAY1" align="center"/>
          <WTCHECK col="1" value="PARAM(DAY2)" label="DAY2"/>
          <WTCHECK col="1" value="PARAM(DAY3)" label="DAY3"/>
          <WTCHECK col="1" value="PARAM(DAY4)" label="DAY4"/>
          <WTCHECK col="1" value="PARAM(DAY5)" label="DAY5"/>
          <WTCHECK col="1" value="PARAM(DAY6)" label="DAY6"/>
          <WTCHECK col="1" value="PARAM(DAY7)" label="DAY7"/>
        </WTROW>

        <!-- Time Address ******************************************************-->
        <WTROW margin-top="12">
          <WTDIVIDER col="1" merge="2" height="1" color="SYS(headerdivider)"/>
        </WTROW>
        <WTROW margin-top="12" margin-bottom="6">
          <WTSTATIC col="1" merge="2" label="TimeText" class="prompt" align="left"/>
        </WTROW>
        <WTROW margin-bottom="3">
          <WTSTATIC col="1" merge="2" tag="From" align="center"/>
          <WTCOMBO col="1" value="PARAM(TIME1)" prespace="false">
            <WTOPTION id="-99" label="blank"/>
            <WTOPTION id="1" label="12:00am"/>
            <WTOPTION id="100" label="1:00am"/>
            <WTOPTION id="200" label="2:00am"/>
            <WTOPTION id="300" label="3:00am"/>
            <WTOPTION id="400" label="4:00am"/>
            <WTOPTION id="500" label="5:00am"/>
            <WTOPTION id="600" label="6:00am"/>
            <WTOPTION id="700" label="7:00am"/>
            <WTOPTION id="800" label="8:00am"/>
            <WTOPTION id="900" label="9:00am"/>
            <WTOPTION id="1000" label="10:00am"/>
            <WTOPTION id="1100" label="11:00am"/>
            <WTOPTION id="1200" label="12:00pm"/>
            <WTOPTION id="1300" label="1:00pm"/>
            <WTOPTION id="1400" label="2:00pm"/>
            <WTOPTION id="1500" label="3:00pm"/>
            <WTOPTION id="1600" label="4:00pm"/>
            <WTOPTION id="1700" label="5:00pm"/>
            <WTOPTION id="1800" label="6:00pm"/>
            <WTOPTION id="1900" label="7:00pm"/>
            <WTOPTION id="2000" label="8:00pm"/>
            <WTOPTION id="2100" label="9:00pm"/>
            <WTOPTION id="2200" label="10:00pm"/>
            <WTOPTION id="2300" label="11:00pm"/>
            <WTOPTION id="2359" label="12:00am"/>
          </WTCOMBO>
          <WTSTATIC col="1" tag="To"/>
          <WTCOMBO col="1" value="PARAM(TIME2)" prespace="false">
            <WTOPTION id="-99" label="blank"/>
            <WTOPTION id="1" label="12:00am"/>
            <WTOPTION id="100" label="1:00am"/>
            <WTOPTION id="200" label="2:00am"/>
            <WTOPTION id="300" label="3:00am"/>
            <WTOPTION id="400" label="4:00am"/>
            <WTOPTION id="500" label="5:00am"/>
            <WTOPTION id="600" label="6:00am"/>
            <WTOPTION id="700" label="7:00am"/>
            <WTOPTION id="800" label="8:00am"/>
            <WTOPTION id="900" label="9:00am"/>
            <WTOPTION id="1000" label="10:00am"/>
            <WTOPTION id="1100" label="11:00am"/>
            <WTOPTION id="1200" label="12:00pm"/>
            <WTOPTION id="1300" label="1:00pm"/>
            <WTOPTION id="1400" label="2:00pm"/>
            <WTOPTION id="1500" label="3:00pm"/>
            <WTOPTION id="1600" label="4:00pm"/>
            <WTOPTION id="1700" label="5:00pm"/>
            <WTOPTION id="1800" label="6:00pm"/>
            <WTOPTION id="1900" label="7:00pm"/>
            <WTOPTION id="2000" label="8:00pm"/>
            <WTOPTION id="2100" label="9:00pm"/>
            <WTOPTION id="2200" label="10:00pm"/>
            <WTOPTION id="2300" label="11:00pm"/>
            <WTOPTION id="2359" label="12:00am"/>
          </WTCOMBO>
          <WTSTATIC col="1" merge="2" tag="TimeZone" align="center"/>
          <WTCOMBO col="1" value="PARAM(TZ)" prespace="false">
            <WTOPTION id="-99" label="blank"/>
            <WTOPTION id="-12" label="GMT-12"/>
            <WTOPTION id="-11" label="GMT-11"/>
            <WTOPTION id="-10" label="GMT-10"/>
            <WTOPTION id="-9" label="GMT-9"/>
            <WTOPTION id="-8" label="GMT-8"/>
            <WTOPTION id="-7" label="GMT-7"/>
            <WTOPTION id="-6" label="GMT-6"/>
            <WTOPTION id="-5" label="GMT-5"/>
            <WTOPTION id="-4" label="GMT-4"/>
            <WTOPTION id="-3" label="GMT-3"/>
            <WTOPTION id="-2" label="GMT-2"/>
            <WTOPTION id="-1" label="GMT-1"/>
            <WTOPTION id="0" label="GMT"/>
            <WTOPTION id="1" label="GMT+1"/>
            <WTOPTION id="2" label="GMT+2"/>
            <WTOPTION id="3" label="GMT+3"/>
            <WTOPTION id="4" label="GMT+4"/>
            <WTOPTION id="5" label="GMT+5"/>
            <WTOPTION id="6" label="GMT+6"/>
            <WTOPTION id="7" label="GMT+7"/>
            <WTOPTION id="8" label="GMT+8"/>
            <WTOPTION id="9" label="GMT+9"/>
            <WTOPTION id="10" label="GMT+10"/>
            <WTOPTION id="11" label="GMT+11"/>
            <WTOPTION id="12" label="GMT+12"/>
          </WTCOMBO>
        </WTROW>

        <WTROW margin-top="24" margin-bottom="6">
          <WTBUTTON col="1" merge="2" action="1" value="CONST(Update)" align="center"/>
          <WTBUTTON col="1" value="CONST(Close)">
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================-->
    <WTWEBPAGE name="0104" caption="SendLogonPassword" wrapper="wrapper600" header="false" footer="false" navbar="false"
				   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" secured="61">
      <!--==================================================================================================-->
      <WTPARAM name="AuthUserID" datatype="number"/>
      <WTPARAM name="Popup" datatype="number"/>
      <WTPARAM name="IsEdit" datatype="number"/>

      <WTCODEGROUP>
        <WTCONDITION expr="IsOrgAdmin"/>
        <WTSETATTRIBUTE name="PARAM(IsEdit)" value="CONST(1)"/>
      </WTCODEGROUP>
<!--
      <WTCODEGROUP>
        <WTCONDITION expr="SYS(CompanyID)" oper="equal" value="CONST(17)"/>
        <WTSETATTRIBUTE name="PARAM(IsEdit)" value="CONST(0)"/>
      </WTCODEGROUP>
-->      
      <WTCODEGROUP>
        <WTCONDITION expr="IsManager"/>
        <WTSETATTRIBUTE name="PARAM(IsEdit)" value="CONST(1)"/>
      </WTCODEGROUP>

      <WTSUB name="LoadAuthUser">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="PARAM(AuthUserID)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="LoadAuthUser"/>
      </WTACTION>

      <WTACTION id="1" name="Update" type="Update">
        <WTHTTP>
          <WTLINK name="0105">
            <WTPARAM name="AuthUserID" value="PARAM(AuthUserID)"/>
          </WTLINK>
        </WTHTTP>
        <WTCALLSUB name="LoadAuthUser">
          <WTCONDITION expr="PARAM(Popup)" oper="not-equal" value="CONST(0)"/>
        </WTCALLSUB>
        <WTRETURN>
          <WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)"/>
        </WTRETURN>
      </WTACTION>

      <WTACTION id="3" name="Cancel" type="Cancel">
        <WTSETCACHE name="SYS(returnurl)" value="CONST(&quot;&quot;)"/>
        <WTRETURN>
          <WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)"/>
        </WTRETURN>
      </WTACTION>

      <!--*************************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="160" align="right"/>
        <WTCOLUMN width="440" align="left"/>

        <WTROW>
          <WTTABLE col="1" merge="2">
            <WTCOLUMN width="350" align="left"/>
            <WTCOLUMN width="250" align="right"/>
            <WTROW>
              <WTSTATIC col="1" label="ResetLogonPassword" class="PageHeading" align="left"/>
              <WTSTATIC col="2" label="Logon" bold="true" align="right">
                <WTCONDITION expr="PARAM(IsEdit)" oper="not-equal" value="CONST(0)"/>
                <WTLINK name="0113">
                  <WTPARAM name="AuthUserID" value="ATTR(AuthUser.AuthUserID)"/>
                </WTLINK>
              </WTSTATIC>
              <WTSTATIC col="2" value="CONST(|)"/>
              <WTSTATIC col="2" label="2StepVerification" bold="true">
                <WTCONDITION expr="IsManager"/>
                <WTCONDITION expr="IsOrgAdminOnly" connector="or"/>
                <WTLINK name="0107" target="2FA">
                  <WTPARAM name="AuthUserID" value="ATTR(AuthUser.AuthUserID)"/>
                  <WTPARAM name="Popup" value="CONST(1)"/>
                </WTLINK>
              </WTSTATIC>
            </WTROW>
          </WTTABLE>
        </WTROW>

        <WTROW margin-bottom="12" margin-top="2">
          <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="VerifyEmailAddress" class="ColumnHeader"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" merge="2" align="left" label="VerifyEmailResetHelp"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" tag="Email" height="48" class="BoldText"/>
          <WTSTATIC col="2" value="ATTR(AuthUser.Email)" class="BoldText"/>
        </WTROW>

        <WTROW margin-top="12" margin-bottom="12">
          <WTSTATIC col="1"/>
          <WTBUTTON col="2" action="1" value="CONST(SendLogonPassword)"/>
          <WTBUTTON col="2" action="3" value="CONST(Cancel)">
            <WTCONDITION expr="PARAM(Popup)" oper="equal" value="CONST(0)"/>
          </WTBUTTON>
          <WTBUTTON col="2" value="CONST(Close)" align="center">
            <WTCONDITION expr="PARAM(Popup)" oper="not-equal" value="CONST(0)"/>
            <WTCLICK>window.close()</WTCLICK>
          </WTBUTTON>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================-->
    <WTWEBPAGE name="0105" type="mail" aspstyle="GenerateWebASPMail.xsl" xslstyle="GenerateWebXSLMail.xsl" langfile="0105">
      <!--==================================================================================================-->
      <WTPARAM name="MailReturnURL" datatype="text" url="true"/>
      <!--Required Parameter for Mail-->
      <WTPARAM name="AuthUserID" datatype="number"/>
      <WTPARAM name="CompanyID" datatype="number"/>

      <WTACTION id="0" name="New" type="New">
        <WTCUSTOM>
          If reqAuthUserID = 0 Then
          Response.Redirect reqMailReturnURL
          End If
        </WTCUSTOM>
        <!--
				<WTOBJECT name="Business" project="ptsBusinessUser" class="CBusiness">
					<WTMETHOD name="Load">
						<WTPARAM name="BusinessID" direction="input" value="CONST(1)"/>
						<WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
					</WTMETHOD>
					<WTMETHOD name="XML">
						<WTPARAM name="xmlBusiness" direction="return" datatype="text"/>
					</WTMETHOD>
					<WTSETATTRIBUTE name="CONST(tmpSender)" value="ATTR(Business.SystemEmail)"/>
					<WTSETATTRIBUTE name="CONST(tmpFrom)" value="ATTR(Business.SystemEmail)"/>
				</WTOBJECT>
-->
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="PARAM(AuthUserID)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="CONST(tmpTo)" value="ATTR(AuthUser.Email)"/>
          <WTSETATTRIBUTE name="CONST(tmpMemberID)" value="ATTR(AuthUser.MemberID)"/>
          <WTSETATTRIBUTE name="CONST(tmpLogon)" value="ATTR(AuthUser.Logon)"/>
        </WTOBJECT>
        <WTOBJECT name="Member" project="ptsMemberUser" class="CMember">
          <WTCONDITION expr="CONST(tmpMemberID)" oper="greater" value="CONST(0)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="MemberID" direction="input" value="CONST(tmpMemberID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(CompanyID)" value="ATTR(Member.CompanyID)"/>
          <WTSETATTRIBUTE name="CONST(tmpID)" value="ATTR(Member.MemberID)"/>
          <WTSETATTRIBUTE name="CONST(tmpFirstname)" value="ATTR(Member.NameFirst)"/>
          <WTSETATTRIBUTE name="CONST(tmpLastname)" value="ATTR(Member.NameLast)"/>
          <WTSETATTRIBUTE name="CONST(tmpEmail)" value="ATTR(Member.Email)"/>
          <WTSETATTRIBUTE name="CONST(tmpReference)" value="ATTR(Member.Reference)"/>
        </WTOBJECT>
        <WTOBJECT name="Company" project="ptsCompanyUser" class="CCompany">
          <WTMETHOD name="Load">
            <WTPARAM name="CompanyID" direction="input" value="PARAM(CompanyID)"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="CONST(tmpSubject)" value="ATTR(Company.CompanyName)"/>
          <WTSETATTRIBUTE name="CONST(tmpSender)" value="ATTR(Company.Email)"/>
          <WTSETATTRIBUTE name="CONST(tmpFrom)" value="ATTR(Company.Email)"/>
        </WTOBJECT>
        <WTOBJECT name="HTMLFile" project="wtHTMLFile" class="CHTMLFile">
          <WTCONDITION expr="CONST(tmpMemberID)" oper="greater" value="CONST(0)"/>
          <WTCONDITION expr="PARAM(CompanyID)" oper="greater" value="CONST(0)" connector="and"/>
          <WTSETATTRIBUTE name="ATTR(Filename)" value="CONST(&quot;newmember.htm&quot;)"/>
          <WTSETATTRIBUTE name="ATTR(Path)" value="CONST(reqSysWebDirectory + &quot;Sections\Company\&quot; &amp; CStr(reqCompanyID))"/>
          <WTSETATTRIBUTE name="ATTR(Language)" value="SYS(language)"/>
          <WTSETATTRIBUTE name="ATTR(Project)" value="CONST(SysProject)"/>
          <WTMETHOD name="Load"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlHTMLFile" direction="return" datatype="text"/>
          </WTMETHOD>
          <WTCUSTOM>
            xmlHTMLFile = Replace( xmlHTMLFile, "{lgn}", CleanXMLComment(tmpLogon) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{id}", CleanXMLComment(tmpID) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{firstname}", CleanXMLComment(tmpFirstname) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{lastname}", CleanXMLComment(tmpLastname) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{email}", CleanXMLComment(tmpEmail) )
            xmlHTMLFile = Replace( xmlHTMLFile, "{reference}", CleanXMLComment(tmpReference) )
          </WTCUSTOM>
        </WTOBJECT>
        <WTMAIL from="tmpFrom" to="tmpTo" subject="tmpSubject" sender="tmpSender"/>

      </WTACTION>

      <!--************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="650" align="left"/>

        <WTSTATIC label="21"/>
        <WTSTATIC label="22"/>
        <WTSTATIC label="23"/>
        <WTSTATIC label="31"/>
        <WTSTATIC label="41"/>
        <WTSTATIC label="51"/>
        <WTSTATIC label="52"/>
        <WTSTATIC label="61"/>

        <WTROW margin-top="12">
          <WTSTATIC col="1" label="Greeting" class="PageHeading"/>
          <WTSTATIC col="1" value="ATTR(AuthUser.AuthUserName)" class="PageHeading"/>
          <WTSTATIC col="1" value="CONST((&lt;xsl:value-of select=&quot;/DATA/LANGUAGE/LABEL[@name=/DATA/TXN/PTSAUTHUSER/@usergroup]&quot;/&gt;))">
            <WTCONDITION expr="ATTR(AuthUser.UserGroup)" oper="not-equal" value="CONST(41)"/>
          </WTSTATIC>
        </WTROW>
        <WTROW margin-top="24">
          <WTSTATIC col="1" label="LogonIssued" class="BoldText"/>
          <WTSTATIC col="1" value="ATTR(AuthUser.Logon)"/>
        </WTROW>
        <WTROW margin-top="12">
          <WTSTATIC col="1" label="PasswordIssued" class="BoldText"/>
          <WTSTATIC col="1" value="ATTR(AuthUser.Password)"/>
        </WTROW>

        <WTROW margin-top="12">
          <WTCONDITION expr="PARAM(CompanyID)" oper="greater" value="CONST(0)"/>
          <WTSTATIC col="1" value="ATTR(HTMLFile.Data)" embedhtml="true"/>
        </WTROW>

        <WTCODEGROUP>
          <WTCONDITION expr="PARAM(CompanyID)" oper="equal" value="CONST(0)"/>
          <WTROW margin-top="12">
            <WTSTATIC col="1" label="Closing1"/>
          </WTROW>
          <WTROW margin-top="12">
            <WTSTATIC col="1" label="Closing2"/>
          </WTROW>
          <WTROW margin-top="24">
            <WTSTATIC col="1" label="Footer"/>
          </WTROW>
          <WTROW margin-top="24">
            <WTSTATIC col="1" value="ATTR(Business.BusinessName)" class="PageHeading"/>
          </WTROW>
          <WTROW margin-top="12">
            <WTSTATIC col="1" value="ATTR(Business.SystemEmail)" class="BoldText"/>
          </WTROW>
          <WTROW margin-top="12">
            <WTSTATIC col="1" value="ATTR(Business.Phone)" class="BoldText"/>
          </WTROW>
          <!--
					<WTROW margin-top="12">
						<WTLINKGROUP col="1" class="BoldText">
							<WTLINK name="ATTR(Business.WebSite)" label="ATTR(Business.WebSite)" type="anchor"/>
						</WTLINKGROUP>
					</WTROW>
-->
        </WTCODEGROUP>

      </WTCONTENT>
    </WTWEBPAGE>

    <!--==================================================================================================-->
    <WTWEBPAGE name="0113" header="false" footer="false" navbar="false" wrapper="wrapper600"
				   aspstyle="GenerateWebASP.xsl" xslstyle="GenerateWebXSLItem.xsl" secured="125">
      <!--==================================================================================================-->
      <WTPARAM name="AuthUserID" datatype="number"/>
      <WTPARAM name="AuthyID" datatype="number"/>

      <WTSUB name="LoadAuthUser">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="PARAM(AuthUserID)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTE name="PARAM(AuthyID)" value="ATTR(UserType)"/>
          <WTMETHOD name="XML">
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>
      </WTSUB>

      <WTACTION id="0" name="New" type="New">
        <WTCALLSUB name="LoadAuthUser"/>
      </WTACTION>

      <WTACTION id="1" name="Update" type="Update">
        <WTOBJECT name="AuthUser" project="ptsAuthUser" class="CAuthUser">
          <WTSETATTRIBUTE name="ATTR(AuthUserID)" value="PARAM(AuthUserID)"/>
          <WTMETHOD name="Load">
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTSETATTRIBUTES/>
          <WTSETATTRIBUTE name="ATTR(UserType)" value="PARAM(AuthyID)"/>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Len(.Logon))" oper="less" value="CONST(6)"/>
            <WTERROR number="10101" message="Oops, Your Logon Name must be at least six characters/numbers long."/>
          </WTCODEGROUP>
          <WTCODEGROUP>
            <WTCONDITION expr="CONST(Len(.Password))" oper="less" value="CONST(6)"/>
            <WTERROR number="10102" message="Oops, Your Password must be at least six characters/numbers long."/>
          </WTCODEGROUP>
          <WTMETHOD name="UpdateLogonPassword">
            <WTCONDITION expr="NoErrors"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="UpdateUserType">
            <WTCONDITION expr="NoErrors"/>
            <WTPARAM name="SecurityToken" direction="input" value="SYS(userid)"/>
          </WTMETHOD>
          <WTMETHOD name="XML">
            <WTCONDITION expr="IsErrors"/>
            <WTPARAM name="xmlAuthUser" direction="return" datatype="text"/>
          </WTMETHOD>
        </WTOBJECT>

        <WTRETURN>
          <WTCONDITION expr="NoErrors"/>
        </WTRETURN>
      </WTACTION>

      <WTACTION id="3" name="Cancel" type="Cancel">
        <WTRETURN/>
      </WTACTION>

      <!--*******************************************************************************************-->
      <WTCONTENT>
        <WTCOLUMN width="160" align="right"/>
        <WTCOLUMN width="440" align="left"/>

        <WTROW>
          <WTTABLE col="1" merge="2">
            <WTCOLUMN width="450" align="left"/>
            <WTCOLUMN width="150" align="right"/>
            <WTROW>
              <WTSTATIC col="1" tag="AuthUser" value="ATTR(AuthUser.AuthUserName)" class="PageHeading" align="left"/>
              <WTSTATIC col="2" label="2StepVerification" bold="true">
                <WTLINK name="0107" target="2FA">
                  <WTPARAM name="AuthUserID" value="PARAM(AuthUserID)"/>
                  <WTPARAM name="Popup" value="CONST(1)"/>
                </WTLINK>
              </WTSTATIC>
            </WTROW>
          </WTTABLE>
        </WTROW>
        <WTROW margin-bottom="12">
          <WTDIVIDER col="1" merge="2" align="left" height="1" color="SYS(headerdivider)"/>
        </WTROW>

        <WTROW margin-bottom="6">
          <WTSTATIC col="1" tag="Logon"/>
          <WTTEXT col="2" value="ATTR(AuthUser.Logon)" size="20"/>
        </WTROW>
        <WTROW margin-bottom="6">
          <WTSTATIC col="1" tag="Password"/>
          <WTTEXT col="2" value="ATTR(AuthUser.Password)" size="20" secure="false"/>
        </WTROW>
        <WTROW>
          <WTSTATIC col="1" tag="UserType"/>
          <WTTEXT col="2" value="PARAM(AuthyID)" size="10"/>
        </WTROW>

        <WTROW margin-top="12" margin-bottom="12">
          <WTSTATIC col="1"/>
          <WTBUTTON col="2" action="1" value="CONST(Update)"/>
          <WTBUTTON col="2" action="3" value="CONST(Cancel)"/>
        </WTROW>

      </WTCONTENT>
    </WTWEBPAGE>


  </WTWEBPAGES>
</WTROOT>
