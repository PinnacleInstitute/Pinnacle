-- **************************************************
-- Calculate GCR Finances for the time period
-- **************************************************
DECLARE @StartDate datetime, @EndDate datetime, @NextDate datetime, @Revenue money, @Amount money, @COGS money,  @Comp money, @cnt int
--SET @StartDate = '1/1/16 00:00:00'
--SET @EndDate   = '1/4/16 00:00:00'
--SET @StartDate = '1/4/16 00:00:00'
--SET @EndDate   = '1/11/16 00:00:00'
--SET @StartDate = '1/11/16 00:00:00'
--SET @EndDate   = '1/18/16 00:00:00'
--SET @StartDate = '1/18/16 00:00:00'
--SET @EndDate   = '1/25/16 00:00:00'
--SET @StartDate = '1/25/16 00:00:00'
--SET @EndDate   = '2/1/16 00:00:00'
--SET @StartDate = '2/1/16 00:00:00'
--SET @EndDate   = '2/8/16 00:00:00'
--SET @StartDate = '2/8/16 00:00:00'
--SET @EndDate   = '2/15/16 00:00:00'
--SET @StartDate = '2/15/16 00:00:00'
--SET @EndDate   = '2/22/16 00:00:00'
--SET @StartDate = '2/22/16 00:00:00'
--SET @EndDate   = '2/29/16 00:00:00'
--SET @StartDate = '2/29/16 00:00:00'
--SET @EndDate   = '3/7/16 00:00:00'
--SET @StartDate = '3/7/16 00:00:00'
--SET @EndDate   = '3/14/16 00:00:00'
--SET @StartDate = '3/14/16 00:00:00'
--SET @EndDate   = '3/21/16 00:00:00'
--SET @StartDate = '3/21/16 00:00:00'
--SET @EndDate   = '3/28/16 00:00:00'
--SET @StartDate = '3/28/16 00:00:00'
--SET @EndDate   = '4/4/16 00:00:00'
--SET @StartDate = '4/4/16 00:00:00'
--SET @EndDate   = '4/11/16 00:00:00'
--SET @StartDate = '4/11/16 00:00:00'
--SET @EndDate   = '4/18/16 00:00:00'
--SET @StartDate = '4/18/16 00:00:00'
--SET @EndDate   = '4/25/16 00:00:00'
--SET @StartDate = '4/25/16 00:00:00'
--SET @EndDate   = '5/2/16 00:00:00'
--SET @StartDate = '5/2/16 00:00:00'
--SET @EndDate   = '5/9/16 00:00:00'
--SET @StartDate = '5/9/16 00:00:00'
--SET @EndDate   = '5/16/16 00:00:00'
--SET @StartDate = '5/16/16 00:00:00'
--SET @EndDate   = '5/23/16 00:00:00'
--SET @StartDate = '5/23/16 00:00:00'
--SET @EndDate   = '5/30/16 00:00:00'
--SET @StartDate = '5/30/16 00:00:00'
--SET @EndDate   = '6/6/16 00:00:00'
--SET @StartDate = '6/6/16 00:00:00'
--SET @EndDate   = '6/13/16 00:00:00'
--SET @StartDate = '6/13/16 00:00:00'
--SET @EndDate   = '6/20/16 00:00:00'
--SET @StartDate = '6/20/16 00:00:00'
--SET @EndDate   = '6/27/16 00:00:00'
--SET @StartDate = '6/27/16 00:00:00'
--SET @EndDate   = '7/4/16 00:00:00'
--SET @StartDate = '7/4/16 00:00:00'
--SET @EndDate   = '7/11/16 00:00:00'
--SET @StartDate = '7/11/16 00:00:00'
--SET @EndDate   = '7/18/16 00:00:00'
--SET @StartDate = '7/18/16 00:00:00'
--SET @EndDate   = '7/25/16 00:00:00'
--SET @StartDate = '7/25/16 00:00:00'
--SET @EndDate   = '8/1/16 00:00:00'
--SET @StartDate = '8/1/16 00:00:00'
--SET @EndDate   = '8/8/16 00:00:00'
--SET @StartDate = '8/8/16 00:00:00'
--SET @EndDate   = '8/15/16 00:00:00'
--SET @StartDate = '8/15/16 00:00:00'
--SET @EndDate   = '8/22/16 00:00:00'
--SET @StartDate = '8/22/16 00:00:00'
--SET @EndDate   = '8/29/16 00:00:00'
--SET @StartDate = '8/29/16 00:00:00'
--SET @EndDate   = '9/5/16 00:00:00'
--SET @StartDate = '9/5/16 00:00:00'
--SET @EndDate   = '9/12/16 00:00:00'
--SET @StartDate = '9/12/16 00:00:00'
--SET @EndDate   = '9/19/16 00:00:00'
--SET @StartDate = '9/19/16 00:00:00'
--SET @EndDate   = '9/26/16 00:00:00'
--SET @StartDate = '9/26/16 00:00:00'
--SET @EndDate   = '10/3/16 00:00:00'
--SET @StartDate = '10/3/16 00:00:00'
--SET @EndDate   = '10/10/16 00:00:00'
--SET @StartDate = '10/10/16 00:00:00'
--SET @EndDate   = '10/17/16 00:00:00'
--SET @StartDate = '10/17/16 00:00:00'
--SET @EndDate   = '10/24/16 00:00:00'
--SET @StartDate = '10/24/16 00:00:00'
--SET @EndDate   = '10/31/16 00:00:00'
--SET @StartDate = '10/31/16 00:00:00'
--SET @EndDate   = '11/7/16 00:00:00'
--SET @StartDate = '11/7/16 00:00:00'
--SET @EndDate   = '11/14/16 00:00:00'
--SET @StartDate = '11/14/16 00:00:00'
--SET @EndDate   = '11/21/16 00:00:00'
--SET @StartDate = '11/21/16 00:00:00'
--SET @EndDate   = '11/28/16 00:00:00'
--SET @StartDate = '11/28/16 00:00:00'
--SET @EndDate   = '12/5/16 00:00:00'
--SET @StartDate = '12/5/16 00:00:00'
--SET @EndDate   = '12/12/16 00:00:00'
--SET @StartDate = '12/12/16 00:00:00'
--SET @EndDate   = '12/19/16 00:00:00'
--SET @StartDate = '12/19/16 00:00:00'
--SET @EndDate   = '12/26/16 00:00:00'
--SET @StartDate = '12/26/16 00:00:00'
--SET @EndDate   = '1/2/17 00:00:00'

--SET @StartDate = '1/2/17 00:00:00'
--SET @EndDate   = '1/9/17 00:00:00'
--SET @StartDate = '1/9/17 00:00:00'
--SET @EndDate   = '1/16/17 00:00:00'
--SET @StartDate = '1/16/17 00:00:00'
--SET @EndDate   = '1/23/17 00:00:00'
--SET @StartDate = '1/23/17 00:00:00'
--SET @EndDate   = '1/30/17 00:00:00'
--SET @StartDate = '1/30/17 00:00:00'
--SET @EndDate   = '2/6/17 00:00:00'
--SET @StartDate = '2/6/17 00:00:00'
--SET @EndDate   = '2/13/17 00:00:00'
--SET @StartDate = '2/13/17 00:00:00'
--SET @EndDate   = '2/20/17 00:00:00'
--SET @StartDate = '2/20/17 00:00:00'
--SET @EndDate   = '2/27/17 00:00:00'
--SET @StartDate = '2/27/17 00:00:00'
--SET @EndDate   = '3/6/17 00:00:00'
--SET @StartDate = '3/6/17 00:00:00'
--SET @EndDate   = '3/13/17 00:00:00'
--SET @StartDate = '3/13/17 00:00:00'
--SET @EndDate   = '3/20/17 00:00:00'
--SET @StartDate = '3/20/17 00:00:00'
--SET @EndDate   = '3/27/17 00:00:00'
--SET @StartDate = '3/27/17 00:00:00'
--SET @EndDate   = '4/3/17 00:00:00'
--SET @StartDate = '4/3/17 00:00:00'
--SET @EndDate   = '4/10/17 00:00:00'
--SET @StartDate = '4/10/17 00:00:00'
--SET @EndDate   = '4/17/17 00:00:00'
--SET @StartDate = '4/17/17 00:00:00'
--SET @EndDate   = '4/24/17 00:00:00'
--SET @StartDate = '4/24/17 00:00:00'
--SET @EndDate   = '5/1/17 00:00:00'
--SET @StartDate = '5/1/17 00:00:00'
--SET @EndDate   = '5/8/17 00:00:00'
--SET @StartDate = '5/8/17 00:00:00'
--SET @EndDate   = '5/15/17 00:00:00'
--SET @StartDate = '5/15/17 00:00:00'
--SET @EndDate   = '5/22/17 00:00:00'
--SET @StartDate = '5/22/17 00:00:00'
--SET @EndDate   = '5/29/17 00:00:00'
--SET @StartDate = '5/29/17 00:00:00'
--SET @EndDate   = '6/5/17 00:00:00'

--SET @StartDate = '6/5/17 00:00:00'
--SET @EndDate   = '6/12/17 00:00:00'
SET @StartDate = '6/12/17 00:00:00'
SET @EndDate   = '6/19/17 00:00:00'
SET @StartDate = '6/19/17 00:00:00'
SET @EndDate   = '6/26/17 00:00:00'
SET @StartDate = '6/26/17 00:00:00'
SET @EndDate   = '7/3/17 00:00:00'
SET @StartDate = '7/3/17 00:00:00'
SET @EndDate   = '7/10/17 00:00:00'
SET @StartDate = '7/10/17 00:00:00'
SET @EndDate   = '7/17/17 00:00:00'
SET @StartDate = '7/17/17 00:00:00'
SET @EndDate   = '7/24/17 00:00:00'
SET @StartDate = '7/24/17 00:00:00'
SET @EndDate   = '7/31/17 00:00:00'
SET @StartDate = '7/31/17 00:00:00'
SET @EndDate   = '8/7/17 00:00:00'
SET @StartDate = '8/7/17 00:00:00'
SET @EndDate   = '8/14/17 00:00:00'
SET @StartDate = '8/14/17 00:00:00'
SET @EndDate   = '8/21/17 00:00:00'
SET @StartDate = '8/21/17 00:00:00'
SET @EndDate   = '8/28/17 00:00:00'
SET @StartDate = '8/28/17 00:00:00'
SET @EndDate   = '9/4/17 00:00:00'
SET @StartDate = '9/4/17 00:00:00'
SET @EndDate   = '9/11/17 00:00:00'
SET @StartDate = '9/11/17 00:00:00'
SET @EndDate   = '9/18/17 00:00:00'
SET @StartDate = '9/18/17 00:00:00'
SET @EndDate   = '9/25/17 00:00:00'
SET @StartDate = '9/25/17 00:00:00'
SET @EndDate   = '10/2/17 00:00:00'
SET @StartDate = '10/2/17 00:00:00'
SET @EndDate   = '10/9/17 00:00:00'
SET @StartDate = '10/9/17 00:00:00'
SET @EndDate   = '10/16/17 00:00:00'
SET @StartDate = '10/16/17 00:00:00'
SET @EndDate   = '10/23/17 00:00:00'
SET @StartDate = '10/23/17 00:00:00'
SET @EndDate   = '10/30/17 00:00:00'

SET @NextDate = DATEADD(d,1,@EndDate)
SET @NextDate = @EndDate

PRINT 'Nexxus Finances:  ' + CAST(@StartDate AS varchar(20)) + ' up to ' + CAST(@EndDate AS varchar(20))
PRINT '------------------'
SELECT @Amount = SUM(Amount) FROM Payment WHERE companyid = 21 AND PaidDate >= @StartDate AND PaidDate < @EndDate AND Status = 3 AND PayType IN (1,2) 
PRINT 'CC:      ' + CAST(ISNULL(@Amount,0) AS VARCHAR(10))
SELECT @Amount = SUM(Amount) FROM Payment WHERE companyid = 21 AND PaidDate >= @StartDate AND PaidDate < @EndDate AND Status = 3 AND PayType = 10
PRINT 'Wallet:  ' + CAST(ISNULL(@Amount,0) AS VARCHAR(10))
SELECT @Amount = SUM(Amount) FROM Payment WHERE companyid = 21 AND PaidDate >= @StartDate AND PaidDate < @EndDate AND Status = 3 AND PayType = 90
PRINT 'Comm:    ' + CAST(ISNULL(@Amount,0) AS VARCHAR(10))
SELECT @Amount = SUM(Amount) FROM Payment WHERE companyid = 21 AND PaidDate >= @StartDate AND PaidDate < @EndDate AND Status = 3 AND PayType IN (7,14,21,22) AND Purpose != '999'
PRINT 'Cash:    ' + CAST(ISNULL(@Amount,0) AS VARCHAR(10))
SELECT @Amount = SUM(Amount) FROM Payment WHERE companyid = 21 AND PaidDate >= @StartDate AND PaidDate < @EndDate AND Status = 3 AND PayType IN (7,14,21,22) AND Purpose = '999'
PRINT 'Founder: ' + CAST(ISNULL(@Amount,0) AS VARCHAR(10))
SELECT @Amount = SUM(Amount) FROM Payment WHERE companyid = 21 AND PaidDate >= @StartDate AND PaidDate < @EndDate AND Status = 3 AND Reference LIKE '%Comp%'
PRINT 'Comp:    ' + CAST(ISNULL(@Amount,0) AS VARCHAR(10))
PRINT '------------------'
SELECT @Revenue = SUM(Amount) FROM Payment WHERE companyid = 21 AND PaidDate >= @StartDate AND PaidDate < @EndDate AND PayType != 91 AND Reference NOT LIKE '%Comp%' AND Status = 3
--SELECT * FROM Payment WHERE companyid = 21 AND PaidDate >= @StartDate AND PaidDate < @EndDate AND PayType != 91 AND Reference NOT LIKE '%Comp%' AND Status = 3 and Amount = 2000
PRINT 'Revenue: ' + CAST(ISNULL(@Revenue,0) AS VARCHAR(10))
PRINT '------------------'
SELECT @Amount = SUM(Amount) FROM Commission WHERE companyid = 21 AND CommDate >= @StartDate AND CommDate < @NextDate
IF @Revenue IS NULL
	PRINT 'COS:     ' + CAST(ISNULL(@Amount,0) AS VARCHAR(10))
ELSE	
	PRINT 'COS:     ' + CAST(ISNULL(@Amount,0) AS VARCHAR(10)) + ' - ' + CAST((@Amount/ISNULL(@Revenue,1))*100 AS VARCHAR(10)) + '%)'


--SELECT * FROM Payment WHERE companyid = 21 AND PaidDate >= @StartDate AND PaidDate < @EndDate AND Status = 3

--SELECT * FROM Payment WHERE companyid = 21 AND Status = 3 AND PayType = 14


--select * from Payment where Amount = 2000
