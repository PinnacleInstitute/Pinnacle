EXEC [dbo].pts_CheckProc 'pts_GFTG_ValidPayment'
GO

-- EXEC pts_GFTG_ValidPayment 17849

CREATE PROCEDURE [dbo].pts_GFTG_ValidPayment
   @PaymentID int 
AS

SET NOCOUNT ON

DECLARE @Amount money, @Purpose varchar(100), @Purpose2 varchar(100) 

SELECT @Amount = Amount, @Purpose = Purpose FROM Payment WHERE PaymentID = @PaymentID
SET @Purpose2 = @Purpose

-- If Silver Pak, remove if not enough money (autoship)
IF CHARINDEX('101', @Purpose) > 0
BEGIN
	IF @Amount < 199 SET @Purpose2 = REPLACE(@Purpose2, '101', '')
END	

-- If Gold Pak, remove if not enough money (autoship)
IF CHARINDEX('102', @Purpose) > 0
BEGIN
	IF @Amount < 249 SET @Purpose2 = REPLACE(@Purpose2, '102', '')
END	

-- If Platinum Pak, remove if not enough money (autoship)
IF CHARINDEX('103', @Purpose) > 0
BEGIN
	IF @Amount < 349 SET @Purpose2 = REPLACE(@Purpose2, '103', '')
END	

-- If Monthly Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('104', @Purpose) > 0
BEGIN
	IF @Amount > 60 SET @Purpose2 = REPLACE(@Purpose2, '104', '')
END	

-- If Monthly Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('105', @Purpose) > 0
BEGIN
	IF @Amount > 60 SET @Purpose2 = REPLACE(@Purpose2, '105', '')
END	

-- If Monthly Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('106', @Purpose) > 0
BEGIN
	IF @Amount > 60 SET @Purpose2 = REPLACE(@Purpose2, '106', '')
END	

-- If Monthly Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('107', @Purpose) > 0
BEGIN
	IF @Amount > 60 SET @Purpose2 = REPLACE(@Purpose2, '107', '')
END	

-- If Monthly Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('108', @Purpose) > 0
BEGIN
	IF @Amount > 60 SET @Purpose2 = REPLACE(@Purpose2, '108', '')
END	

-- If Monthly Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('109', @Purpose) > 0
BEGIN
	IF @Amount > 60 SET @Purpose2 = REPLACE(@Purpose2, '109', '')
END	

-- If Monthly Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('111', @Purpose) > 0
BEGIN
	IF @Amount > 80 SET @Purpose2 = REPLACE(@Purpose2, '111', '')
END	


-- If 2 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('224', @Purpose) > 0
BEGIN
	IF @Amount > 110 SET @Purpose2 = REPLACE(@Purpose2, '224', '')
END	

-- If 2 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('225', @Purpose) > 0
BEGIN
	IF @Amount > 110 SET @Purpose2 = REPLACE(@Purpose2, '225', '')
END	

-- If 2 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('226', @Purpose) > 0
BEGIN
	IF @Amount > 110 SET @Purpose2 = REPLACE(@Purpose2, '226', '')
END	

-- If 2 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('227', @Purpose) > 0
BEGIN
	IF @Amount > 110 SET @Purpose2 = REPLACE(@Purpose2, '227', '')
END	

-- If 2 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('228', @Purpose) > 0
BEGIN
	IF @Amount > 110 SET @Purpose2 = REPLACE(@Purpose2, '228', '')
END	

-- If 2 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('229', @Purpose) > 0
BEGIN
	IF @Amount > 110 SET @Purpose2 = REPLACE(@Purpose2, '229', '')
END	

-- If 2 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('221', @Purpose) > 0
BEGIN
	IF @Amount > 150 SET @Purpose2 = REPLACE(@Purpose2, '221', '')
END	


-- If 3 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('334', @Purpose) > 0
BEGIN
	IF @Amount > 160 SET @Purpose2 = REPLACE(@Purpose2, '334', '')
END	

-- If 3 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('335', @Purpose) > 0
BEGIN
	IF @Amount > 160 SET @Purpose2 = REPLACE(@Purpose2, '335', '')
END	

-- If 3 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('336', @Purpose) > 0
BEGIN
	IF @Amount > 160 SET @Purpose2 = REPLACE(@Purpose2, '336', '')
END	

-- If 3 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('337', @Purpose) > 0
BEGIN
	IF @Amount > 160 SET @Purpose2 = REPLACE(@Purpose2, '337', '')
END	

-- If 3 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('338', @Purpose) > 0
BEGIN
	IF @Amount > 160 SET @Purpose2 = REPLACE(@Purpose2, '338', '')
END	

-- If 3 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('339', @Purpose) > 0
BEGIN
	IF @Amount > 160 SET @Purpose2 = REPLACE(@Purpose2, '339', '')
END	

-- If 3 Month Affiliate Autoship, remove if money is for starter pack
IF CHARINDEX('331', @Purpose) > 0
BEGIN
	IF @Amount > 211 SET @Purpose2 = REPLACE(@Purpose2, '331', '')
END	


-- If Upgrade Afffiliate-Silver, remove if not enough money (autoship)
IF CHARINDEX('121', @Purpose) > 0
BEGIN
	IF @Amount < 179 SET @Purpose2 = REPLACE(@Purpose2, '121', '')
END	

-- If Upgrade Afffiliate-Gold, remove if not enough money (autoship)
IF CHARINDEX('122', @Purpose) > 0
BEGIN
	IF @Amount < 229 SET @Purpose2 = REPLACE(@Purpose2, '122', '')
END	

-- If Upgrade Afffiliate-Platinum, remove if not enough money (autoship)
IF CHARINDEX('123', @Purpose) > 0
BEGIN
	IF @Amount < 329 SET @Purpose2 = REPLACE(@Purpose2, '123', '')
END	

-- If Upgrade Silver-Gold, remove if not enough money (autoship)
IF CHARINDEX('124', @Purpose) > 0
BEGIN
	IF @Amount < 70 SET @Purpose2 = REPLACE(@Purpose2, '124', '')
END	

-- If Upgrade Silver-Platinum, remove if not enough money (autoship)
IF CHARINDEX('125', @Purpose) > 0
BEGIN
	IF @Amount < 170 SET @Purpose2 = REPLACE(@Purpose2, '125', '')
END	

-- If Upgrade Gold-Platinum, remove if not enough money (autoship)
IF CHARINDEX('126', @Purpose) > 0
BEGIN
	IF @Amount < 120 SET @Purpose2 = REPLACE(@Purpose2, '126', '')
END	


IF @Purpose <> @Purpose2
BEGIN
	UPDATE Payment SET Purpose = @Purpose2 WHERE PaymentID = @PaymentID
END

GO 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        